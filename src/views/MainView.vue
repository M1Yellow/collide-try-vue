<style scoped>
/*********************** ä¸»åº”ç”¨æ ·å¼ start ***********************/
/* canvas å›¾å±‚æ ·å¼ */
#container {
    position: relative;
    height: 100vh;
}

canvas {
    position: absolute;
    left: 0;
    top: 0;
    display: none;
}

#game-scene-graph {
    z-index: -1;
}

#game-scene-emoji {
    z-index: -1;
}

#game-scene-lines-bg {
    z-index: -1;
}

#game-scene {
    background: rgba(255, 255, 255, 0);
    /*å›¾å±‚é€æ˜ï¼Œç»™ç”»çš„å›¾å½¢å¡«å……é¢œè‰²*/
    z-index: -1;
}

#game-scene-lines {
    z-index: 0;
}

#game-scene-coordinate {
    z-index: 0;
}

#game-main {
    z-index: 1;
}

#game-main-ball {
    z-index: 2;
    pointer-events: none;
    /* å¯ä»¥ç‚¹å‡»ç©¿é€ */
}

#game-path {
    z-index: 1;
    pointer-events: none;
    /* å¯ä»¥ç‚¹å‡»ç©¿é€ */
}

#game-path-ball {
    z-index: 1;
    pointer-events: none;
    /* å¯ä»¥ç‚¹å‡»ç©¿é€ */
}

#game-click-play {
    z-index: 10;
    /* åœ¨è§’è‰²å’Œè¿åŠ¨å±‚ä¹‹ä¸Š */
}

#game-mask {
    z-index: -2;
}

/* é®ç½©å›¾å±‚æ ·å¼ */
#dialog-mask {
    position: absolute;
    left: 0;
    top: 0;
    z-index: 1000;
    background-color: rgba(0, 0, 0, 0.5);
    width: 100vw;
    height: 100vh;
    display: none;
}

/* åº”ç”¨å…¨å±€å…¬ç”¨æ ·å¼ */
.collide-try-btn {
    width: 40px;
    text-align: center;
    vertical-align: middle;
    line-height: 1;
    border-radius: 3px;
    cursor: pointer;
}

.collide-try-in-one-line {
    display: flex;
    flex-wrap: nowrap;
    flex-direction: row;
    align-content: center;
    justify-content: center;
    align-items: stretch;
}

.collide-try-each-item-border-bottom {
    width: 100%;
    display: inline-block;
    border-bottom: 1px solid #ddd;
    text-align: left;
}

.collide-try-each-item-margin {
    display: inline-block;
    margin: 3px 0 3px 0;
}

/* å¸¦ä¸€ä¸ªå…³é—­æŒ‰é’®çš„å±…ä¸­åä¸Šå¼¹çª— */
.collide-try-close-btn-dialog {
    position: absolute;
    left: 0;
    top: -20vh;
    right: 0;
    bottom: 0;
    margin: auto;
    z-index: 10010;
    width: 80%;
    height: max-content;
    border-radius: 10px;
    text-align: center;
    display: none;
}

.collide-try-close-btn-dialog-title {
    border-radius: 10px 10px 0 0;
    background: #edeff6;
    display: flex;
    flex-direction: row;
    align-items: baseline;
    flex-wrap: nowrap;
    justify-content: flex-start;
}

.collide-try-close-btn-dialog-title-close {
    position: absolute;
    width: 100%;
    font-size: 18px;
    top: 6px;
    left: -6px;
    text-align: right;
}

.collide-try-close-btn-dialog-title-close span {
    font-size: 16px;
    cursor: pointer;
}

.collide-try-close-btn-dialog-title b {
    font-size: 18px;
    text-align: left;
    line-height: 2.4;
    padding-left: 10px;
    vertical-align: middle;
}

.collide-try-close-btn-dialog-content {
    background-color: #f7f7fc;
    max-height: 40.0vh;
    /* å†…å®¹è¶…å‡ºåŒºåŸŸï¼Œéœ€è¦è®¾ç½®é«˜åº¦ï¼Œæ‰èƒ½æ»šåŠ¨ */
    /* éšè— IEã€Edge å’Œ Firefox çš„æ»šåŠ¨æ¡ */
    -ms-overflow-style: none;
    /* IE and Edge */
    scrollbar-width: none;
    /* Firefox */
    overflow-x: hidden;
    overflow-y: scroll;
    font-size: 14px;
    margin-top: -2px;
    /* è§£å†³æ ‡é¢˜è¾¹æ¡†é€æ˜é—®é¢˜ */
    padding: 10px 10px 25px 10px;
    border-radius: 0 0 10px 10px;
}

.collide-try-close-btn-dialog-content pre {
    width: 100%;
    text-align: left;
    font-size: 14px;
    line-height: 1.6;
    white-space: pre-line;
}

.collide-try-close-btn-dialog-content pre a {
    font-size: 10px;
}

.collide-try-close-btn-dialog-ok {
    text-align: right;
    margin-top: -11px;
    margin-right: 20px;
}

.collide-try-close-btn-dialog-ok span {
    text-align: center;
    vertical-align: middle;
    width: max-content;
    padding: 6px;
    font-size: 14px;
    background: chartreuse;
    border-radius: 5px;
    border: 1px black;
    box-shadow: rgba(0, 0, 0, 0.16) 0px 10px 36px 0px, rgba(0, 0, 0, 0.06) 0px 0px 0px 1px;
    cursor: pointer;
}

/* å°æç¤ºå¼¹çª—æ ·å¼ï¼Œé‡å†™æ ·å¼éœ€è¦æ”¾åœ¨è¿™ä¸ªæ ·å¼åé¢ */
.collide-try-tiny-dialog {
    position: absolute;
    top: 5px;
    right: 40px;
    margin: auto;
    z-index: 0;
    text-align: center;
    font-size: 16px;
    display: none;
}

.collide-try-left-tiny-dialog {
    left: 40px;
    right: unset;
}

.collide-try-tiny-dialog-msg {
    text-align: right;
    vertical-align: middle;
    padding: 0 5px 5px 5px;
    font-size: 16px;
    background: #fff;
    border-radius: 5px;
    border: 1px dashed black;
    box-shadow: rgba(0, 0, 0, 0.16) 0px 10px 36px 0px, rgba(0, 0, 0, 0.06) 0px 0px 0px 1px;
}

.collide-try-tiny-dialog-msg span {
    font-size: 20px;
}

.collide-try-tiny-dialog-ok {
    text-align: right;
    vertical-align: middle;
    width: 100%;
    margin: 5px 0;
    font-size: 14px;
}

.collide-try-left-tiny-dialog-ok {
    text-align: left;
}

.collide-try-tiny-dialog-ok span {
    text-align: center;
    vertical-align: middle;
    width: max-content;
    margin-top: 5px;
    padding: 5px;
    font-size: 14px;
    background: chartreuse;
    border-radius: 5px;
    border: 1px black;
    box-shadow: rgba(0, 0, 0, 0.16) 0px 10px 36px 0px, rgba(0, 0, 0, 0.06) 0px 0px 0px 1px;
    cursor: pointer;
}


/* å·¦ä¸Šè§’é‡é€‰è§’è‰²æç¤ºå¼¹çª—æ ·å¼ */
#re-choose-role-icon {
    position: absolute;
    left: 10px;
    top: 10px;
    z-index: 0;
}

#re-choose-role-icon>span {
    padding: 2px;
    font-size: 16px;
    text-align: center;
    vertical-align: middle;
    cursor: pointer;
}

/* å³ä¸Šè§’è®¾ç½®æç¤ºå¼¹çª—æ ·å¼ */
#game-setting-icon {
    position: absolute;
    right: 10px;
    top: 10px;
    z-index: 0;
}

#game-setting-icon>span {
    padding: 2px;
    font-size: 16px;
    text-align: center;
    vertical-align: middle;
    cursor: pointer;
}

/* è®¾ç½®ä¸»è§’æ—¶æç¤ºå¼¹çª—æ ·å¼ */
/* çˆ¶å…ƒç´ è®¾ç½® position ä¸º relativeï¼Œè‡ªèº«è®¾ç½®ä¸º absoluteï¼Œå³å¯è·Ÿéšå®šä½ */
.user-setting-item-input-area {
    position: relative;
}

#game-setting-main-role-dialog {
    top: 25px;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 1003;
}

#game-setting-main-role-dialog-msg {
    text-align: left;
    padding: 5px;
    font-size: 14px;
}

#game-setting-main-role-dialog-msg span {
    font-size: 16px;
}

#game-setting-main-role-dialog-ok {}

#game-setting-main-role-dialog-ok span {}

/* TODO åç»­å†å°è£…ä¸€ä¸ªå…¨å±€å¼¹çª—ï¼Œå¤šå¤„è°ƒç”¨åŒä¸€ä¸ªï¼Œå‡å°‘é‡å¤ä»£ç  */
/* é€‰æ‹©è§’è‰²å¼¹çª—æ ·å¼ */
#choose-role-dialog {
    position: absolute;
    left: 0;
    top: 0;
    right: 0;
    bottom: 0;
    margin: auto;
    z-index: 1001;
    width: 80%;
    height: max-content;
    border-radius: 10px;
    background-color: #f7f7fc;
    text-align: center;
    display: none;
    overflow: hidden;
}

#role-list-area {
    max-height: 80.0vh;
    -ms-overflow-style: none;
    scrollbar-width: none;
    overflow-x: hidden;
    overflow-y: scroll;
}

#role-list-head {
    border-radius: 10px 10px 0 0;
    background: #edeff6;
    text-align: center;
    vertical-align: middle;
}

#role-list-head-msg {
    padding: 12px 0;
    font-size: 24px;
    line-height: 24px;
}

#role-list-head-desc {
    padding: 0 0 5px 0;
    font-size: 10px;
}

#role-list-head-setting-icon {
    position: absolute;
    width: 100%;
    font-size: 24px;
    line-height: 24px;
    top: 7px;
    right: 7px;
    text-align: right;
    display: inline-flex;
    flex-direction: row;
    align-content: center;
    justify-content: flex-end;
    align-items: center;
}

#role-list-head-setting-icon span {
    font-size: 18px;
    cursor: pointer;
}

.role-list {
    padding: 10px 0 10px 0;
    font-size: 20px;
    cursor: pointer;
}

.role-list:not(:last-child) {
    border-bottom: 1px solid #ddd;
}

.role-list:last-child {
    border-radius: 0 0 10px 10px;
}

.role-list:hover {
    background-color: #FAFAFA;
}

/* é€‰æ‹©è§’è‰²åˆ—è¡¨iconã€nameè¡¨æ ¼æ ·å¼ */
.role-list-icon-name {
    display: inline-grid;
    grid-template-columns: 50px 180px;
    grid-template-rows: 100%;
    align-content: center;
    justify-content: center;
    align-items: baseline;
    justify-items: stretch;
    /*padding-left: 10px;*/
}

.role-list-icon-name span {
    font-size: 20px;
}

.role-list-icon {
    text-align: right;
    vertical-align: middle;
}

.role-list-name {
    text-align: left;
    margin-left: 10px;
}

/* é€‰æ‹©è§’è‰²åŒå­å›¾æ ‡é‡ç”» */
#role-shuangzi span {
    font-size: 20px;
}

#role-shuangzi-new-draw {
    display: inline-grid;
}

.role-shuangzi-single {
    grid-area: 1 / 2;
}

#role-shuangzi-1 {
    margin-right: 4px;
    z-index: 1002;
}

#role-shuangzi-2 {
    margin-right: -4px;
    margin-top: -2px;
    z-index: 1001;
}

/* ç”¨æˆ·è®¾ç½®å¼¹çª—æ ·å¼ */
#user-setting-dialog {
    overflow: hidden;
    position: absolute;
    left: 0;
    top: 0;
    right: 0;
    bottom: 0;
    margin: auto;
    z-index: 1002;
    width: 80%;
    height: max-content;
    border-radius: 10px;
    background-color: #f7f7fc;
    text-align: center;
    display: none;
}

#user-setting-area {
    max-height: 80.0vh;
    /* å†…å®¹è¶…å‡ºåŒºåŸŸï¼Œéœ€è¦è®¾ç½®é«˜åº¦ï¼Œæ‰èƒ½æ»šåŠ¨ */
    /* éšè— IEã€Edge å’Œ Firefox çš„æ»šåŠ¨æ¡ */
    -ms-overflow-style: none;
    /* IE and Edge */
    scrollbar-width: none;
    /* Firefox */
    overflow-x: hidden;
    overflow-y: scroll;
}

/* éšè— Chromeã€Safari å’Œ Opera çš„æ»šåŠ¨æ¡ */
#user-setting-area::-webkit-scrollbar {
    display: none;
}

#user-setting-head {
    border-radius: 10px 10px 0 0;
    background: #edeff6;
    text-align: center;
    vertical-align: middle;
}

#user-setting-head-msg {
    padding: 12px 0;
    font-size: 24px;
    line-height: 24px;
}

#user-setting-head-desc {
    padding: 0 0 5px 0;
    font-size: 10px;
}

#user-setting-close-icon {
    position: absolute;
    width: 100%;
    font-size: 24px;
    line-height: 24px;
    top: 7px;
    right: 7px;
    text-align: right;
    display: inline-flex;
    flex-direction: row;
    align-content: center;
    justify-content: flex-end;
    align-items: center;
}

#user-setting-close-icon span {
    font-size: 18px;
    cursor: pointer;
}

.user-setting-item {
    padding: 9px 10px;
    font-size: 18px;
    line-height: 18px;
    text-align: left;
}

.li-space-between-center {
    display: flex;
    flex-direction: row;
    align-content: center;
    justify-content: space-between;
    align-items: center;
}

#page-color-image {
    padding: 8.2px 10px;
}

.user-setting-item-msg-left {
    font-size: 16px;
}

.user-setting-item-switch-right button {
    font-size: 12px;
}

.custom-theme-conf-inout {
    line-height: 18px;
    width: 30px;
    margin-left: 7px;
}

.user-setting-item:not(:last-child) {
    border-bottom: 1px solid #ddd;
}

.user-setting-item:last-child {
    border-radius: 0 0 10px 10px;
}

.user-setting-item:hover {
    background-color: #FAFAFA;
}

.user-setting-item-msg-left {
    position: relative;
    text-align: left;
}

.user-setting-item-switch-right {
    position: relative;
    float: right;
    /*top: 4px;*/
    vertical-align: middle;
    display: flex;
}

.user-setting-item-input-area {
    margin: 4px 0px;
}

.user-setting-item-input-area input {
    width: 100%;
    vertical-align: middle;
    border: none;
    padding: 2px 2px;
    font-size: 12px;
    color: #2196F3;
    background-color: transparent;
    outline: none;
    -webkit-appearance: none;
}

.user-setting-item-right-input-area {
    margin: 0;
}

.user-setting-item-right-input-area input {
    width: 100px;
    text-align: right;
    padding: 0;
}

.user-setting-item-right-input-area label {
    font-size: 16px;
    margin-left: 2px;
    cursor: pointer;
}

.user-setting-item-right-input-area svg {
    width: 18px;
    height: 18px;
    vertical-align: sub;
    transform: rotate(90deg);
    fill: #2196F3;
}

.user-setting-item-right-input-color-code {
    width: 80px !important;
}

.user-setting-item-right-input-number-m {
    width: 50px !important;
}

.div-input-game-roles {
    display: inline-block;
    min-width: 25px;
    max-width: 100px;
    vertical-align: middle;
    border: 1px solid transparent;
    border-color: #2196F3;
    border-radius: 4px;
    padding: 2px 4px;
    margin-right: 3px;
    font-size: 12px;
    color: #2196F3;
    background-color: transparent;
    outline: none;
    -webkit-appearance: none;
}

.div-input-game-roles.red {
    color: red;
    border-color: red;
}

.div-input-game-roles.default {}

.reset-btn {
    /*
        vertical-align: middle;
        margin-left: 4px;
        */
    font-size: 15px;
    cursor: pointer;
}

/* å¯¼å…¥/å¯¼å‡ºè§’è‰²å’Œåæ ‡ */
#shareRoleAndPos {}

.bg-lv1 {
    background-color: #16C60C;
    color: #fff;
}

.bg-lv2 {
    background-color: #2196F3;
    color: #fff;
}

/* ç”¨æˆ·è®¾ç½®-äºŒçº§åˆ—è¡¨ */
.user-setting-item-expand {
    background-color: #EDF2FA;
    display: none;
}

.user-setting-item-expand .user-setting-item-msg-left {
    font-size: 14px;
}

.user-setting-item-disabled {
    color: #999 !important;
}


/* å…³äºåº”ç”¨å¼¹çª—æ ·å¼ */
#user-setting-about-app-dialog {
    position: absolute;
    left: 0;
    top: 0;
    right: 0;
    bottom: 0;
    margin: auto;
    z-index: 1003;
    width: 80%;
    height: max-content;
    border-radius: 10px;
    background-color: #f7f7fc;
    text-align: center;
    display: none;
}

#user-setting-about-app-close-icon {
    position: absolute;
    width: 100%;
    border-radius: 10px 10px 0 0;
    font-size: 18px;
    top: 6px;
    left: -6px;
    text-align: right;
}

#user-setting-about-app-close-icon span {
    font-size: 18px;
    cursor: pointer;
}

#user-setting-about-app-content {
    max-height: 80.0vh;
    /* å†…å®¹è¶…å‡ºåŒºåŸŸï¼Œéœ€è¦è®¾ç½®é«˜åº¦ï¼Œæ‰èƒ½æ»šåŠ¨ */
    /* éšè— IEã€Edge å’Œ Firefox çš„æ»šåŠ¨æ¡ */
    -ms-overflow-style: none;
    /* IE and Edge */
    scrollbar-width: none;
    /* Firefox */
    overflow-x: hidden;
    overflow-y: scroll;
    font-size: 14px;
    padding: 10px;
}

#user-setting-about-app-content pre {
    width: 100%;
    text-align: left;
    font-size: 12px;
    line-height: 1.5;
    white-space: pre-line;
}

#user-setting-about-app-content pre b {
    /*line-height: 2;*/
}

#user-setting-about-app-content pre a {
    font-size: 10px;
}

#user-setting-about-app-title {}

#about-app-title {
    font-size: 18px;
    text-align: left;
    line-height: 2.4;
    padding-left: 10px;
    vertical-align: middle;
}

#about-app-title svg {
    width: 25px;
    height: 20px;
    vertical-align: sub;
    padding-right: 5px;
}

.collide-try-goodbye {
    display: none;
}

#collide-try-bye {
    margin-top: 886px;
}

#collide-try-bye span {
    line-height: 1.5;
}

#see-you-next-time {
    font-size: 16px;
    font-weight: bold;
    /*color: mediumblue;*/
}

.collide-try-update-title {
    display: inline-block;
    vertical-align: bottom;
    width: 100%;
    margin-bottom: 2px;
}

.collide-try-update-title b {
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    align-content: flex-end;
    justify-content: space-between;
    align-items: flex-end;
}

.collide-try-update-date {
    font-weight: normal;
    font-size: 9px;
    color: #999;
}

.collide-try-author-declare {}

.collide-try-author-declare-title {
    font-size: 14px;
}

.collide-try-author-declare-content {
    display: grid;
    background: #edeff6;
    border: 1px solid black;
    margin-top: 6px;
    padding-bottom: 6px;
}

.collide-try-author-declare-content li {
    display: inline-block;
    margin: 6px 0 0 0;
    padding: 0 5px 0 5px;
}

/* è§’è‰²åæ ‡æ‚¬æµ®æ¡æ ·å¼ */
#collide-try-role-pos-line {
    position: absolute;
    left: 0;
    top: 0;
    margin: auto;
    z-index: 1;
    background-color: #fff;
    border-radius: 5px;
    width: max-content;
    height: max-content;
    text-align: center;
    vertical-align: middle;
    padding: 2px 0px 2px 4px;
    box-shadow: rgba(0, 0, 0, 0.16) 0px 10px 36px 0px, rgba(0, 0, 0, 0.06) 0px 0px 0px 1px;
    display: none;
}

.div-input-role-pos {
    display: inline-block;
    text-align: left;
    line-height: 1;
    padding: 2px 4px;
    background-color: transparent;
    outline: none;
    -webkit-appearance: none;
}

/* é¢œè‰²æ ·å¼ */
.red {
    color: red !important;
}

/* SVG å›¾å½¢åŒºåŸŸ */
.svg-image-area .bi {
    display: none;
}

/************************ ä¸»åº”ç”¨æ ·å¼ end ************************/


/********************** ç¬¬ä¸‰æ–¹ç»„ä»¶æ ·å¼ start *********************/
/* CSS å¼€å…³æ ·å¼ */
/* https://c.runoob.com/codedemo/3146/ */
.switch {
    position: relative;
    display: inline-block;
    width: 40px;
    height: 18px;
}

.switch input {
    display: none;
}

.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    -webkit-transition: .1s;
    transition: .1s;
}

.slider:before {
    position: absolute;
    content: "";
    height: 14px;
    width: 14px;
    left: 3px;
    bottom: 2px;
    background-color: white;
    -webkit-transition: .1s;
    transition: .1s;
}

input:checked+.slider {
    background-color: #2196F3;
}

input:focus+.slider {
    box-shadow: 0 0 1px #2196F3;
}

input:checked+.slider:before {
    -webkit-transform: translateX(20px);
    -ms-transform: translateX(20px);
    transform: translateX(20px);
}

/* Rounded sliders */
.slider.round {
    border-radius: 34px;
}

.slider.round:before {
    border-radius: 50%;
}


/* CSS ä¸‹æ‹‰èœå• */
/* https://c.runoob.com/codedemo/161/ */
.dropbtn {
    color: #2196F3;
    border: none;
    cursor: pointer;
    background: unset;
}

.dropdown {
    position: relative;
    display: inline-block;
}

.dropdown-content {
    display: none;
    position: absolute;
    background-color: #f9f9f9;
    width: max-content;
    box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
    z-index: 2;
}

.dropdown-content a {
    color: black;
    padding: 5px 5px 5px 5px;
    text-decoration: none;
    display: block;
}

.dropdown-content a:hover {
    background-color: #f1f1f1
}

.dropdown:hover .dropdown-content {
    display: block;
}

.dropdown:hover .dropbtn {
    background-color: #3e8e41;
}

.show {
    display: block;
}


/* console.log æ—¥å¿—åŒºåŸŸ */
/* https://blog.csdn.net/ChenX_Web/article/details/99721636 */
#info {
    position: fixed;
    left: 0;
    top: 0;
    width: 100vw;
    height: 60vh;
    background: #fff;
    overflow: scroll;
    font-size: 10px;
    z-index: 999999999;
    -webkit-tap-highlight-color: transparent;
    /* éšè— IEã€Edge å’Œ Firefox çš„æ»šåŠ¨æ¡ */
    -ms-overflow-style: none;
    /* IE and Edge */
    scrollbar-width: none;
    /* Firefox */
}

#info h1 {
    color: #000;
    word-wrap: break-word;
    word-break: normal;
    border-bottom: 1px solid #D3E3FD;
    padding: 2px;
    font-size: 8px;
}

#info h1:nth-child(odd) {
    background-color: #fff;
}

/********************** ç¬¬ä¸‰æ–¹ç»„ä»¶æ ·å¼ end ***********************/
</style>

<template>
    <main id="app-main">
        <!-- canvas å›¾å±‚å®¹å™¨ -->
        <div id="container" ref="container">
            <!--
    å¤šå›¾å±‚æœªæŒ‡å®š z-indexï¼Œåå®šä¹‰çš„å›¾å±‚ä¼šè¦†ç›–å‰é¢å®šä¹‰çš„
    å›¾å±‚é¡ºåºï¼Œä¼šåœ¨æ¸¸æˆè¿‡ç¨‹è°ƒæ•´
    -->
            <!-- scene-graph åœºæ™¯å›¾å½¢å±‚ -->
            <canvas id="game-scene-graph" ref="gameSceneGraph" width="420" height="660"
                style="width: 420px; height: 660px; display: unset;"><!-- é™æ€åœºæ™¯æ›²çº¿å›¾å½¢å±‚ï¼Œå…¨å±ç”»å¸ƒï¼Œåªæ¸²æŸ“ä¸€æ¬¡ -->
                å¦‚æœçœ‹åˆ°è¿™ä¸ªæç¤ºï¼Œè¯´æ˜ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒCanvasï¼Œè¯·å‡çº§æµè§ˆå™¨ç‰ˆæœ¬ï¼Œæˆ–è€…æ›´æ¢å…¶ä»–æµè§ˆå™¨
            </canvas>
            <!-- scene-emoji åœºæ™¯emojiå›¾æ ‡å±‚ -->
            <canvas id="game-scene-emoji" ref="gameSceneEmoji" width="420" height="660"
                style="width: 420px; height: 660px; display: unset;"><!-- é™æ€åœºæ™¯æ™¯ç‰©å›¾å½¢å±‚ï¼Œå…¨å±ç”»å¸ƒï¼Œåªæ¸²æŸ“ä¸€æ¬¡ -->
                Canvas not supported
            </canvas>
            <!-- scene-lines åœºæ™¯è¾¹æ¡†èƒŒæ™¯å±‚ï¼ŒæŠŠæ¸¸æˆåœºæ™¯å±‚å¤¹åœ¨ä¸­é—´ -->
            <canvas id="game-scene-lines-bg" width="420" height="660"
                style="width: 420px; height: 660px; display: unset;"><!-- é™æ€åœºæ™¯è¾¹æ¡†èƒŒæ™¯å±‚ï¼Œå…¨å±ç”»å¸ƒï¼Œåªæ¸²æŸ“ä¸€æ¬¡ -->
                Canvas not supported
            </canvas>
            <!-- scene æ¸¸æˆåœºæ™¯å±‚ -->
            <canvas id="game-scene" ref="gameScene" width="420" height="660"
                style="width: 420px; height: 660px;"><!-- é™æ€åœºæ™¯èƒŒæ™¯å±‚ï¼Œåªæ¸²æŸ“ä¸€æ¬¡ï¼Œä¼˜åŒ–CPUæ€§èƒ½ -->
                Canvas not supported
            </canvas>
            <!-- scene-lines åœºæ™¯è¾¹æ¡†å±‚ -->
            <canvas id="game-scene-lines" ref="gameSceneLines" width="420" height="660"
                style="width: 420px; height: 660px; display: unset;"><!-- é™æ€åœºæ™¯åœºåœ°è¾¹æ¡†å±‚ï¼Œå…¨å±ç”»å¸ƒï¼Œåªæ¸²æŸ“ä¸€æ¬¡ -->
                Canvas not supported
            </canvas>
            <!-- scene-coordinate åœºæ™¯åæ ‡å±‚ -->
            <canvas id="game-scene-coordinate" ref="gameSceneCoordinate" width="420" height="660"
                style="width: 420px; height: 660px; display: unset;"><!-- é™æ€åœºæ™¯ç –æ ¼åæ ‡å±‚ï¼Œå…¨å±ç”»å¸ƒï¼Œåªæ¸²æŸ“ä¸€æ¬¡ -->
                Canvas not supported
            </canvas>
            <!-- main è§’è‰²è¿åŠ¨å±‚ -->
            <canvas id="game-main" ref="gameMain" width="420" height="660"
                style="width: 420px; height: 660px;"><!-- ä¸»è¿åŠ¨å±‚ï¼Œæ¯æ¬¡æ¸²æŸ“ä¼šæ¸…ç©ºç”»å¸ƒ -->
                Canvas not supported
            </canvas>
            <!-- main-ball ä¸»è§’è¿åŠ¨å±‚ -->
            <canvas id="game-main-ball" ref="gameMainBall" width="420" height="660"
                style="width: 420px; height: 660px;"><!-- ä¸»çƒï¼ˆä¸»è§’ï¼‰è¿åŠ¨å±‚ï¼Œæ¯æ¬¡æ¸²æŸ“ä¼šæ¸…ç©ºç”»å¸ƒ -->
                Canvas not supported
            </canvas>
            <!-- path è§’è‰²è·¯å¾„å±‚ -->
            <canvas id="game-path" ref="gamePath" width="420" height="660"
                style="width: 420px; height: 660px;"><!-- è§’è‰²ä¸­çº¿è·¯å¾„å±‚ï¼Œæ‰‹åŠ¨æ¸…ç©ºç”»å¸ƒ -->
                Canvas not supported
            </canvas>
            <!-- path-ball ä¸»è§’å…¨è·¯å¾„å±‚ -->
            <canvas id="game-path-ball" ref="gamePathBall" width="420" height="660"
                style="width: 420px; height: 660px;"><!-- è§’è‰²å…¨è·¯å¾„å±‚ï¼Œæ‰‹åŠ¨æ¸…ç©ºç”»å¸ƒ -->
                Canvas not supported
            </canvas>
            <!-- click-play ç‚¹æŒ‰å‘å°„æŒ‰é’®å±‚ -->
            <canvas id="game-click-play" width="600" height="600"
                style="width: 600px; height: 600px;"><!-- ç‚¹æŒ‰å‘å°„æŒ‰é’®å±‚ï¼Œåªç”»ä¸€æ¬¡ -->
                Canvas not supported
            </canvas>
            <!-- mask è¿åŠ¨é®ç½©å±‚ -->
            <canvas id="game-mask" ref="gameMask" width="420" height="660"
                style="width: 420px; height: 660px;"><!-- é®ç½©å±‚ï¼Œé¿å…è¿åŠ¨æ—¶æ“ä½œå°çƒï¼Œæ‰‹åŠ¨è°ƒæ•´å›¾å±‚é¡ºåº -->
                Canvas not supported
            </canvas>
        </div>
        <!-- å¼¹çª—é®ç½© -->
        <div id="dialog-mask" ref="dialogMask" class="collide-try-dialog"></div>
        <!-- å·¦ä¸Šè§’é€‰æ‹©è§’è‰²æç¤º -->
        <div id="re-choose-role-icon"><span @click="switchChooseRoleDialog(true);">&nbsp;&nbsp;&nbsp;&nbsp;</span>
        </div>
        <div id="re-choose-role-entry-dialog"
            class="collide-try-dialog collide-try-tiny-dialog collide-try-left-tiny-dialog" style="display: none;">
            <div id="re-choose-role-entry-dialog-msg" class="collide-try-tiny-dialog-msg"><span>ğŸ‘ˆ</span>ç‚¹å‡»å·¦ä¸Šè§’å¯ä»¥é‡æ–°é€‰æ‹©è§’è‰²å“¦~
            </div>
            <div id="re-choose-role-entry-dialog-ok" class="collide-try-tiny-dialog-ok collide-try-left-tiny-dialog-ok"
                @click="closeReChooseRoleEntryDialog();"><span class="collide-try-dialog-ok">å¯ä»¥çš„</span></div>
        </div>
        <!-- å³ä¸Šè§’è®¾ç½®æç¤º -->
        <div id="game-setting-icon"><span @click="switchUserSettingDialog(true);">&nbsp;&nbsp;&nbsp;&nbsp;</span></div>
        <div id="game-setting-entry-dialog" ref="gameSettingEntryDialog"
            class="collide-try-dialog collide-try-tiny-dialog" style="display: none;">
            <div id="game-setting-entry-dialog-msg" class="collide-try-tiny-dialog-msg">
                å³ä¸Šè§’æœ‰ä¸€ä¸ªéšè—çš„è®¾ç½®<span>âš™</span>å…¥å£å“¦~<span>ğŸ‘‰</span></div>
            <div id="game-setting-entry-dialog-ok" class="collide-try-tiny-dialog-ok"
                @click="closeGameSettingEntryDialog();"><span class="collide-try-dialog-ok">çŸ¥é“å•¦</span></div>
        </div>
        <!-- é€‰æ‹©è§’è‰²å¼¹çª— -->
        <div id="choose-role-dialog" ref="chooseRoleDialog" class="collide-try-dialog">
            <div id="role-list-head">
                <div id="role-list-head-msg">ğŸ‘‡è¯·é€‰æ‹©è§’è‰²</div>
                <div id="role-list-head-setting-icon"><span id="choose-role-to-setting-entry"
                        @click="switchUserSettingDialog(true);" style="display: none;">âš™ï¸</span><span
                        id="choose-role-close-btn" @click="switchChooseRoleDialog(false);"
                        style="display: none;">â</span></div>
                <!--<div id="role-list-head-desc">ï¼ˆé‡æ–°æ‰“å¼€é¡µé¢/åˆ·æ–°å³å¯å†æ¬¡é€‰è§’è‰²ï¼‰</div>-->
            </div>
            <ul id="role-list-area">
                <li id="role-heiwa" class="role-list" @click="chooseRole($event.target, Role.HEIWA.id);">
                    <div class="role-list-icon-name"><span class="role-list-icon">ğŸ‘¶ğŸ½</span><span
                            class="role-list-name">åœ£å©´å¤§ç‹ï¼ˆé»‘å¨ƒï¼‰</span></div>
                </li>
                <li id="role-jiangjiang" class="role-list" @click="chooseRole($event.target, Role.JIANGJIANG.id);">
                    <div class="role-list-icon-name"><span class="role-list-icon">ğŸ§Ÿâ€â™‚</span><span
                            class="role-list-name">æ³¢æ¯”åƒµåƒµï¼ˆåƒµå°¸ï¼‰</span></div>
                </li>
                <li id="role-duoduo" class="role-list" @click="chooseRole($event.target, Role.DUODUO.id);">
                    <div class="role-list-icon-name"><span class="role-list-icon">ğŸ¥š</span><span
                            class="role-list-name">é£é“ƒæœµæœµï¼ˆæœµæœµï¼‰</span></div>
                </li>
                <li id="role-kuilei" class="role-list" @click="chooseRole($event.target, Role.KUILEI.id);">
                    <div class="role-list-icon-name"><span class="role-list-icon">ğŸ¦Š</span><span
                            class="role-list-name">å‚€å„¡å¨ƒå¨ƒï¼ˆç‹ç‹¸ï¼‰</span></div>
                </li>
                <li id="role-shuangzi" class="role-list" @click="chooseRole($event.target, Role.SHUANGZI.id);">
                    <div class="role-list-icon-name">
                        <span class="role-list-icon">
                            <div id="role-shuangzi-new-draw"><span id="role-shuangzi-1"
                                    class="role-shuangzi-single">ğŸ§â€â™‚ï¸</span><span id="role-shuangzi-2"
                                    class="role-shuangzi-single">ğŸ§</span></div>
                        </span>
                        <span class="role-list-name">æ€ªç›—åŒå­ï¼ˆåŒå­ï¼‰</span>
                    </div>
                </li>
                <li id="role-lele" class="role-list" @click="chooseRole($event.target, Role.DIANYIN.id);">
                    <div class="role-list-icon-name"><span class="role-list-icon">ğŸµ</span><span
                            class="role-list-name">ç”µéŸ³å°‘å¥³ï¼ˆç”µéŸ³ï¼‰</span></div>
                </li>
                <li id="role-lele" class="role-list" @click="chooseRole($event.target, Role.LELE.id);">
                    <div class="role-list-icon-name"><span class="role-list-icon">ğŸ¥™</span><span
                            class="role-list-name">å¤ªå¹³ä¹ï¼ˆä¹ä¹ï¼‰</span></div>
                </li>
                <li id="role-lele" class="role-list" @click="chooseRole($event.target, Role.WUKONG.id);">
                    <div class="role-list-icon-name"><span class="role-list-icon">ğŸ’</span><span
                            class="role-list-name">é»‘ç¥è¯ï¼ˆæ‚Ÿç©ºï¼‰</span></div>
                </li>
                <li id="role-huaqianji" class="role-list" @click="chooseRole($event.target, Role.HUAQIANJI.id);">
                    <div class="role-list-icon-name"><span class="role-list-icon">ğŸš€</span><span
                            class="role-list-name">èŠ±åƒæœºï¼ˆç‚®å¼¹ï¼‰</span></div>
                </li>
                <li id="role-youxia" class="role-list" @click="chooseRole($event.target, Role.YOUXIA.id);">
                    <div class="role-list-icon-name"><span class="role-list-icon">ğŸ¹</span><span
                            class="role-list-name">æš—å¤œæ¸¸ä¾ ï¼ˆæ¸¸ä¾ ï¼‰</span></div>
                </li>
                <li id="role-flash" class="role-list" @click="chooseRole($event.target, -2);">
                    <div class="role-list-icon-name"><span class="role-list-icon">âš¡</span><span
                            class="role-list-name">æé€Ÿå¼€å§‹ï¼ˆæ¥å§ï¼‰</span></div>
                </li>
                <li id="role-random" class="role-list" @click="chooseRole($event.target, -1);">
                    <div class="role-list-icon-name"><span class="role-list-icon">ğŸ”€</span><span
                            class="role-list-name">éšä¾¿ç©ç©ï¼ˆå¥½çš„ï¼‰</span></div>
                </li>
            </ul>
        </div>
        <!-- å‚æ•°è®¾ç½®å¼¹çª— -->
        <div id="user-setting-dialog" ref="userSettingDialog" class="collide-try-dialog">
            <div id="user-setting-head">
                <div id="user-setting-head-msg">å‚æ•°è®¾ç½®</div>
                <div id="user-setting-close-icon"><span @click="switchUserSettingDialog(false);">â</span></div>
                <!--<div id="user-setting-head-desc"></div>-->
            </div>
            <ul id="user-setting-area">
                <!-- æŒ‡å®šè§’è‰²æ”¾åˆ°æœ€ä¸Šæ–¹ï¼Œå…å¾—æ¯æ¬¡éƒ½è¦ä¸Šæ»‘é¡µé¢å¾ˆä¹…ã€è¾“å…¥æ³•ä¼šæŠŠè¾“å…¥æ¡†é¡¶ä¸Šå»å¯¼è‡´çœ‹ä¸åˆ°è¾“å…¥æ¡†ã€‘ -->
                <li class="user-setting-item li-space-between-center">
                    <span class="user-setting-item-msg-left">è‡ªå®šä¹‰ä¸»é¢˜</span>
                    <span id="toggleCustomThemeSvgArrow"
                        class="user-setting-item-switch-right user-setting-item-input-area user-setting-item-right-input-area"
                        @click="toggleCustomTheme($event.target);">
                        <svg t="1723345403203" class="icon" viewBox="0 0 1024 1024" version="1.1"
                            xmlns="http://www.w3.org/2000/svg" p-id="4920" xmlns:xlink="http://www.w3.org/1999/xlink"
                            width="1000" height="1000">
                            <path
                                d="M346.52382345477406 104.43830532674417c-12.257495055447652-12.257495055447652-30.6437359627898-12.257495055447652-42.90123101823747 0s-12.257495055447652 30.6437359627898 0 42.90123101823747L668.2830560915551 512 303.6225924365366 876.6604636550185c-12.257495055447652 12.257495055447652-12.257495055447652 30.6437359627898 0 42.90123101823747 6.128747527723826 6.128747527723826 15.3218679813949 9.193120453671073 21.450615509118734 9.193120453671073s15.3218679813949-3.064372925947246 21.450615509118734-9.193120453671073l386.1110791641372-386.1110791641372c12.257495055447652-12.257495055447652 12.257495055447652-30.6437359627898 0-42.90123101823747L346.52382345477406 104.43830532674417z"
                                fill="" p-id="4921"></path>
                        </svg>
                    </span>
                </li>
                <li class="user-setting-item user-setting-item-expand li-space-between-center">
                    <span class="user-setting-item-msg-left custom-theme-item user-setting-item-disabled">å¯ç”¨è‡ªå®šä¹‰<span
                            id="resetThemeDefault" class="reset-btn" @click="resetThemeDefault($event.target);"
                            title="é‡ç½®ä¸»é¢˜" style="display: none;"> ğŸ”„ </span></span>
                    <span class="user-setting-item-switch-right">
                        <label class="switch" @click="switchCheckbox($event, 'isUseCustomTheme');">
                            <input type="checkbox" id="isUseCustomTheme">
                            <div class="slider round"></div>
                        </label>
                        <input id="customThemeInitStatus" type="hidden" value="0">
                    </span>
                </li>
                <li class="user-setting-item user-setting-item-expand li-space-between-center">
                    <span class="user-setting-item-msg-left custom-theme-item user-setting-item-disabled">å¯¼å…¥/å¯¼å‡ºä¸»é¢˜</span>
                    <span id="customThemeInOut" class="user-setting-item-switch-right" style="display: none;">
                        <button class="collide-try-btn bg-lv2 custom-theme-conf-inout" id="customThemeInput">å¯¼å…¥</button>
                        <button class="collide-try-btn bg-lv1 custom-theme-conf-inout"
                            id="customThemeOutput">å¯¼å‡º</button>
                        <input id="customThemeInputFile" type="file" style="display: none;"
                            accept="text/plain,application/json">
                    </span>
                </li>
                <li class="user-setting-item user-setting-item-expand li-space-between-center">
                    <span class="user-setting-item-msg-left custom-theme-item user-setting-item-disabled">ä¸»é¢˜åç§°</span>
                    <span
                        class="user-setting-item-switch-right user-setting-item-input-area user-setting-item-right-input-area">
                        <input type="text" class="custom-theme-item custom-theme-item-input user-setting-item-disabled"
                            id="name" value="è‡ªå®šä¹‰ä¸»é¢˜01" maxlength="7" disabled="disabled">
                    </span>
                </li>
                <li class="user-setting-item user-setting-item-expand li-space-between-center">
                    <span class="user-setting-item-msg-left custom-theme-item user-setting-item-disabled">é¡µé¢èƒŒæ™¯é¢œè‰²</span>
                    <span
                        class="user-setting-item-switch-right user-setting-item-input-area user-setting-item-right-input-area">
                        <input type="text"
                            class="user-setting-item-right-input-color-code custom-theme-item custom-theme-item-input user-setting-item-disabled theme-color-item"
                            id="bgColor" value="#ffffffff" maxlength="9" disabled="disabled">
                    </span>
                </li>
                <li id="page-color-image" class="user-setting-item user-setting-item-expand li-space-between-center">
                    <span class="user-setting-item-msg-left custom-theme-item user-setting-item-disabled">é¡µé¢èƒŒæ™¯å›¾ç‰‡</span>
                    <span
                        class="user-setting-item-switch-right user-setting-item-input-area user-setting-item-right-input-area">
                        <input type="text" id="bgImage"
                            class="custom-theme-item custom-theme-item-input user-setting-item-disabled" value=""
                            placeholder="é€‰æ‹©å›¾ç‰‡" maxlength="9" disabled="disabled">
                        <form class="user-setting-item-form" action="" method="post">
                            <label id="pageBgImageIcon" style="display: none;"><i class=""></i>ğŸ“</label>
                            <input id="pageBgImageFile" type="file" style="display: none;"
                                accept="image/jpg,image/jpeg,image/png,image/gif">
                        </form>
                    </span>
                </li>
                <li class="user-setting-item user-setting-item-expand li-space-between-center">
                    <span class="user-setting-item-msg-left custom-theme-item user-setting-item-disabled">å°é¢å¡«å……é¢œè‰²</span>
                    <span
                        class="user-setting-item-switch-right user-setting-item-input-area user-setting-item-right-input-area">
                        <input type="text"
                            class="user-setting-item-right-input-color-code custom-theme-item custom-theme-item-input user-setting-item-disabled theme-color-item"
                            id="tbColor" value="#ffffff00" maxlength="9" disabled="disabled">
                    </span>
                </li>
                <li class="user-setting-item user-setting-item-expand li-space-between-center">
                    <span class="user-setting-item-msg-left custom-theme-item user-setting-item-disabled">å°é¢è¾¹æ¡†é¢œè‰²</span>
                    <span
                        class="user-setting-item-switch-right user-setting-item-input-area user-setting-item-right-input-area">
                        <input type="text"
                            class="user-setting-item-right-input-color-code custom-theme-item custom-theme-item-input user-setting-item-disabled theme-color-item"
                            id="tblColor" value="#ffffff00" maxlength="9" disabled="disabled">
                    </span>
                </li>
                <li class="user-setting-item user-setting-item-expand li-space-between-center">
                    <span class="user-setting-item-msg-left custom-theme-item user-setting-item-disabled">ç –æ ¼çº¿é¢œè‰²</span>
                    <span
                        class="user-setting-item-switch-right user-setting-item-input-area user-setting-item-right-input-area">
                        <input type="text"
                            class="user-setting-item-right-input-color-code custom-theme-item custom-theme-item-input user-setting-item-disabled theme-color-item"
                            id="glColor" value="#ffffff00" maxlength="9" disabled="disabled">
                    </span>
                </li>
                <li class="user-setting-item user-setting-item-expand li-space-between-center">
                    <span class="user-setting-item-msg-left custom-theme-item user-setting-item-disabled">ç –æ ¼ä¸­çº¿é¢œè‰²</span>
                    <span
                        class="user-setting-item-switch-right user-setting-item-input-area user-setting-item-right-input-area">
                        <input type="text"
                            class="user-setting-item-right-input-color-code custom-theme-item custom-theme-item-input user-setting-item-disabled theme-color-item"
                            id="glmColor" value="#ffffff00" maxlength="9" disabled="disabled">
                    </span>
                </li>
                <li class="user-setting-item user-setting-item-expand li-space-between-center">
                    <span class="user-setting-item-msg-left custom-theme-item user-setting-item-disabled">ç –æ ¼åæ ‡é¢œè‰²</span>
                    <span
                        class="user-setting-item-switch-right user-setting-item-input-area user-setting-item-right-input-area">
                        <input type="text"
                            class="user-setting-item-right-input-color-code custom-theme-item custom-theme-item-input user-setting-item-disabled theme-color-item"
                            id="gnColor" value="#ffffff00" maxlength="9" disabled="disabled">
                    </span>
                </li>
                <li class="user-setting-item user-setting-item-expand li-space-between-center">
                    <span
                        class="user-setting-item-msg-left custom-theme-item user-setting-item-disabled">ç –æ ¼åæ ‡é»‘å¤œé¢œè‰²</span>
                    <span
                        class="user-setting-item-switch-right user-setting-item-input-area user-setting-item-right-input-area">
                        <input type="text"
                            class="user-setting-item-right-input-color-code custom-theme-item custom-theme-item-input user-setting-item-disabled theme-color-item"
                            id="gndColor" value="#ffffff00" maxlength="9" disabled="disabled">
                    </span>
                </li>
                <li class="user-setting-item user-setting-item-expand li-space-between-center">
                    <span
                        class="user-setting-item-msg-left custom-theme-item user-setting-item-disabled">è§’è‰²è¿åŠ¨è·¯å¾„é¢œè‰²</span>
                    <span
                        class="user-setting-item-switch-right user-setting-item-input-area user-setting-item-right-input-area">
                        <input type="text"
                            class="user-setting-item-right-input-color-code custom-theme-item custom-theme-item-input user-setting-item-disabled theme-color-item"
                            id="plColor" value="#ffffff00" maxlength="9" disabled="disabled">
                    </span>
                </li>
                <li class="user-setting-item user-setting-item-expand li-space-between-center">
                    <span
                        class="user-setting-item-msg-left custom-theme-item user-setting-item-disabled">è§’è‰²æœ¬ä½“è·¯å¾„é¢œè‰²</span>
                    <span
                        class="user-setting-item-switch-right user-setting-item-input-area user-setting-item-right-input-area">
                        <input type="text"
                            class="user-setting-item-right-input-color-code custom-theme-item custom-theme-item-input user-setting-item-disabled theme-color-item"
                            id="rlColor" value="#ffffff00" maxlength="9" disabled="disabled">
                    </span>
                </li>
                <!--
      <li class="user-setting-item user-setting-item-expand li-space-between-center">
        <span class="user-setting-item-msg-left custom-theme-item user-setting-item-disabled">å‚€å„¡è¿åŠ¨è·¯å¾„é¢œè‰²</span>
        <span class="user-setting-item-switch-right user-setting-item-input-area user-setting-item-right-input-area">
          <input type="text" class="user-setting-item-right-input-color-code custom-theme-item custom-theme-item-input user-setting-item-disabled theme-color-item" id="klplColor" value="#ffffff00" maxlength="9" disabled="disabled">
        </span>
      </li>
      -->
                <li class="user-setting-item user-setting-item-expand li-space-between-center">
                    <span
                        class="user-setting-item-msg-left custom-theme-item user-setting-item-disabled">åˆ†èº«è¿åŠ¨è·¯å¾„é¢œè‰²</span>
                    <span
                        class="user-setting-item-switch-right user-setting-item-input-area user-setting-item-right-input-area">
                        <input type="text"
                            class="user-setting-item-right-input-color-code custom-theme-item custom-theme-item-input user-setting-item-disabled theme-color-item"
                            id="szbplColor" value="#ffffff00" maxlength="9" disabled="disabled">
                    </span>
                </li>
                <!--
      <li class="user-setting-item user-setting-item-expand li-space-between-center">
        <span class="user-setting-item-msg-left custom-theme-item user-setting-item-disabled">åˆ†èº«æœ¬ä½“è·¯å¾„é¢œè‰²</span>
        <span class="user-setting-item-switch-right user-setting-item-input-area user-setting-item-right-input-area">
          <input type="text" class="user-setting-item-right-input-color-code custom-theme-item custom-theme-item-input user-setting-item-disabled theme-color-item" id="szbrlColor" value="#ffffff00" maxlength="9" disabled="disabled">
        </span>
      </li>
      -->
                <li class="user-setting-item user-setting-item-expand li-space-between-center">
                    <span class="user-setting-item-msg-left custom-theme-item user-setting-item-disabled">ç¢°æ’æŒ‡ç¤ºåœˆé¢œè‰²</span>
                    <span
                        class="user-setting-item-switch-right user-setting-item-input-area user-setting-item-right-input-area">
                        <input type="text"
                            class="user-setting-item-right-input-color-code custom-theme-item custom-theme-item-input user-setting-item-disabled theme-color-item"
                            id="ccColor" value="#ffffff00" maxlength="9" disabled="disabled">
                    </span>
                </li>
                <li class="user-setting-item user-setting-item-expand li-space-between-center">
                    <span
                        class="user-setting-item-msg-left custom-theme-item user-setting-item-disabled">åˆ†èº«ç¢°æ’æŒ‡ç¤ºåœˆé¢œè‰²</span>
                    <span
                        class="user-setting-item-switch-right user-setting-item-input-area user-setting-item-right-input-area">
                        <input type="text"
                            class="user-setting-item-right-input-color-code custom-theme-item custom-theme-item-input user-setting-item-disabled theme-color-item"
                            id="szccColor" value="#ffffff00" maxlength="9" disabled="disabled">
                    </span>
                </li>
                <li class="user-setting-item user-setting-item-expand li-space-between-center">
                    <span
                        class="user-setting-item-msg-left custom-theme-item user-setting-item-disabled">çŒ´å­åˆ†èº«æç¤ºè·¯å¾„é¢œè‰²</span>
                    <span
                        class="user-setting-item-switch-right user-setting-item-input-area user-setting-item-right-input-area">
                        <input type="text"
                            class="user-setting-item-right-input-color-code custom-theme-item custom-theme-item-input user-setting-item-disabled theme-color-item"
                            id="wkShowColor" value="#ffffff00" maxlength="9" disabled="disabled">
                    </span>
                </li>
                <li class="user-setting-item user-setting-item-expand li-space-between-center">
                    <span class="user-setting-item-msg-left custom-theme-item user-setting-item-disabled">å°é¢è¾¹æ¡†çº¿å®½</span>
                    <span
                        class="user-setting-item-switch-right user-setting-item-input-area user-setting-item-right-input-area">
                        <input type="text"
                            class="user-setting-item-right-input-number-m custom-theme-item custom-theme-item-input user-setting-item-disabled"
                            id="tblWidth" value="0" maxlength="5" disabled="disabled">
                    </span>
                </li>
                <li class="user-setting-item user-setting-item-expand li-space-between-center">
                    <span class="user-setting-item-msg-left custom-theme-item user-setting-item-disabled">å°é¢ç –æ ¼çº¿å®½</span>
                    <span
                        class="user-setting-item-switch-right user-setting-item-input-area user-setting-item-right-input-area">
                        <input type="text"
                            class="user-setting-item-right-input-number-m custom-theme-item custom-theme-item-input user-setting-item-disabled"
                            id="glWidth" value="0" maxlength="5" disabled="disabled">
                    </span>
                </li>
                <li class="user-setting-item user-setting-item-expand li-space-between-center">
                    <span
                        class="user-setting-item-msg-left custom-theme-item user-setting-item-disabled">ç –æ ¼åæ ‡å­—ä½“å¤§å°</span>
                    <span
                        class="user-setting-item-switch-right user-setting-item-input-area user-setting-item-right-input-area">
                        <input type="text"
                            class="user-setting-item-right-input-number-m custom-theme-item custom-theme-item-input user-setting-item-disabled"
                            id="gnSize" value="0" maxlength="5" disabled="disabled">
                    </span>
                </li>
                <li class="user-setting-item user-setting-item-expand li-space-between-center">
                    <span
                        class="user-setting-item-msg-left custom-theme-item user-setting-item-disabled">è§’è‰²è¿åŠ¨è·¯å¾„çº¿å®½</span>
                    <span
                        class="user-setting-item-switch-right user-setting-item-input-area user-setting-item-right-input-area">
                        <input type="text"
                            class="user-setting-item-right-input-number-m custom-theme-item custom-theme-item-input user-setting-item-disabled"
                            id="plWidth" value="0" maxlength="5" disabled="disabled">
                    </span>
                </li>
                <!--
      <li class="user-setting-item user-setting-item-expand li-space-between-center">
        <span class="user-setting-item-msg-left custom-theme-item user-setting-item-disabled">å‚€å„¡è¿åŠ¨è·¯å¾„çº¿å®½</span>
        <span class="user-setting-item-switch-right user-setting-item-input-area user-setting-item-right-input-area">
          <input type="text" class="user-setting-item-right-input-number-m custom-theme-item custom-theme-item-input user-setting-item-disabled" id="klplWidth" value="0" maxlength="5" disabled="disabled">
        </span>
      </li>
      -->
                <li class="user-setting-item user-setting-item-expand li-space-between-center">
                    <span class="user-setting-item-msg-left custom-theme-item user-setting-item-disabled">ç¢°æ’æŒ‡ç¤ºåœˆçº¿å®½</span>
                    <span
                        class="user-setting-item-switch-right user-setting-item-input-area user-setting-item-right-input-area">
                        <input type="text"
                            class="user-setting-item-right-input-number-m custom-theme-item custom-theme-item-input user-setting-item-disabled"
                            id="ccWidth" value="0" maxlength="5" disabled="disabled">
                    </span>
                </li>
                <li class="user-setting-item li-space-between-center" id="user-setting-item-1st">
                    <span class="user-setting-item-msg-left">æ¸¸æˆåœºæ™¯ä¸»é¢˜</span>
                    <span class="user-setting-item-switch-right">
                        <button class="dropbtn" @click="toggleDropdown()" id="sceneThemeMode">é»˜è®¤ä¸»é¢˜</button>
                        <div class="dropdown-content" id="themeDropdown">
                            <!-- a æ ‡ç­¾çš„ href ä¼šè§¦å‘ popstate äº‹ä»¶ -->
                            <a @click="setSceneThemeVal($event.target, 0);">é»˜è®¤ä¸»é¢˜</a>
                            <!-- <a @click="setSceneThemeVal($event.target, 2);">æ–°å¹´ä¸»é¢˜</a> -->
                            <a @click="setSceneThemeVal($event.target, 3);">ç”°å›­ä¸»é¢˜</a>
                            <a @click="setSceneThemeVal($event.target, 5);">å¤æ—¥ä¸»é¢˜</a>
                            <a @click="setSceneThemeVal($event.target, 4);">æ˜Ÿé™…ä¸»é¢˜</a>
                            <a @click="setSceneThemeVal($event.target, 1);">å†°é›ªä¸»é¢˜</a>
                        </div>
                    </span>
                </li>
                <li class="user-setting-item li-space-between-center">
                    <span class="user-setting-item-msg-left">å½“å‰æ“ä½œæ–¹å¼</span>
                    <span class="user-setting-item-switch-right">
                        <button class="dropbtn" @click="toggleCurrPlayOpt()" id="currPlayOpt">æ‹–æ‹½</button>
                    </span>
                </li>
                <li class="user-setting-item li-space-between-center">
                    <span class="user-setting-item-msg-left">ä¸»è§’æ‰€åœ¨é˜Ÿé¢œè‰²</span>
                    <span class="user-setting-item-switch-right">
                        <button class="dropbtn red" @click="toggleTeamColor()" id="mainTeamColor">çº¢è‰²</button>
                    </span>
                </li>
                <li class="user-setting-item li-space-between-center">
                    <span class="user-setting-item-msg-left">åªç”¨ä¸€ä¸ªè§’è‰²æµ‹è¯•</span>
                    <span class="user-setting-item-switch-right">
                        <label class="switch" @click="switchCheckbox($event, 'isTestOnlyOne');">
                            <input type="checkbox" id="isTestOnlyOne">
                            <div class="slider round"></div>
                        </label>
                    </span>
                </li>
                <li class="user-setting-item li-space-between-center">
                    <span class="user-setting-item-msg-left">æ˜¾ç¤ºè§’è‰²è¿åŠ¨è·¯å¾„</span>
                    <span class="user-setting-item-switch-right">
                        <label class="switch" @click="switchCheckbox($event, 'isShowBallMovePath');">
                            <input type="checkbox" id="isShowBallMovePath">
                            <div class="slider round"></div>
                        </label>
                    </span>
                </li>
                <li class="user-setting-item li-space-between-center">
                    <span class="user-setting-item-msg-left">æ˜¾ç¤ºè§’è‰²æœ¬ä½“è·¯å¾„</span>
                    <span class="user-setting-item-switch-right">
                        <label class="switch" @click="switchCheckbox($event, 'isShowBallPath');">
                            <input type="checkbox" id="isShowBallPath">
                            <div class="slider round"></div>
                        </label>
                    </span>
                </li>
                <li class="user-setting-item li-space-between-center">
                    <span class="user-setting-item-msg-left">åªç„å‡†ä¸æ‰“</span>
                    <span class="user-setting-item-switch-right">
                        <label class="switch" @click="switchCheckbox($event, 'isJustTrying');">
                            <input type="checkbox" id="isJustTrying">
                            <div class="slider round"></div>
                        </label>
                    </span>
                </li>
                <li class="user-setting-item li-space-between-center">
                    <span class="user-setting-item-msg-left">åªç¢°ä¸€æ¬¡è§’è‰²</span>
                    <span class="user-setting-item-switch-right">
                        <label class="switch" @click="switchCheckbox($event, 'isRoleCollidedOnce');">
                            <input type="checkbox" id="isRoleCollidedOnce">
                            <div class="slider round"></div>
                        </label>
                    </span>
                </li>
                <li class="user-setting-item li-space-between-center">
                    <span class="user-setting-item-msg-left">ç¢°åˆ°è§’è‰²å³åœæ­¢</span>
                    <span class="user-setting-item-switch-right">
                        <label class="switch" @click="switchCheckbox($event, 'isStopAfterCollided');">
                            <input type="checkbox" id="isStopAfterCollided">
                            <div class="slider round"></div>
                        </label>
                    </span>
                </li>
                <li class="user-setting-item li-space-between-center">
                    <span class="user-setting-item-msg-left">ç¢°å¢™ä¸¤æ¬¡å³åœæ­¢</span>
                    <span class="user-setting-item-switch-right">
                        <label class="switch" @click="switchCheckbox($event, 'isStopAfter2WallCollided');">
                            <input type="checkbox" id="isStopAfter2WallCollided">
                            <div class="slider round"></div>
                        </label>
                    </span>
                </li>
                <li class="user-setting-item li-space-between-center">
                    <span class="user-setting-item-msg-left">åªæ˜¾ç¤ºæ’å‡»å°é¢</span>
                    <span class="user-setting-item-switch-right">
                        <label class="switch" @click="switchCheckbox($event, 'isJustShowTable');">
                            <input type="checkbox" id="isJustShowTable">
                            <div class="slider round"></div>
                        </label>
                    </span>
                </li>
                <li class="user-setting-item li-space-between-center">
                    <span class="user-setting-item-msg-left">æ˜¾ç¤ºåœºæ™¯å›¾å½¢</span>
                    <span class="user-setting-item-switch-right">
                        <label class="switch" @click="switchCheckbox($event, 'isShowSceneGraph');">
                            <input type="checkbox" id="isShowSceneGraph">
                            <div class="slider round"></div>
                        </label>
                    </span>
                </li>
                <li class="user-setting-item li-space-between-center">
                    <span class="user-setting-item-msg-left">æ˜¾ç¤ºå°é¢è¾¹æ¡†</span>
                    <span class="user-setting-item-switch-right">
                        <label class="switch"
                            @click="switchCheckbox($event, 'isShowTableBorder', { canvasEle: gameSceneLinesCanvas });">
                            <input type="checkbox" id="isShowTableBorder">
                            <div class="slider round"></div>
                        </label>
                    </span>
                </li>
                <li class="user-setting-item li-space-between-center">
                    <span class="user-setting-item-msg-left">æ˜¾ç¤ºç –æ ¼åæ ‡</span>
                    <span class="user-setting-item-switch-right">
                        <label class="switch"
                            @click="switchCheckbox($event, 'isShowGridCoordinate', { canvasEle: gameSceneCoordinateCanvas });">
                            <input type="checkbox" id="isShowGridCoordinate">
                            <div class="slider round"></div>
                        </label>
                    </span>
                </li>
                <li class="user-setting-item li-space-between-center">
                    <span class="user-setting-item-msg-left">æ˜¾ç¤ºè§’è‰²è¡€é‡æ¡</span>
                    <span class="user-setting-item-switch-right">
                        <label class="switch" @click="switchCheckbox($event, 'isShowRoleBloodLine');">
                            <input type="checkbox" id="isShowRoleBloodLine">
                            <div class="slider round"></div>
                        </label>
                    </span>
                </li>
                <li class="user-setting-item li-space-between-center">
                    <span class="user-setting-item-msg-left">æ˜¾ç¤ºè§’è‰²ç¼–å·</span>
                    <span class="user-setting-item-switch-right">
                        <label class="switch" @click="switchCheckbox($event, 'isShowRoleBloodNo');">
                            <input type="checkbox" id="isShowRoleBloodNo">
                            <div class="slider round"></div>
                        </label>
                    </span>
                </li>
                <li class="user-setting-item li-space-between-center">
                    <span class="user-setting-item-msg-left">å‚€å„¡æ‹‰å›</span>
                    <span class="user-setting-item-switch-right">
                        <label class="switch" @click="switchCheckbox($event, 'isKuileiPullBack');">
                            <input type="checkbox" id="isKuileiPullBack">
                            <div class="slider round"></div>
                        </label>
                    </span>
                </li>
                <!--
                <li class="user-setting-item li-space-between-center">
                    <span class="user-setting-item-msg-left">ç„å‡†ç©¿é€</span>
                    <span class="user-setting-item-switch-right">
                        <label class="switch" @click="switchCheckbox($event, 'isPiercesTry');">
                            <input type="checkbox" id="isPiercesTry">
                            <div class="slider round"></div>
                        </label>
                    </span>
                </li>
                -->
                <li class="user-setting-item li-space-between-center">
                    <span class="user-setting-item-msg-left">ç„å‡†æ˜¾ç¤ºè·¯å¾„</span>
                    <span class="user-setting-item-switch-right">
                        <label class="switch" @click="switchCheckbox($event, 'isShowTryFullPath');">
                            <input type="checkbox" id="isShowTryFullPath">
                            <div class="slider round"></div>
                        </label>
                    </span>
                </li>
                <li class="user-setting-item li-space-between-center">
                    <span class="user-setting-item-msg-left">æ˜¾ç¤ºçŒ´å­åˆ†èº«æç¤º</span>
                    <span class="user-setting-item-switch-right">
                        <label class="switch" @click="switchCheckbox($event, 'isShowWkPath');">
                            <input type="checkbox" id="isShowWkPath">
                            <div class="slider round"></div>
                        </label>
                    </span>
                </li>
                <li class="user-setting-item li-space-between-center">
                    <span class="user-setting-item-msg-left">åŒå‡»å±å¹•å›é€€</span>
                    <span class="user-setting-item-switch-right">
                        <label class="switch" @click="switchCheckbox($event, 'isDbclickBack');">
                            <input type="checkbox" id="isDbclickBack">
                            <div class="slider round"></div>
                        </label>
                    </span>
                </li>
                <li class="user-setting-item li-space-between-center">
                    <span class="user-setting-item-msg-left">é•¿æŒ‰é‡ç½®è§’è‰²ä½ç½®</span>
                    <span class="user-setting-item-switch-right">
                        <label class="switch" @click="switchCheckbox($event, 'isLongPressRandom');">
                            <input type="checkbox" id="isLongPressRandom">
                            <div class="slider round"></div>
                        </label>
                    </span>
                </li>
                <li class="user-setting-item li-space-between-center">
                    <span class="user-setting-item-msg-left">æ˜¾ç¤ºè§’è‰²åæ ‡(å•ä½ï¼šæ ¼)</span>
                    <span class="user-setting-item-switch-right">
                        <label class="switch" @click="switchCheckbox($event, 'isShowRoleMovePos');">
                            <input type="checkbox" id="isShowRoleMovePos">
                            <div class="slider round"></div>
                        </label>
                    </span>
                </li>
                <li class="user-setting-item li-space-between-center">
                    <span class="user-setting-item-msg-left">è§’è‰²åŠ é€Ÿæˆ–å‡é€Ÿ(-20~200)</span>
                    <span
                        class="user-setting-item-switch-right user-setting-item-input-area user-setting-item-right-input-area">
                        <input type="text" class="user-setting-item-right-input-number-m" id="roleSpeedAddVal" value="0"
                            maxlength="3">
                    </span>
                </li>
                <li class="user-setting-item">
                    <span class="user-setting-item-msg-left">æŒ‡å®šæ¸¸æˆè§’è‰²(è¾“å…¥è§’è‰²å)</span><span class="reset-btn"
                        @click="resetGameRoleIds(this);" title="é‡ç½®è§’è‰²"> ğŸ”„ </span>
                    <div class="user-setting-item-input-area">
                        <div class="div-input-game-roles default" contenteditable="true" id="gameRoleId1"
                            placeholder="è¾“å…¥ä¸»è§’" value="">è¾“å…¥ä¸»è§’</div>
                        <div class="div-input-game-roles default" contenteditable="true" id="gameRoleId2"
                            placeholder="è¾“å…¥é˜Ÿå‹" value="">è¾“å…¥é˜Ÿå‹</div>
                        <div class="div-input-game-roles default red" contenteditable="true" id="gameRoleId3"
                            placeholder="è¾“å…¥å¯¹æ‰‹1" value="">è¾“å…¥å¯¹æ‰‹1</div>
                        <div class="div-input-game-roles default red" contenteditable="true" id="gameRoleId4"
                            placeholder="è¾“å…¥å¯¹æ‰‹2" value="">è¾“å…¥å¯¹æ‰‹2</div>
                        <div id="game-setting-main-role-dialog" class="collide-try-dialog collide-try-tiny-dialog"
                            style="display: none;">
                            <div id="game-setting-main-role-dialog-msg" class="collide-try-tiny-dialog-msg">
                                ğŸ‘†ä¸»è§’è®¾ç½®åªåœ¨<span>ã€æé€Ÿå¼€å§‹ã€‘</span>é€‰é¡¹ç”Ÿæ•ˆå“¦~</div>
                            <div id="game-setting-main-role-dialog-ok" class="collide-try-tiny-dialog-ok"
                                @click="closeGameSettingMainRoleDialog();"><span
                                    class="collide-try-dialog-ok">å¥½çš„å§</span></div>
                        </div>
                    </div>
                </li>
                <li class="user-setting-item">
                    <span class="user-setting-item-msg-left">åˆ†äº«/å¯¼å…¥è§’è‰²åŠåæ ‡</span><span class="reset-btn"
                        @click="resetShareContent(this);" title="é‡ç½®åˆ†äº«"> ğŸ”„ </span>
                    <div class="user-setting-item-input-area collide-try-in-one-line">
                        <input type="text" id="shareRoleAndPos" value="" maxlength="1000" placeholder="ç²˜è´´å†…å®¹åç‚¹å‡»å¯¼å…¥">
                        <button class="collide-try-btn bg-lv1" id="rpShareCopy" @click="copyShareContent();">å¤åˆ¶</button>
                        <button class="collide-try-btn bg-lv2" id="rpShareImport" @click="importShareContent();"
                            style="display: none;">å¯¼å…¥</button>
                    </div>
                </li>
                <li class="user-setting-item" style="display: none;">
                    <span class="user-setting-item-msg-left">å¡é¡¿è‡ªåŠ¨æ¢å¤ç­‰å¾…æ—¶é—´(å•ä½ï¼šç§’)</span>
                    <div class="user-setting-item-input-area">
                        <input type="text" id="animateAutoRestTime" value="20" maxlength="100">
                    </div>
                </li>
                <li class="user-setting-item">
                    <span class="user-setting-item-msg-left">æ–œè¾¹å€¾æ–œåå·®(å•ä½ï¼šæ ¼)</span>
                    <div class="user-setting-item-input-area">
                        <input type="text" id="wan8CocosTableMoveVals" value="0" maxlength="100">
                    </div>
                </li>
                <li class="user-setting-item" id="collide-try-save-html" @click="saveRemoteHtml(this);">
                    <span class="user-setting-item-msg-left">ä¸‹è½½ç¦»çº¿ç‰ˆ</span>
                </li>
                <li class="user-setting-item" @click="resetUserSettings()">
                    <span class="user-setting-item-msg-left">æ¢å¤é»˜è®¤è®¾ç½®</span>
                </li>
                <li class="user-setting-item" @click="switchDialogShow(aboutAppDialog, true, { display: 'unset' });">
                    <span class="user-setting-item-msg-left">å…³äºåº”ç”¨</span>
                </li>
                <li class="user-setting-item">&nbsp;&nbsp;</li>
            </ul>
        </div>

        <!-- æ›´æ–°æç¤ºå¼¹çª— -->
        <div id="collide-try-update-content-dialog" ref="collideTryUpdateContentDialog"
            class="collide-try-dialog collide-try-close-btn-dialog">
            <div id="collide-try-update-content-close-icon" class="collide-try-close-btn-dialog-title-close">
                <span @click="showUpdateContent(false);">â</span>
            </div>
            <div id="collide-try-update-content-title"
                class="collide-try-each-item-border-bottom collide-try-close-btn-dialog-title">
                <b id="update-content-title">ğŸ†• åº”ç”¨æ›´æ–°</b>
            </div>
            <div id="collide-try-update-content" class="collide-try-close-btn-dialog-content">

            </div>
        </div>

        <!-- æ“ä½œæŒ‡å—å¼¹çª— -->
        <div id="collide-try-how-to-play-dialog" class="collide-try-dialog collide-try-close-btn-dialog">
            <div class="collide-try-close-btn-dialog-title-close" style="display: none;">
                <span @click="showHowToPlay(false);">â</span>
            </div>
            <div id="collide-try-how-to-play-title"
                class="collide-try-each-item-border-bottom collide-try-close-btn-dialog-title">
                <b>ğŸ‘‡ æ“ä½œæŒ‡å—</b><span>ï¼ˆå…ˆè¿™æ ·å†é‚£æ ·ğŸ¤ªï¼‰</span>
            </div>
            <div id="collide-try-how-to-play-content" class="collide-try-close-btn-dialog-content">
                <pre>
                â‘  æ‹–åŠ¨è§’è‰²æ‘†å¥½ä½ç½®ï¼Œå†æ‹–åŠ¨ä¸»è§’ç„å‡†ï¼Œæ¾æ‰‹å¼€æ‰“
                â‘¡ æ‰“å®ŒåŒå‡»å°é¢å¯é‡æ‰“ï¼›é•¿æŒ‰å°é¢å¯éšæœºé‡ç½®è§’è‰²ä½ç½®
                â‘¢ è®¾ç½®é‡Œé¢å¯ä»¥æŒ‡å®šä»»æ„è§’è‰²å“¦~
                </pre>
            </div>
            <div class="collide-try-close-btn-dialog-ok" @click="showHowToPlay(false);">
                <span class="collide-try-dialog-ok">æœ•çŸ¥é“äº†</span>
            </div>
        </div>

        <!-- è§’è‰²åæ ‡æ‚¬æµ®æ¡ -->
        <div id="collide-try-role-pos-line" ref="collideTryRolePosLine"
            class="collide-try-dialog collide-try-role-pos-line-font">
            <b class="collide-try-role-pos-line-font">X</b> :<div
                class="div-input-role-pos collide-try-role-pos-line-font" contenteditable="false" id="rolePosX"
                placeholder="0.00" value="">
                0.00
            </div>
            <b class="collide-try-role-pos-line-font">Y</b> :<div
                class="div-input-role-pos collide-try-role-pos-line-font" contenteditable="false" id="rolePosY"
                placeholder="0.00" value="">
                0.00
            </div>
        </div>

        <!-- å…³äºåº”ç”¨å¼¹çª— -->
        <div id="user-setting-about-app-dialog" ref="userSettingAboutAppDialog" class="collide-try-dialog">
            <div id="user-setting-about-app-close-icon" style="display: none;"><span
                    @click="switchDialogShow(aboutAppDialog, false);">â</span></div>
            <div id="user-setting-about-app-title" class="collide-try-each-item-border-bottom">
                <b id="about-app-title">
                    <span @click="switchDialogShow(aboutAppDialog, false);"><svg t="1709376528064" class="icon"
                            viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="8794"
                            width="20" height="20">
                            <path d="M512 959.68L640 896 320 576h640v-128H320L640 128l-128-63.68L64.32 512z"
                                fill="#2c2c2c" p-id="8795"></path>
                        </svg></span>
                    å…³äºåº”ç”¨
                </b>
            </div>
            <div id="user-setting-about-app-content">
                <pre>
<b class="collide-try-app-full-name collide-try-each-item-margin">ç©å§-æ’å‡»ç‹è€…-æ¨¡æ‹Ÿç»ƒä¹ å·¥å…·</b>
<b class="collide-try-each-item-margin">ğŸ‘¨â€ğŸ’» Author: THeLiGht_ Group</b>
<b class="collide-try-each-item-margin">ğŸ“§ Contact: m1yellow@163.com</b>
<div class="collide-try-author-declare">
<b class="collide-try-author-declare-title">å¼€å‘è€…å£°æ˜ï¼š</b>
<ul class="collide-try-author-declare-content">
<li>1. æœ¬å·¥å…·<b>ä¸æ”¶å–ä»»ä½•è´¹ç”¨</b>ï¼Œä¹Ÿä¸ä¸å®˜æ–¹æ¸¸æˆäº§ç”Ÿä»»ä½•å…³è”ï¼Œä»…ç”¨äºæ—¥å¸¸ç»ƒä¹ å’Œäº¤æµï¼Œ<b>å¦‚æœæœ‰ä¾µå®³åˆ°ç©å§å®˜æ–¹çš„åˆ©ç›Šï¼Œè¯·ç©å§å·¥ä½œäººå‘˜ç›´æ¥è”ç³»ä¸Šæ–¹çš„é‚®ç®±å¤„ç†ï¼</b></li>
<li>2. æœ¬å·¥å…·<b>ä¿è¯ä¸åŒ…å«ä»»ä½•æ¶æ„ä»£ç ï¼Œä¸æ”¶é›†ä»»ä½•ä¸ªäººéšç§ä¿¡æ¯ï¼</b></li>
<!-- <li>3. ä¸ªäººç«™ç‚¹å¯èƒ½ä¼šè¢«åˆ©ç›Šç›¸å…³è€…æˆ–ä¸å‹å¥½çš„äºº<b>ã€æ¶æ„åŒ¿åä¸¾æŠ¥ã€‘</b>ï¼Œæ¯æ¬¡ç”³è¯‰ä¼šåœ¨ä¸‰ä¸ªå·¥ä½œæ—¥å†…ç­”å¤ï¼ˆé¦–æ¬¡ç”³è¯‰å¾ˆå¿«å¤„ç†ï¼‰ï¼Œä½†å¯èƒ½è¿‡ä¸äº†å¤šä¹…åˆä¼šè¢«ä¸¾æŠ¥å±è”½ï¼</li> -->
<li>3. è¿™ä¸ªç»ƒä¹ å·¥å…·å·²ç»èŠ±è´¹äº†å°†è¿‘ä¸¤å¹´çš„æ—¶é—´å’Œç²¾åŠ›å¼€å‘å’Œç»´æŠ¤äº†ï¼Œçº¯å±<b>ä¸ºçˆ±å‘ç”µï¼</b></li>
<li>4. å¦‚æœæœ‰ä¸ªåˆ«æµè§ˆå™¨å±è”½äº†ç½‘ç«™å¯¼è‡´æ‰“ä¸å¼€é¡µé¢ï¼Œå¯ä»¥å°è¯•æ›´æ¢å…¶ä»–æµè§ˆå™¨ã€‚ã€<a target="_blank" href="https://viayoo.com/zh-cn/">Viaæµè§ˆå™¨</a>ã€‘æˆ–ã€<a target="_blank" href="https://www.xbext.com/">Xæµè§ˆå™¨</a>ã€‘ï¼Œæç®€æ— å¹¿å‘Šï¼ˆAppå¤§å°ä¸åˆ°2Mï¼‰ï¼Œå“ªä¸ªèƒ½ç”¨å¥½ç”¨é€‰å“ªä¸ªå°±è¡Œï¼ˆæ²¡æœ‰ä»»ä½•æ¨å¹¿ï¼‰ï¼Œæ„Ÿè°¢å„ä½ç©å‹çš„ä¿¡ä»»ï¼</li>
</ul>
</div>
<div class="collide-try-update-title"><b class="collide-try-each-item-border-bottom">ğŸ“– åŠŸèƒ½è¯´æ˜ï¼š<span class="collide-try-update-date"></span></b></div>
<span class="collide-try-each-item-margin">1ï¸âƒ£ æ”¯æŒä¸€ä¸ªä¸»æ‰“è§’è‰²ã€ä¸‰ä¸ªè¾…åŠ©è§’è‰²ï¼Œä¸»è¦é€‚ç”¨äºé»‘å¨ƒã€åƒµåƒµã€æœµæœµã€å‚€å„¡ã€åŒå­ã€ç”µéŸ³ã€å¤ªå¹³ä¹ã€æ‚Ÿç©ºç­‰è§’è‰²ã€è§’åº¦ã€å’Œã€èµ°ä½ã€ç»ƒä¹ </span>
<span class="collide-try-each-item-margin">2ï¸âƒ£ è¡€é‡æ¡ä»…ç”¨æ¥åŒºåˆ†é˜Ÿä¼ï¼Œå› ä¸ºè¡€é‡ä¼¤å®³ä½“ç³»å¾ˆå¤æ‚ï¼Œç›®å‰ä¸è€ƒè™‘å»å®ç°</span>
<span class="collide-try-each-item-margin">3ï¸âƒ£ è§’è‰²è¿åŠ¨é€Ÿåº¦å’Œè·ç¦»å¯èƒ½å’Œå®æˆ˜æœ‰ä¸€å®šå·®è·ï¼Œåšåˆ°ä¸€æ¨¡ä¸€æ ·å¾ˆéš¾</span>
<span class="collide-try-each-item-margin">4ï¸âƒ£ å¯èƒ½å­˜åœ¨ä¸ªåˆ«è§’åº¦ï¼ˆç¢°å¢™è§’ï¼‰åå¼¹æœ‰ç‚¹é—®é¢˜ï¼Œè¯·ä»¥å®æˆ˜æ•°æ®ä¸ºå‡†</span>
<span class="collide-try-each-item-margin">5ï¸âƒ£ å…¼å®¹æ‰‹æœºã€å¹³æ¿ã€ç”µè„‘æµè§ˆå™¨</span>
<!-- 
<div class="collide-try-update-title"><b class="collide-try-each-item-border-bottom">ğŸ‘¨â€ğŸ« æ¸©é¦¨æç¤ºï¼š<span class="collide-try-update-date"></span></b></div>
<span class="collide-try-each-item-margin">æµè§ˆå™¨ä¼šå¯¹æ‰“å¼€è¿‡çš„ç½‘é¡µåšç¼“å­˜ï¼Œå¤šæ¬¡åˆ·æ–°åªä¼šå»æŸ¥è¯¢ç½‘é¡µæ˜¯å¦æœ‰å˜åŠ¨ï¼Œæ²¡å˜åŠ¨æ˜¯ä¸ä¼šé‡æ–°è¯·æ±‚ç½‘é¡µèµ„æºçš„ï¼Œæ‰€ä»¥ï¼Œ<b>ã€åˆ·æ–°é‡é€‰è§’è‰²ã€‘è¦ä¸äº†å¤šå°‘æµé‡å“¦~</b></span>
<span class="collide-try-each-item-margin">è¾“å…¥æ­£ç¡®è®¿é—®å¯†é’¥åï¼Œ<b>å¯ä»¥åˆ°è®¾ç½®é‡Œé¢ä¸‹è½½ç¦»çº¿ç‰ˆï¼ˆæ²¡æœ‰ç½‘ç»œä¹Ÿå¯ä»¥ç©ï¼‰</b>ï¼Œç‚¹å‡»ä¸‹è½½çš„htmlæ–‡ä»¶ä¼šç”¨é»˜è®¤æµè§ˆå™¨æ‰“å¼€ï¼Œä¹Ÿå¯ä»¥é•¿æŒ‰æ–‡ä»¶ï¼Œé€‰æ‹©å…¶ä»–æ–¹å¼æ‰“å¼€ã€‚</span>
<span class="collide-try-each-item-margin">æ‰‹æœºç³»ç»Ÿç‰ˆæœ¬è¿‡ä½ï¼Œå¯èƒ½ä¼šæœ‰å…¼å®¹é—®é¢˜ã€‚å¦‚æœçœ‹åˆ°ä¸€äº›å›¾å½¢æ˜¾ç¤ºä¸ºæ–¹å—ï¼Œéœ€è¦å‡çº§æ‰‹æœºç³»ç»Ÿæˆ–ç”¨æ–°çš„æ™ºèƒ½æ‰‹æœºæ‰“å¼€ï¼›å¦‚æœç½‘é¡µæ‰“å¼€ç™½å±ï¼Œåˆ™æ˜¯ç¨‹åºä¸å…¼å®¹ï¼Œå¯ä»¥æŠŠç½‘å€åé¢çš„â€œcollide-tryâ€æ”¹ä¸ºâ€œcollide-try-vueâ€ï¼ŒVueç‰ˆæœ¬çš„ç¨‹åºå…¼å®¹æ€§æ›´å¥½å“¦~</span>
-->

<div class="collide-try-update-title"><b class="collide-try-each-item-border-bottom">ğŸ†• V4.8.0 æ›´æ–°ï¼š<span class="collide-try-update-date">2025-09-07</span></b></div>
<pre id="collide-try-about-app-update-newest">
1. æ–°å¢ã€åªç¢°ä¸€æ¬¡è§’è‰²ã€‘å¼€å…³ï¼Œæ–¹ä¾¿ç»ƒä¹ ç¢°æ’åå¼¹è§’åº¦
2. ä¿®å¤äº†è§’è‰²ç¢°æ’åå¼¹è§’åº¦å¯èƒ½ä¸æ­£ç¡®çš„é—®é¢˜
3. ä¼˜åŒ–äº†ä¸€äº›å·²çŸ¥é—®é¢˜
</pre>
                <div class="collide-try-update-title"><b class="collide-try-each-item-border-bottom">V4.7.1 æ›´æ–°ï¼š<span
                            class="collide-try-update-date">2025-08-30</span></b></div>
                1. ä¼˜åŒ–äº†è´´è¾¹ç¢°æ’å¯èƒ½ç¢°ä¸åˆ°çš„é—®é¢˜
                2. è°ƒæ•´äº†åº”ç”¨åç§°

                <div class="collide-try-update-title"><b class="collide-try-each-item-border-bottom">V4.7.0 æ›´æ–°ï¼š<span
                            class="collide-try-update-date">2025-08-23</span></b></div>
                1. æ–°å¢è¡€é‡æ¡æ˜¾ç¤ºè§’è‰²ç¼–å·
                2. ä¼˜åŒ–äº†ä¸€äº›å·²çŸ¥é—®é¢˜

                <div class="collide-try-update-title"><b class="collide-try-each-item-border-bottom">V4.6.3 æ›´æ–°ï¼š<span
                            class="collide-try-update-date">2025-08-18</span></b></div>
                1. ä¿®å¤é«˜å±å¹•åˆ·æ–°ç‡ï¼ˆ90/120Hzï¼‰å…¼å®¹æ€§é—®é¢˜
                2. è¡¥å…¨è§’è‰²å½•å…¥ï¼ˆ70ä¸ªï¼‰

                <div class="collide-try-update-title"><b class="collide-try-each-item-border-bottom">V4.6.2 æ›´æ–°ï¼š<span
                            class="collide-try-update-date">2025-03-11</span></b></div>
                1. ä¸å…¬å¹³çš„æ¸¸æˆï¼Œå…¨æ˜¯â­•ï¸ğŸ’°ï¸å’Œç®—è®¡ï¼
                2. æ¸¸æˆçš„æ„ä¹‰åº”è¯¥æ˜¯å’Œæœ‰è¶£çš„äººè½»æ¾æ„‰å¿«åœ°äº«å—æ¸¸æˆè¿‡ç¨‹ï¼Œè€Œä¸æ˜¯æ¯æ—¥æ¯å¤œåƒç¯‡ä¸€å¾‹åœ°æ‰“æ¥æ‰“å»ã€æ¯”æ¥æ¯”å»ï¼

                <div class="collide-try-update-title"><b class="collide-try-each-item-border-bottom">V4.6.1 æ›´æ–°ï¼š<span
                            class="collide-try-update-date">2025-02-23</span></b></div>
                1. æ–°å¢ã€ç‚¹æŒ‰å‘å°„ã€‘æ“ä½œæ–¹å¼
                2. è¡¥å…¨è§’è‰²å½•å…¥ï¼ˆ67ä¸ªï¼‰

                <div class="collide-try-update-title"><b class="collide-try-each-item-border-bottom">V4.6.0 æ›´æ–°ï¼š<span
                            class="collide-try-update-date">2025-01-29</span></b></div>
                1. ä¼˜åŒ–è§’è‰²ç¢°æ’åå¼¹è§’åº¦é—®é¢˜
                2. è°ƒæ•´å°é¢æ–œè¾¹è§’åº¦æ›´æ¥è¿‘å®æˆ˜
                3. è¡¥å…¨è§’è‰²å½•å…¥ï¼ˆ66ä¸ªï¼‰

                <div class="collide-try-update-title"><b class="collide-try-each-item-border-bottom">V4.5.5 æ›´æ–°ï¼š<span
                            class="collide-try-update-date">2024-11-24</span></b></div>
                1. åŒå­ã€æ‚Ÿç©ºåˆ†èº«é€Ÿåº¦è°ƒæ•´
                2. è¡¥å…¨è§’è‰²å½•å…¥ï¼ˆ65ä¸ªï¼‰

                <div class="collide-try-update-title"><b class="collide-try-each-item-border-bottom">V4.5.4 æ›´æ–°ï¼š<span
                            class="collide-try-update-date">2024-09-03</span></b></div>
                1. ä¼˜åŒ–å‚€å„¡ã€åƒµåƒµã€å¹½çµç­‰å¯ç©¿é€è§’è‰²ç¢°è›‹é—®é¢˜
                2. è¡¥å…¨è§’è‰²å½•å…¥ï¼ˆ63ä¸ªï¼‰

                <div class="collide-try-update-title"><b class="collide-try-each-item-border-bottom">V4.5.3 æ›´æ–°ï¼š<span
                            class="collide-try-update-date">2024-08-28</span></b></div>
                1. é‡æ–°è°ƒæ•´è§’è‰²é€Ÿåº¦å’Œæ‘©æ“¦åŠ›ï¼Œè®©è¿åŠ¨ç¢°æ’æ›´æ¥è¿‘å®æˆ˜

                <div class="collide-try-update-title"><b class="collide-try-each-item-border-bottom">V4.5.2 æ›´æ–°ï¼š<span
                            class="collide-try-update-date">2024-08-25</span></b></div>
                1. é€‰æ‹©è§’è‰²åˆ—è¡¨æ–°å¢ã€æ‚Ÿç©ºã€‘é€‰é¡¹
                2. ä¿®å¤è‡ªå®šä¹‰ä¸»é¢˜å·²çŸ¥çš„é—®é¢˜

                <div class="collide-try-update-title"><b class="collide-try-each-item-border-bottom">V4.5.1 æ›´æ–°ï¼š<span
                            class="collide-try-update-date">2024-08-21</span></b></div>
                1. æ–°å¢åŒå‡»ç –æ ¼åæ ‡è¡¥å…¨æ•°å­—åŠŸèƒ½
                2. åŠ å…¥è‡ªå®šä¹‰ä¸»é¢˜ã€å–è‰²å™¨ã€‘ï¼Œæ”¹é¢œè‰²æ›´ä¾¿æ·
                3. å®Œå–„è‡ªå®šä¹‰ä¸»é¢˜é‡ç½®åŠŸèƒ½

                <div class="collide-try-update-title"><b class="collide-try-each-item-border-bottom">V4.5.0 æ›´æ–°ï¼š<span
                            class="collide-try-update-date">2024-08-15</span></b></div>
                1. åˆ·æ–°é¡µé¢é‡é€‰è§’è‰²æ”¹ä¸ºç‚¹å‡»å·¦ä¸Šè§’é‡é€‰è§’è‰²ï¼Œä¸ç”¨é¢‘ç¹åˆ·æ–°é¡µé¢ï¼ŒèŠ‚çœæ€§èƒ½
                2. é€‰æ‹©è§’è‰²åˆ—è¡¨æ–°å¢ã€ç”µéŸ³å°‘å¥³ã€‘é€‰é¡¹
                3. ä¿®å¤è‡ªå®šä¹‰ä¸»é¢˜å·²çŸ¥çš„é—®é¢˜

                <div class="collide-try-update-title"><b class="collide-try-each-item-border-bottom">V4.4.0 æ›´æ–°ï¼š<span
                            class="collide-try-update-date">2024-08-12</span></b></div>
                1. è‡ªå®šä¹‰ä¸»é¢˜å°é²œç‰ˆï¼ˆæ”¯æŒè®¾ç½®èƒŒæ™¯å›¾ç‰‡ï¼Œåªä¼šåœ¨åº”ç”¨å†…å­˜å‚¨ï¼Œä¸ä¼šä¸Šä¼ å“¦~ï¼‰

                <div class="collide-try-update-title"><b class="collide-try-each-item-border-bottom">V4.3.0 æ›´æ–°ï¼š<span
                            class="collide-try-update-date">2024-08-08</span></b></div>
                1. ä¼˜åŒ–å‚€å„¡ã€åƒµåƒµç­‰è§’è‰²ç„å‡†æ—¶ä¸çµæ•çš„é—®é¢˜
                2. ä¼˜åŒ–é•¿æŒ‰å°é¢éšæœºé‡ç½®è§’è‰²ä½ç½®ä¸çµæ•çš„é—®é¢˜
                3. ä¿®å¤ç¢°è›‹æ—¶ä½ç½®åæ ‡ä¼šå‡ºç°åå·®çš„é—®é¢˜

                <div class="collide-try-update-title"><b class="collide-try-each-item-border-bottom">V4.2.4 æ›´æ–°ï¼š<span
                            class="collide-try-update-date">2024-08-06</span></b></div>
                1. é‡æ–°åŠ å…¥è®¿é—®å¯†é’¥ï¼ˆç©å‹ç§èŠè·å–å³å¯å“¦ï¼‰
                2. ã€å…³äºåº”ç”¨ã€‘æ·»åŠ ç½‘ç«™è¢«QQæµè§ˆå™¨å±è”½å£°æ˜

                <div class="collide-try-update-title"><b class="collide-try-each-item-border-bottom">V4.2.3 æ›´æ–°ï¼š<span
                            class="collide-try-update-date">2024-08-05</span></b></div>
                1. æ¸¸æˆåœºæ™¯å›¾å½¢é‡å é—®é¢˜ä¼˜åŒ–
                2. ã€å…³äºåº”ç”¨ã€‘æ·»åŠ äº†ç‰ˆæœ¬æ›´æ–°æ—¥æœŸ

                <div class="collide-try-update-title"><b class="collide-try-each-item-border-bottom">V4.2.2 æ›´æ–°ï¼š<span
                            class="collide-try-update-date">2024-08-02</span></b></div>
                1. æ–°å¢ã€æ“ä½œæŒ‡å—ã€‘è¯´æ˜ï¼Œé¦–æ¬¡è¿›å…¥æ¸¸æˆæ—¶æç¤º
                2. è°ƒæ•´åŒå­å›¾æ ‡ï¼ˆæœ‰æ˜¾ç¤ºé—®é¢˜å¯ä»¥åé¦ˆä¸€ä¸‹ï¼‰
                3. æ›´æ–°ã€å…³äºåº”ç”¨ã€‘å†…å®¹

                <div class="collide-try-update-title"><b class="collide-try-each-item-border-bottom">V4.2.1 æ›´æ–°ï¼š<span
                            class="collide-try-update-date">2024-07-31</span></b></div>
                1. æ–°å¢ã€ç„å‡†ç©¿é€ã€‘å¼€å…³ï¼Œå¼¥è¡¥å‚€å„¡ã€åƒµåƒµç­‰å¯ç©¿é€è§’è‰²ç„å‡†æ—¶çš„æµç•…çµæ•åº¦
                2. è¡¥å…¨è§’è‰²å½•å…¥ï¼ˆ62ä¸ªï¼‰

                <div class="collide-try-update-title"><b class="collide-try-each-item-border-bottom">V4.2.0 æ›´æ–°ï¼š<span
                            class="collide-try-update-date">2024-07-21</span></b></div>
                1. æ–°å¢ã€å¤æ—¥ä¸»é¢˜ã€‘
                2. ä¸»é¢˜æ¨¡å¼éšå­£èŠ‚è‡ªåŠ¨åˆ‡æ¢
                3. è¡¥å…¨è§’è‰²å½•å…¥ï¼ˆ61ä¸ªï¼‰

                <div class="collide-try-update-title"><b class="collide-try-each-item-border-bottom">V4.1.5 æ›´æ–°ï¼š<span
                            class="collide-try-update-date">2024-07-18</span></b></div>
                1. æ–°å¢ã€æ˜¾ç¤ºè§’è‰²è¿åŠ¨è·¯å¾„ã€‘å¼€å…³åŠŸèƒ½
                2. ä¿®å¤ç§»åŠ¨ç«¯å¤šç‚¹è§¦ç¢°å¯èƒ½å‡ºç°å¡æ­»çš„é—®é¢˜
                3. åŠ å…¥è¶…æ—¶è‡ªåŠ¨ç»“æŸï¼ˆé»˜è®¤20ç§’ï¼‰ï¼Œé¿å…ç¨‹åºä¸€ç›´å¡æ­»æ¶ˆè€—æ€§èƒ½
                4. ã€ä¿å­˜ç¦»çº¿ç‰ˆã€‘ï¼ˆä¸ç”¨è”ç½‘ï¼‰æ”¹ä¸ºã€ä¸‹è½½ç¦»çº¿ç‰ˆã€‘ï¼ˆè¦è”ç½‘ï¼Œæ›´å¯é ï¼‰

                <div class="collide-try-update-title"><b class="collide-try-each-item-border-bottom">V4.1.4 æ›´æ–°ï¼š<span
                            class="collide-try-update-date">2024-05-24</span></b></div>
                1. å…¼å®¹é€‚é…å¹³æ¿æµè§ˆå™¨
                2. è§’è‰²å›¾æ ‡ã€åœºæ™¯ä¸»é¢˜å›¾å½¢å¤§å°è°ƒæ•´
                3. åŠ å…¥ã€å‘Šåˆ«ã€ä¿¡æ¯ï¼Œé€€æ¸¸ä¸€æ®µæ—¶é—´

                <div class="collide-try-update-title"><b class="collide-try-each-item-border-bottom">V4.1.3 æ›´æ–°ï¼š<span
                            class="collide-try-update-date">2024-04-10</span></b></div>
                1. æ–°å¢ã€æ˜¾ç¤ºè§’è‰²åæ ‡ã€‘åŠŸèƒ½
                2. æ–°å¢ã€åˆ†äº«/å¯¼å…¥è§’è‰²åŠåæ ‡ã€‘åŠŸèƒ½

                <div class="collide-try-update-title"><b class="collide-try-each-item-border-bottom">V4.1.2 æ›´æ–°ï¼š<span
                            class="collide-try-update-date">2024-03-27</span></b></div>
                1. ç¦»çº¿ç‰ˆè°ƒæ•´ä¸ºä¸éœ€è¦è¾“å…¥è®¿é—®å¯†é’¥
                2. æ–°å¢åˆ‡æ¢ã€ä¸»è§’æ‰€åœ¨é˜Ÿé¢œè‰²ã€‘åŠŸèƒ½
                3. ä¼˜åŒ–ã€åªæ˜¾ç¤ºæ’å‡»å°é¢ã€‘ã€ã€æ˜¾ç¤ºåœºæ™¯å›¾å½¢ã€‘å¼€å…³ï¼Œå…åˆ·æ–°é¡µé¢

                <div class="collide-try-update-title"><b class="collide-try-each-item-border-bottom">V4.1.1 æ›´æ–°ï¼š<span
                            class="collide-try-update-date">2024-03-18</span></b></div>
                1. æ–°å¢ã€æ˜¾ç¤ºç –æ ¼åæ ‡ã€‘åŠŸèƒ½
                2. æ–°å¢ã€é•¿æŒ‰é‡ç½®è§’è‰²ä½ç½®ã€‘åŠŸèƒ½
                3. ä¼˜åŒ–ã€æ˜¾ç¤ºå°é¢è¾¹æ¡†ã€‘ã€ã€æ˜¾ç¤ºç –æ ¼åæ ‡ã€‘å¼€å…³ï¼Œå…åˆ·æ–°é¡µé¢

                <div class="collide-try-update-title"><b class="collide-try-each-item-border-bottom">V4.1.0 æ›´æ–°ï¼š<span
                            class="collide-try-update-date">2024-03-13</span></b></div>
                1. æ–°å¢ã€ç„å‡†æ˜¾ç¤ºè·¯å¾„ã€‘åŠŸèƒ½
                2. ä¿®å¤ã€åªç„å‡†ä¸æ‰“ã€‘æ—¶çš„æ‹–åŠ¨é—®é¢˜
                3. åŠ å…¥æ›´æ–°æç¤º
                4. ä¼˜åŒ–æ‹–åŠ¨ã€ç„å‡†æ—¶çš„åŠ¨ç”»æ¸²æŸ“ï¼Œå‡å°‘æ€§èƒ½æ¶ˆè€—

                <div class="collide-try-update-title"><b class="collide-try-each-item-border-bottom">V4.0.3 æ›´æ–°ï¼š<span
                            class="collide-try-update-date">2024-03-11</span></b></div>
                1. å®ç°å‚€å„¡æ‹‰å›åŠŸèƒ½
                2. æ–°å¢å¤ªå¹³ä¹ç»ƒä¹ é€‰é¡¹

                <div class="collide-try-update-title"><b class="collide-try-each-item-border-bottom">V4.0.2 æ›´æ–°ï¼š<span
                            class="collide-try-update-date">2024-03-09</span></b></div>
                1. ä¿®å¤åƒµåƒµã€å‚€å„¡ç„å‡†æ—¶ç©¿é€é—®é¢˜
                2. å®ç°ç”µéŸ³çªç ´åŠ é€Ÿæ•ˆæœ
                3. åŠ å…¥è®¿é—®å¯†é’¥ï¼ˆç©å‹ç§èŠè·å–å³å¯å“¦ï¼‰

                <div class="collide-try-update-title"><b class="collide-try-each-item-border-bottom">V4.0.1 æ›´æ–°ï¼š<span
                            class="collide-try-update-date">2024-03-07</span></b></div>
                1. æ–°å¢ã€ä¿å­˜ç¦»çº¿ç‰ˆã€‘åŠŸèƒ½
                2. è®¾ç½®ä¸»è§’æ—¶ï¼Œæç¤ºä½¿ç”¨ã€æé€Ÿå¼€å§‹ã€‘æ‰ç”Ÿæ•ˆ

                <div class="collide-try-update-title"><b class="collide-try-each-item-border-bottom">V4.0.0 æ›´æ–°ï¼š<span
                            class="collide-try-update-date">2024-03-02</span></b></div>
                1. å¯ä»¥åœ¨è®¾ç½®é‡Œé¢æŒ‡å®šä»»æ„è§’è‰²
                2. æ–°å¢ã€åŒå‡»å±å¹•å›é€€ã€‘é‡æ‰“åŠŸèƒ½
                3. æ¸¸æˆç•Œé¢å³ä¸Šè§’åŠ å…¥éšå½¢è®¾ç½®æŒ‰é’®ï¼Œå¤šé¡¹è®¾ç½®ä¸ç”¨åˆ·æ–°é¡µé¢
                4. æ–°å¢ã€å…³äºåº”ç”¨ã€‘ä¿¡æ¯
                5. è§’è‰²åŠ¨ç”»åˆ†å±‚ä¼˜åŒ–ï¼Œå‡å°‘æ€§èƒ½æ¶ˆè€—


                <b class="collide-try-each-item-border-bottom">ğŸ”— å‚è€ƒæ–‡ç« ï¼š</b>
                <a target="_blank"
                    href="https://www.kai666666.com/2020/07/28/Canvas%E7%B3%BB%E5%88%97%EF%BC%8814%EF%BC%89%EF%BC%9A%E5%AE%9E%E6%88%98-%E5%B0%8F%E7%90%83%E7%A2%B0%E6%92%9E/">Canvasç³»åˆ—ï¼ˆ14ï¼‰ï¼šå®æˆ˜-å°çƒç¢°æ’</a><a
                    target="_blank" href="https://cloud.tencent.com/developer/article/1722313"> â‘¡ </a>
                <a target="_blank"
                    href="https://www.kai666666.com/2020/08/04/Canvas%E7%B3%BB%E5%88%97%EF%BC%8816%EF%BC%89%EF%BC%9A%E5%AE%9E%E6%88%98-%E5%B0%8F%E7%90%83%E4%B8%8E%E6%96%9C%E9%9D%A2%E7%A2%B0%E6%92%9E/">Canvasç³»åˆ—ï¼ˆ16ï¼‰ï¼šå®æˆ˜-å°çƒä¸æ–œé¢ç¢°æ’</a><a
                    target="_blank" href="https://cloud.tencent.com/developer/article/1720496"> â‘¡ </a>
                <a target="_blank" href="https://www.w3cschool.cn/xjmuw/xjmuw-ymch25y5.html">canvasåŠ¨ç”»åŒ…æ•™ä¸åŒ…ä¼šï¼šåæ ‡æ—‹è½¬å’Œæ–œé¢åå¼¹</a>
                <a target="_blank" href="https://juejin.cn/post/7016972355956113439">ä½¿ç”¨canvasåˆ¶ä½œä¸€ä¸ªå°çƒç¢°æ’æ¨¡å‹</a>

                </pre>

                <br><br>
                <div id="collide-try-bye-reason" class="collide-try-goodbye">
                    <pre>
<div class="collide-try-update-title"><b class="collide-try-each-item-border-bottom">å‡ ä¸ªæ¸¸æˆå…¬å¹³å»ºè®®ï¼š<span class="collide-try-update-date"></span></b></div>
<span class="collide-try-each-item-margin">â‘  å¼€å±€åœ¨é€‰æ‹©è§’è‰²æ¡†ä¸‹æ–¹åŠ å…¥â€œçŸ³å¤´å‰ªåˆ€å¸ƒâ€é€‰é¡¹ï¼Œè°èµ¢è°å…ˆæ‰‹ï¼ç³»ç»Ÿä¸è¦å¸®é€‰ï¼Œä¸é€‰åˆ™åæ‰‹ï¼Œé€‰å®Œåœ¨æ¸¸æˆç•Œé¢å…¬ç¤ºï¼å¹³å±€å†æŒ‰ç°æœ‰çš„è“çº¢é¡ºåºè½®æµå…ˆæ‰‹æ–¹å¼</span>
<span class="collide-try-each-item-margin">â‘¡ 1å·ä½å…ˆæ‰“ï¼Œ2å·ä½åæ‰“ï¼Œäº¤ç»™ç©å®¶è‡ªå·±å†³å®šï¼Œç©å®¶å°±æƒ³1å·ä½å…ˆæ‰“å°±è¿™ä¹ˆéš¾ï¼Ÿï¼ˆå·²å®ç°ï¼‰</span>
<span class="collide-try-each-item-margin">â‘¢ å¼€å±€è§’è‰²ä½ç½®ã€ğŸŒ¿ã€ğŸ’£ã€ğŸ„ã€ğŸ”ª ç­‰é™·é˜±ä½ç½®ï¼Œè¯·å®Œå…¨éšæœºï¼å“ªæœ‰é‚£ä¹ˆå·§å°±åˆšå¥½ç»™ç›´çº¿ï¼Ÿ</span>
<span class="collide-try-each-item-margin">â‘£ åŠ å…¥ã€å…è®¸å‘è¨€äº¤æµã€å‹¾é€‰æ¡†ï¼Œåªè¦æœ‰ä¸€ä¸ªç©å®¶ä¸å‹¾é€‰ï¼Œå°±ä¸èƒ½å‘è¨€å’Œå‘è¡¨æƒ…ï¼</span>
<span class="collide-try-each-item-margin">â‘¤ åŠ å…¥ã€Šæ’ç‹ç­‰çº§èµ„æ ¼è¯ã€‹æœºåˆ¶ï¼Œæ ¹æ®ä¸Šä¸€ä¸ªèµ›å­£å’Œå½“å‰èµ›å­£æœ€é«˜æ®µä½è‡ªåŠ¨åŒºåˆ†ï¼Œå¤§å¥–èµ›ã€å¤§å¸ˆã€‘ä»¥ä¸‹æ®µä½åŠ å…¥æ’ç‹ç­‰çº§åŒ¹é…è§„åˆ™ï¼Œé¿å… 20ã€30 å¤šçº§çš„ç©å®¶é¢‘ç¹å¯¹é˜µæ»¡çº§å¤§ä½¬è¢«æ°”èµ°ï¼ç•™ä½æ–°ç”¨æˆ·æ‰æœ‰å¾— â­• å•Šï¼[ç‹—å¤´]</span>
<span class="collide-try-each-item-margin">â‘¥ ä¸­å¥–æ¦‚ç‡æœ‰åçˆ±å°±ä¸æäº†ï¼å›é¦ˆè¡£é£Ÿçˆ¶æ¯ä¹Ÿæ²¡é”™ ğŸ‘Œ</span>

ä½ åœ¨æ•™æˆ‘åšäº‹ï¼Ÿ
æ¸¸æˆå…¬å¹³ï¼ç©çš„äººæ›´å¤šï¼æ ¼å±€æ‰“å¼€ï¼


<div class="collide-try-update-title"><b class="collide-try-each-item-border-bottom">ä¸å…¬å¹³ï¼BUGå¤ªå¤šï¼å¤ªæµªè´¹æ—¶é—´ç²¾åŠ›ï¼<span class="collide-try-update-date"></span></b></div>
<span class="collide-try-each-item-margin">â€¢ ç‰ºç‰²å…¬å¹³æ¢åˆ©ç›Šï¼Œå®åœ¨æ˜¯ç©ä¸è¿‡ï¼æ¯å¤©éƒ½ä¼šè¢«ä¸å…¬å¹³å’Œå„ç§BUGæ°”ç‚¸ï¼ï¼ˆè¶Šæ˜¯åœ¨ä¹ï¼Œçœ‹å¾—è¶Šæ¸…ï¼Œå°±ä¼šè¶Šæ°”ï¼‰</span>
<span class="collide-try-each-item-margin">â€¢ å·¥ä½œã€ç”Ÿæ´»å·²ç»å¤Ÿç´¯äº†ï¼Œè¿˜è¦æ¯”æ¥æ¯”å»ï¼æ¸¸æˆå¨±ä¹æ”¾æ¾äº†ä¸ªå•¥ï¼Ÿæ¸¸æˆç¤¾äº¤çœŸçš„èƒ½äº¤åˆ°å¥½æœ‹å‹æˆ–å¥”ç°å¯¹è±¡ï¼Ÿ</span>
<span class="collide-try-each-item-margin">â€¢ 40çº§ä»¥ä¸‹ï¼ŒæŠ€å·§ä¸å¤Ÿã€æ²¡è§’è‰²æˆ–è€…åªæœ‰æ ‡é…ç»„åˆï¼Œå¾ˆéš¾æ‰“èµ¢é«˜é…ç»„åˆï¼Œå¤§æ¦‚ç‡ç™½é€ï¼›40çº§ä»¥ä¸Šï¼Œå‡ ä¹éƒ½æ˜¯é«˜é…ï¼Œå…ˆæ‰‹å’Œå¼€å±€ä½ç½®è‡³å…³é‡è¦ï¼Œä¸¤å±€ç”šè‡³ä¸‰å±€ä¸ç»™å…ˆæ‰‹ï¼Œå¤§æ¦‚ç‡è¿è·ªï¼å…ˆæ‰‹å’Œå¼€å±€å¥½ä½ç½®ç»™è°ï¼Œæ‡‚çš„éƒ½æ‡‚ï¼</span>
<span class="collide-try-each-item-margin">â€¢ è€—è´¹ä¸€ä¸¤å¹´å¥½ä¸å®¹æ˜“æ¢é½äº†é«˜é…ç»„åˆï¼Œåˆé™†ç»­æå‡ºæ–°çš„â€œä¸€åˆ€666â€çš„â­•ï¸ğŸ’°ï¸è§’è‰²ï¼Œæ°¸è¿œéƒ½æ˜¯èŠ±é’±çš„çˆ½ï¼Œä¸èŠ±é’±çš„é™ªç©ï¼</span>
<span class="collide-try-each-item-margin">â€¢ ä¸€ç›´åŒ¹é…æ»¡çº§æ»¡è§’è‰²çš„å¯¹æ‰‹ï¼Œè¿˜ä¸€ç›´ç»™å¯¹æ‰‹å…ˆæ‰‹å’Œå¼€å±€ä½ç½®ä¼˜åŠ¿ï¼Œè°æœ‰è¿™ä¸ªæ—¶é—´ç²¾åŠ›è¢«è¿™æ ·ç®—è®¡æˆå¼„ï¼Ÿæ¯å¤©æ‹¿ä¸€ä¸¤ä¸ªå°æ—¶å®è´µçš„ä¸šä½™æ—¶é—´æ¥ç©æ¸¸æˆï¼Œæ¢æ¥çš„å´æ˜¯ç®—è®¡å’Œæ°”æ„¤ï¼</span>


<div class="collide-try-update-title"><b class="collide-try-each-item-border-bottom">æ‰€ä»¥å‘¢ï¼Ÿè¿˜ç©å—ï¼Ÿ<span class="collide-try-update-date"></span></b></div>
<span class="collide-try-each-item-margin">â€¢ <b>æ¸…æ¥šè‡ªå·±ä¸ºä»€ä¹ˆç©è¿™ä¸ªæ¸¸æˆï¼</b>ä¸å…¬å¹³çš„äº‹æƒ…å¤šäº†å»äº†ï¼æ€•æµªè´¹æ—¶é—´ç²¾åŠ›å°±å‡å°‘åšä»»åŠ¡/å†²åˆ†çš„å±€æ•°ï¼Œæˆ–è€…è·Ÿå¥½å‹è¿‡ä¸€ä¸‹æ—¥å¸¸ä»»åŠ¡ã€åˆ‡ç£‹å‡ å±€ç»ƒä¹ è§’è‰²æŠ€å·§ï¼Œå†æˆ–è€…æ¯å¤©ç™»å½•ç­¾åˆ°å°±è¡Œäº†ï¼</span>
<span class="collide-try-each-item-margin">â€¢ <b>ç›®æ ‡æ®µä½æœŸæœ›å¤ªé«˜ä¼šç©å¾—å¾ˆç´¯ï¼</b>è§’è‰²æ­é…æ²¡å‡‘é½é«˜é…ï¼Œæ’å‡»æŠ€å·§ï¼ˆè§’åº¦ã€è¿å‡»ã€è½ç‚¹ï¼‰ç†Ÿç»ƒåº¦ä¸å¤Ÿï¼ˆè§’è‰² > æŠ€å·§ = è¿æ°”[æ°ªé‡‘]ï¼‰ï¼Œé‡åˆ°æ»¡çº§å¤§ä½¬æˆ–è€…çªç ´&é«˜é…ç»„åˆç¡®å®å¾ˆéš¾èµ¢ï¼ˆæ¯•ç«Ÿä»–ä»¬å·²ç»ç©äº†å‡ å¹´äº†ï¼‰ï¼å¾ˆå¤š 20ã€30 å¤šçº§çš„ç©å®¶å¤§å¥–èµ›é¢‘ç¹å¯¹é˜µæ»¡çº§å¤§ä½¬ï¼Œè¾“åˆ°æ€€ç–‘äººç”Ÿï¼Œæ²¡æŒºè¿‡è¿™æ®µè‰°éš¾çš„ç“¶é¢ˆæœŸå°±æ°”åˆ°ã€æ³¨é”€ã€‘äº†ï¼</span>
<span class="collide-try-each-item-margin">â€¢ <b>å¤§å¥–èµ›â€œæ—¥ä¸‰â€ï¼Œæœ€å¤šäºŒåå±€å®Œä¸æˆå°±æ”¾ä¸‹å§ï¼</b>å¹³å‡ä¸€å¤§å±€ï¼ˆ3å°å±€ï¼‰7 åˆ†é’Ÿï¼Œ10 å±€å°±ä¸€ä¸ªå¤šå°æ—¶ï¼Œ20 å±€ä¸¤å°æ—¶ä»¥ä¸Šï¼Œæ¯å¤©å‡ ä¸ªå°æ—¶ç©æ¸¸æˆæ˜¯æŒºå¥¢ä¾ˆçš„äº†ï¼ç”¨ä¸€åŠçš„æ¸¸æˆæ—¶é—´ç»è¥æ‰“ç†ç°å®ç”Ÿæ´»ï¼Œä¼šä¸ä¼šæ›´æœ‰æ„ä¹‰ï¼Ÿ</span>
<span class="collide-try-each-item-margin">â€¢ã€è§’è‰²æ‹¼ä¸è¿‡ã€‘+ã€ç³»ç»Ÿå…ˆåæ‰‹å’Œå¼€å±€ä½ç½®ç®—è®¡ã€‘+ã€ä¸€ä¸ªåŠ²å„¿ä¸è®¤è¾“ã€‘ï¼Œæ–°æ‰‹è§’è‰²è·Ÿé«˜é…è§’è‰²æ¯”æ‹¼ï¼Œå°±åƒâ€œé¸¡è›‹ç¢°çŸ³å¤´â€å’Œé«˜ç­‰æ•°å­¦ï¼Œæ‰“ä¸è¿‡å°±æ˜¯æ‰“ä¸è¿‡ï¼ä¸ä¼šå°±æ˜¯ä¸ä¼šï¼<b>è¿™ä¸ªã€æ‹¼è§’è‰²ã€‘çš„æ¸¸æˆåˆ«å¤ªè¾ƒåŠ²ç¡¬è‚ï¼40çº§ä¹‹å‰ï¼Œè§’è‰²å…‘æ¢è·¯çº¿å’ŒæŠ€å·§ç»ƒä¹ æ‰æ˜¯å…³é”®ï¼</b></span>


                    </pre>
                </div>
                <div id="collide-try-bye" class="collide-try-goodbye">
                    <span>å°±åªæƒ³å•çº¯åœ°ç©ä¸€ä¸‹æ¸¸æˆï¼Œ<br>å¯æ›¾æƒ³è¢«æ¸¸æˆç©å¾—ä¸€å¡Œç³Šæ¶‚ï¼</span><br>
                    <span id="see-you-next-time">æœ‰ç¼˜å†è§~</span>
                </div>
            </div>
        </div>

        <!-- SVG å›¾å½¢åŒºåŸŸï¼ŒCSS è®¾ç½®ä¸æ˜¾ç¤ºï¼Œå®½é«˜è¿‡å¤§ä¼šå¯¼è‡´åŸæœ‰æ ·å¼é”™ä½ -->
        <div class="svg-image-area">
            <!-- https://icons.bootcss.com/icons/snow2/ -->
            <!-- https://yqnn.github.io/svg-path-editor/ -->
            <!-- é»˜è®¤ä¸»é¢˜-ä¸­å¿ƒå›¾å½¢ -->
            <svg xmlns="http://www.w3.org/2000/svg" width="800" height="800" fill="#6274C490" id="svg-default-center"
                class="bi bi-default-center" viewBox="0 0 800 800">
                <path
                    d="M39,361l30.165-17.437,30.526,15.268L71.346,378.462Zm662.489-17.437,30.526-15.269L762,345l-29.985,18.194ZM252.321,295.575s-4-11.846,6.541-15.269c0,0,7.614-2.782,17.444,8.725,0,0,4.3,11.666-6.541,15.269C269.765,304.3,259.013,307.626,252.321,295.575Zm82.856-102.519s-1.426-13.026,10.9-10.906c0,0,8.137-.392,10.9,10.906,0,0,2.2,11.184-10.9,10.907C346.08,203.963,338.523,204.884,335.177,193.056Zm2.181,370.813s1.134-10.64,10.9-8.725c0,0,7.362-.237,10.9,8.725,0,0,1.475,12.706-10.9,10.906C348.26,574.775,339.665,575.264,337.358,563.869Zm104.66,2.181s1.121-11.772,13.083-10.906c0,0,9.711,2.567,8.722,10.906,0,0,.728,8.846-10.9,10.906C452.92,576.956,444,578.611,442.018,566.05ZM402.771,361.012s0.222-12.616,13.082-15.268c0,0,9.647-2.729,13.083,15.268,0,0-1.931,11.839-13.083,13.088C415.853,374.1,404.6,372.223,402.771,361.012ZM531,337c4.43,5.388,5.75,43.344,3,40l75.911-24.713Zm-19.208-47.969s-11.152-21.5-30.526-28.356l87.217-74.162Zm-74.135-32.719C428.364,235.6,394.038,50.255,398.41,60l-10.9,161.412S354.487,232.022,333,251.95l-82.856-54.531,58.871,82.887s-17.634,25.994-17.443,56.713L189,358l102.569,16.1s26.934,89.76,111.2,87.25c0,0,98.875,1.955,93.758-100.338,0,0-7.184-64.79-69.774-65.437,0,0-40.215-1.321-54.51,39.263,0,0-7.811,27.219,13.082,47.987,0,0-20.41-45.658,23.673-64.825,0,0,35.347-7.477,48.281,32.106,0,0,16.709,63.783-49.281,77.894,0,0-76.807,4.3-83.725-73.531C324.275,354.469,312.226,252.288,437.657,256.312ZM278.486,428.631L93.15,657.662,274.125,487.525s29.3,23.868,37.068,28.356L283,605l56.538-76.031s20.24,12.3,45.789,13.087L400.59,758s15.5-195.811,17.279-218.224C417.977,538.415,418,540,418,540s33.951-3.5,48-17l71,71-42.651-86.844s17.212-10.4,34.886-32.719L725.474,624.944,518.333,428.631s-42.507,62.707-113.382,67.619C404.951,496.25,343.848,502.446,278.486,428.631Z" />
            </svg>
            <!-- å†°é›ªä¸»é¢˜-ä¸­å¿ƒé›ªèŠ± -->
            <svg xmlns="http://www.w3.org/2000/svg" width="1600" height="1600" fill="#EEF0F220" id="svg-snow"
                class="bi bi-snow2" viewBox="0 0 1600 1600">
                <path
                    d="M 800 1600 a 50 50 90 0 1 -50 -50 v -129.3 l -64.6 64.7 a 50 50 90 0 1 -70.7 -70.8 L 750 1279.3 v -108.6 l -64.6 64.7 a 50 50 90 0 1 -70.7 -70.8 L 750 1029.3 V 886.6 l -123.6 71.3 l -49.5 185 a 50 50 90 1 1 -96.6 -26 l 23.7 -88.2 l -94 54.2 l -49.6 185 a 50 50 90 1 1 -96.6 -26 l 23.7 -88.2 l -112 64.6 a 50 50 90 0 1 -50 -86.6 l 112 -64.6 l -88.4 -23.7 a 50 50 90 1 1 26 -96.6 l 184.8 49.5 l 94 -54.2 l -88.2 -23.7 a 50 50 90 1 1 25.8 -96.6 l 185 49.5 L 700 800 l -123.6 -71.3 l -184.9 49.5 a 50 50 90 1 1 -25.8 -96.6 l 88.3 -23.7 l -94 -54.2 l -185 49.5 a 50 50 90 0 1 -25.8 -96.6 l 88.3 -23.7 l -112 -64.6 a 50 50 90 1 1 50 -86.6 l 112 64.6 l -23.7 -88.3 a 50 50 90 0 1 96.6 -25.8 l 49.5 184.9 l 94 54.2 l -23.6 -88.3 a 50 50 90 0 1 96.6 -25.8 l 49.5 184.9 l 123.6 71.3 V 570.7 L 614.7 435.4 a 50 50 90 1 1 70.7 -70.8 l 64.6 64.7 V 320.7 L 614.7 185.4 a 50 50 90 1 1 70.7 -70.8 l 64.6 64.7 V 50 a 50 50 90 0 1 100 0 v 129.3 l 64.7 -64.7 a 50 50 90 1 1 70.7 70.8 L 850 320.7 v 108.6 l 64.7 -64.7 a 50 50 90 1 1 70.7 70.8 L 850 570.7 v 142.7 l 123.6 -71.3 l 49.5 -185 a 50 50 90 1 1 96.6 26 l -23.6 88.2 l 94 -54.2 l 49.5 -185 a 50 50 90 1 1 96.6 26 l -23.6 88.2 l 112 -64.6 a 50 50 90 0 1 50 86.6 l -112 64.6 l 88.3 23.7 a 50 50 90 1 1 -26 96.6 l -184.8 -49.5 l -94 54.2 l 88.3 23.7 a 50 50 90 1 1 -26 96.6 l -184.8 -49.5 L 900 800 l 123.6 71.3 l 184.9 -49.5 a 50 50 90 0 1 25.9 96.6 l -88.3 23.7 l 94 54.2 l 184.9 -49.5 a 50 50 90 0 1 25.9 96.6 l -88.3 23.7 l 112 64.6 a 50 50 90 0 1 -50 86.6 l -112 -64.6 l 23.6 88.3 a 50 50 90 1 1 -96.6 25.8 l -49.5 -184.9 l -94 -54.2 l 23.6 88.3 a 50 50 90 0 1 -96.6 25.8 L 973.6 958 L 850 886.6 v 142.7 l 135.4 135.3 a 50 50 90 0 1 -70.7 70.8 l -64.7 -64.7 v 108.6 l 135.4 135.3 a 50 50 90 0 1 -70.7 70.8 l -64.7 -64.7 V 1550 a 50 50 90 0 1 -50 50 z" />
            </svg>
            <!-- é»˜è®¤ä¸»é¢˜-éª¨å¤´ -->
            <svg xmlns="http://www.w3.org/2000/svg" width="1156" height="517" fill="#FAF8F9A0" id="svg-bone"
                class="bi bi-bone" viewBox="0 0 1156 517">
                <path
                    d="M792.742,214l57.981,11c3.363-29.552-.866-54.089-7-78-2.4-9.366-.024-22.848-2-32-2.756-12.77-5.116-37.265,5-41,4.986-3.95,15.353-.123,20.994,2,17.974,6.764,38.175,12.06,55.981,20,7.922,3.532,15.683,10.442,23.993,14,11.179,4.787,21.369,6.927,30.989,13,9.948,6.279,18.756,14.747,28.989,21,10.71,6.539,22.34,9.5,32.99,16,29.58,18.072,58.62,36.04,84.97,57,13.08,10.4,24.71,32.444,26,54,0.61,10.3,1.26,27.307-5,31-6.46,4.477-16.89,2.009-25.99,4-23.16,5.063-56.47.19-80.98,0-9.79-.076-18.55-2.665-25.99,0,0.63,1.754.19,0.971,1,2,2.47,7.744,9.69,9.051,15.99,13,10.61,6.641,22.03,13.213,34.99,18,7.46,2.755,22.38,4.63,27.99,9h-1c-11.71,11.493-31.73,15.109-47.98,22-41.91,17.771-86.1,28-143.953,28-18.818,0-34.74,2-54.982,2H823.732c-5.875-1.889-8.167-7.075-12-11-0.354-17.627,7.822-25.443,13-37,10.049-22.45,19.493-45.007,19.993-77l-3-1c-7.616-5.636-41.911-9.444-53.982-12-4.534,52.915-31.062,101.589-51.984,140-6.922,12.709-17.711,39.253-34.988,40a18.324,18.324,0,0,1-1-6c3.474-3.869,3.686-8.7,6-14,5.09-11.667,10.537-23.4,16-36,14.961-34.548,40.4-82.758,41.986-128l-96.968-16c1.058,44.646-16.339,103.107-33.989,130-3.4,5.179-9.339,9.173-13,14-6.087,8.037-14.232,21.163-25.991,23-1.588-2.95-2.075-5.721-2-11,7.807-10.562,8.419-33.928,13-48,10.814-33.244,20.663-67.317,20.993-110h-2c-4.541-2.84-13.811.31-19.994-1-8.691-1.842-46.887-4.9-52.982-3,4.532,13.093,2,33.92,2,50,0,59.086-15.28,98.1-43.986,128l-4-2c-2.163-18.366,1.188-44.319,5-62q0.5-57.995,1-116c-22.312-.853-50.247,3.117-69.978,9-8.128,2.424-17.691.73-23.992,5-0.96,1.418-.976,3.273-1,6,5.5,8.265,1.426,25.461,3,37,4.01,29.431-17.2,68-28.991,87-4.908,7.908-8.173,23.353-19.993,24v-2c-3.549-5.645,0-30.838,0-40,0-34.26,4.652-65.063,5-101h-1c-2.467,1.738-4.363.709-8,2-12.15,4.316-26.066,10.022-37.988,15-7.112,2.97-16.413,2.355-16.994,12,3.65,5.559,3.123,27.578,3,37-0.324,24.556-14.154,38.656-25.992,52-4.013,4.524-6.914,10.639-14,12-1.124.144-1.787-.067-4-1-3.809-30.813,6.634-57.745,7-89h-2c-6.774,5.9-31.421,12.544-40.987,17-2.567,23.606-22.621,48.571-30.99,68-3.571,8.291-3.524,16.462-7,25-8.157,20.047-17.051,45.871-26.991,65-6.367,12.253-20.929,42.732-36.988,43a24.966,24.966,0,0,0-4-5c0.2-20.015,1.553-52.337-3-69-2.362-8.649-8.5-11.167-9-22,3.069-3.5,3.484-8.853,6-13,6.228-10.274,14.561-22.634,17.994-35a23.635,23.635,0,0,1-8-1,16.936,16.936,0,0,1-2-6c2.161-2.688,3.173-7.056,4-11h-1c-3.27,3.075-38.246,15.949-42.986,13-2.222-1.382-1.89-4.365-2-8,8.746-8.589,19.334-20.834,24.992-32h-2c-1.8,1.488-28.293,10.916-30.99,10-3.031-1.029-3.655-3.981-4-8,7.331-4.806,12.683-11.772,20.993-16v-1h-2c-6.953,4.614-44.236,12.022-54.982,10-1.113-2.476-1.687-3.233-2-7,3.921-3.582,16.349-13.578,17.994-18-13.905-1.408-28.469-9.161-39.987-14-4.759-2-12.629-.525-15-5-0.877-1.3-.894-2.467-1-5a18.058,18.058,0,0,0,4-3c78.125,0.41,150.189,14.25,216.929,26,11.007,1.938,35.66-13.768,43.986-18,3.636-1.848,12.182-3.6,14-7V256c-5.011-7.79-4.018-22.785-9-31-12.138-20.028-28.283-36.567-44.985-52-0.093-10.478,3.9-10.265,9-15,48.81,0.306,58.334,66.3,72.976,103,14.669-6.819,28.894-16.5,43.986-23,6.26-2.7,19.386-4.919,21.993-11-2.408-3.732-1.451-9.225-3-14-3.124-9.629-6.752-20.225-11-30-10.143-23.359-27.548-42.49-37.987-65-4.851-10.459-15.093-29.765,5-29,6.659,6.867,17.167,10.312,24.992,16,5.709,4.15,9.708,11.31,13.995,17l11,10c16.367,22.489,22.482,55.04,32.989,83,17.461-6.611,34.972-9.887,53.982-16,13-4.18,28.214-9.018,43.986-10,0.105-8.829-2.206-16.135-4-23-4.822-18.464-5.314-34.9-12-51-3.043-7.334-8.352-14.31-12-21-6.378-11.711-10.614-24.409-19.993-33a50.141,50.141,0,0,1,1-11c26.713-15.492,39.515.656,49.984,20,16.506,30.5,30.855,76.456,35.988,117,27.335-.087,52.049,1.905,77.975,2,0.445-28.115-8.134-49.972-15-71-5.828-17.862-8.185-32.654-15-49-4.326-10.382-22.8-39.378-17-53,2.189-5.133,7.417-7.271,11-11,27.522-1.686,35.066,13.431,45.985,31,16.622,26.746,22.822,59.785,30.99,96,4.425,19.621.079,41.827,4,62h6c7.736,4.675,24.731,2.585,34.989,5l56.981,10v-2c-2.106-3.544.138-10.073-1-15-3.084-13.361-.965-28.537-5-41-9.288-28.7-15.7-57.04-26.991-83-4.342-9.981-12.346-18.946-16.994-28-3.851-7.5-8.294-28.548-1-34,2.841-2.245,8.155-2.879,13-3,6.25,5.347,15.159,8.379,19.993,15C759.2,32.3,761.34,48.786,767.75,68c4.578,13.723,10.611,29.339,15,44q1.5,12,3,24C791.106,158.74,792.56,187,792.742,214Zm172.944-56c-3.7,2.2-10,1.3-14,3-10.252,4.349-21.064,15.4-24.992,26-11.145,30.082,19.654,64.22,51.983,56C1028.9,230.232,1018.28,160.747,965.686,158Zm140.954,63c-0.96,1.766-1.26,1.68-2,4,6,2.193,5.51,6.5,14,7a10.727,10.727,0,0,1,2-3c-0.64-1.754-.2-0.971-1-2-1.19-3.511-2.84-3.73-5-6h-8Z" />
            </svg>
            <!-- é»˜è®¤ä¸»é¢˜-çŸ³å¤´ -->
            <svg xmlns="http://www.w3.org/2000/svg" width="800" height="800" id="svg-stone" class="bi bi-stone"
                viewBox="0 0 1024 1024">
                <path
                    d="M614.737067 655.978667c2.4192 0.605867 43.178667-9.796267 46.199466-12.458667 6.4128-5.802667 84.535467-101.956267 97.719467-116.347733-0.610133-4.352 0.1152-2.901333-4.842667-6.165334l-49.9456-30.4768c3.264-3.869867-0.362667-1.3312 4.232534-2.299733l95.057066-38.8224c4.232533-1.6896 10.5216-3.0208 13.7856-6.894933l-39.424-49.5872c-5.568-7.8592-14.276267-17.416533-19.716266-24.5504-9.915733-12.9408-32.533333-39.061333-38.8224-50.1888-1.813333-3.268267-6.045867-9.796267-8.4608-13.064534-1.937067-2.538667-3.268267-4.1088-4.842667-6.7712l-21.768533-32.776533-23.825067-23.825067c-27.456-0.605867-24.3072-3.0208-37.009067-15.9616-17.2928-17.898667-58.2912-43.054933-76.189866-58.052266l-150.442667 17.9072-98.568533 3.0208-101.469867 185.642666c-8.465067 9.553067-18.261333 20.1984-26.1248 30.357334 3.264 4.714667 0.482133-1.450667 1.088 2.781866 0 0.2432-0.362667 1.450667-0.4864 1.937067 11.733333 2.781867 23.825067 6.7712 35.554133 10.039467l66.274134 24.187733c20.680533 7.739733 19.9552 11.1232 34.709333 28.177067l81.271467 96.0256c6.165333 7.377067 11.1232 14.148267 17.655466 21.2864 5.201067 5.6832 121.301333 41.723733 136.661334 46.314666 12.821333 3.7504 62.523733 21.892267 71.4752 20.322134l0.256 0.2432z"
                    fill="#13227a" p-id="3204"></path>
                <path
                    d="M458.120533 847.6672c10.402133 2.180267 31.5648-0.2432 42.449067-0.3584 40.029867-0.482133 90.461867-3.392 128.9216-3.268267 10.525867 0 10.525867 1.813333 18.0224-4.957866 21.6448-19.349333 29.755733-22.980267 54.664533-37.858134 10.282667-6.0416 31.2064-20.189867 40.64-23.940266l15.232-6.1696c0.366933-0.119467 1.693867-0.605867 2.180267-0.725334l49.344-158.6688a2027.989333 2027.989333 0 0 1 24.5504-79.825066c4.232533-12.817067 8.226133-26.363733 12.091733-38.698667 2.542933-8.226133 4.232533-11.490133 8.708267-16.448 2.658133-3.0208 7.8592-7.377067 9.314133-12.578133l-0.482133 5.9264c4.957867-4.475733-0.362667-12.578133-2.7776-17.053867-5.205333-9.796267-20.1984-44.987733-24.797867-52.608-3.0208-4.8384-47.044267-49.224533-54.545066-56.6016L682.709333 246.839467c-5.568-4.232533-15.36-3.5072-22.493866-5.077334l23.825066 23.825067 21.7728 32.776533c1.570133 2.6624 2.901333 4.232533 4.834134 6.7712 2.4192 3.268267 6.656 9.796267 8.465066 13.064534 6.293333 11.246933 28.906667 37.248 38.826667 50.1888 5.44 7.133867 14.148267 16.6912 19.707733 24.5504l39.428267 49.5872c-3.144533 3.7504-9.553067 5.201067-13.7856 6.894933l-122.3936 39.6672c3.025067 3.144533 90.824533-2.4192 95.185067-2.4192 11.972267 0.119467 22.370133-1.207467 35.191466-1.3312 10.5216-0.119467 24.5504-1.937067 36.040534-1.211733-3.7504 4.475733-24.311467 12.334933-32.290134 16.6912l-44.872533 20.322133c-4.5952 2.414933-6.894933 3.8656-11.485867 6.0416-13.184 14.391467-91.306667 110.5408-97.719466 116.347733-3.0208 2.781867-43.780267 13.184-46.199467 12.458667-4.8384 6.045867-8.221867 30.839467-10.039467 39.185067-26.850133-3.989333-79.0912-7.620267-110.178133-10.402134l-72.443733-5.563733c-25.518933-1.6896-23.7056-4.8384-32.0512 4.352-5.802667 6.293333-14.997333 18.2656-21.649067 22.856533-7.8592 5.3248-17.053867 11.127467-23.825067 17.053867l18.8672 12.9408c5.077333 3.746133 34.833067 40.3968 41.723734 47.650133l53.090133 63.735467-0.119467-0.128z"
                    fill="#13227a" p-id="3205"></path>
                <path
                    d="M186.248533 702.664533c3.144533-1.937067-1.813333-1.211733 5.077334-1.088l14.8736 2.295467c39.547733 7.253333 98.688 11.127467 138.116266 19.4688 6.7712-6.045867 15.965867-11.733333 23.825067-17.0496 6.7712-4.599467 15.965867-16.571733 21.649067-22.856533 8.3456-9.070933 6.532267-5.9264 32.0512-4.356267l72.443733 5.563733c31.202133 2.781867 83.451733 6.532267 110.178133 10.402134 1.8176-8.341333 5.320533-33.1392 10.039467-39.185067-8.951467 1.6896-58.653867-16.448-71.4752-20.317867-15.364267-4.599467-131.464533-40.635733-136.661333-46.318933-6.651733-7.2576-11.6096-14.0288-17.655467-21.2864l-81.271467-96.0256c-14.634667-17.053867-13.909333-20.4416-34.709333-28.177067l-66.286933-24.192c-11.733333-3.268267-23.825067-7.2576-35.554134-10.039466 0.119467-0.362667 0.4864-1.6896 0.4864-1.9328-0.605867-4.356267 2.176 1.9328-1.088-2.781867-17.898667 25.275733-11.733333 46.318933-8.465066 76.194133 2.781867 25.156267 5.077333 48.8576 7.620266 74.1376 1.6896 16.324267 13.179733 142.340267 16.6912 147.5456h0.1152z"
                    fill="#13227a" p-id="3206"></path>
                <path
                    d="M281.186133 817.070933c0.968533-4.475733-2.901333-1.207467 9.6768 1.3312l123.477334 22.737067c7.739733 1.454933 41.122133 9.796267 43.780266 6.528l-53.090133-63.735467c-6.7712-7.2576-36.6464-43.784533-41.723733-47.650133l-18.8672-12.9408c-39.547733-8.341333-98.688-12.334933-138.116267-19.4688l-14.8736-2.295467c-6.894933-0.123733-1.937067-0.849067-5.077333 1.088 16.448 18.8672 31.684267 37.853867 47.168 56.840534 3.869867 4.714667 44.266667 55.2704 47.7696 57.6896l-0.123734-0.123734z"
                    fill="#13227a" p-id="3207"></path>
                <path
                    d="M863.633067 470.216533l0.482133-5.9264c-1.450667 5.201067-6.651733 9.4336-9.314133 12.578134-4.475733 4.957867-6.1696 8.221867-8.708267 16.448-3.869867 12.334933-7.863467 25.8816-12.096 38.702933a2042.112 2042.112 0 0 0-24.5504 79.816533l-49.339733 158.673067c-0.482133 0.119467-1.8176 0.605867-2.176 0.725333l-15.240534 6.165334c-9.4336 3.7504-30.353067 17.783467-40.631466 23.9488-24.917333 14.754133-33.015467 18.385067-54.6688 37.8496-7.5008 6.775467-7.5008 4.957867-18.018134 4.957866-38.464-0.2432-88.891733 2.781867-128.925866 3.268267-11.008 0.123733-32.0512 2.542933-42.449067 0.366933-2.6624 3.264-36.040533-5.0816-43.780267-6.532266l-123.477333-22.7328c-12.578133-2.542933-8.708267-5.806933-9.6768-1.335467 4.957867 5.802667 104.3712 37.4912 111.022933 38.216533l100.501334 0.725334c65.668267 0.849067 132.1856-2.176 196.8896-5.802667 6.1696-0.362667 6.289067-0.2432 10.039466-3.144533a174.0928 174.0928 0 0 0 8.827734-7.253334c5.320533-4.714667 11.729067-9.553067 16.810666-13.909333l67.844267-56.1152c3.0208-4.714667 10.641067-52.002133 12.4544-61.435733 7.5008-39.185067 13.422933-85.504 24.917333-122.632534 4.8384-15.726933 32.896-107.153067 33.258667-115.7376v0.1152z"
                    fill="#13227a" p-id="3208"></path>
                <path
                    d="M743.300267 534.673067c5.316267-2.542933 8.098133-4.1088 13.422933-7.0144l52.612267-23.825067c9.309867-5.077333 33.501867-14.272 37.8496-19.592533-13.422933-0.8448-29.870933 1.3312-42.325334 1.450666-15.121067 0.119467-27.217067 1.6896-41.365333 1.570134-5.073067 0-76.066133 5.444267-79.697067 1.813333-5.444267 1.088-1.088-1.813333-4.962133 2.6624l58.658133 35.8016c5.806933 3.8656 4.957867 2.176 5.6832 7.253333l0.123734-0.119466z"
                    fill="#13227a" p-id="3209"></path>
            </svg>
            <!-- å¤æ—¥ä¸»é¢˜-å°é»„é¸­ -->
            <svg xmlns="http://www.w3.org/2000/svg" width="800" height="800" id="svg-yl-duck" class="bi bi-yl-duck"
                viewBox="0 0 1024 1024">
                <path
                    d="M212.5 465c-13.8 4.1-25.5 13.1-33.1 25.3-36.4 58.5-126.6 237.8 38.5 367.8 199.9 157.4 655 68.1 699.7-197.8C953.7 445.5 890 364.7 802.8 320c0 0-51-23.4-106.3 0l-484 145z"
                    fill="#FFDC48" p-id="4556"></path>
                <path
                    d="M526.2 543.3s191.5-7.9 194.7 78.2c1.6 42.1-122.8 357.8-467.3 260 0 0 281.2 161.6 574.6-59.6 216.9-280.7 21.3-572.1-123.4-508.3S526.2 543.3 526.2 543.3z"
                    fill="#FFBE3C" p-id="4557"></path>
                <path
                    d="M206 482.7c21.9 37.2 57.5 64.4 99 76.2 36 10.2 79.1 16.2 125.4 16.2 49.8 0 95.9-6.9 133.5-18.6 39.9-12.4 73.8-39.5 94.6-75.7 0.1-0.2 0.2-0.4 0.3-0.5 21.8-38 34.3-82 34.4-128.9 0.5-144.5-117.1-262.5-261.6-262.5C287.1 88.9 170 206 170 350.5c0.1 48.2 13.2 93.4 36 132.2z"
                    fill="#FFDC48" p-id="4558"></path>
                <path
                    d="M431.7 88.8c-16.7 0-33 1.6-48.8 4.6 95.3 28.8 165 117.7 164.6 222.2-0.1 41.5-11.2 80.3-30.4 113.9-0.1 0.2-0.2 0.3-0.3 0.5-18.4 32-48.4 56-83.6 66.9-33.2 10.4-74 16.5-118 16.5-34.3 0-66.6-3.7-94.9-10.2 21.7 26.7 51.3 46.2 84.8 55.7 36 10.2 79.1 16.2 125.4 16.2 49.8 0 95.9-6.9 133.5-18.6 39.9-12.4 73.8-39.5 94.6-75.7 0.1-0.2 0.2-0.4 0.3-0.5 21.8-38 34.3-82 34.4-128.9 0.5-144.5-117.1-262.6-261.6-262.6z"
                    fill="#FFBE3C" p-id="4559"></path>
                <path
                    d="M162 409.9l18.1-9.6c36.3-12.7 76.6-4.4 104.8 21.7 31.8 34 52.7 59.2 85.1 78.4 4.5 2.7 7.3 7.5 7.3 12.7v12.2c0 11.9-8.5 22.2-20.2 24.5-55.5 10.7-209.4 30.8-260-61.8-15.4-37.2 64.9-78.1 64.9-78.1z"
                    fill="#FF4160" p-id="4560"></path>
                <path
                    d="M324.6 464.1L304 447.6s-164.2 68.3-193.9 59.2c0.2 0.3 0.5 0.6 0.7 0.8 13.8 8.5 85.8 48.9 178.4 34.6 103.1-16 81-41.8 81-41.8-17.4-10.3-31.4-22.2-45.6-36.3z"
                    fill="#F43459" p-id="4561"></path>
                <path
                    d="M361.8 513.2c-51.5 12.7-179.2 36.7-257.2-13.4 56.8 79.1 199.6 60.3 252.6 50 11.7-2.3 20.2-12.5 20.2-24.5v-12.2c0-2.8-0.8-5.4-2.2-7.7-3.6 3.7-8.2 6.5-13.4 7.8z"
                    fill="#DB214E" p-id="4562"></path>
                <path
                    d="M776.9 784.8s-125.5 61.7-153.1-51c-25.5-146.7 140.4-117 163.8-153.1 25.8-39.9 42.5-112.7 70.2-70.2s32.9 210.5-80.9 274.3z"
                    fill="#FFDC48" p-id="4563"></path>
                <path
                    d="M667 793.5c46.6 22.4 109.9-8.8 109.9-8.8C890.7 721 885.4 553 857.7 510.4s-44.3 30.3-70.2 70.2c26.3 95.2-16.2 172.2-120.5 212.9z"
                    fill="#FFBE3C" p-id="4564"></path>
                <path d="M405.2 357.4m-40.7 0a40.7 40.7 0 1 0 81.4 0 40.7 40.7 0 1 0-81.4 0Z" fill="#FFBE3C"
                    p-id="4565"></path>
                <path d="M397.4 351.7m-40.7 0a40.7 40.7 0 1 0 81.4 0 40.7 40.7 0 1 0-81.4 0Z" fill="#5E4153"
                    p-id="4566"></path>
                <path
                    d="M918.4 421.2c-20.9-49.4-55.8-85.2-109.7-112.9-0.2-0.1-0.3-0.2-0.5-0.2-2.2-1-50.4-22.5-105.8-4.3-10.4-60.4-40.9-115.8-87-157.3-50.6-45.6-115.8-70.7-183.7-70.7-151.4 0-274.6 123.2-274.6 274.6 0 15.2 1.3 30.4 3.7 45.3l-4.8 2.5c-9.7 5-90.3 47.9-70.9 94.7 0.2 0.4 0.4 0.9 0.6 1.3 12.4 22.6 30 39.1 50.7 50.9-33.2 79.6-61.1 217.3 73.4 323.1 57.7 45.4 136.9 72.8 229.2 79.2 13.4 0.9 26.9 1.4 40.5 1.4 74.5 0 150.8-13.8 218.5-40 60.7-23.5 113.5-56.6 152.5-95.8 43.6-43.8 70.5-94.5 79.9-150.6 17.3-102.5 13.3-181.4-12-241.2zM431.7 101.9c126.8 0 233 95 247 221 1 9.3 1.6 18.9 1.5 28.4-0.1 43-11.4 85.3-32.7 122.4-0.1 0.2-0.3 0.5-0.3 0.6-19.3 33.5-50.2 58.3-87.2 69.8-37.8 11.8-82.6 18-129.6 18-20.3 0-40.4-1.2-59.6-3.5 11.8-6.5 19.6-19.1 19.6-33.2v-12.2c0-9.8-5.2-19-13.7-24-26.2-15.5-44.3-35.1-69.4-62.3-4.1-4.4-8.4-9-12.8-13.8-0.2-0.2-0.4-0.5-0.7-0.7-29.3-27.2-70-37.2-108.3-27.4-1.6-11.4-2.4-23-2.4-34.6 0-3.1 0.1-6.1 0.2-9.2C194.5 334 202 321.4 202 307c0-9.7-3.4-18.6-9.1-25.6 30-103.5 125.7-179.5 238.8-179.5zM109 482.5c-6.3-17.8 31.2-46.8 59-61 0.1 0 0.1-0.1 0.2-0.1l17.2-9.1c31.4-10.7 65.9-3.4 90.4 19 4.3 4.6 8.4 9.1 12.4 13.3 25.6 27.7 45.8 49.5 75.3 67 0.5 0.3 0.9 0.9 0.9 1.5v12.2c0 5.7-4 10.6-9.6 11.7-45.8 8.8-198.2 30.8-245.8-54.5z m795.7 175.6c-16.3 97.1-95.1 179.6-216.1 226.4-161.7 62.5-356.3 47-462.6-36.7-115.4-90.8-101.4-206.4-66-291.4 31.6 12.1 67.4 16.2 101.1 16.2 13.2 0 26.1-0.6 38.3-1.6 0.7 0.2 1.3 0.4 2 0.6 38.4 10.9 83 16.7 128.9 16.7 49.6 0 97.1-6.6 137.4-19.2 43.2-13.5 79.5-42.5 102.1-81.8l0.2-0.3c0-0.1 0.1-0.1 0.1-0.2 23.5-41 36-87.8 36.2-135.4 0-7-0.2-14-0.8-21 45.9-17.4 88.4 0.1 91.5 1.4 74.1 38 144.6 106.6 107.7 326.3z"
                    fill="#5E4153" p-id="4567"></path>
                <path
                    d="M841.5 482.8c-19.6 1.3-31.1 25.4-44.5 53.4-6 12.5-12.1 25.4-18.7 35.6-4.4 6.8-25.8 11.8-44.8 16.2-27.9 6.5-62.5 14.6-87.9 35-30.4 24.5-41.5 61.9-32.9 111.3 0.1 0.3 0.1 0.6 0.2 0.9 8.3 33.7 25.5 56.9 51.1 68.9 14.1 6.6 29.2 9 43.8 9 39.1 0 74.6-17.2 76.7-18.2l0.6-0.3c60.1-33.7 85.2-91.6 95.7-134.2 16-64.8 7.3-131.6-10.4-158.7-8.6-13.3-18.3-19.6-28.9-18.9z m7 33c12.5 19.2 21.8 77.8 6.9 138.2-9.2 37.5-31.1 88.3-82.8 117.4-4.4 2.1-59 27-97.7 8.8-18-8.4-30.3-25.6-36.6-50.9-15.2-88.8 46.6-103.2 101.1-115.9 28.3-6.6 50.7-11.8 60.8-27.4 7.5-11.6 14.1-25.3 20.4-38.5 6.2-13 16.4-34.4 22.3-38.3 1 0.7 2.9 2.5 5.6 6.6z"
                    fill="#5E4153" p-id="4568"></path>
                <path d="M384.7 339.1m-12.7 0a12.7 12.7 0 1 0 25.4 0 12.7 12.7 0 1 0-25.4 0Z" fill="#FFFFFF"
                    p-id="4569"></path>
                <path
                    d="M225.5 485.3c-5.1-0.5-9.6-4-11.2-9.1-2.1-6.9 1.7-14.2 8.6-16.3 15.5-4.8 33.8-13 34-13.1 6.6-3 14.3 0 17.3 6.5 3 6.6 0 14.3-6.5 17.3-0.8 0.4-19.9 8.9-37 14.2-1.8 0.5-3.5 0.7-5.2 0.5z"
                    fill="#FFD7DF" p-id="4570"></path>
            </svg>

            <!-- è§’è‰²iconå›¾æ ‡ -->

        </div>

        <!-- æ˜¾ç¤ºconsole.logæ—¥å¿— -->
        <div id="info" ref="info" @click="show();" type="0"></div>
    </main>
</template>

<script setup>
import { onBeforeMount, onMounted, onBeforeUnmount, onUnmounted } from "vue";

const packageVersion = __APP_VERSION__;

// https://github.com/MaksymSemenykhin/javascript-aes
"use strict"; var Aes = {}; if (Aes.cipher = function (e, r) { for (var o = 4, n = r.length / o - 1, t = [[], [], [], []], s = 0; 4 * o > s; s++)t[s % 4][Math.floor(s / 4)] = e[s]; t = Aes.addRoundKey(t, r, 0, o); for (var f = 1; n > f; f++)t = Aes.subBytes(t, o), t = Aes.shiftRows(t, o), t = Aes.mixColumns(t, o), t = Aes.addRoundKey(t, r, f, o); t = Aes.subBytes(t, o), t = Aes.shiftRows(t, o), t = Aes.addRoundKey(t, r, n, o); for (var a = new Array(4 * o), s = 0; 4 * o > s; s++)a[s] = t[s % 4][Math.floor(s / 4)]; return a }, Aes.keyExpansion = function (e) { for (var r = 4, o = e.length / 4, n = o + 6, t = new Array(r * (n + 1)), s = new Array(4), f = 0; o > f; f++) { var a = [e[4 * f], e[4 * f + 1], e[4 * f + 2], e[4 * f + 3]]; t[f] = a } for (var f = o; r * (n + 1) > f; f++) { t[f] = new Array(4); for (var i = 0; 4 > i; i++)s[i] = t[f - 1][i]; if (f % o == 0) { s = Aes.subWord(Aes.rotWord(s)); for (var i = 0; 4 > i; i++)s[i] ^= Aes.rCon[f / o][i] } else o > 6 && f % o == 4 && (s = Aes.subWord(s)); for (var i = 0; 4 > i; i++)t[f][i] = t[f - o][i] ^ s[i] } return t }, Aes.subBytes = function (e, r) { for (var o = 0; 4 > o; o++)for (var n = 0; r > n; n++)e[o][n] = Aes.sBox[e[o][n]]; return e }, Aes.shiftRows = function (e, r) { for (var o = new Array(4), n = 1; 4 > n; n++) { for (var t = 0; 4 > t; t++)o[t] = e[n][(t + n) % r]; for (var t = 0; 4 > t; t++)e[n][t] = o[t] } return e }, Aes.mixColumns = function (e, r) { for (var o = 0; 4 > o; o++) { for (var n = new Array(4), t = new Array(4), s = 0; 4 > s; s++)n[s] = e[s][o], t[s] = 128 & e[s][o] ? e[s][o] << 1 ^ 283 : e[s][o] << 1; e[0][o] = t[0] ^ n[1] ^ t[1] ^ n[2] ^ n[3], e[1][o] = n[0] ^ t[1] ^ n[2] ^ t[2] ^ n[3], e[2][o] = n[0] ^ n[1] ^ t[2] ^ n[3] ^ t[3], e[3][o] = n[0] ^ t[0] ^ n[1] ^ n[2] ^ t[3] } return e }, Aes.addRoundKey = function (e, r, o, n) { for (var t = 0; 4 > t; t++)for (var s = 0; n > s; s++)e[t][s] ^= r[4 * o + s][t]; return e }, Aes.subWord = function (e) { for (var r = 0; 4 > r; r++)e[r] = Aes.sBox[e[r]]; return e }, Aes.rotWord = function (e) { for (var r = e[0], o = 0; 3 > o; o++)e[o] = e[o + 1]; return e[3] = r, e }, Aes.sBox = [99, 124, 119, 123, 242, 107, 111, 197, 48, 1, 103, 43, 254, 215, 171, 118, 202, 130, 201, 125, 250, 89, 71, 240, 173, 212, 162, 175, 156, 164, 114, 192, 183, 253, 147, 38, 54, 63, 247, 204, 52, 165, 229, 241, 113, 216, 49, 21, 4, 199, 35, 195, 24, 150, 5, 154, 7, 18, 128, 226, 235, 39, 178, 117, 9, 131, 44, 26, 27, 110, 90, 160, 82, 59, 214, 179, 41, 227, 47, 132, 83, 209, 0, 237, 32, 252, 177, 91, 106, 203, 190, 57, 74, 76, 88, 207, 208, 239, 170, 251, 67, 77, 51, 133, 69, 249, 2, 127, 80, 60, 159, 168, 81, 163, 64, 143, 146, 157, 56, 245, 188, 182, 218, 33, 16, 255, 243, 210, 205, 12, 19, 236, 95, 151, 68, 23, 196, 167, 126, 61, 100, 93, 25, 115, 96, 129, 79, 220, 34, 42, 144, 136, 70, 238, 184, 20, 222, 94, 11, 219, 224, 50, 58, 10, 73, 6, 36, 92, 194, 211, 172, 98, 145, 149, 228, 121, 231, 200, 55, 109, 141, 213, 78, 169, 108, 86, 244, 234, 101, 122, 174, 8, 186, 120, 37, 46, 28, 166, 180, 198, 232, 221, 116, 31, 75, 189, 139, 138, 112, 62, 181, 102, 72, 3, 246, 14, 97, 53, 87, 185, 134, 193, 29, 158, 225, 248, 152, 17, 105, 217, 142, 148, 155, 30, 135, 233, 206, 85, 40, 223, 140, 161, 137, 13, 191, 230, 66, 104, 65, 153, 45, 15, 176, 84, 187, 22], Aes.rCon = [[0, 0, 0, 0], [1, 0, 0, 0], [2, 0, 0, 0], [4, 0, 0, 0], [8, 0, 0, 0], [16, 0, 0, 0], [32, 0, 0, 0], [64, 0, 0, 0], [128, 0, 0, 0], [27, 0, 0, 0], [54, 0, 0, 0]], "undefined" != typeof module && module.exports && (module.exports = Aes), "undefined" != typeof module && module.exports) var Aes = require("./aes.js"); Aes.Ctr = {}, Aes.Ctr.encrypt = function (e, r, o) { var n = 16; if (128 != o && 192 != o && 256 != o) throw new Error("Key size is not 128 / 192 / 256"); e = String(e).utf8Encode(), r = String(r).utf8Encode(); for (var t = o / 8, s = new Array(t), f = 0; t > f; f++)s[f] = f < r.length ? r.charCodeAt(f) : 0; var a = Aes.cipher(s, Aes.keyExpansion(s)); a = a.concat(a.slice(0, t - 16)); for (var i = new Array(n), d = (new Date).getTime(), u = d % 1e3, c = Math.floor(d / 1e3), p = Math.floor(65535 * Math.random()), f = 0; 2 > f; f++)i[f] = u >>> 8 * f & 255; for (var f = 0; 2 > f; f++)i[f + 2] = p >>> 8 * f & 255; for (var f = 0; 4 > f; f++)i[f + 4] = c >>> 8 * f & 255; for (var A = "", f = 0; 8 > f; f++)A += String.fromCharCode(i[f]); for (var y = Aes.keyExpansion(a), h = Math.ceil(e.length / n), l = "", v = 0; h > v; v++) { for (var g = 0; 4 > g; g++)i[15 - g] = v >>> 8 * g & 255; for (var g = 0; 4 > g; g++)i[15 - g - 4] = v / 4294967296 >>> 8 * g; for (var w = Aes.cipher(i, y), b = h - 1 > v ? n : (e.length - 1) % n + 1, C = new Array(b), f = 0; b > f; f++)C[f] = w[f] ^ e.charCodeAt(v * n + f), C[f] = String.fromCharCode(C[f]); l += C.join(""), "undefined" != typeof WorkerGlobalScope && self instanceof WorkerGlobalScope && v % 1e3 == 0 && self.postMessage({ progress: v / h }) } return l = (A + l).base64Encode() }, Aes.Ctr.decrypt = function (e, r, o) { var n = 16; if (128 != o && 192 != o && 256 != o) throw new Error("Key size is not 128 / 192 / 256"); e = String(e).base64Decode(), r = String(r).utf8Encode(); for (var t = o / 8, s = new Array(t), f = 0; t > f; f++)s[f] = f < r.length ? r.charCodeAt(f) : 0; var a = Aes.cipher(s, Aes.keyExpansion(s)); a = a.concat(a.slice(0, t - 16)); for (var i = new Array(8), d = e.slice(0, 8), f = 0; 8 > f; f++)i[f] = d.charCodeAt(f); for (var u = Aes.keyExpansion(a), c = Math.ceil((e.length - 8) / n), p = new Array(c), A = 0; c > A; A++)p[A] = e.slice(8 + A * n, 8 + A * n + n); e = p; for (var y = "", A = 0; c > A; A++) { for (var h = 0; 4 > h; h++)i[15 - h] = A >>> 8 * h & 255; for (var h = 0; 4 > h; h++)i[15 - h - 4] = (A + 1) / 4294967296 - 1 >>> 8 * h & 255; for (var l = Aes.cipher(i, u), v = new Array(e[A].length), f = 0; f < e[A].length; f++)v[f] = l[f] ^ e[A].charCodeAt(f), v[f] = String.fromCharCode(v[f]); y += v.join(""), "undefined" != typeof WorkerGlobalScope && self instanceof WorkerGlobalScope && A % 1e3 == 0 && self.postMessage({ progress: A / c }) } return y = y.utf8Decode() }, "undefined" == typeof String.prototype.utf8Encode && (String.prototype.utf8Encode = function () { return unescape(encodeURIComponent(this)) }), "undefined" == typeof String.prototype.utf8Decode && (String.prototype.utf8Decode = function () { try { return decodeURIComponent(escape(this)) } catch (e) { return this } }), "undefined" == typeof String.prototype.base64Encode && (String.prototype.base64Encode = function () { if ("undefined" != typeof btoa) return btoa(this); if ("undefined" != typeof Buffer) return new Buffer(this, "binary").toString("base64"); throw new Error("No Base64 Encode") }), "undefined" == typeof String.prototype.base64Decode && (String.prototype.base64Decode = function () { if ("undefined" != typeof atob) return atob(this); if ("undefined" != typeof Buffer) return new Buffer(this, "base64").toString("binary"); throw new Error("No Base64 Decode") }), "undefined" != typeof module && module.exports && (module.exports = Aes.Ctr);


// https://github.com/zhouatie/plugin/tree/master/colorpicker
(function () {

    var util = {
        css: function (elem, obj) {
            for (var i in obj) {
                elem.style[i] = obj[i];
            }
        },
        hasClass: function (elem, classN) {
            var className = elem.getAttribute("class");
            return className.indexOf(classN) != -1;
        },
        // åˆ¤æ–­æ˜¯å¦ä¸ºé¢œè‰²ç 
        isColorCode: function (str) {
            if (!str || typeof str !== "string" || str.replaceAll(" ", "") === "") return false;
            if (!str.startsWith("#") || !(/^[A-Fa-f0-9]{3,8}$/.test(str.substring(1)))) return false;
            let len = str.substring(1).length; // å»æ‰#ï¼Œ3ã€4ã€6ã€8 æ­£å¸¸å¯ç”¨
            if (len === 5 || len === 7) return false;
            return true;
        },
        // é¢œè‰²çŸ­ç è¡¥å…¨ï¼ˆ8ä½å½¢å¼ï¼‰
        getFullColorCode: function (code) {
            if (!code || !this.isColorCode(code)) return code;
            // ä¸ç®—#ï¼Œ3ã€4 ä½çŸ­ç ï¼Œæ¯ä¸€ä½é‡å¤ä¸€æ¬¡
            // ç®—ä¸Š#ï¼Œå¾€åé¡ºç§»ä¸€ä½
            code = code.slice(1);
            if (code.length == 3) return '#' + code[0] + code[0] + code[1] + code[1] + code[2] + code[2] + "ff";
            if (code.length == 4) return '#' + code[0] + code[0] + code[1] + code[1] + code[2] + code[2] + code[3] + code[3];
            if (code.length == 6) return '#' + code + "ff";
            return '#' + code;
        },
        // è·å–ä¸å¸¦é€æ˜åº¦çš„é¢œè‰²ç +å¼€å¤´#
        getColorCodeNormal: function (code) {
            if (!code || !this.isColorCode(code)) return code;
            // ä¸ç®—#ï¼Œ3-æ¯ä¸€ä½é‡å¤ä¸€æ¬¡ï¼›4-å‰ä¸‰ä½æ¯ä¸€ä½é‡å¤ä¸€æ¬¡ï¼›6-ç›´æ¥è¿”å›ï¼›8-æˆªå–å‰6ä½
            code = code.slice(1);
            if (code.length === 4) code = code.substring(0, 3);
            if (code.length === 3) return '#' + code[0] + code[0] + code[1] + code[1] + code[2] + code[2];
            if (code.length === 6) return '#' + code;
            if (code.length > 6) return '#' + code.substring(0, 6);
            return '#' + code;
        }
    };

    function Colorpicker(elem) {

        this.bindElem = elem; // ç»‘å®šçš„å…ƒç´ 
        this.elem_wrap = null; // æœ€å¤–å±‚å®¹å™¨
        this.fixedBg = null; // æ‹¾è‰²å™¨åé¢å›ºå®šå®šä½çš„é€æ˜div ç”¨äºç‚¹å‡»éšè—æ‹¾è‰²å™¨
        this.elem_colorPickerPancel = null; // æ•´ä¸ªå–è‰²å™¨é¢æ¿
        this.elem_colorPancel = null; // è‰²å½©é¢æ¿
        this.elem_picker = null; // æ‹¾è‰²å™¨è‰²å—æŒ‰é’®
        this.elem_barPicker1 = null; // é¢œè‰²æ¡
        this.elem_barPicker2 = null; // é€æ˜æ¡
        this.elem_hexInput = null; // æ˜¾ç¤ºhexçš„è¡¨å•
        this.elem_showColor = null; // æ˜¾ç¤ºå½“å‰é¢œè‰²
        this.elem_opacityPancel = null; // é€æ˜åº¦èƒŒæ™¯å…ƒç´ 
        this.elem_showModeBtn = null; // åˆ‡æ¢è¾“å…¥æ¡†æ¨¡å¼æŒ‰é’®
        this.elem_inputWrap = null; // è¾“å…¥æ¡†å¤–å±‚å®¹å™¨

        this.pancelLeft = 0;
        this.pancelTop = 0;

        this.downX = 0;
        this.downY = 0;
        this.moveX = 0;
        this.moveY = 0;

        this.pointLeft = 0;
        this.pointTop = 0;

        this.current_mode = 'hex'; // inputæ¡†å½“å‰çš„æ¨¡å¼

        this.rgba = {
            r: 0,
            g: 0,
            b: 0,
            a: 1
        };

        this.hsb = {
            h: 0,
            s: 100,
            b: 100
        };

        try {
            this.init();
        } catch (e) {
            console.log(e.message);
        }
    };
    /*
    var default = {
        elem:obj,
        cards:['#000','#fff'],
        afterCreat : fn
    }
    */
    Colorpicker.Opt = {
        singleton: false, // TODO åç»­è€ƒè™‘ä¿®æ”¹ï¼Œå•ä¾‹å¹¶ä¸ä¸€å®šå°±å¥½ï¼Œéœ€è¦æ›´æ–°ä¸åŒç»‘å®šå…ƒç´ åŠäº‹ä»¶
        bindClass: '',
        initColor: "rgb(255,0,0)",
        allMode: ['hex', 'rgb']
    }

    Colorpicker.create = function (opt) {
        for (var prop in opt) {
            Colorpicker.Opt[prop] = opt[prop];
        };

        var elemArr = document.getElementsByClassName(Colorpicker.Opt.bindClass);

        for (var i = 0; i < elemArr.length; i++) {
            elemArr[i].colorpicker = new Colorpicker(elemArr[i]);
        }

    }

    Colorpicker.prototype = {
        render: function () {
            var tpl = '<div style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px;"></div>' +
                '<div style="position: inherit; z-index: 100;">' +
                '<div class="colorpicker-pancel" style="background: rgb(255, 255, 255); border-radius: 2px; box-shadow: rgba(0, 0, 0, 0.3) 0px 0px 2px, rgba(0, 0, 0, 0.3) 0px 4px 8px; box-sizing: initial; width: 225px; font-family: Menlo;"><div style="width: 100%; padding-bottom: 55%; position: relative; border-radius: 2px 2px 0px 0px; overflow: hidden;">' +
                '<div class="color-pancel" style="position: absolute; top: 0px; right: 0px; bottom: 0px; left: 0px; background: rgb(' + this.rgba.r + ',' + this.rgba.g + ',' + this.rgba.b + ')">' +
                '<style>' +
                '.saturation-white {background: -webkit-linear-gradient(to right, #fff, rgba(255,255,255,0));background: linear-gradient(to right, #fff, rgba(255,255,255,0));}' +
                '.saturation-black {background: -webkit-linear-gradient(to top, #000, rgba(0,0,0,0));background: linear-gradient(to top, #000, rgba(0,0,0,0));}' +
                '</style>' +
                '<div class="saturation-white" style="position: absolute; top: 0px; right: 0px; bottom: 0px; left: 0px;">' +
                '<div class="saturation-black" style="position: absolute; top: 0px; right: 0px; bottom: 0px; left: 0px;"></div>' +
                '<div class="pickerBtn" style="position: absolute; top: 0%; left: 100%; cursor: default;">' +
                '<div style="width: 14px; height: 14px; border-radius: 50%; box-shadow: rgb(255, 255, 255) 0px 0px 0px 1px inset; transform: translate(-6px, -6px);"></div>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '<div style="padding: 16px 16px 12px;">' +
                '<div class="flexbox-fix" style="display: flex;">' +
                '<div style="width: 32px; display: inline-flex; flex-direction: row; justify-content: flex-start; align-items: center;">' +
                '<div style="width: 20px; height: 20px; border-radius: 50%; position: relative; overflow: hidden;">' +
                '<div class="colorpicker-showColor" style="position: absolute; top: 0px; right: 0px; bottom: 0px; left: 0px; border-radius: 50%; box-shadow: rgba(0, 0, 0, 0.1) 0px 0px 0px 1px inset; background:rgb(' + this.rgba.r + ',' + this.rgba.g + ',' + this.rgba.b + '); z-index: 2;"></div>' +
                '<div class="" style="position: absolute; top: 0px; right: 0px; bottom: 0px; left: 0px; background: url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMUlEQVQ4T2NkYGAQYcAP3uCTZhw1gGGYhAGBZIA/nYDCgBDAm9BGDWAAJyRCgLaBCAAgXwixzAS0pgAAAABJRU5ErkJggg==&quot;) left center;"></div></div></div><div style="-webkit-box-flex: 1; flex: 1 1 0%;"><div style="height: 12px; position: relative; margin-bottom: 12px;"><div style="position: absolute; top: 0px;' + 'right: 0px; bottom: 0px; left: 0px;"><div class="hue-horizontal" style="padding: 0px 2px; position: relative; height: 100%;">' +
                '<style>' +
                '.hue-horizontal {background: linear-gradient(to right, #f00 0%, #ff0 17%, #0f0 33%, #0ff 50%, #00f 67%, #f0f 83%, #f00 100%);background: -webkit-linear-gradient(to right, #f00 0%, #ff0 17%, #0f0 33%, #0ff 50%, #00f 67%, #f0f 83%, #f00 100%);}' +
                '.hue-vertical {background: linear-gradient(to top, #f00 0%, #ff0 17%, #0f0 33%,#0ff 50%, #00f 67%, #f0f 83%, #f00 100%);background: -webkit-linear-gradient(to top, #f00 0%, #ff0 17%,#0f0 33%, #0ff 50%, #00f 67%, #f0f 83%, #f00 100%);}' +
                '</style>' +
                '<div  class="colorBar-color-picker" style="position: absolute; left: 0%;">' +
                '<div style="width: 14px; height: 14px; border-radius: 50%; transform: translate(-6px, -1px); background-color: rgb(248, 248, 248); box-shadow: rgba(0, 0, 0, 0.37) 0px 1px 4px 0px;">' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '<div style="height: 12px; position: relative;">' +
                '<div style="position: absolute; top: 0px; right: 0px; bottom: 0px; left: 0px;">' +
                '<div style="position: absolute; top: 0px; right: 0px; bottom: 0px; left: 0px; overflow: hidden;">' +
                '<div style="position: absolute; top: 0px; right: 0px; bottom: 0px; left: 0px; background: url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMUlEQVQ4T2NkYGAQYcAP3uCTZhw1gGGYhAGBZIA/nYDCgBDAm9BGDWAAJyRCgLaBCAAgXwixzAS0pgAAAABJRU5ErkJggg==&quot;) left center;"></div>' +
                '</div>' +
                '<div style="position: absolute; top: 0px; right: 0px; bottom: 0px; left: 0px; background: linear-gradient(to right, rgba(' + this.rgba.r + ',' + this.rgba.g + ',' + this.rgba.b + ',0) 0%, rgb(' + this.rgba.r + ',' + this.rgba.g + ',' + this.rgba.b + ') 100%);"></div>' +
                '<div style="position: relative; height: 100%;">' +
                '<div class="colorBar-opacity-picker" style="position: absolute; left: 100%;">' +
                '<div style="width: 14px; height: 14px; border-radius: 50%; transform: translate(-6px, -1px); background-color: rgb(248, 248, 248); box-shadow: rgba(0, 0, 0, 0.37) 0px 1px 4px 0px;"></div>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '<div class="flexbox-fix" style="padding-top: 10px; display: flex;">' +
                '<div class="flexbox-fix colorpicker-inputWrap" style="-webkit-box-flex: 1; flex: 1 1 0%; display: flex; margin-left: -6px;">';

            tpl += this.getInputTpl();
            tpl += '</div>' +
                '<div class="colorpicker-showModeBtn" style="width: 32px; text-align: right; position: relative; display: none;">' +
                '<div style="margin-right: -4px;  cursor: pointer; position: relative;">' +
                '<svg viewBox="0 0 24 24" style="width: 24px; height: 24px; border: 1px solid transparent; border-radius: 5px;"><path fill="#333" d="M12,5.83L15.17,9L16.58,7.59L12,3L7.41,7.59L8.83,9L12,5.83Z"></path><path fill="#333" d="M12,18.17L8.83,15L7.42,16.41L12,21L16.59,16.41L15.17,15Z"></path></svg>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>';

            return tpl;
        },
        getInputTpl: function (hex) {
            var current_mode_html = "";
            switch (this.current_mode) {
                case 'hex':
                    //var hex = "#"+this.rgbToHex(this.HSBToRGB(this.hsb));
                    current_mode_html += '<div style="padding-left: 6px; width: 100%;">' +
                        '<div style="position: relative;">' +
                        '<input class="colorpicker-hexInput" value="' + hex + '" maxlength="9" spellcheck="false" style="font-size: 11px; color: rgb(51, 51, 51); width: 100%; border-radius: 2px; border: none; box-shadow: rgb(218, 218, 218) 0px 0px 0px 1px inset; height: 21px; text-align: center;">' +
                        '<span style="text-transform: uppercase; font-size: 11px; line-height: 11px; color: rgb(150, 150, 150); text-align: center; display: block; margin-top: 12px; display: none;">hex</span>' +
                        '</div>' +
                        '</div>';
                    break;
                case 'rgb':
                    for (var i = 0; i < 3; i++) {
                        current_mode_html += '<div style="padding-left: 6px; width: 100%;">' +
                            '<div style="position: relative;">' +
                            '<input class="colorpicker-hexInput" value="' + this.rgba['rgb'[i]] + '" maxlength="3" spellcheck="false" style="font-size: 11px; color: rgb(51, 51, 51); width: 100%; border-radius: 2px; border: none; box-shadow: rgb(218, 218, 218) 0px 0px 0px 1px inset; height: 21px; text-align: center;">' +
                            '<span style="text-transform: uppercase; font-size: 11px; line-height: 11px; color: rgb(150, 150, 150); text-align: center; display: block; margin-top: 12px;">' + ('rgb'[i]) + '</span>' +
                            '</div>' +
                            '</div>';
                    }
                default:

            }
            return current_mode_html;
        },
        init: function () {
            // é¢œè‰²ç ç»Ÿä¸€è½¬å°å†™
            if (this.bindElem && this.bindElem.value) this.bindElem.value = this.bindElem.value.toLocaleLowerCase();

            var _this = this,
                initColor = (this.bindElem && this.bindElem.value && util.isColorCode(this.bindElem.value)) ? this.rgbToStr(this.hexToRgb(this.bindElem.value)) : Colorpicker.Opt.initColor,
                rgb = initColor.slice(4, -1).split(",");

            this.rgba.r = parseInt(rgb[0]);
            this.rgba.g = parseInt(rgb[1]);
            this.rgba.b = parseInt(rgb[2]);
            this.rgba.a = Number(rgb[3]);

            var body = document.getElementsByTagName("body")[0],
                div = document.createElement("div");

            div.innerHTML = this.render();
            div.classList.add("colorpicker-pancel-wrap");
            body.appendChild(div);

            this.elem_wrap = div;
            this.fixedBg = div.children[0];
            this.elem_colorPickerPancel = div.getElementsByClassName("colorpicker-pancel")[0];
            this.total_pancel_width = this.elem_colorPickerPancel.offsetWidth;
            this.total_pancel_height = this.elem_colorPickerPancel.offsetHeight;
            this.elem_colorPancel = div.getElementsByClassName("color-pancel")[0];
            this.pancel_width = this.elem_colorPancel.offsetWidth;
            this.pancel_height = this.elem_colorPancel.offsetHeight;
            this.elem_picker = div.getElementsByClassName("pickerBtn")[0];
            this.elem_showColor = div.getElementsByClassName("colorpicker-showColor")[0];
            this.elem_barPicker1 = div.getElementsByClassName("colorBar-color-picker")[0];
            this.elem_barPicker2 = div.getElementsByClassName("colorBar-opacity-picker")[0];
            this.elem_hexInput = div.getElementsByClassName("colorpicker-hexInput")[0];
            this.elem_showModeBtn = div.getElementsByClassName("colorpicker-showModeBtn")[0];
            this.elem_inputWrap = div.getElementsByClassName("colorpicker-inputWrap")[0];
            this.elem_opacityPancel = this.elem_barPicker2.parentNode.parentNode.children[1];

            // var rect = this.bindElem.getBoundingClientRect();
            var elem = this.bindElem;
            var top = elem.offsetTop;
            var left = elem.offsetLeft;
            /*
            while(elem.offsetParent) {
                top += elem.offsetParent.offsetTop;
                left += elem.offsetParent.offsetLeft;
                elem = elem.offsetParent;
            }
            */

            // å±…ä¸­
            top = Math.round(document.body.clientHeight / 6);
            left = Math.round(document.body.clientWidth - this.pancel_width);
            // å³ä¸‹è§’ï¼ˆè¾“å…¥æ³•ä¼šæŒ¡ä½è¾“å…¥æ¡†ï¼‰
            //top = Math.round(document.body.clientHeight - this.total_pancel_height - 50);
            //left = Math.round(document.body.clientWidth - this.total_pancel_width - 20);
            // ä¸‹æ–¹
            //top = Math.round(document.body.clientHeight - this.total_pancel_height - 50);
            //left = Math.round((document.body.clientWidth - this.pancel_width) / 2);
            //this.bindElem.offsetHeight = 0; // åªè¯»

            this.pancelLeft = left;
            //this.pancelTop = top + this.bindElem.offsetHeight;
            this.pancelTop = top;

            util.css(div, {
                "position": "absolute",
                "z-index": 999999999,
                "display": 'none',
                "left": left + "px",
                //"top": top + this.bindElem.offsetHeight + "px"
                "top": top + "px"
            });

            this.bindMove(this.elem_colorPancel, this.setPosition, true);
            this.bindMove(this.elem_barPicker1.parentNode, this.setBar, false);
            this.bindMove(this.elem_barPicker2.parentNode, this.setBar, false);

            this.bindElem.addEventListener("click", function () {
                _this.show();
            }, false);

            this.fixedBg.addEventListener("click", function (e) {
                _this.hide();
            }, false)

            this.elem_showModeBtn.addEventListener("click", function () {
                _this.switch_current_mode();
            }, false)

            this.elem_wrap.addEventListener("input", function (e) {
                var target = e.target,
                    value = target.value;

                _this.setColorByInput(value);
            }, false)
        },
        setPosition: function (x, y) {
            var LEFT = parseInt(x - this.pancelLeft),
                TOP = parseInt(y - this.pancelTop);

            this.pointLeft = Math.max(0, Math.min(LEFT, this.pancel_width));
            this.pointTop = Math.max(0, Math.min(TOP, this.pancel_height));

            util.css(this.elem_picker, {
                left: this.pointLeft + "px",
                top: this.pointTop + "px"
            })
            this.hsb.s = parseInt(100 * this.pointLeft / this.pancel_width);
            this.hsb.b = parseInt(100 * (this.pancel_height - this.pointTop) / this.pancel_height);

            this.setShowColor();
            this.setValue(this.rgba);

        },
        setBar: function (elem, x) {
            var elem_bar = elem.getElementsByTagName("div")[0],
                rect = elem.getBoundingClientRect(),
                elem_width = elem.offsetWidth,
                X = Math.max(0, Math.min(x - rect.x, elem_width));

            if (elem_bar === this.elem_barPicker1) {
                util.css(elem_bar, {
                    left: X + "px"
                });
                this.hsb.h = parseInt(360 * X / elem_width);
            } else {
                util.css(elem_bar, {
                    left: X + "px"
                });
                this.rgba.a = X / elem_width;
            }

            this.setPancelColor(this.hsb.h);
            this.setShowColor();
            this.setValue(this.rgba);

        },
        setPancelColor: function (h) {
            var rgb = this.HSBToRGB({ h: h, s: 100, b: 100 });

            util.css(this.elem_colorPancel, {
                background: 'rgba(' + rgb.r + ',' + rgb.g + ',' + rgb.b + ',' + this.rgba.a + ')'
            });
        },
        setShowColor: function () {
            var rgb = this.HSBToRGB(this.hsb);

            this.rgba.r = rgb.r;
            this.rgba.g = rgb.g;
            this.rgba.b = rgb.b;

            util.css(this.elem_showColor, {
                background: 'rgba(' + rgb.r + ',' + rgb.g + ',' + rgb.b + ',' + this.rgba.a + ')'
            });

            util.css(this.elem_opacityPancel, {
                background: 'linear-gradient(to right, rgba(' + rgb.r + ',' + rgb.g + ',' + rgb.b + ',0) 0%, rgba(' + rgb.r + ',' + rgb.g + ',' + rgb.b + ',1))'
            });
        },
        setValue: function (value) {
            var hex = value;
            if (typeof hex !== "string" || !hex.startsWith("#")) hex = "#" + this.rgbToHex(value); // è½¬æ¢ä¼šå¯¼è‡´è¯¯å·®
            this.elem_inputWrap.innerHTML = this.getInputTpl(hex);
            // this.bindElem.setAttribute("colorpickerOfColor",'#'+hex);
            // util.css(this.bindElem,{
            //     background:"#"+hex
            // })
            Colorpicker.Opt.change(this.bindElem, hex);

        },
        setColorByInput: function (value) {
            if (!util.isColorCode(value)) return;
            var _this = this;
            switch (this.current_mode) {
                case "hex":
                    this.hsb = this.hexToHsb(value);
                    break;
                case 'rgb':
                    var inputs = this.elem_wrap.getElementsByTagName("input"),
                        rgb = {
                            r: inputs[0].value ? parseInt(inputs[0].value) : 0,
                            g: inputs[1].value ? parseInt(inputs[1].value) : 0,
                            b: inputs[2].value ? parseInt(inputs[2].value) : 0
                        };

                    this.hsb = this.rgbToHsb(rgb);
            }

            this.changeViewByHsb(value);
        },
        changeViewByHsb: function (value) {
            this.pointLeft = parseInt(this.hsb.s * this.pancel_width / 100);
            this.pointTop = parseInt((100 - this.hsb.b) * this.pancel_height / 100);
            util.css(this.elem_picker, {
                left: this.pointLeft + "px",
                top: this.pointTop + "px"
            });

            this.setPancelColor(this.hsb.h);
            this.setShowColor();
            util.css(this.elem_barPicker1, {
                left: this.hsb.h / 360 * (this.elem_barPicker1.parentNode.offsetWidth) + "px"
            });

            //var hex = '#'+this.rgbToHex(this.HSBToRGB(this.hsb)); // è½¬æ¢ä¼šå¯¼è‡´è¯¯å·®
            var hex = value;
            if (!util.isColorCode(hex)) return;
            Colorpicker.Opt.change(this.bindElem, hex);
            // this.bindElem.setAttribute("colorpickerOfColor",hex);
            // util.css(this.bindElem,{
            //     background:hex
            // })
        },
        switch_current_mode: function () {
            this.current_mode = this.current_mode == 'hex' ? 'rgb' : 'hex';
            this.elem_inputWrap.innerHTML = this.getInputTpl();
        },
        bindMove: function (elem, fn, bool) {
            var _this = this;

            function mousemove(e) {
                if (e.pageX && typeof e.pageX === "number") {
                    _this.moveX = e.pageX;
                    _this.moveY = e.pageY;
                } else if (e.touches && e.touches[0]) {
                    _this.moveX = e.touches[0].pageX;
                    _this.moveY = e.touches[0].pageY;
                } else if (e.changedTouches && e.changedTouches[0]) { // touchend
                    _this.moveX = e.changedTouches[0].pageX;
                    _this.moveY = e.changedTouches[0].pageY;
                }
                bool ? fn.call(_this, _this.moveX, _this.moveY) : fn.call(_this, elem, _this.moveX, _this.moveY);
                e.preventDefault();
            }

            function mouseup(e) {
                document.removeEventListener("mousemove", mousemove, false)
                document.removeEventListener("mouseup", mouseup, false)
            }

            if (os.isPc) elem.addEventListener("mousedown", (e) => {
                _this.downX = e.pageX;
                _this.downY = e.pageY;
                bool ? fn.call(_this, _this.downX, _this.downY) : fn.call(_this, elem, _this.downX, _this.downY);

                document.addEventListener("mousemove", mousemove, false);
                document.addEventListener("mouseup", mouseup, false);
            }, false);

            // ç§»åŠ¨ç«¯å¼€å§‹è§¦æ‘¸äº‹ä»¶
            var currTouchPointNum = 0;
            if (!os.isPc) elem.addEventListener('touchstart', (e) => {
                //console.log(e);
                e.preventDefault();
                currTouchPointNum = e.touches.length;
                // ç›®å‰åªæ”¯æŒå•ç‚¹è§¦ç¢°
                if (currTouchPointNum !== 1) return;

            }, false);

            var lastTouchEnd = 0;
            if (!os.isPc) elem.addEventListener('touchend', (e) => {
                //console.log(e);
                //alert(e.touches.length);
                e.preventDefault();
                //if (e.type !== "touchend" && e.touches.length !== 0) return;
                if (currTouchPointNum !== 1) return;

                let now = (new Date()).getTime();
                if (now - lastTouchEnd <= 300) { // 200~300
                    //alert(">>>> åŒå‡»äº†");
                    //doDbClick(e);
                } else {
                    //alert(">>>> å•å‡»äº†");
                    //doClick(e);
                    mousemove(e);
                }
                lastTouchEnd = now;
            }, false);

            // ç§»åŠ¨ç«¯æ»‘åŠ¨äº‹ä»¶
            if (!os.isPc) elem.addEventListener('touchmove', (e) => {
                if (currTouchPointNum !== 1) return;
                mousemove(e);
            }, false);
        },
        show: function () {
            util.css(this.elem_wrap, {
                "display": "block"
            });

            if (util.isColorCode(this.bindElem.value)) {
                let value = util.getFullColorCode(this.bindElem.value);
                this.rgba = this.hexToRgb(value);
                //this.hsb = this.hexToHsb(value); // setColorByInput æ–¹æ³•ä¸­æœ‰
                // é€æ˜è¿›åº¦æ¡å®šä½
                let p2Left = this.elem_opacityPancel.getBoundingClientRect().left;
                //console.log(p2Left);
                let p2Width = this.elem_opacityPancel.offsetWidth;
                let a = 1, aStr = value.substring(7);
                if (aStr && aStr.length == 2) a = Math.floor(parseInt(aStr, 16) / 255 * 100) / 100;
                let x = p2Left + p2Width * a;
                this.setBar(this.elem_barPicker2.parentNode, x); // setBar æ–¹æ³•å†…éƒ¨ä¹Ÿä¼š setValue
                // è®¾ç½®é»˜è®¤é¢œè‰²
                this.setColorByInput(value);
                this.setValue(value);
            }

            var hex = "#" + this.rgbToHex(this.rgba);
            Colorpicker.Opt.show(this.bindElem, hex);
        },
        hide: function () {
            util.css(this.elem_wrap, {
                "display": "none"
            });
            var hex = "#" + this.rgbToHex(this.rgba);
            Colorpicker.Opt.hide(this.bindElem, hex);
        },
        HSBToRGB: function (hsb) {
            var rgb = {};
            var h = Math.round(hsb.h);
            var s = Math.round(hsb.s * 255 / 100);
            var v = Math.round(hsb.b * 255 / 100);

            if (s == 0) {
                rgb.r = rgb.g = rgb.b = v;
            } else {
                var t1 = v;
                var t2 = (255 - s) * v / 255;
                var t3 = (t1 - t2) * (h % 60) / 60;

                if (h == 360) h = 0;

                if (h < 60) { rgb.r = t1; rgb.b = t2; rgb.g = t2 + t3 }
                else if (h < 120) { rgb.g = t1; rgb.b = t2; rgb.r = t1 - t3 }
                else if (h < 180) { rgb.g = t1; rgb.r = t2; rgb.b = t2 + t3 }
                else if (h < 240) { rgb.b = t1; rgb.r = t2; rgb.g = t1 - t3 }
                else if (h < 300) { rgb.b = t1; rgb.g = t2; rgb.r = t2 + t3 }
                else if (h < 360) { rgb.r = t1; rgb.g = t2; rgb.b = t1 - t3 }
                else { rgb.r = 0; rgb.g = 0; rgb.b = 0 }
            }

            return { r: Math.round(rgb.r), g: Math.round(rgb.g), b: Math.round(rgb.b) };
        },
        rgbToHex: function (rgb) {
            //debugger;
            var hex = [
                rgb.r.toString(16),
                rgb.g.toString(16),
                rgb.b.toString(16),
                Math.round(255 * (rgb.a !== undefined && rgb.a >= 0 && rgb.a <= 1 ? rgb.a : (this.rgba.a !== undefined && this.rgba.a >= 0 && this.rgba.a <= 1 ? this.rgba.a : 1))).toString(16)
            ];
            hex.map(function (str, i) {
                if (str.length == 1) {
                    hex[i] = '0' + str;
                }
            });

            return hex.join('');
        },
        hexToRgb: function (hex) {
            var a = parseInt(((hex.indexOf('#') > -1 && hex.length == 9) ? hex.substring(7, 9) : "FF"), 16) * (1 / 255);
            var hex = parseInt(((hex.indexOf('#') > -1) ? hex.substring(1, 7) : hex), 16);
            return { r: hex >> 16, g: (hex & 0x00FF00) >> 8, b: (hex & 0x0000FF), a: Number(a.toFixed(2)) };
        },
        hexToHsb: function (hex) {
            return this.rgbToHsb(this.hexToRgb(hex));
        },
        rgbToHsb: function (rgb) {
            var hsb = { h: 0, s: 0, b: 0 };
            var min = Math.min(rgb.r, rgb.g, rgb.b);
            var max = Math.max(rgb.r, rgb.g, rgb.b);
            var delta = max - min;
            hsb.b = max;
            hsb.s = max != 0 ? 255 * delta / max : 0;
            if (hsb.s != 0) {
                if (rgb.r == max) hsb.h = (rgb.g - rgb.b) / delta;
                else if (rgb.g == max) hsb.h = 2 + (rgb.b - rgb.r) / delta;
                else hsb.h = 4 + (rgb.r - rgb.g) / delta;
            } else hsb.h = -1;
            hsb.h *= 60;
            if (hsb.h < 0) hsb.h += 360;
            hsb.s *= 100 / 255;
            hsb.b *= 100 / 255;
            return hsb;
        },
        rgbToStr: function (rgb) {
            let a = (rgb.a !== undefined && rgb.a >= 0 && rgb.a <= 1) ? rgb.a : 1;
            return `rgb(${rgb.r}, ${rgb.g}, ${rgb.b}, ${a})`;
        }
    }

    window.Colorpicker = Colorpicker;
})()


//////////////////////////////////////////////////////////////////////
// ã€æ¡†æ¶å…¨å±€ã€‘ å˜é‡ã€æ–¹æ³•åŒºåŸŸ
//////////////////////////////////////////////////////////////////////

// TODO å½“å‰åº”ç”¨ç¯å¢ƒï¼Œå‘å¸ƒæ—¶è®°å¾—ä¿®æ”¹ã€‚prod-æ­£å¼ç¯å¢ƒï¼Œä¸æ‰“æ—¥å¿—ï¼›dev-å¼€å‘ç¯å¢ƒï¼›debug-è°ƒè¯•ç¯å¢ƒ
//const currActive = window.location.host.includes("m1yellow.cn") ? "prod" : "dev";
const currActive = "dev"; // TODO ä¸‹è½½çš„ç¦»çº¿ç‰ˆä¸æ˜¯çº¿ä¸ŠåŸŸåï¼Œä½†ä¹Ÿæ˜¯ç”Ÿäº§ç¯å¢ƒï¼Œä¸éœ€è¦æ‰“æ—¥å¿—

function isProd() {
    if (currActive && currActive.toLowerCase() === "prod" || import.meta.env.PROD) return true;
    return false;
}

// å…¨å±€å¼‚å¸¸æ•è·
// https://juejin.cn/post/7031876097390149645
var isGlobalErrorCatchAllow = true;
if (isGlobalErrorCatchAllow) {
    /*
    // error äº‹ä»¶ç›‘å¬å¯ä»¥æ›¿ä»£è¿™ä¸ªæ–¹æ³•
    window.onerror = function (message, source, lineno, colno, error) {
        console.log("catch error:", {message, source, line, col, error});
        // message: é”™è¯¯çš„ä¿¡æ¯
        // source:  é”™è¯¯å‘ç”Ÿçš„æ–‡ä»¶
        // lineno:  é”™è¯¯å‘ç”Ÿçš„è¡Œæ•°
        // colno:   é”™è¯¯å‘ç”Ÿçš„åˆ—æ•°
        // error:   é”™è¯¯å¯¹è±¡
    };
    */

    window.addEventListener('error', (e) => {
        //console.log(">>>> error: " + JSON.stringify(e));
        // é˜»æ­¢äº‹ä»¶å†’æ³¡å’Œé»˜è®¤è¡Œä¸º
        doEventDefault(e);
        doGlobalError(e, (sysConfig && sysConfig.alertErrorCount) ? sysConfig.alertErrorCount : 3);
        return false; // è¿™æ ·ä¹Ÿå¯ä»¥é˜»æ­¢äº‹ä»¶å†’æ³¡å’Œé»˜è®¤è¡Œä¸º
    }, true);

    window.addEventListener('unhandledrejection', (e) => {
        doEventDefault(e);
        doGlobalError(e, (sysConfig && sysConfig.alertErrorCount) ? sysConfig.alertErrorCount : 3);
        return false;
    }, true);

}


// å¼‚å¸¸ä¿¡æ¯å¤„ç†
function doGlobalErrorMsg(e, isAlert) {
    // æ§åˆ¶å°æ‰“å°
    console.error(e);
    // æ‰“å°è°ƒç”¨å †æ ˆ
    printStack();
    // é”™è¯¯ä¿¡æ¯æ‹¼æ¥
    let eMsg;
    if (e.stack) eMsg = e.stack;
    if (!eMsg && (e instanceof ErrorEvent)) eMsg = e.message + ", " + e.lineno + ", " + e.colno;
    if (!eMsg) eMsg = e.message;
    if (eMsg && eMsg.includes("æ‰‹åŠ¨ç»“æŸç¨‹åº")) isAlert = false;
    // ç§»åŠ¨ç«¯çª—å£æ˜¾ç¤º
    console.log("âš ï¸ ç¨‹åºå‡ºç°é”™è¯¯: \n" + eMsg);
    // å¼¹çª—æç¤º
    if (isAlert) alert("âš ï¸ ç¨‹åºå‡ºç°é”™è¯¯: \n" + eMsg);
}


// å…³é—­æ•´ä¸ªé¡¹ç›®console.logçš„æ–¹æ³•
// https://blog.csdn.net/halo1416/article/details/122595285
// console.log é‡å†™
const isDebug = !isProd(); // æ§åˆ¶æ˜¯å¦å±è”½å…¨å±€ console.log æ—¥å¿—ï¼›isDebug è®¾ä¸º false å³å¯å±è”½
if (isProd()) console.log = (function (oldLogFunc) {
    return function () {
        if (isDebug) {
            oldLogFunc.apply(this, arguments);
        }
    }
})(console.log);


// ç§»åŠ¨ç«¯æ˜¾ç¤ºconsole.logæ—¥å¿—ã€ä¼šå¯¼è‡´ä¸¥é‡å¡é¡¿ï¼Œä»…åœ¨æ’æŸ¥é—®é¢˜æ—¶ä½¿ç”¨ã€‘
// https://blog.csdn.net/ChenX_Web/article/details/99721636
onMounted(() => {
    let isShowInfoConsole = false;
    let infoConsole = document.getElementById('info');
    if (!isShowInfoConsole && infoConsole) infoConsole.style.display = "none";
    if (isShowInfoConsole && infoConsole) {
        if (console) {
            let _console = {
                log: console.log
            }
            console.log = function (attr) {
                _console.log(attr);
                //let str = JSON.stringify(attr, null, 4);
                let str = attr.toString();
                let node = document.createElement("H1");
                let textnode = document.createTextNode(str);

                node.appendChild(textnode);
                infoConsole.appendChild(node);
                // æ»šåŠ¨åˆ°åº•éƒ¨ï¼Œæ˜¾ç¤ºæœ€æ–°æ—¥å¿—
                infoConsole.scrollTop = infoConsole.scrollHeight;
            }
        }

        function show() {
            // æ»šåŠ¨åˆ°åº•éƒ¨ï¼Œæ˜¾ç¤ºæœ€æ–°æ—¥å¿—
            infoConsole.scrollTop = infoConsole.scrollHeight;
            let type = infoConsole.getAttribute("type");
            if (type === "0") { // æ”¶èµ·
                infoConsole.style.cssText = "width:20px;height:20px;";
                infoConsole.setAttribute("type", "1");
                // æ¸…ç©ºæ—¥å¿—
                if (confirm("æ˜¯å¦æ¸…ç©ºæ—¥å¿—è®°å½•ï¼Ÿ")) {
                    console.clear();
                    infoConsole.innerHTML = "";
                } else { }
            } else { // å±•å¼€
                infoConsole.removeAttribute('style');
                infoConsole.setAttribute("type", "0");
            }
        }
    }
})


// æ‰“å°è°ƒç”¨å †æ ˆ
function printStack() {
    let stack = (new Error()).stack;
    console.log(stack);
}


// åˆ¤æ–­å®¢æˆ·ç«¯
const os = function () {
    let ua = navigator.userAgent,
        isChrome = /(?:Chrome|CriOS)/.test(ua),
        isFireFox = /(?:Firefox)/.test(ua),
        isWindowsPhone = /(?:Windows Phone)/.test(ua),
        isSymbian = /(?:SymbianOS)/.test(ua) || isWindowsPhone,
        isAndroid = /(?:Android)/.test(ua),
        isIPhone = /(?:iPhone)/.test(ua),
        isTablet = /(?:iPad|PlayBook)/.test(ua) || (isAndroid && !/(?:Mobile)/.test(ua)) || (isFireFox && /(?:Tablet)/.test(ua)),
        isIPadPro = !isIPhone && !isAndroid && !isSymbian && isIpadPro(),
        isPc = !isIPhone && !isAndroid && !isSymbian && !isTablet && !isIPadPro;
    return {
        isTablet: isTablet || isIPadPro,
        isIPhone: isIPhone,
        isAndroid: isAndroid,
        isPc: isPc
    };
}();


// iPad pro UA æœ‰æ”¹åŠ¨ï¼Œéœ€è¦ç‰¹æ®Šåˆ¤æ–­
// https://blog.csdn.net/Min_Fox/article/details/135225990
function isIpadPro() {
    var ua = window.navigator.userAgent;
    var IsIPad = false;
    if (/ipad/i.test(ua)) {
        IsIPad = true;
    }
    // iPad from IOS13
    var macApp = ua.match(/Macintosh/i) != null;
    if (macApp) {
        // need to distinguish between Macbook and iPad
        var canvas = document.createElement('canvas');
        if (canvas != null) {
            var context = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
            if (context) {
                var info = context.getExtension('WEBGL_debug_renderer_info');
                if (info) {
                    var renderer = context.getParameter(info.UNMASKED_RENDERER_WEBGL);
                    //console.log(renderer);
                    // TODO è¿™ä¸ªåˆ¤æ–­éœ€è¦çœŸå®è®¾å¤‡ã€æˆ–Mac xcodeæ¨¡æ‹Ÿè®¾å¤‡éªŒè¯
                    if (renderer.indexOf('Apple') != -1) IsIPad = true;
                }
            }
        }
    }

    // å¤šè§¦ç‚¹åˆ¤æ–­ã€å±å¹•åˆ†è¾¨ç‡å®½é«˜åˆ¤æ–­
    IsIPad = isProd() ? (navigator.maxTouchPoints > 1 && window.screen.height > window.screen.width) : (window.screen.height > window.screen.width);

    return IsIPad;
}


// åˆ¤æ–­æ˜¯å¦ä¸ºVUE
function isVue() {
    return window.__VUE__ === true || window.app;
}


// è·å–è®¾å¤‡å±å¹•åƒç´ æ¯”ï¼Œç”¨äºè§£å†³å›¾å½¢æ¨¡ç³Šã€é”¯é½¿é—®é¢˜
// TODO æ‰€æœ‰å•ç‹¬è®¾ç½®çº¿å®½çš„åœ°æ–¹éƒ½è¦ * dprï¼Œæ³¨æ„ï¼Œä¸åŠå¾„ç›¸å…³å‚æ•°ä¸ç”¨ï¼Œå› ä¸ºåŠå¾„å·²ç»è®¡ç®—è¿‡äº†
let dpr = window.devicePixelRatio;
dpr = roundNumber(dpr, 4);
console.log(">>>> dpr=" + dpr); // 2/2.7/3


// è®¾å¤‡å¸§ç‡æ£€æµ‹
let fpsCheckLast = Date.now();
let fpsTicks = 0;
let fpsCheckValues = new Array();
let fpsCheckCount = 0;
let fpsCtrlFlag = false; // fps å¸§ç‡æ˜¯å¦éœ€è¦æ§åˆ¶å¸§ç‡
let fpsCheckRst = 60; // fps æ£€æµ‹å€¼ï¼Œé»˜è®¤60
function fpsCheckLoop() {
    fpsTicks += 1;
    // æ¯30å¸§ç»Ÿè®¡ä¸€æ¬¡å¸§ç‡
    if (fpsTicks >= 30) {
        const now = Date.now();
        const diff = now - fpsCheckLast;
        const fps = Math.round(1000 / (diff / fpsTicks));
        fpsCheckLast = now;
        fpsTicks = 0;
        fpsCheckValues[fpsCheckCount] = fps;
        fpsCheckCount += 1;
        //console.log(">>>> fps" + fpsCheckCount + ":" + fps);
        if (fpsCheckCount >= 3) {
            fpsCheckCount = 0;
            let minVal = 50;
            let maxVal = 70;
            if (fpsCheckValues[0] < minVal && fpsCheckValues[1] < minVal && fpsCheckValues[2] < minVal) alert("âš ï¸ å½“å‰æ‰‹æœºå¸§ç‡ä½äº60å¸§ï¼Œæ¸¸æˆä¸èƒ½æ­£å¸¸è¿ä½œï¼");
            // TODO ä¸ç”¨é™åˆ¶å¸§ç‡çš„æ–¹å¼ï¼Œæ”¹ç”¨è°ƒæ•´æ‘©æª«åŠ›æ¯”ä¾‹çš„æ–¹å¼
            if (fpsCheckValues[0] > maxVal || fpsCheckValues[1] > maxVal || fpsCheckValues[2] > maxVal) fpsCtrlFlag = true;
            fpsCheckRst = fpsCheckValues[2];
            console.log(">>>> fps=" + fpsCheckRst);
            // é‡æ–°è®¡ç®—ä¸€éé€Ÿåº¦å’Œæ‘©æª«åŠ›
            //setSpeed();
            //setFriction();
            //alert(">>>> fps=" + fpsCheckRst);
            //alert(">>>> friction=" + sysConfig.friction);
            return;
        }
    }
    requestAnimationFrame(fpsCheckLoop);
}
fpsCheckLoop();


// è·å–é¼ æ ‡ç§»åŠ¨ç‚¹åæ ‡
let mouse = null; // æ”¾åœ¨è®¾ç½®ç”»å¸ƒä½ç½®åå†åˆå§‹åŒ–èµ‹å€¼
let screenPos = { x: 0, y: 0 }; // å±å¹•å¯è§åæ ‡ï¼Œä¸ç®—dpr
function captureMouse(element) {
    mouse = { // 
        x: 0,
        y: 0,
        event: null
    };
    let body_scrollLeft = document.body.scrollLeft;
    let element_scrollLeft = document.documentElement.scrollLeft;
    let body_scrollTop = document.body.scrollTop;
    let element_scrollTop = document.documentElement.scrollTop;
    let offsetLeft = element.offsetLeft;
    let offsetTop = element.offsetTop;
    console.log(">>>> captureMouse offsetLeft:" + offsetLeft + ", offsetTop:" + offsetTop);

    if (os.isPc) { // PCç«¯
        //element.addEventListener('mousedown', (e) => {
        element.addEventListener('mousemove', (e) => {
            let x, y;
            if (e.pageX || e.pageY) { // é¡µé¢å·¦ä¸Šè§’ä¸ºåŸç‚¹
                x = e.pageX;
                y = e.pageY;
            } else { // å¯è§†çª—å£çš„å·¦ä¸Šè§’
                x = e.clientX + body_scrollLeft + element_scrollLeft;
                y = e.clientY + body_scrollTop + element_scrollTop;
            }

            screenPos.x = x;
            screenPos.y = y;

            x -= offsetLeft;
            y -= offsetTop;

            mouse.x = x * dpr;
            mouse.y = y * dpr;
            //console.log(">>>> mouse.x=" + mouse.x + ", mouse.y=" + mouse.y);
            mouse.event = e;
        }, false);

    } else { // ç§»åŠ¨ç«¯
        //element.addEventListener('touchstart', (e) => {
        element.addEventListener('touchmove', (e) => {
            let x, y;

            x = e.touches[0].pageX;
            y = e.touches[0].pageY;

            screenPos.x = x;
            screenPos.y = y;

            x -= offsetLeft;
            y -= offsetTop;

            mouse.x = x * dpr;
            mouse.y = y * dpr;
            mouse.event = e;
        }, false);
    }

    mouse.x = roundNumber(mouse.x, 4);
    mouse.y = roundNumber(mouse.y, 4);
    return mouse;
};


// è·å–é¼ æ ‡ç‚¹å‡»åæ ‡
let clickPos = null;
function getClickPos(e) {
    // åªæ˜¾ç¤ºå°é¢ï¼Œä¸å¤„ç†ç‚¹å‡»äº‹ä»¶
    if (userConfig.isJustShowTable) return;
    if (!e) return;
    //if (!e || e.type === "touchend") return;
    //console.log(e);
    //console.log(e.target);
    let element = e.target;
    let offsetLeft = element.offsetLeft;
    let offsetTop = element.offsetTop;
    //console.log(">>>> getClickPos offsetLeft:" + offsetLeft + ", offsetTop:" + offsetTop);
    clickPos = { x: 0, y: 0 };
    let x = 0, y = 0;
    if (e.pageX && typeof e.pageX === "number") {
        x = e.pageX;
        y = e.pageY;
    } else if (e.touches && e.touches[0]) {
        x = e.touches[0].pageX;
        y = e.touches[0].pageY;
    } else if (e.changedTouches && e.changedTouches[0]) { // touchend
        x = e.changedTouches[0].pageX;
        y = e.changedTouches[0].pageY;
    }
    x -= offsetLeft;
    y -= offsetTop;
    clickPos.x = x * dpr;
    clickPos.y = y * dpr;
    clickPos.x = roundNumber(clickPos.x, 4);
    clickPos.y = roundNumber(clickPos.y, 4);
    mouse.x = clickPos.x;
    mouse.y = clickPos.y;
    console.log(">>>> getClickPos clickPos.x=" + clickPos.x + ", clickPos.y=" + clickPos.y);
    return clickPos;
}


// æ—‹è½¬åæ ‡ç³»
function rotate(x, y, sin, cos, reverse) {
    return {
        x: (reverse) ? (x * cos + y * sin) : (x * cos - y * sin),
        y: (reverse) ? (y * cos - x * sin) : (y * cos + x * sin)
    };
}


// ç›‘å¬é¡µé¢å¤§å°å˜åŒ–ï¼Œé‡æ–°è°ƒæ•´ç”»å¸ƒåŠå°çƒå¤§å°
function resetCanvasSize() {
    // dpr æ²¡å˜ä¸åˆ·æ–°
    if (roundNumber(window.devicePixelRatio, 4) === dpr) return;
    // ç›´æ¥åˆ·æ–°ä¸€æ¬¡é¡µé¢å°±å¥½
    location.reload();
    /*ä¼šå­˜åœ¨å¾ˆå¤šå†å²å˜é‡å½±å“ï¼Œballsã€linesã€linesMiddlePoints ç­‰æ•°ç»„å˜é‡è¦æ¸…ç©º
    // é‡æ–°åˆå§‹åŒ–
    init();
    // æ¸²æŸ“å®Œæˆæ ‡è¯†false
    isAnimated = false;
    // æ¸…ç©ºä¸€æ¬¡ç”»å¸ƒ
    context.clearRect(0, 0, canvas.width, canvas.height); // æ¸…ç†ä¸å¹²å‡€
    context.beginPath(); // å¼€å¯æ–°pathï¼Œé¿å…æ¸…ç†ä¸å¹²å‡€
    // é‡æ–°æ¸²æŸ“
    if (!isPlaying) animate();
    */
}
window.addEventListener('resize', resetCanvasSize); // å¯¹åŒä¸€ä¸ªå…ƒç´ çš„åŒä¸€ä¸ªäº‹ä»¶é‡å¤æ·»åŠ ç›‘å¬å‡½æ•°ï¼Œåªä¼šç”Ÿæ•ˆä¸€æ¬¡


// æ£€æµ‹æ˜¯å¦å¯ä»¥ä½¿ç”¨ï¼Œæµè§ˆå™¨æ”¯æŒï¼Œä»¥åŠæµè§ˆå™¨éšç§è®¾ç½®å…è®¸
function checkWebStorage() {
    let result = false;

    if (window.localStorage) {
        try {
            localStorage.setItem('collide-try-role-chose-test', 1);
            let testVal = localStorage.getItem('collide-try-role-chose-test');
            localStorage.removeItem('collide-try-role-chose-test');
            if (!testVal) throw new Error(">>>> å½“å‰æµè§ˆå™¨æ”¯æŒ localStorageï¼Œä½†ä½¿ç”¨å¼‚å¸¸ï¼Œè¯·æ£€æŸ¥æ˜¯å¦å¼€å¯äº†ã€æ— ç—•æ¨¡å¼ã€‘");
            result = true;
        } catch (e) {
            alert(e.message);
        }
    } else {
        alert(">>>> å½“å‰æµè§ˆå™¨ä¸æ”¯æŒ localStorageï¼Œè¯·æ£€æŸ¥æ˜¯å¦å¼€å¯äº†ã€æ— ç—•æ¨¡å¼ã€‘ï¼Œæˆ–å‡çº§æµè§ˆå™¨ç‰ˆæœ¬ï¼Œæˆ–æ›´æ¢å…¶ä»–æµè§ˆå™¨");
    }

    if (result) return result;

    /*
    if (window.sessionStorage) {
        try {
            sessionStorage.setItem('collide-try-role-chose-test', 1);
            let testVal = sessionStorage.getItem('collide-try-role-chose-test');
            sessionStorage.removeItem('collide-try-role-chose-test');
            if (!testVal) throw new Error(">>>> å½“å‰æµè§ˆå™¨æ”¯æŒ sessionStorageï¼Œä½†ä½¿ç”¨å¼‚å¸¸ï¼Œè¯·æ£€æŸ¥éšç§è®¾ç½®æ˜¯å¦è¿‡äºä¸¥æ ¼");
            result = true;
        } catch (e) {
            alert(e.message);
        }
    } else {
        alert(">>>> å½“å‰æµè§ˆå™¨ä¸æ”¯æŒ sessionStorageï¼Œè¯·å‡çº§æµè§ˆå™¨ç‰ˆæœ¬ï¼Œæˆ–è€…æ›´æ¢å…¶ä»–æµè§ˆå™¨");
    }
    */

    return result;
}


// ä½¿ç”¨ IndexedDB æ•°æ®åº“ å­˜å‚¨å›¾ç‰‡
// https://www.cnblogs.com/zhang-zi-yi/p/12703656.html
var indexedDB = window.indexedDB || window.webkitIndexedDB || window.mozIndexedDB || window.OIndexedDB || window.msIndexedDB,
    IDBTransaction = window.IDBTransaction || window.webkitIDBTransaction || window.OIDBTransaction || window.msIDBTransaction,
    dbVersion = 3, // ç‰ˆæœ¬ The requested version (2) is less than the existing version (3).
    //idbOpenReq, // æ‰“å¼€æ•°æ®è¯·æ±‚
    IDB, // IndexedDB è¿æ¥å¯¹è±¡
    dbName = "collide-try", // è¦ä½¿ç”¨çš„æ•°æ®åº“
    tbName = "images"; // è¦ä½¿ç”¨çš„æ•°æ®åº“è¡¨

if (!indexedDB) {
    console.log(">>>> æµè§ˆå™¨ä¸æ”¯æŒ IndexedDB V" + dbVersion);
} else {
    openIndexedDB();
}

// æ‰“å¼€æ•°æ®åº“
function openIndexedDB() {
    // æ‰“å¼€æ•°æ®åº“ï¼Œä¸å­˜åœ¨ä¼šè‡ªåŠ¨å…ˆåˆ›å»º
    let idbOpenReq = indexedDB.open(dbName, dbVersion);
    // æ•°æ®åº“æ‰“å¼€æˆåŠŸ
    idbOpenReq.onsuccess = function (event) {
        IDB = idbOpenReq.result;
        doIndexedDBOpenSuccess();
        IDB.onerror = function (e) {
            console.log(">>>> IndexedDB è¿æ¥é”™è¯¯ï¼š" + e.currentTarget.error.message);
        }
    }

    // æ•°æ®åº“æ‰“å¼€å¤±è´¥
    idbOpenReq.onerror = function (e) {
        console.log(">>>> IndexedDB æ‰“å¼€é”™è¯¯ï¼š" + e.currentTarget.error.message);
    }

    // åœ¨æ•°æ®åº“åˆ›å»ºæˆ–è€…ç‰ˆæœ¬æ›´æ–°æ—¶ï¼Œä¼šè§¦å‘onupgradeneededäº‹ä»¶
    idbOpenReq.onupgradeneeded = function (e) {
        IDB = e.target.result;
        if (!IDB.objectStoreNames.contains(tbName)) {
            // å¦‚æœè¡¨æ ¼ä¸å­˜åœ¨ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„è¡¨æ ¼
            // ï¼ˆkeyPathï¼Œä¸»é”® ï¼› autoIncrement,æ˜¯å¦è‡ªå¢ï¼‰ï¼Œä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼ˆobjectStoreï¼‰
            let objectStore = IDB.createObjectStore(tbName); // , { keyPath: 'id', autoIncrement: true }
            // æŒ‡å®šå¯ä»¥è¢«ç´¢å¼•çš„å­—æ®µï¼Œuniqueå­—æ®µæ˜¯å¦å”¯ä¸€
            // objectStore.createIndex('fileName', 'name', { unique: false });
        }
    }
}

// å¤„ç† IndexedDB æ‰“å¼€æˆåŠŸäº‹é¡¹
function doIndexedDBOpenSuccess() {
    // ä»IndexedDBè¯»å–å›¾ç‰‡ï¼Œå¹¶è®¾ç½®bodyå›¾ç‰‡èƒŒæ™¯
    if (sysConfig.isRoleChooseFinished)
        doPageBgImage(currTheme.bgImage, true);
}

// å¤„ç† IndexedDB æ‰“å¼€å¤±è´¥äº‹é¡¹
function doIndexedDBOpenError() {
    // TODO 
}

// indexedDB å¯¹è±¡ IDB æ˜¯å¦åˆå§‹åŒ–åŠ è½½å®Œæˆ
function checkIDBReady() {
    if (!IDB) return false;
    if (!IDB.name || !IDB.name.toLocaleLowerCase().startsWith(dbName)) return false;
    return true;
}

// å°† blob å¯¹è±¡å­˜å‚¨åˆ°æ•°æ®åº“ä¸­
function putImageInDb(blob, key) {
    let transaction = getNewTransaction();
    if (!transaction) return;
    let put = transaction.objectStore(tbName).put(blob, key);
}

// è·å–å›¾ç‰‡æ–‡ä»¶
function getImageRequest(key) {
    let transaction = getNewTransaction();
    if (!transaction) return;
    transaction.objectStore(tbName).get(key).onsuccess = (event) => {
        // å¼‚æ­¥å›è°ƒ
        let blob = event.target.result;
        if (blob) {
            let url = window.URL.createObjectURL(blob);
            //$('.img').attr('src', url);
        }
    }
}

// è·å–ä¸€ä¸ªæ–°çš„æ•°æ®åº“æ“ä½œäº‹åŠ¡
function getNewTransaction() {
    if (!checkIDBReady()) {
        console.log(">>>> IndexedDB æ•°æ®åº“è¿æ¥å¯¹è±¡æš‚æœªåˆå§‹åŒ–å®Œæˆ");
        return null;
    }
    return IDB.transaction([tbName], 'readwrite');
}

// æ¸…ç©º indexedDB è¡¨æ•°æ®å­˜å‚¨
function clearTable(tbName) {
    const transaction = IDB.transaction(tbName, 'readwrite');
    const objectStore = transaction.objectStore(tbName);
    const clearRequest = objectStore.clear();
    clearRequest.onsuccess = () => {
        console.log(">>>> " + tbName + " è¡¨æ•°æ®æ¸…ç©ºå®Œæˆ");
    }
    clearRequest.onerror = (event) => {
        console.log(">>>> " + tbName + " è¡¨æ•°æ®æ¸…ç©ºå‡ºé”™ï¼š" + event.target.error);
    }
}


// JS æ£€æµ‹å½“å‰ç¯å¢ƒæ˜¯å¦å¤„äºæ·±è‰²æ¨¡å¼
// https://juejin.cn/post/7080567228029992996
var isLightMode = true;
var isDarkMode = false;
try {
    isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches;
    isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;
} catch (e) {
    doGlobalErrorMsg(e, false);
}
console.log(">>>> isLightMode=" + isLightMode);
console.log(">>>> isDarkMode=" + isDarkMode);


// ç›‘å¬è¿”å›
// popstate æ–¹æ¡ˆï¼Œå¿…é¡»æ‰‹åŠ¨ç‚¹ä¸€ä¸‹é¡µé¢ä»»ä½•åœ°æ–¹ï¼Œæ‰ä¼šè§¦å‘ï¼
// chrome ä¸ºäº†é˜²æ­¢æµæ°“ç½‘ç«™ç¦æ­¢ç”¨æˆ·æ‰§è¡Œå›é€€æ“ä½œï¼ŒæŠŠç”¨æˆ·å›°åœ¨å½“å‰ç½‘ç«™ï¼Œä¸“é—¨åšçš„è¿™ä¸ªè®¾è®¡ï¼
onMounted(() => {
    pushHistory();
    window.addEventListener("popstate", function (e) { // åé€€ã€å‰è¿›éƒ½ä¼šè§¦å‘
        //console.log(e);
        e.preventDefault();
        //alert("æˆ‘ç›‘å¬åˆ°äº†æµè§ˆå™¨çš„è¿”å›æŒ‰é’®äº‹ä»¶å•¦"); // æ ¹æ®è‡ªå·±çš„éœ€æ±‚å®ç°è‡ªå·±çš„åŠŸèƒ½
        pushHistory();
        // å¤„ç†è¿”å›äº‹é¡¹
        doBack();
    }, false);
});

function pushHistory() {
    //let ts = new Date().getTime().toString();
    /*
    var state = {
        title: "title",
        url: "#"
    };
    window.history.pushState(state, "title", "#");
    */
    //window.history.pushState(null, null, "#");
    history.pushState(null, null, document.URL);
}
var backClickCount = 0;
var backClickTimer = 0;
function doBack(isMaskIn) {
    // å¼¹çª—é®ç½©
    let isDialogMaskShowing = isDialogShowing(dialogMask);
    // é€‰æ‹©è§’è‰²å¼¹çª—
    let isChooseRoleDialogShowing = isDialogShowing(chooseRoleDialog);
    // æ¸¸æˆè®¾ç½®å¼¹çª—
    let isUserSettingDialogShowing = isDialogShowing(userSettingDialog);
    // å…³äºåº”ç”¨å¼¹çª—
    let isAboutAppDialogShowing = isDialogShowing(aboutAppDialog);
    // æ›´æ–°æç¤ºå¼¹çª—
    let isUpdateContentDialogShowing = isDialogShowing(updateContentDialog);
    // æ“ä½œæŒ‡å—å¼¹çª—
    let isHowToPlayDialogShowing = isDialogShowing(howToPlayDialog);

    // å…³é—­æ›´æ–°æç¤ºå¼¹çª—
    if (!isMaskIn && isUpdateContentDialogShowing) {
        showUpdateContent(false);
        return;
    }

    // å…³é—­æ“ä½œæŒ‡å—å¼¹çª—
    if (!isMaskIn && isHowToPlayDialogShowing) {
        showHowToPlay(false);
        return;
    }

    // å…³é—­å…³äºåº”ç”¨å¼¹çª—
    if (isAboutAppDialogShowing) {
        switchDialogShow(aboutAppDialog, false);
        return;
    }

    // å…³é—­æ¸¸æˆè®¾ç½®å¼¹çª—
    if (isUserSettingDialogShowing) {
        switchUserSettingDialog(false);
        return;
    }

    // å…³é—­é€‰æ‹©è§’è‰²å¼¹çª—
    if (isChooseRoleDialogShowing) {
        switchChooseRoleDialog(false);
        return;
    }

    if (isMaskIn) return;

    // æ¸¸æˆæ­£åœ¨è¿›è¡Œ
    if (checkIsMoving()) {
        //alert("ğŸ‘‰ æ¸¸æˆæ­£åœ¨è¿›è¡Œï¼Œä¸å»ºè®®è¿”å›å“¦~");
        return;
    } else {
        if (!backClickTimer) backClickTimer = setTimeout(() => {
            backClickCount = 0;
            backClickTimer && clearTimeout(backClickTimer);
            backClickTimer = 0;
        }, 3000);
        backClickCount += 1;
        if (backClickCount > 2) {
            alert("ğŸ‘‰ ç‚¹å‡»å·¦ä¸Šè§’é‡é€‰è§’è‰²ï¼Œå…³æ‰é¡µé¢é€€å‡ºæ¸¸æˆ");
            backClickCount = 0;
        }
    }

    /*
    // é€€å‡ºæ¸¸æˆ
    if (!isChooseRoleDialogShowing) { // æ¸¸æˆç•Œé¢
        window.history.go(0); // å›åˆ°èµ·å§‹ç•Œé¢
        return;
    } else { // é€‰æ‹©è§’è‰²ç•Œé¢
        //window.history.go(0); // å›åˆ°èµ·å§‹ç•Œé¢
        window.history.forward(1); // ç‚¹åé€€åˆå‰è¿›ï¼Œç›¸å½“äºæ²¡åŠ¨ï¼Œè¾¾åˆ°å±è”½åé€€æŒ‰é’®çš„æ•ˆæœ
        return;
        if (confirm("ğŸ’¡ ç¡®å®šè¦ç¦»å¼€æ¸¸æˆäº†å—ï¼Ÿ")) { // ç¡®è®¤
            window.opener = null;
            window.open('', '_self');
            // Scripts may close only the windows that were opened by them.
            // window.close()æ–¹æ³•åªèƒ½å…³é—­ç”±window.open()æˆ–è€…æµè§ˆå™¨ç›´æ¥è¾“å…¥urlæ‰“å¼€çš„é¡µé¢ï¼Œå…¶ä½™æƒ…å†µå®‰å…¨è€ƒè™‘æ˜¯è¢«é™åˆ¶çš„
            window.close(); // jså…³ä¸äº†ï¼Œéœ€è¦æŒ‰é’®ç‚¹å‡»è°ƒç”¨
        } else { // å–æ¶ˆ
            // ignore
        }
        return;
    }
    */
}


// window å…¨å±€ç‚¹å‡»ç©ºç™½äº‹é¡¹å¤„ç†
window.onclick = function (e) {
    doEventDefault(e); // å¤„ç†äº‹ä»¶é»˜è®¤è¡Œä¸ºï¼Œé˜²æ­¢å‡ºç°ç‚¹ä¸€æ¬¡ï¼Œæ‰§è¡Œä¸¤æ¬¡
    // ç‚¹å‡»äº†ä¸»é¢˜è®¾ç½®ä¸‹æ‹‰æ¡†ä»¥å¤–çš„åŒºåŸŸ
    if (!e.target.matches('.dropbtn')) {
        let themeDropdown = document.getElementById("themeDropdown");
        if (themeDropdown.classList.contains('show')) {
            themeDropdown.classList.remove('show');
        }
    }
}


// æµè§ˆå™¨çª—å£å…³é—­æˆ–è€…åˆ·æ–°æ—¶ã€ä¸€å®šè¦åœ¨å…³é—­é¡µé¢å‰ç§»é™¤æ‰€æœ‰ç›‘å¬äº‹ä»¶ï¼Ÿé¡µé¢å…³é—­è‡ªåŠ¨å¤„ç†äº†å•Šã€‘
// ä¼šå¯¼è‡´é‡æ–°åŠ è½½ä¸€ç›´æç¤º â€œç³»ç»Ÿå¯èƒ½ä¸ä¼šä¿å­˜æ‚¨æ‰€åšçš„æ›´æ”¹â€
/*
window.addEventListener("beforeunload", (event) => {
    // Cancel the event as stated by the standard.
    event.preventDefault();
    // Chrome requires returnValue to be set.
    event.returnValue = "";
});
*/


/*
// ç›‘å¬æµè§ˆå™¨åˆ‡æ¢é¡µé¢ã€‚åˆ¤æ–­ç”¨æˆ·æµè§ˆçš„æ˜¯å¦ä¸ºå½“å‰é¡µï¼Œæ ¹æ®å½“å‰é¡µé¢æ¿€æ´»çŠ¶æ€ï¼Œè¿›è¡Œä¸šåŠ¡å¤„ç†
// Documentï¼šhidden å±æ€§
var hiddenProperty = 'hidden' in document ? 'hidden' :
'webkitHidden' in document ? 'webkitHidden' :
'mozHidden' in document ? 'mozHidden' :
null;
var visibilityChangeEvent = hiddenProperty.replace(/hidden/i, 'visibilitychange');
var onVisibilityChange = function() {
    if (document[hiddenProperty]) { // hidden===true éæ¿€æ´»
        console.log('é¡µé¢éæ¿€æ´»');
    } else {
        console.log('é¡µé¢æ¿€æ´»')
    }
}
document.addEventListener(visibilityChangeEvent, onVisibilityChange);
*/


// è·å–æ­£å¸¸å±•ç¤º Emoji æ—¶çš„å®½åº¦
// https://cloud.tencent.com/developer/article/2211194
const getTextWidth = (text) => {
    const element = document.createElement('span');
    element.setAttribute('aria-hidden', 'true');
    element.setAttribute('style', 'font-size:16px!important;position:absolute;top:0;opacity:0;font-family:Consolas,"Liberation Mono","Courier New",monospace');
    element.textContent = text;
    document.body.appendChild(element);
    const width = element.clientWidth;
    document.body.removeChild(element);
    return width;
}

// icon å…¼å®¹æ—§æœºå‹
//const iconWidth = getTextWidth(Role.getRoleIconById(Role.SHUANGZI.id));
const iconWidth = getTextWidth("ğŸ§â€â™‚ï¸");
//const iconWidth = getTextWidth("ğŸƒâ€â™‚ï¸â€â¡ï¸");
console.log(">>>> iconWidth=" + iconWidth);

// æ£€éªŒ Emoji èƒ½å¦è¢«æ­£å¸¸å±•ç¤º
const isEmojiValid = (emoji) => {
    return getTextWidth(emoji) === iconWidth && iconWidth >= 14;
}

// åŒå­åˆ†èº«å›¾æ ‡æ˜¯å¦èƒ½æ­£å¸¸æ˜¾ç¤º
//const isTwinSingleIconShow = isEmojiValid("ğŸ§") && isEmojiValid("ğŸ§â€â™‚ï¸"); // TODO let const å®šä¹‰çš„å˜é‡ï¼Œåœ¨å®šä¹‰ä¹‹å‰ä¸èƒ½è®¿é—®
var isTwinSingleIconShow = isEmojiValid("ğŸ§") && isEmojiValid("ğŸ§â€â™‚ï¸"); // var å¯ä»¥å…¨å±€è®¿é—®åˆ°ä¸ºåˆå§‹åŒ–çš„å˜é‡ï¼ˆåªæœ‰é»˜è®¤å€¼ï¼‰ï¼Œä¸å—å®šä¹‰ä½ç½®é™åˆ¶
var isTwinLeftIconShow = isEmojiValid("ğŸƒ");
var isTwinRightIconShow = isEmojiValid("ğŸƒâ€â™‚ï¸â€â¡ï¸");
console.log(">>>> isTwinSingleIconShow=" + isTwinSingleIconShow);
//console.log(">>>> twinSingleIconWidth=" + getTextWidth("ğŸ§"));
//console.log(">>>> twinSingleIconWidth=" + getTextWidth("ğŸ§â€â™‚ï¸"));
//console.log(">>>> twinSingleIconWidth=" + getTextWidth("ğŸƒâ€â™‚ï¸â€â¡ï¸"));

// ç”°å›­ä¸»é¢˜-æœ¨å¤´å›¾æ ‡æ˜¯å¦èƒ½æ­£å¸¸æ˜¾ç¤º
var isWoodIconShow = getTextWidth("ğŸªµ") >= 14;
console.log(">>>> isWoodIconShow=" + isWoodIconShow);

// é»˜è®¤ä¸»é¢˜-çŸ³å¤´å›¾æ ‡æ˜¯å¦èƒ½æ­£å¸¸æ˜¾ç¤º
var isRockIconShow = getTextWidth("ğŸª¨") >= 14;
console.log(">>>> isRockIconShow=" + isRockIconShow);

// æ˜Ÿé™…ä¸»é¢˜-åœŸæ˜Ÿå›¾æ ‡æ˜¯å¦èƒ½æ­£å¸¸æ˜¾ç¤º
var isRingedIconShow = getTextWidth("ğŸª") >= 14;
console.log(">>>> isRingedIconShow=" + isRingedIconShow);


//////////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////////
// ã€åŠ å¯†è§£å¯†ã€‘ å˜é‡ã€æ–¹æ³•åŒºåŸŸ
//////////////////////////////////////////////////////////////////////

// æ ¸å¿ƒæ–¹æ³•è§£å¯†ï¼ŒåŠ¨æ€æ·»åŠ 
function addCoreScript(eles, eleId, eleClass, content, targetId) {
    if (eles && eles instanceof HTMLCollection) {
        for (let i = 0, len = eles.length; i < len; i++) {
            //document.head.appendChild(eles[i]);
            document.body.appendChild(eles[i]);
        }
        if (!content) return true;
    }
    if (!content) return false;
    let enScript = document.getElementById(eleId);
    if (!enScript) enScript = document.createElement('script');
    enScript.type = 'text/javascript';
    if (eleId) enScript.setAttribute('id', eleId);
    if (eleClass) enScript.setAttribute('class', eleClass);
    enScript.textContent = content;
    let targetEle = document.getElementById(targetId);
    if (targetEle) targetEle.appendChild(enScript);
    //document.head.appendChild(enScript);
    else document.body.appendChild(enScript);
    return true;
}

onMounted(() => {
    //addCoreScript(null, "test-balls", null, "alert(balls.length)", "app-main");
})

// ç§»é™¤æ ¸å¿ƒæ–¹æ³•[ç‹—å¤´]
// ç§»é™¤ script æ ‡ç­¾ï¼Œä¸ä¼šå½±å“å·²ç»åŠ è½½è¿›å†…å­˜çš„ script
function removeCoreScript(eles, eleIdOrClass) {
    if (eles && eles instanceof HTMLCollection) {
        for (let i = 0, len = eles.length; i < len; i++) {
            eles[i].remove(); // éƒ½ä¼šæŠŠå…ƒç´ ä» eles ä¸­ç§»é™¤
            //document.body.removeChild(eles[i]);
        }
        if (!eleIdOrClass) return true;
    }
    if (!eleIdOrClass) return false;
    let ele = document.getElementById(eleIdOrClass);
    if (!ele) ele = document.getElementsByClassName(eleIdOrClass);
    if (!ele) return false;
    //console.log(ele);
    if (ele instanceof HTMLCollection) {
        for (let i = 0, len = ele.length; i < len; i++) {
            ele[i].remove();
            //document.body.removeChild(ele[i]);
        }
        return true;
    } else {
        ele.remove();
        return true;
    }
    return false;
}


let accessKey = "";
let superKey = "";
let easyKey = "";
let accessMsg = "";
let codeStr = "";
let encodeStr = "iwCkbEe4umgXW8Z8XMxbCkBZYXCUpgJlRaxhZtRQ4cG09pa5tlsKs0jzY+7WLIkaR2JN8tAKX2TpSsDN1YudYqqVasY6kZYG7ywzls7LJEabMBIwPz/O2FlyH1VxamwMxyZHXYGLS/EF2wtiwyUv+npl63pZi4mUNBAwFMy7T5rwiJtiM5guQ/SaK7/3W37A+F46Q0cIKkPfd8ZKs9D7WjfXdfEtiPNCB80QqzvwfOgTSQ0uveMamdpx4lEYcUiEgiWHy0n54lnakg/jj8JLcYqesjAC8GM972q5ZUeV5NZnJ7Q/xRtdOSaFrcDJlXdjyVI11Zrf/nELZDMGTIiC8oGclsYVe7nchj+8lX6NKXrYPlZu1XHze7bW1O6FwZRdNrwL4NbahskjroQlC4Q9FD3e1CPO4v0v7J5zxPkjXxU6cWQ+dB5gLIv3732UyDZj25NBlhmvKzuU82yfB+GInhntvGAjtWdXy2ZsswQvVrhr09sAF5PPycRtQlp1L0oY4TK0BAY7HnYvORPVEcWg1FhPRN1TckMFN7rqTjgUQmps5oZjdoBUCW7V3kpq85FZT8cJFTXPo7EBQu3Oow+CExuGuGJ510QcGVNJshihxUJXFW5zruGYOU8ahqo0+HqpuHTx2j0Emx0=";
let superKeyEnStr = "PQJ2F4bEvWjpdc6Yw2U3jioK4lk/IaWec5Jyy89UeoCGHtii0ljX6A==";
let easyKeyEnStr = "jgCXJUe4umhO7FyajvDhdPi+6mrNKa1/GIUz6wtrBxS3YjtaHGlzEw==";
if (accessKey && codeStr) {
    encodeStr = Aes.Ctr.encrypt(codeStr, accessKey, 256);
    console.log('>>>> encodeStr=', encodeStr);
}
if (accessKey && superKey) {
    superKeyEnStr = Aes.Ctr.encrypt(accessKey, superKey, 256);
    console.log('>>>> superKeyEnStr=', superKeyEnStr);
}
if (accessKey && easyKey) {
    easyKeyEnStr = Aes.Ctr.encrypt(accessKey, easyKey, 256);
    console.log('>>>> easyKeyEnStr=', easyKeyEnStr);
}
// TODO æ›´æ–°è®¿é—®å¯†é’¥ä¹‹åï¼Œè¿˜éœ€è¦æ›´æ”¹ nginx ä¸‹è½½é“¾æ¥ä¸­çš„å¯†é’¥

// æ£€æµ‹æ ¸å¿ƒä»£ç å’Œå¯†é’¥
function checkCoreCode(method, isDialog) {

    // æœ¬åœ°ç‰ˆæœ¬ä¸æ£€æµ‹
    if (isLocalVersion()) return true;

    // è°ƒç”¨æ–¹æ³•åç§°æ ¡éªŒ
    if (!method || typeof method !== 'string' || method.length > 50) return false;

    // å‚æ•°é»˜è®¤å€¼
    accessMsg = "ğŸ”‘ è¯·è¾“å…¥è®¿é—®å¯†é’¥";

    for (let i = 0, len = 100; i < len; i++) {
        // å…ˆä» localStorage è·å– accessKey
        accessKey = localStorage.getItem('collide-try-access-key');
        // é€€æ¸¸äº†ï¼Œå…¬å¼€è®¿é—®
        //accessKey = "Pg24fzRl02a45odGEvKsFqL0MHmykigF";

        if (isDialog) {
            // æ²¡æ‰¾åˆ°ï¼Œå†å¼¹çª—æç¤ºè¾“å…¥ã€è®¿é—®å¯†é’¥ã€‘
            // å•å‡»å–æ¶ˆæŒ‰é’®ï¼Œprompt() æ–¹æ³•å°†è¿”å› nullï¼Œå•å‡»ç¡®è®¤æŒ‰é’®ï¼Œprompt() å°†è¿”å›è¾“å…¥çš„æ–‡æœ¬ï¼Œå¼¹çª—æ—¶ä¼šæš‚åœ JavaScript æ‰§è¡Œ
            if (!accessKey) accessKey = prompt(accessMsg, "è¯¢é—®ä½œè€…æˆ–å…³æ³¨ä½œè€…ç©å§åŠ¨æ€");
            //console.log(">>>> accessKey=" + accessKey);
            if (accessKey === null) { // ç‚¹äº†å–æ¶ˆ
                alert("ğŸ’¡ æ¸©é¦¨æç¤ºï¼š\næ²¡æœ‰è®¿é—®å¯†é’¥ï¼Œæ ¸å¿ƒåŠŸèƒ½ä¼šå—åˆ°å½±å“ï¼è¯·è”ç³»å¼€å‘è€…è·å–è®¿é—®å¯†é’¥");
                return false;
            }
            if (!accessKey || accessKey.replaceAll(" ", "") === "") {
                accessMsg = "âŒ è®¿é—®å¯†é’¥ä¸èƒ½ä¸ºç©º";
                continue;
            }
            if (accessKey.length < 8 || accessKey.length > 128) {
                accessMsg = "âŒ è®¿é—®å¯†é’¥é•¿åº¦é”™è¯¯";
                continue;
            }
        }

        if (!accessKey) {
            console.log(">>>> checkCoreCode accessKey empty");
            return false;
        }

        try {
            //encodeStr = Aes.Ctr.encrypt(codeStr, accessKey, 256);
            //console.log(encodeStr);
            if (accessKey.toLowerCase().includes("thelight")) accessKey = Aes.Ctr.decrypt(superKeyEnStr, accessKey, 256); // superKey
            else if (accessKey.length < 32) accessKey = Aes.Ctr.decrypt(easyKeyEnStr, accessKey, 256); // easyKey
            //console.log(">>>> accessKey=" + accessKey);
            codeStr = Aes.Ctr.decrypt(encodeStr, accessKey, 256);
            //console.log(codeStr); // å¯†é’¥ä¸å¯¹ï¼Œè¿”å›æ˜¯ä¹±ç  QÂƒÂªÃ‘g=[JLÃ¤Ã³jÂ´qÃ€Â76

            // åŠ¨æ€æ·»åŠ  do2BallsCollidedMV2 æ–¹æ³•
            if (codeStr && codeStr.includes(method)) addCoreScript(null, method, 'collide-try-core-code', codeStr);
            else throw new Error(">>>> Decrypt failed. Please check your accessKey!");
            // å°è¯•è°ƒç”¨éªŒè¯
            //do2BallsCollidedMV2();
            Function('return ' + method + '()')(); // TODO Function å‡½æ•°ä½œç”¨åŸŸè®¿é—®ä¸åˆ° vue å†…éƒ¨æ¨¡æ¿ï¼Œä½†æ˜¯èƒ½è®¿é—®åˆ°å…¨å±€ script
            // è°ƒç”¨ä¸æŠ¥é”™ï¼ŒæŠŠ accessKey å­˜å…¥ localStorage
            localStorage.setItem('collide-try-access-key', accessKey);
            codeStr = null; // é‡Šæ”¾å­—ç¬¦ä¸²å†…å­˜
            encodeStr = null;
            superKeyEnStr = null;
            //break;
            return true;
        } catch (e) {
            accessMsg = "âŒ è®¿é—®å¯†é’¥é”™è¯¯";
            //doGlobalError(e, (sysConfig && sysConfig.alertErrorCount)?sysConfig.alertErrorCount:3);
            doGlobalErrorMsg(e, false);
            //localStorage.removeItem('collide-try-access-key');
            // å¤„ç†å¯†é’¥æ ¡éªŒä¸é€šè¿‡
            doKeyCheckFail();
        }
    }
    return false;
}

// é¡µé¢å…ƒç´ ã€è„šæœ¬ã€æ–‡ä»¶åŠ è½½å®Œæˆä¹‹åå†æ‰§è¡Œï¼Œé¿å…è·å–ä¸åˆ°å…ƒç´ 
window.onload = function () {
    let keyCkeckResult = checkCoreCode("do2BallsCollidedMV2", false);
    if (!keyCkeckResult) {
        // å¤„ç†å¯†é’¥æ ¡éªŒä¸é€šè¿‡
        doKeyCheckFail();
    }
}


// å¯†é’¥æ ¡éªŒä¸é€šè¿‡å¤„ç†äº‹é¡¹
function doKeyCheckFail() {
    // å¯†é’¥æ ¡éªŒä¸é€šè¿‡ï¼Œæ¸…é™¤ç”¨æˆ·å·²é€‰çš„è§’è‰²è®°å½•ï¼Œé‡æ–°å¼¹å‡ºé€‰æ‹©è§’è‰²å¼¹çª—
    localStorage.removeItem('collide-try-access-key');
    localStorage.removeItem('collide-try-role-chose');
    //userConfig.currRole = -1;
    setCurrRoleV2();
}


// æ£€æµ‹è¾“å…¥çš„è®¿é—®å¯†é’¥æ˜¯å¦æ­£ç¡®
function checkAccessKey() {

    // æœ¬åœ°ç‰ˆæœ¬ä¸æ£€æµ‹
    if (isLocalVersion()) return true;

    let result = false;
    // æ ¡éªŒæ˜¯å¦è¾“å…¥äº†å¯†é’¥
    accessKey = localStorage.getItem('collide-try-access-key');
    if (!accessKey || accessKey.replaceAll(' ', '') === '') return false;

    // æ ¡éªŒå¯†é’¥æ˜¯å¦æ­£ç¡®ï¼Œè§£å¯†æ–¹æ³•æ˜¯å¦èƒ½æ­£å¸¸è®¿é—®
    // checkCoreCode å·²ç»è§£å¯†äº†ä¸€æ¬¡ï¼Œè¿™é‡Œä¸å†é‡å¤è§£å¯†
    try {
        // å°è¯•è°ƒç”¨éªŒè¯
        do2BallsCollidedMV2();
        result = true;
    } catch (e) {
        //doGlobalErrorMsg(e, false);
    }

    return result;

    // è¿™ä¸ªæ£€æµ‹æ–¹æ³•ç›´æ¥æ”¹ä¸ºè¿”å›trueï¼Œå°±ç ´è§£ç»•è¿‡äº†
    //return true;
}


// æ˜¯å¦ä¸ºç¦»çº¿ç‰ˆæœ¬
function isLocalVersion() {
    let result = false;
    // è·å–æ ¸å¿ƒè„šæœ¬å…ƒç´ 
    let coreJsEles = document.getElementsByClassName("collide-try-core-code");
    if (!coreJsEles || coreJsEles.length < 1) return false;
    //console.log(coreJsEles);
    // å°è¯•è®¿é—®æ ¸å¿ƒæ–¹æ³•
    try {
        do2BallsCollidedMV2();
        result = true;
    } catch (e) {
        //doGlobalErrorMsg(e, false);
    }

    return result;
}


//////////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////////
// ã€ä¸»ç¨‹åºã€‘ å˜é‡ã€æ–¹æ³•åŒºåŸŸ
//////////////////////////////////////////////////////////////////////

// è·å–ç”»å¸ƒ
let gameSceneGraphCanvas = document.getElementById('game-scene-graph'); // é™æ€åœºæ™¯å¤§é¢ç§¯åŒºåŸŸæ™¯ç‰©å›¾å½¢å±‚ç”»å¸ƒ
let gameSceneEmojiCanvas = document.getElementById('game-scene-emoji'); // é™æ€åœºæ™¯æ™¯ç‰©å›¾å½¢å±‚ç”»å¸ƒ
let gameSceneCanvas = document.getElementById('game-scene'); // é™æ€åœºæ™¯å±‚ç”»å¸ƒ
let gameSceneLinesCanvas = document.getElementById('game-scene-lines'); // é™æ€åœºæ™¯è¾¹æ¡†å±‚ç”»å¸ƒ
let gameSceneLinesBgCanvas = document.getElementById('game-scene-lines-bg'); // é™æ€åœºæ™¯è¾¹æ¡†èƒŒæ™¯å±‚ç”»å¸ƒ
let gameSceneCoordinateCanvas = document.getElementById('game-scene-coordinate'); // é™æ€åœºæ™¯ç –æ ¼åæ ‡å¸ƒ
let canvas = document.getElementById('game-main'); // ä¸»è¿åŠ¨å±‚ç”»å¸ƒ
let gameMainBallCanvas = document.getElementById('game-main-ball'); // ä¸»çƒè¿åŠ¨å±‚ç”»å¸ƒï¼Œä¸»çƒå’Œå…¶ä»–çƒåˆ†å¼€
let gamePathCanvas = document.getElementById('game-path'); // è§’è‰²ä¸­çº¿è·¯å¾„å±‚ç”»å¸ƒï¼ˆä¸€æ¡ç»†çº¿ï¼‰
let gamePathBallCanvas = document.getElementById('game-path-ball'); // è§’è‰²å…¨è·¯å¾„å±‚ç”»å¸ƒï¼ˆè·¯å¾„çº¿å®½ä¸ºè§’è‰²ç›´å¾„ï¼‰
let gameClickPlayCanvas = document.getElementById('game-click-play'); // ç‚¹æŒ‰å‘å°„æŒ‰é’®å±‚
let gameMaskCanvas = document.getElementById('game-mask'); // é®ç½©å±‚ç”»å¸ƒ
// è·å–ä¸Šä¸‹æ–‡
let gameSceneGraphContext = gameSceneGraphCanvas ? gameSceneGraphCanvas.getContext('2d') : null;
let gameSceneEmojiContext = gameSceneEmojiCanvas ? gameSceneEmojiCanvas.getContext('2d') : null;
let gameSceneContext = gameSceneCanvas ? gameSceneCanvas.getContext('2d') : null;
let gameSceneLinesContext = gameSceneLinesCanvas ? gameSceneLinesCanvas.getContext('2d') : null;
let gameSceneLinesBgContext = gameSceneLinesBgCanvas ? gameSceneLinesBgCanvas.getContext('2d') : null;
let gameSceneCoordinateContext = gameSceneCoordinateCanvas ? gameSceneCoordinateCanvas.getContext('2d') : null;
let context = canvas ? canvas.getContext('2d') : null;
let gameMainBallContext = gameMainBallCanvas ? gameMainBallCanvas.getContext('2d') : null;
let gamePathContext = gamePathCanvas ? gamePathCanvas.getContext('2d') : null;
let gamePathBallContext = gamePathBallCanvas ? gamePathBallCanvas.getContext('2d') : null;
let gameClickPlayContext = gameClickPlayCanvas ? gameClickPlayCanvas.getContext('2d') : null;
let gameMaskContext = gameMaskCanvas ? gameMaskCanvas.getContext('2d') : null;
// å¼¹çª—å…ƒç´ 
let dialogMask = document.getElementById('dialog-mask'); // é€‰æ‹©è§’è‰²å¼¹çª—é®ç½©
let chooseRoleDialog = document.getElementById('choose-role-dialog'); // é€‰æ‹©è§’è‰²å¼¹çª—
let userSettingDialog = document.getElementById('user-setting-dialog'); // å‚æ•°è®¾ç½®å¼¹çª—
let reChooseRoleEntryDialog = document.getElementById('re-choose-role-entry-dialog'); // é‡æ–°é€‰æ‹©è§’è‰²å…¥å£æç¤º
let gameSettingEntryDialog = document.getElementById('game-setting-entry-dialog'); // æ¸¸æˆè®¾ç½®æç¤º
let gameSettingMainRoleDialog = document.getElementById('game-setting-main-role-dialog'); // æ¸¸æˆè®¾ç½®-ä¸»è§’è®¾ç½®æç¤º
let aboutAppDialog = document.getElementById('user-setting-about-app-dialog'); // å‚æ•°è®¾ç½®-å…³äºåº”ç”¨
let updateContentDialog = document.getElementById('collide-try-update-content-dialog'); // æ›´æ–°å†…å®¹æç¤º
let howToPlayDialog = document.getElementById('collide-try-how-to-play-dialog'); // æ“ä½œæŒ‡å—æç¤º
let rolePosLine = document.getElementById('collide-try-role-pos-line'); // è§’è‰²åæ ‡æ‚¬æµ®æ¡

onMounted(() => {
    gameSceneGraphCanvas = document.getElementById('game-scene-graph'); // é™æ€åœºæ™¯å¤§é¢ç§¯åŒºåŸŸæ™¯ç‰©å›¾å½¢å±‚ç”»å¸ƒ
    gameSceneEmojiCanvas = document.getElementById('game-scene-emoji'); // é™æ€åœºæ™¯æ™¯ç‰©å›¾å½¢å±‚ç”»å¸ƒ
    gameSceneCanvas = document.getElementById('game-scene'); // é™æ€åœºæ™¯å±‚ç”»å¸ƒ
    gameSceneLinesCanvas = document.getElementById('game-scene-lines'); // é™æ€åœºæ™¯è¾¹æ¡†å±‚ç”»å¸ƒ
    gameSceneLinesBgCanvas = document.getElementById('game-scene-lines-bg'); // é™æ€åœºæ™¯è¾¹æ¡†èƒŒæ™¯å±‚ç”»å¸ƒ
    gameSceneCoordinateCanvas = document.getElementById('game-scene-coordinate'); // é™æ€åœºæ™¯ç –æ ¼åæ ‡å¸ƒ
    canvas = document.getElementById('game-main'); // ä¸»è¿åŠ¨å±‚ç”»å¸ƒ
    gameMainBallCanvas = document.getElementById('game-main-ball'); // ä¸»çƒè¿åŠ¨å±‚ç”»å¸ƒï¼Œä¸»çƒå’Œå…¶ä»–çƒåˆ†å¼€
    gamePathCanvas = document.getElementById('game-path'); // è§’è‰²ä¸­çº¿è·¯å¾„å±‚ç”»å¸ƒï¼ˆä¸€æ¡ç»†çº¿ï¼‰
    gamePathBallCanvas = document.getElementById('game-path-ball'); // è§’è‰²å…¨è·¯å¾„å±‚ç”»å¸ƒï¼ˆè·¯å¾„çº¿å®½ä¸ºè§’è‰²ç›´å¾„ï¼‰
    gameClickPlayCanvas = document.getElementById('game-click-play'); // ç‚¹æŒ‰å‘å°„æŒ‰é’®å±‚
    gameMaskCanvas = document.getElementById('game-mask'); // é®ç½©å±‚ç”»å¸ƒ

    gameSceneGraphContext = gameSceneGraphCanvas.getContext('2d');
    gameSceneEmojiContext = gameSceneEmojiCanvas.getContext('2d');
    gameSceneContext = gameSceneCanvas.getContext('2d');
    gameSceneLinesContext = gameSceneLinesCanvas.getContext('2d');
    gameSceneLinesBgContext = gameSceneLinesBgCanvas.getContext('2d');
    gameSceneCoordinateContext = gameSceneCoordinateCanvas.getContext('2d');
    context = canvas.getContext('2d');
    gameMainBallContext = gameMainBallCanvas.getContext('2d');
    gamePathContext = gamePathCanvas.getContext('2d');
    gamePathBallContext = gamePathBallCanvas.getContext('2d');
    gameClickPlayContext = gameClickPlayCanvas.getContext('2d');
    gameMaskContext = gameMaskCanvas.getContext('2d');

    dialogMask = document.getElementById('dialog-mask'); // é€‰æ‹©è§’è‰²å¼¹çª—é®ç½©
    chooseRoleDialog = document.getElementById('choose-role-dialog'); // é€‰æ‹©è§’è‰²å¼¹çª—
    userSettingDialog = document.getElementById('user-setting-dialog'); // å‚æ•°è®¾ç½®å¼¹çª—
    reChooseRoleEntryDialog = document.getElementById('re-choose-role-entry-dialog'); // é‡æ–°é€‰æ‹©è§’è‰²å…¥å£æç¤º
    gameSettingEntryDialog = document.getElementById('game-setting-entry-dialog'); // æ¸¸æˆè®¾ç½®æç¤º
    gameSettingMainRoleDialog = document.getElementById('game-setting-main-role-dialog'); // æ¸¸æˆè®¾ç½®-ä¸»è§’è®¾ç½®æç¤º
    aboutAppDialog = document.getElementById('user-setting-about-app-dialog'); // å‚æ•°è®¾ç½®-å…³äºåº”ç”¨
    updateContentDialog = document.getElementById('collide-try-update-content-dialog'); // æ›´æ–°å†…å®¹æç¤º
    howToPlayDialog = document.getElementById('collide-try-how-to-play-dialog'); // æ“ä½œæŒ‡å—æç¤º
    rolePosLine = document.getElementById('collide-try-role-pos-line'); // è§’è‰²åæ ‡æ‚¬æµ®æ¡
})

////////////////////////////////////////////////
// ç³»ç»Ÿå‚æ•°é…ç½®
////////////////////////////////////////////////
var sysConfig = {
    // åº”ç”¨åç§°
    appName: "ç©å§-æ’å‡»ç‹è€…-æ¨¡æ‹Ÿç»ƒä¹ å·¥å…·",
    // ç¨‹åºç‰ˆæœ¬å· TODO è®°å¾—æŸ¥çœ‹å¹¶æ›´æ–°ç‰ˆæœ¬è¿‡æœŸçš„æ—¶é—´
    version: Number(packageVersion.replaceAll(".", "") + "250907"),
    versionName: "V" + packageVersion + "-Beta",
    // è®¾å¤‡å±å¹•åƒç´ æ¯”ï¼Œinitæ–¹æ³•åˆå§‹åŒ–æ—¶æ›´æ–°
    dpr: 3,
    // åƒç´ ç¼©æ”¾æ¯”ä¾‹ï¼Œç”¨äºå¹³æ¿åƒç´ æ”¾å¤§
    pxRatio: 1,
    // æ¸¸æˆæ˜¯å¦å¼€å§‹ï¼Œä»ç¬¬ä¸€æ¬¡æ‹–åŠ¨åï¼Œå°±è®¾ç½®ä¸ºtrue
    isGameBeginning: false,
    // æ¸¸æˆè§’è‰²æ˜¯å¦é€‰æ‹©å®Œæˆï¼Œç”¨äºæ§åˆ¶æ€§èƒ½ä¼˜åŒ–
    isRoleChooseFinished: false,
    // ä¿®æ”¹å‚æ•°è®¾ç½®åï¼Œæ˜¯å¦éœ€è¦åˆ·æ–°é¡µé¢
    isNeedReload: false,
    // ç¨‹åºå‡ºé”™å‡ æ¬¡å¼¹çª—æç¤º
    alertErrorCount: 3,
    // è®¾ç½®æ¸¸æˆå°é¢å å±å¹•å®½åº¦çš„æ¯”ä¾‹
    sceneWidthRatio: 0.78,
    // è®¾ç½®æ¸¸æˆå°é¢è¾¹æ¡†çº¿å®½ï¼Œå– 0.3 * girdSizeCss
    sceneLineWidth: 6,
    // è®¾ç½®ç”»å¸ƒæ˜¾ç¤ºå¤§å°ï¼ˆcssæ ·å¼ä¸­çš„å¤§å°ï¼‰ã€å¤§å›¾ç¼©å°ä¸ä¼šæ¨¡ç³Šã€‘ï¼Œåˆå§‹åŒ–çš„æ—¶å€™ä¼šè®¡ç®—ä¿®æ”¹
    cssWidth: 0,
    cssHeight: 0,
    // è®¾ç½®Canvasç”»å¸ƒåç§»ä½ç½®
    cLeft: 0,
    cTop: 0,
    // ç½‘æ ¼å¤§å°
    girdSize: 0, // canvas å®é™…çš„ girdSize
    girdSizeCss: 0, // css ç¼©å°åçš„ girdSize
    // æ˜¯å¦ä¸ºç©å§æ’å‡»å°é¢ï¼Œåˆ‡è§’ä¸æ˜¯æ ‡å‡†çš„ 180-45=135 è€Œæ˜¯ 180-44=136
    isWan8CocosTable: true,
    // æ–œè¾¹è§’åº¦å€¾æ–œåå·®ï¼ˆå•ä½ï¼šåƒç´ ï¼‰ï¼Œåˆå§‹åŒ–çš„æ—¶å€™ä¼šæ ¹æ® girdSize é‡æ–°è®¡ç®—ï¼Œç¨‹åºå–è¿™é‡Œçš„æ•°å€¼ã€‚ç¬¬ä¸€ä¸ªå€¼å¯¹åº”ç‚¹(0, 3)ï¼Œå…¶ä»–ç‚¹å¾€é¡ºæ—¶é’ˆæ–¹å‘é€’å¢
    wan8CocosTableMoveVals: [0, 0, 0, 0, 0, 0, 0, 0],
    // åœ¨æ£€æµ‹ä¸¤åœ†çƒç¢°æ’æ—¶ï¼Œå¢åŠ ä¸€ä¸ªå¾®å°çš„å®¹å·®å€¼ï¼ˆepsilonï¼‰ï¼Œç¡®ä¿å³ä½¿å°çƒéå¸¸æ¥è¿‘ä¹Ÿèƒ½æ£€æµ‹åˆ°ç¢°æ’
    epsilon: 0.20,
    // ç¢°æ’æŸè€—ï¼Œç©å§è§’è‰²ç¢°å¢™æˆ–è€…ç¢°å…¶ä»–è§’è‰²ï¼Œçœ‹ç€ä¼¼ä¹æ²¡æœ‰æŸè€—ã€‚checkBounceæ–¹æ³•ï¼Œä½œç”¨åœ¨åˆé€Ÿåº¦ä¸Š
    bounce: 0,
    // è›‹æœ‰å¼¹æ€§ï¼Œç¢°æ’å¯å¢åŠ ä¸€å®šç™¾åˆ†æ¯”çš„é€Ÿåº¦
    eggBounce: 0.35, // v * eggBounce 50 * 0.2 = 10
    // æ‘©æ“¦åŠ› f=Î¼Ã—Fnï¼ˆFnï¼šæ­£å‹åŠ›ï¼Œä¸ä¸€å®šç­‰äºæ–½åŠ›ç‰©ä½“çš„é‡åŠ›(mg) Î¼ï¼šåŠ¨æ‘©æ“¦å› æ•°ï¼Œæ˜¯æ•°å€¼ï¼Œæ— å•ä½ï¼‰
    // ç®€å•æ¨¡æ‹Ÿ 0.05 0.24 ä¸€ä¸ªæ¥è¿‘0.9çš„ç³»æ•°èƒ½å¾ˆå¥½çš„æ¨¡æ‹Ÿå‡ºæ‘©æ“¦åŠ›çš„æ•ˆæœ
    friction: 0.575,
    // è§’è‰²é‡é‡æé‡ï¼Œå¯¹åº”æ•°å€¼ï¼Œé»˜è®¤ 100ï¼Œå…¶ä»–è§’è‰²ç›¸å¯¹è¿™ä¸ªå€¼çš„æ¯”ç‡å–å€¼
    maxWeightVal: 100,
    // emoji/svg å›¾å½¢å›¾å½¢é‡å é‡è¯•æ¬¡æ•°
    emojiCrossRetryCount: 3,
    // æ˜¯å¦ä¸ºå±•ç¤ºdemo
    isDemo: false,
    // ç½‘é¡µèƒŒæ™¯å›¾ç‰‡key
    bgImageKey: "COLLIDE-TRY-BG-IMAGE-THEME-",
    // æ˜¯å¦è¯´å†è§ï¼Œç”¨äºæ§åˆ¶æ˜¾ç¤ºå‘Šåˆ«ä¿¡æ¯
    isSayGoodbye: true,

}
console.log(">>>> sysConfig=" + JSON.stringify(sysConfig));

////////////////////////////////////////////////
// ç”¨æˆ·å‚æ•°é…ç½®
////////////////////////////////////////////////
var userConfig = {
    // ä¸»è§’è‰²é…ç½®
    currRole: -1, // é»˜è®¤æ²¡é€‰ä»»ä½•è§’è‰²ï¼Œå…·ä½“è®¾ç½®å“ªä¸ªè§’è‰²ä¼šå¼¹çª—æç¤ºç”¨æˆ·é€‰æ‹©ã€‚è§’è‰²å¯¹åº”åºå·åœ¨ Role æšä¸¾ç±»
    // åœºæ™¯ä¸»é¢˜ï¼Œ0-é»˜è®¤ä¸»é¢˜ï¼›1-å†¬å­£å†°é›ªä¸»é¢˜ï¼›2-æ–°å¹´ä¸»é¢˜ï¼›3-ç”°å›­ä¸»é¢˜ï¼›4-æ˜Ÿé™…ä¸»é¢˜
    sceneThemeMode: -1, // -1 æ²¡é€‰æ‹©ä»»ä½•ä¸»é¢˜ï¼Œæ ¹æ®æ—¶é—´å­£èŠ‚è‡ªåŠ¨è®¾ç½®
    // å½“å‰æ“ä½œæ–¹å¼ï¼Œ0-æ‹–æ‹½ï¼ˆé»˜è®¤ï¼‰ï¼›1-ç‚¹æŒ‰
    currPlayOpt: 0,
    // ä¸»è§’æ‰€åœ¨é˜Ÿé¢œè‰²
    mainTeamColor: 'b',
    // æ˜¯å¦éšæœºè§’è‰²ï¼Œå®Œå…¨éšæœº
    isRandomRole: false,
    // æ˜¯å¦æé€Ÿå¼€å§‹ï¼ŒæŒ‘é€‰å¸¸ç”¨ç»„åˆ
    isFlashRole: false,
    // æ˜¯å¦åªç”¨ä¸€ä¸ªè§’è‰²æµ‹è¯•
    isTestOnlyOne: false,
    // æ˜¯å¦æ˜¾ç¤ºå°çƒè¿åŠ¨è·¯å¾„
    isShowBallMovePath: true,
    // æ˜¯å¦æ˜¾ç¤ºå°çƒæœ¬ä½“è·¯å¾„
    isShowBallPath: true,
    // ç¢°åˆ°å¦ä¸€ä¸ªå°çƒæ˜¯å¦åœæ­¢è¿åŠ¨
    isStopAfterCollided: false,
    // åªç„å‡†ä¸æ‰“ï¼Œç”¨äºæˆªå›¾åˆ†äº«
    isJustTrying: false,
    // åªç¢°ä¸€æ¬¡è§’è‰²ï¼Œç”¨äºç»ƒä¹ ç¢°æ’åå¼¹
    isRoleCollidedOnce: false,
    // ç¢°ä¸¤æ¬¡ååœæ­¢ï¼Œç”¨äºæµ‹è¯•è§‚å¯Ÿè§’åº¦
    isStopAfter2WallCollided: false,
    // åªæ˜¾ç¤ºå°é¢
    isJustShowTable: false,
    // æ˜¯å¦æ˜¾ç¤ºå°é¢è¾¹æ¡†
    isShowTableBorder: true,
    // æ˜¯å¦æ˜¾ç¤ºç –æ ¼åæ ‡
    isShowGridCoordinate: true,
    // æ˜¯å¦æ˜¾ç¤ºç –æ ¼å…¨åæ ‡ï¼ˆæ˜¾ç¤ºåˆ‡è§’ç –æ ¼ï¼‰
    isShowGridCoordinateFull: false,
    // æ˜¯å¦æ˜¾ç¤ºåœºæ™¯å›¾å½¢
    isShowSceneGraph: true,
    // æ˜¯å¦æ˜¾ç¤ºè§’è‰²è¡€é‡æ¡
    isShowRoleBloodLine: true,
    // æ˜¯å¦æ˜¾ç¤ºè§’è‰²ç¼–å·
    isShowRoleBloodNo: true,
    // æ˜¯å¦åŒå‡»å±å¹•å›é€€
    isDbclickBack: true,
    // å‚€å„¡æ‹‰å›
    isKuileiPullBack: true,
    // ç„å‡†ç©¿é€(æå‡æµç•…)ï¼Œåªå¯¹åƒµå°¸ã€å‚€å„¡ç­‰å¯ç©¿é€è§’è‰²æœ‰æ•ˆ
    isPiercesTry: false,
    // ç„å‡†æ˜¾ç¤ºè·¯å¾„ï¼Œåªå¯¹åƒµå°¸ã€å‚€å„¡ç­‰å¯ç©¿é€è§’è‰²æœ‰æ•ˆ
    isShowTryFullPath: true,
    // æ˜¾ç¤ºçŒ´å­åˆ†èº«æç¤º
    isShowWkPath: true,
    // ç„å‡†æ˜¾ç¤ºè·¯å¾„ï¼ŒæŒ‡å®šç¢°æ’å‡ æ¬¡çš„è·¯å¾„
    tryFullPathPointNum: 6,
    // é•¿æŒ‰é‡ç½®è§’è‰²ä½ç½®
    isLongPressRandom: true,
    // ç§»åŠ¨è§’è‰²æ˜¾ç¤ºåæ ‡ï¼ˆå•ä½ï¼šæ ¼ï¼‰
    isShowRoleMovePos: true,
    // åˆ†äº«/å¯¼å…¥è§’è‰²åŠåæ ‡
    shareRoleAndPos: "",
    // æŒ‡å®šæ¸¸æˆè§’è‰²ï¼Œæ•°é‡ä¸å¤Ÿä¼šéšæœºè¡¥æ»¡ã€‚è¾“å…¥ä¸€ä¸ªå­—å³å¯è‡ªåŠ¨è¯†åˆ«è¡¥å……è§’è‰²å…¨å
    gameRoleIds: [-1, -1, -1, -1],
    // è§’è‰²åŠ é€Ÿæˆ–å‡é€Ÿï¼ˆè´Ÿæ•°ä¸ºå‡é€Ÿï¼‰
    roleSpeedAddVal: 0,
    // å¡é¡¿è‡ªåŠ¨æ¢å¤ç­‰å¾…æ—¶é—´ï¼ˆå•ä½ï¼šç§’ï¼‰
    animateAutoRestTime: 20,
    // æ˜¯å¦ä½¿ç”¨è‡ªå®šä¹‰ä¸»é¢˜
    isUseCustomTheme: false,
    // æ–œè¾¹è§’åº¦å€¾æ–œåå·®ï¼ˆå•ä½ï¼šæ ¼ï¼‰ï¼Œç”¨æˆ·è®¾ç½®çœ‹åˆ°çš„æ˜¯è¿™é‡Œçš„æ•°å€¼ã€‚ç¬¬ä¸€ä¸ªå€¼å¯¹åº”ç‚¹(0, 3)ï¼Œå…¶ä»–ç‚¹å¾€é¡ºæ—¶é’ˆæ–¹å‘é€’å¢
    //wan8CocosTableMoveVals: [0,0.05,-0.05,-0.05,0.12,-0.025,0.025,0.08], // æ³¨æ„ undefined æ‰¾ä¸åˆ°å€¼ï¼Œæˆ–è€…æ•°å€¼ä¸å¯¹ï¼Œéœ€è¦æ¸…é™¤ localStorage ç¼“å­˜
    wan8CocosTableMoveVals: [0, 0.05, -0.05, -0.05, 0.12, -0.025, 0.025, 0.05],

}
// ç”¨æˆ·åŸå§‹é…ç½®å¤‡ä»½
var userConfigBack = JSON.parse(JSON.stringify(userConfig));

// å…¨å±€å‚æ•°è®¾ç½®
class GlobalParams {
    constructor(options = {}) {
        /*
        å›¾å½¢å åŠ æ¨¡å¼ https://blog.csdn.net/qq_33933205/article/details/107337882
        copyï¼šåªæ˜¾ç¤ºæ–°çš„å›¾å±‚
        xorï¼šæ˜¾ç¤ºæ–°çš„å›¾å±‚å’Œæ—§çš„å›¾å±‚ï¼Œä¸æ˜¾ç¤ºé‡å çš„å›¾å±‚
        source-overï¼šé»˜è®¤å€¼ï¼Œæ–°çš„å›¾å±‚è¦†ç›–è€çš„å›¾å±‚
        destination-overï¼šæ–°çš„å›¾å±‚åœ¨è€çš„å›¾å±‚ä¸‹é¢
        */
        this.composite = options.composite || "";
        // æ‰€æœ‰ç»˜åˆ¶ä¸å—é™åˆ¶
        this.isAll = options.isAll || false;
        // åªç”»å°çƒ
        this.isBallOnly = options.isBallOnly || false;
        // ç»˜åˆ¶å›¾å½¢ï¼Œæ–‡å­—ã€iconã€imgã€svg ç­‰
        this.graph = options.graph || null;
        // é˜´å½±é¢œè‰²
        this.shadowColor = options.shadowColor || "#999";
        // è™šåŒ–èŒƒå›´
        this.shadowBlur = options.shadowBlur || "5";
    }

    static getInstance(options) {
        if (!this.instance) {
            this.instance = new GlobalParams(options);
            //console.log(">>>> GlobalParams new GlobalParams(options)");
        }
        return this.instance;
    }

    reset() {
        this.composite = "";
        this.isAll = false;
        this.isBallOnly = false;
        this.graph = null;
        this.shadowColor = "#999";
        this.shadowBlur = "5";
    }

    static getCleanParams() {
        this.getInstance();
        this.instance.reset();
        return this.instance;
    }
}
const globalParams = GlobalParams.getCleanParams();

//globalParams.graph = "test";
//console.log(globalParams);
//globalParams.reset();
//console.log(globalParams);


// åˆ¤æ–­canvasç”»å¸ƒæ˜¯å¦æœ‰ç»˜åˆ¶å†…å®¹
// https://segmentfault.com/q/1010000005820251
function isCanvasBlank(canvas) {
    let blank = document.createElement('canvas'); // åˆ›å»ºä¸€ä¸ªç©ºcanvaså¯¹è±¡
    blank.width = canvas.width;
    blank.height = canvas.height;
    return canvas.toDataURL() == blank.toDataURL(); // æ¯”è¾ƒå€¼ç›¸ç­‰åˆ™ä¸ºç©º
}

//////////////////////////////////////////////////////////////////////  


//////////////////////////////////////////////////////////////////////
// ã€Ballçƒç›¸å…³ã€‘ å˜é‡ã€æ–¹æ³•åŒºåŸŸ
//////////////////////////////////////////////////////////////////////

// çƒ/æ’å‡»è§’è‰²å¯¹è±¡
class Ball {
    constructor(context, options = {}) {
        this.context = context;
        this.x = options.x || 0; // ä½ç½®
        this.y = options.y || 0;
        this.radius = options.radius || 27; // åŠå¾„
        this.color = options.color || ''; // é¢œè‰²
        this.vx = options.vx || 0; // é€Ÿåº¦
        this.vy = options.vy || 0;
        this.ax = options.ax || 0; // åŠ é€Ÿåº¦
        this.ay = options.ay || 0;
        ////////////////////////////////////////////////
        // ã€æ–°å¢ã€‘å°çƒç¢°æ’æ£€æµ‹ç›¸å…³å˜é‡
        ////////////////////////////////////////////////
        this.no = options.no || 0; // è§’è‰²ç¼–å·ï¼Œä»1å¼€å§‹
        this.teamColor = options.teamColor || 'r'; // r-red;b-blue
        this.roleId = options.roleId || Role.HEIWA.id; // å°çƒå¯¹åº”è§’è‰²idï¼Œä»æšä¸¾ Role ä¸­å–idã€‚æ³¨æ„ï¼šoptions.roleId ä¸º 0 æ—¶ï¼Œæ˜¯ falseï¼Œå¯¼è‡´å–å€¼ä¸º -1
        this.isMainBall = options.isMainBall || false; // æ˜¯å¦ä¸ºä¸»çƒï¼Œç›®å‰åªæœ‰ä¸»çƒå¯ä»¥å‘å°„
        this.sizeRatio = options.sizeRatio || 2.0; // å°çƒç›¸å¯¹ç½‘æ ¼å¤§å°çš„æ¯”ä¾‹ï¼Œé»˜è®¤ 2 ä¸ªç½‘æ ¼å¤§å°
        this.pathRadius = options.pathRadius || roundNumber(5.20 / 2 * dpr, 4); // è·¯å¾„åŠå¾„
        this.tryRadius = options.tryRadius || this.radius; // ç„å‡†åœˆåŠå¾„
        this.radiusTmp = options.radiusTmp || this.radius; // åŠå¾„å¤‡ä»½ï¼Œç”¨äºæ§åˆ¶åŠå¾„å˜åŒ–
        this.pathColor = options.pathColor || "#cfe0d380"; // è·¯å¾„é¢œè‰²
        this.tryColor = options.tryColor || "#cfe0d330"; // ç„å‡†è¿çº¿é¢œè‰²
        this.collidedCount = options.collidedCount || 0; // ï¼ˆæ€»ï¼‰ç¢°æ’æ¬¡æ•°
        this.wallCollidedCount = options.wallCollidedCount || 0; // å¢™å£ç¢°æ’æ¬¡æ•°
        this.roleCollidedCount = options.roleCollidedCount || 0; // è§’è‰²ç¢°æ’æ¬¡æ•°
        this.vRatio = options.vRatio || 1; // åˆå§‹é€Ÿåº¦æ¯”ç‡ï¼šæå¿«-å¿«-ä¸­ç­‰-æ…¢-ææ…¢ é€çº§é€’å‡ 0.1 é»‘å¨ƒï¼šæå¿«-1
        this.v = options.v || 0; // åˆå§‹é€Ÿåº¦
        this.mRatio = options.mRatio || 1; // åˆå§‹é‡é‡æ¯”ç‡ï¼šæé‡-é‡-ä¸­ç­‰-è½»-æè½» é€çº§é€’å‡ 0.1 é»‘å¨ƒï¼šæè½»-0.6
        this.m = options.m || 0; // åˆå§‹é‡é‡
        this.x0 = options.x0 || 0; // èµ·ç‚¹ä½ç½®
        this.y0 = options.y0 || 0;
        this.addCount = options.addCount || 0; // å åŠ æŠ€èƒ½è®¡æ•°
        // æ£€æµ‹é¡ºåºï¼Œä»å¤§åˆ°å°ï¼Œå››é¢å¢™-å››ä¸ªåˆ‡è§’-è›‹
        this.isWallCollided = false; // å¢™é¢æ˜¯å¦ç¢°æ’
        this.isLineCollided = false; // åˆ‡è§’çº¿æ˜¯å¦ç¢°æ’
        this.isBallCollided = false; // çƒæ˜¯å¦ç¢°æ’
        this.isEggCollided = false; // è›‹æ˜¯å¦ç¢°æ’
        this.isCollided = false; // æ€»ç¢°æ’æ ‡è¯†ï¼Œå¢™é¢ã€åˆ‡é¢ã€çƒã€è›‹ï¼Œåªè¦æœ‰ä¸€ä¸ªå°±ç¢°æ’äº†å°±ç®—
        this.isCheckFinished = false; // ç¢°æ’æ£€æµ‹æ˜¯å¦å®Œæˆ
        this.collidingNos = []; // æ­£åœ¨ä¸å“ªå‡ ä¸ªè§’è‰²ç¢°æ’ï¼Œè®¾ç½®è§’è‰²æ—¶åˆå§‹åŒ–
        // å¤‡ä»½ä¸Šä¸€ä¸ªæ’å‡»ç‚¹
        this.preCollided = null;
        // å¤‡ä»½ä¸Šä¸€ä¸ªè¿åŠ¨ç‚¹
        this.prePoint = null;
        // åŸå§‹æ’å‡»ç‚¹
        this.collidedP0 = { x: 0, y: 0 };
        // åŸå§‹æ’å‡»ç‚¹é€Ÿåº¦
        this.collidedV0 = { x: 0, y: 0 };
        // æ¸²æŸ“æ§åˆ¶ç›¸å…³
        this.isMoving = false; // åœ¨ç§»åŠ¨
        this.isChgPosFinished = false; // æ‹–åŠ¨ä½ç½®å®ŒæˆçŠ¶æ€
        // çªç ´å’Œæ•ˆæœ
        this.upgradeEffect = 0;
        // å›¾æ ‡å¤§å°
        this.iconSize = 0;
        ////////////////////////////////////////////////
    }

    // ä½“å‹å¸¸é‡ï¼Œæå°-1.80ï¼›åå°-1.90ï¼›å°-2.00ï¼›ä¸­ç­‰-2.10ï¼›ä¸­å¤§-2.20ï¼›å¤§-2.30ï¼›æå¤§-2.40
    static SIZERATIO = { XS: 1.80, SS: 1.90, S: 2.00, M: 2.10, ML: 2.20, L: 2.30, XL: 2.40 }
    // é€Ÿåº¦å¸¸é‡ï¼Œææ…¢-0.70ï¼›æ…¢-0.75ï¼›ä¸­ç­‰-0.80ï¼›å¿«-0.90ï¼›æå¿«-1.00
    static SPEEDRATIO = { XS: 0.70, S: 0.75, M: 0.80, L: 0.90, XL: 1.00 }
    // è´¨é‡å¸¸é‡ï¼Œæè½»-0.20ï¼›è½»-0.40ï¼›ä¸­ç­‰-0.60ï¼›é‡-0.80ï¼›æé‡-1.00
    //static WEIGHTRATIO = { XS: 0.20, S: 0.40, M: 0.60, L: 0.80, XL: 1.00 }
    static WEIGHTRATIO = { XS: 0.30, S: 0.45, M: 0.60, L: 0.80, XL: 1.00 }
    // åˆ†èº«åˆå§‹ä½ç½®
    static BODY2POS = { x: -1000, y: -1000 }
    // ç‰¹æ®Šè§’è‰²id
    static SPECIALROLEID = { eggId: -1 }


    // ç¢°æ’åç«‹é©¬æ›´æ–°ï¼Œé¿å…å¤šæ¬¡ç¢°æ’åæ‰æ›´æ–°
    update() {
        this.ax = roundNumber(this.ax, 4);
        this.ay = roundNumber(this.ay, 4);
        this.vx = roundNumber(this.vx, 4);
        this.vy = roundNumber(this.vy, 4);
        this.vx += this.ax;
        this.vy += this.ay;
        this.x += this.vx;
        this.y += this.vy;
        this.vx = roundNumber(this.vx, 4);
        this.vy = roundNumber(this.vy, 4);
        this.x = roundNumber(this.x, 4);
        this.y = roundNumber(this.y, 4);
        this.x0 = roundNumber(this.x0, 4);
        this.y0 = roundNumber(this.y0, 4);
        console.log(">>>> Ball update " + this.getBallDesc() + " x=" + this.x + ", y=" + this.y);
        console.log(">>>> Ball update " + this.getBallDesc() + " x0=" + this.x0 + ", y0=" + this.y0);
        console.log(">>>> Ball update " + this.getBallDesc() + " vx=" + this.vx + ", vy=" + this.vy);
        console.log(">>>> Ball update " + this.getBallDesc() + " collidedCount=" + this.collidedCount);
        console.log(">>>> Ball update " + this.getBallDesc() + " wallCollidedCount=" + this.wallCollidedCount);
        console.log(">>>> Ball update " + this.getBallDesc() + " roleCollidedCount=" + this.roleCollidedCount);
        console.log(">>>> Ball update " + this.getBallDesc() + " collidingNos=" + this.collidingNos);
        if (this.roleId === Role.KUKU.id) console.log(">>>> Ball update " + this.getBallDesc() + " addCount=" + this.addCount);

        if (this.isMainBall && this.roleId === Role.KUILEI.id && this.wallCollidedCount >= 3) { // å‚€å„¡ç¢°ä¸‰æ¬¡åï¼Œç»³å­é€Ÿåº¦åœæ­¢
            if (userConfig.isKuileiPullBack && this.roleCollidedCount > 0 && !isKuileiPulling) { // å‚€å„¡ç»³å­æœ‰æŠ“åˆ°äººï¼Œä¸”å¼€å¯äº†æ‹‰å›å¼€å…³
                doKuileiPullBack(this); // å¤„ç†å‚€å„¡æ‹‰å›
            } else if (!isKuileiPulling) {
                this.vx = 0;
                this.vy = 0;
            }
        }
        if (this.vx === 0 && this.vy === 0) { // è¿åŠ¨åœæ­¢äº†
            this.isMoving = false;
        } else {
            this.isMoving = true;
        }
    }

    // è·å–æ˜¾ç¤ºå­—ç¬¦ä¸²
    getBallDesc() {
        return this.no + "-" + Role.getShortNameById(this.roleId) + "-" + this.roleId + "-" + this.teamColor;
    }

    // è·å–è§’è‰²è¡€é‡æ¡æ˜¾ç¤ºåºå·
    getShowNo() {
        if (userConfig.isTestOnlyOne) return this.no;
        if (this.no > 4) return this.no;
        // ç©å§ç›®å‰ç¡¬æ€§è§„åˆ™ï¼Œè“é˜Ÿç¼–å·ä¸º1ã€2ï¼Œçº¢é˜Ÿä¸º3ã€4
        if (this.teamColor === 'b') {
            if (this.no % 2 === 0) return 2;
            else return 1;
        } else {
            if (this.no % 2 === 0) return 4;
            else return 3;
        }
    }

    // æ˜¯å¦æ”¹å˜äº†ä½ç½®
    isPosChanged() {
        return this.x !== this.x0 || this.y !== this.y0;
    }

    // åˆ¤æ–­æ˜¯å¦ä¸ºåˆ†èº« åˆ¤æ–­åˆ†èº« è§’è‰²åˆ†èº«
    isRoleBuddy() {
        if (userConfig.isTestOnlyOne && !this.isMainBall) return true;
        if (!userConfig.isTestOnlyOne && !this.isMainBall && this.no > 4) return true;

        return false;
    }

    // TODO globalParams ç›®å‰åªæ˜¯å•ä¾‹ï¼Œé¿å…drawæ–¹æ³•ä¸åœåœ°åˆ›å»ºå¯¹è±¡ã€‚js å•çº¿ç¨‹æ‰§è¡Œæ²¡é—®é¢˜ï¼Œå¤šçº¿ç¨‹ä¸è¡Œ
    draw(params) {
        //if (this.x === this.prePoint.x && this.y === this.prePoint.y) return; // ä½ç½®æ²¡åŠ¨ä¸ç”»ã€‚ä¸è¡Œï¼Œç”»å¸ƒè¢«æ¸…ç©ºäº†ï¼Œè¿˜æ˜¯å¾—ç”»
        if (!params) params = GlobalParams.getCleanParams();
        //if (selectedBall && selectedBall.isMainBall && this === selectedBall) console.log(selectedBall.context);
        // å•ç‹¬ç»˜åˆ¶èµ·ç‚¹ä½ç½®
        if (sysConfig.isGameBeginning && this.x === this.x0 && this.y === this.y0) { // è¿™ä¸ªåæ ‡åˆ¤æ–­ä¼šå‡ºç°é‡å¤ç»˜åˆ¶çš„é—®é¢˜ï¼Œå°çƒç§»åŠ¨åï¼Œç»è¿‡åŸå§‹ä½ç½®ï¼Œåˆä¼šå†ç”»
            this.drawBeginPoint();
        }
        //if (this.isMainBall && this.roleId === Role.KUILEI.id && this.isMoving) return; // ä¸ç”»ç»³å­ä¸Šçš„å¨ƒå¨ƒï¼Œå¯ä»¥ç›´æ¥è¿”å›

        // çªç ´ç¢°æ’æ•ˆæœ
        if (this.upgradeEffect > 0) this.drawUpgradeCircle();

        // ç”»è§’è‰²å›¾æ ‡
        if (!params.isBallOnly) this.drawIcon();

        // TODO canvasä¸­ä½¿ç”¨çš„save()æ•°é‡å’Œrestore()çš„æ•°é‡éœ€è¦ä¿æŒä¸€è‡´ï¼Œsaveå¤šä¼šå¯¼è‡´å†…å­˜æ³„æ¼ï¼ŒåŠè¿è¡Œä¸€æ®µæ—¶é—´åå˜å¡é¡¿
        // å°½é‡å°‘æ”¹å˜ Canvas çŠ¶æ€å˜é‡ï¼Œå…¬å…±è®¾ç½®æ”¾åˆ°å¾ªç¯å¤–å±‚ï¼Œå¯ä»¥èŠ‚çœä¸€ç‚¹æ€§èƒ½
        this.context.save();
        this.context.beginPath();
        this.context.globalCompositeOperation = "destination-over"; // æ–°çš„å›¾å±‚åœ¨è€çš„å›¾å±‚ä¸‹é¢ï¼Œä¸ºäº†å®ç°è·¯å¾„æ˜¾ç¤ºåœ¨è§’è‰²ä¸Šæ–¹
        if (params.composite) this.context.globalCompositeOperation = params.composite;
        if (this.isMainBall && this.roleId === Role.KUILEI.id && this.isMoving && !isKuileiPulling) { // ç”»ç»‘åœ¨ç»³å­ä¸Šçš„å¨ƒå¨ƒã€çœŸæ˜¯ä¸ªç»†èŠ‚ç‹‚é­”å•Šã€‘
            // å·²ç»ç”¨å›¾æ ‡ä»£æ›¿äº†
            //this.context.arc(this.x, this.y, this.tryRadius, 0, roundNumber(Math.PI / 180 * 360, 4));
            //this.context.fillStyle = "#415D9C";
        } else {
            this.context.arc(this.x, this.y, this.radiusTmp, 0, roundNumber(Math.PI / 180 * 360, 4));
            this.context.fillStyle = this.color;
        }
        this.context.fill(); // fill å®å¿ƒï¼›stroke ç©ºå¿ƒ
        // æœ‰éœ²éœ²ï¼Œä¸ºåƒµåƒµåŠ ä¸Šç»ç’ƒçƒ
        if (isLuluExist && this.roleId === Role.JIANGJIANG.id && this.id < 0) { // this.id < 0 å…ˆä¸ç”»ç»ç’ƒçƒäº†
            //this.context.globalCompositeOperation = "source-over";
            this.context.arc(this.x, roundNumber(this.y - this.radius / 4, 4), roundNumber(this.radius + 8 * dpr, 4), 0, roundNumber(Math.PI / 180 * 360, 4));
            this.context.fillStyle = "#C0E0F450";
            //this.context.shadowBlur = 10 * dpr; // é¢‘ç¹ç»˜åˆ¶é˜´å½±ä¼šå½±å“æ€§èƒ½
            this.context.fill();
        }
        //this.context.closePath(); // é—­åˆè·¯å¾„
        //this.context.fill();
        this.context.restore();

        // ç”»ä¸»è§’æŒ‡ç¤ºåœˆ
        if (!checkIsMoving() && !params.isBallOnly) this.drawCurrentCircle();
        // ç”»è§’è‰²è¡€é‡æ¡
        if (!params.isBallOnly) this.drawRoleBloodLine();

    }

    // ç»˜åˆ¶è§’è‰²å›¾æ ‡
    drawIcon(params) {
        if (!params) params = GlobalParams.getCleanParams();
        this.context.save();
        this.context.beginPath();
        this.context.globalCompositeOperation = "source-over";
        if (params.composite) this.context.globalCompositeOperation = params.composite;
        this.context.fillStyle = "#EEF0F2";
        // æ°´å¹³å¯¹é½æ–¹å¼ (center left right start end)
        this.context.textAlign = "center";
        // å‚ç›´å¯¹é½çš„æ–¹å¼ (top bottom middle)
        this.context.textBaseline = 'middle';

        let content = Role.getRoleIconById(this.roleId);
        let iconType = 0; // 0-å…¼å®¹å›¾æ ‡ï¼›1-æ–°å›¾æ ‡
        // åŒå­è¿åŠ¨æ—¶ï¼Œä¸¤ä¸ªäººåˆ†å¼€
        if (isTwinSingleIconShow && userConfig.currRole === Role.SHUANGZI.id && this.roleId === Role.SHUANGZI.id && this.isMainBall && !selectedBall && (checkIsMoving() || isTwinBallShowStill())) {
            // æœ¬ä½“
            if (os.isPc || !isTwinLeftIconShow || !isTwinRightIconShow || !iconType) {
                content = 'ğŸ§â€â™‚ï¸';
            } else {
                content = 'ğŸƒ';
            }
        }
        if (params.graph) content = params.graph;
        if (isTwinSingleIconShow && userConfig.currRole === Role.SHUANGZI.id && this.roleId === Role.SHUANGZI.id && !this.isMainBall && this.teamColor === balls[0].teamColor) {
            // åˆ†èº«
            if (os.isPc || !isTwinLeftIconShow || !isTwinRightIconShow || !iconType) {
                content = 'ğŸ§';
            } else {
                content = 'ğŸƒâ€â™‚ï¸â€â¡ï¸';
            }
        }

        // çŒ´å­åˆ†èº«
        if (userConfig.currRole === Role.WUKONG.id && this.roleId === Role.WUKONG.id && !this.isMainBall && this.teamColor === balls[0].teamColor) {
            content = 'ğŸµ';
        }

        if (this.iconSize < 10) {
            let metrics, width, ratio;
            ratio = 1.4;
            if (this.roleId === Role.BAKE.id || this.roleId === Role.GOLDKING.id
                || this.roleId === Role.X.id || this.roleId === Role.DUODUO.id
                || this.roleId === Role.HUAQIANJI.id) ratio = 1.2; // å›¾æ ‡åå¤§ï¼Œæ‰‹åŠ¨è°ƒå°ä¸€ç‚¹

            if (this.roleId === Role.ZHANAN.id) // é‡ç”»å¤šæ¬¡çš„å›¾æ ‡
                ratio = 1.0;

            let fontSize = roundNumber(sysConfig.girdSize * ratio, 4);
            //console.log(">>>> drawIcon" + this.getBallDesc() + " fontSize origin=" + fontSize);

            this.context.font = fontSize + "px Arial";
            metrics = this.context.measureText(content);
            width = roundNumber(metrics.width, 4);

            while (width > this.radiusTmp * ratio) {
                fontSize -= 1;
                this.context.font = fontSize + "px Arial";
                metrics = this.context.measureText(content);
                width = roundNumber(metrics.width, 4);
                if (fontSize < 12) break; // é¿å… width è®¡ç®—å¼‚å¸¸ï¼Œå¯¼è‡´æ­»å¾ªç¯
            }
            while (width < sysConfig.girdSize * 1.0) { // sysConfig.girdSize * 1.2
                fontSize += 1;
                this.context.font = fontSize + "px Arial";
                metrics = this.context.measureText(content);
                width = roundNumber(metrics.width, 4);
                if (fontSize > 100) break; // é¿å… width è®¡ç®—å¼‚å¸¸ï¼Œå¯¼è‡´æ­»å¾ªç¯
            }
            fontSize = roundNumber(fontSize, 4);
            //console.log(">>>> drawIcon" + this.getBallDesc() + " fontSize final=" + fontSize);
            this.iconSize = fontSize;
        }

        this.context.font = this.iconSize + "px Arial";

        // çªç ´æ•ˆæœ
        //if (this.upgradeEffect > 0) this.context.font = (fontSize + 10) + "px Arial";

        if (this.isMainBall && this.roleId === Role.KUILEI.id && this.isMoving) {
            //if (!isKuileiPulling) this.context.fillText(content, this.x0 === 0 ? this.x : this.x0, this.y0 === 0 ? this.y : this.y0); // æœ¬ä½“ä½ç½® éœ€è¦ç”»åœ¨è·¯åŠ²å±‚
            if (!isKuileiPulling) this.context.font = (this.iconSize - 3 * dpr) + "px Arial"; // ç”»å®Œæœ¬ä½“ä¹‹åï¼Œè°ƒæ•´å›¾æ ‡å¤§å°ï¼Œå†ç”»ç»³å­å¨ƒå¨ƒå›¾æ ‡
            this.context.fillText(content, this.x, this.y); // ç»³å­å¨ƒå¨ƒä½ç½®
        } else if (this.roleId === Role.SHUANGZI.id && content === 'ğŸ‘¬') { // åŒå­å›¾æ ‡é‡ç”»
            if (os.isPc || !isTwinLeftIconShow || !isTwinRightIconShow || !iconType) {
                this.context.fillText('ğŸ§', roundNumber(this.x + (0.20 * sysConfig.girdSize), 4), roundNumber(this.y - (0.1 * sysConfig.girdSize), 4));
                this.context.fillText('ğŸ§â€â™‚ï¸', roundNumber(this.x - (0.20 * sysConfig.girdSize), 4), roundNumber(this.y + (0.1 * sysConfig.girdSize), 4));
            } else {
                this.context.fillText('ğŸƒâ€â™‚ï¸â€â¡ï¸', roundNumber(this.x + (0.20 * sysConfig.girdSize), 4), roundNumber(this.y - (0.1 * sysConfig.girdSize), 4));
                this.context.fillText('ğŸƒ', roundNumber(this.x - (0.20 * sysConfig.girdSize), 4), roundNumber(this.y + (0.1 * sysConfig.girdSize), 4));
            }
        } else if (this.roleId === Role.ZHANAN.id) { // å…‰å½± æ‰ç”·
            // å¤šç”»å‡ ä¸ª
            //this.context.fillText(content, roundNumber(this.x - (0.20 * sysConfig.girdSize), 4), roundNumber(this.y - (0.2 * sysConfig.girdSize), 4)); // å·¦ä¸Š
            this.context.fillText(content, this.x, roundNumber(this.y - (0.4 * sysConfig.girdSize), 4)); // ä¸Š
            this.context.fillText(content, this.x, this.y); // ä¸­é—´
            //this.context.fillText(content, roundNumber(this.x + (0.20 * sysConfig.girdSize), 4), roundNumber(this.y + (0.2 * sysConfig.girdSize), 4)); // å³ä¸‹
            this.context.fillText(content, this.x, roundNumber(this.y + (0.4 * sysConfig.girdSize), 4)); // ä¸‹
        } else if (this.roleId === Role.GOLDKING.id) { // é‡‘è§’å¤§ç‹
            this.context.fillStyle = "#ffd700";
            this.context.fillText(content, this.x, this.y);
        }
        else this.context.fillText(content, this.x, this.y);
        this.context.restore();
    }

    // ç»˜åˆ¶çªç ´ç¢°æ’å…‰åœˆæ•ˆæœ
    drawUpgradeCircle(params) {
        //return; // å…ˆä¸ç”»
        //if (!this.isMainBall) return; // éä¸»è§’ä¸ç”»
        if (this.upgradeEffect < 1) return;
        if (!params) params = GlobalParams.getCleanParams();
        this.context.save();
        this.context.beginPath();
        if (params.composite) this.context.globalCompositeOperation = params.composite;
        let grd = this.context.createRadialGradient(this.x, this.y, roundNumber(0.1 * this.radiusTmp, 4), this.x, this.y, roundNumber(this.radiusTmp * 3, 4));
        grd.addColorStop(0.1, "#EEF0F2F0");
        grd.addColorStop(0.3, "#FFFE6150");
        grd.addColorStop(0.6, "#EEF0F280");
        grd.addColorStop(1, "#EEF0F200");
        this.context.arc(this.x, this.y, roundNumber(this.radiusTmp * 2.5, 4), 0, roundNumber(Math.PI * 2, 4), true);
        //this.context.fillStyle = "#EEF0F2"; // è®¾ç½®é¢œè‰²
        this.context.fillStyle = grd; // ä½¿ç”¨æ¸å˜
        this.context.fill();
        this.context.restore();
        // TODO ç”»å®Œåé‡ç½®ï¼Œéœ€è¦ç­‰ç”»å®Œå†é‡ç½®ï¼Œç¡®ä¿è·ç¦»å¾ˆè¿‘ç¢°æ’æ—¶ï¼Œçœ‹ä¸åˆ°ç¢°æ’æ•ˆæœ
        //console.log(">>>> doDianyinSpeed upgradeEffect", this.upgradeEffect);
        //setTimeout(()=>{this.upgradeEffect = 0;}, 20);
        if (this.upgradeEffect > 2) this.upgradeEffect = 0; // è¿™æ ·å¯ä»¥å»¶è¿Ÿé‡ç½®
        if (this.upgradeEffect > 0) this.upgradeEffect += 1;
    }

    // ç»˜åˆ¶å½“å‰ä¸»æ”»è§’è‰²æŒ‡ç¤ºåœˆ
    drawCurrentCircle(params) {
        if (!this.isMainBall) return; // éä¸»è§’ä¸ç”»
        if (userConfig.isTestOnlyOne) return; // å•ä¸ªè§’è‰²æµ‹è¯•æ—¶ä¸ç”»
        if (!params) params = GlobalParams.getCleanParams();
        this.context.save();
        this.context.beginPath();
        if (params.composite) this.context.globalCompositeOperation = params.composite;
        this.context.arc(this.x, this.y, roundNumber(this.radiusTmp + 2 * dpr * sysConfig.pxRatio, 4), 0, roundNumber(Math.PI / 180 * 360, 4));
        this.context.strokeStyle = "#D75956";
        if (this.teamColor === 'b') this.context.strokeStyle = "#0A7AFD";
        this.context.closePath();
        this.context.lineWidth = roundNumber(0.085 * sysConfig.girdSize); // 0.0892
        this.context.stroke();
        this.context.restore();
    }

    // ç»˜åˆ¶ç„å‡†æ—¶è¢«ç¢°æ’è§’è‰²æŒ‡ç¤ºåœˆ
    drawAimCircle(params) {
        if (this.isMainBall) return; // ç„å‡†æ—¶è¢«ç¢°æ’è§’è‰²ä¸ºéä¸»è§’
        if (userConfig.isTestOnlyOne) return; // å•ä¸ªè§’è‰²æµ‹è¯•æ—¶ä¸ç”»
        if (!params) params = GlobalParams.getCleanParams();
        let context = selectedBall.context;
        context.save();
        context.beginPath();
        if (params.composite) context.globalCompositeOperation = params.composite;
        context.arc(this.x, this.y, roundNumber(this.radiusTmp - 1 * dpr * sysConfig.pxRatio, 4), 0, roundNumber(Math.PI / 180 * 360, 4));
        context.strokeStyle = "#D84646";
        if (this.teamColor === 'b') context.strokeStyle = "#2A7CE9";
        context.closePath();
        context.lineWidth = roundNumber(2 * dpr * sysConfig.pxRatio, 4);
        context.stroke();
        context.restore();
    }

    // ç»˜åˆ¶è§’è‰²è¡€é‡æ¡
    drawRoleBloodLine(params) {
        if (!userConfig.isShowRoleBloodLine) return;
        //if (userConfig.isTestOnlyOne) return; // å•ä¸ªè§’è‰²æµ‹è¯•æ—¶ä¸ç”»
        if (!this.x || !this.y || this.x < 0 || this.y < 0 || !isFinite(this.x) || !isFinite(this.y)) return;
        if (this.roleId === Role.WUKONG.id && this.isRoleBuddy()) return; // çŒ´å­åˆ†èº«ä¸ç”»
        if (!params) params = GlobalParams.getCleanParams();
        this.context.save();
        this.context.fillStyle = "#D84646";
        this.context.strokeStyle = "#00000050";
        this.context.lineWidth = roundNumber(0.25 * dpr * sysConfig.pxRatio, 4);
        if (this.teamColor === 'b') this.context.fillStyle = "#2A7CE9";
        // TODO é¢‘ç¹ç»˜åˆ¶é˜´å½±ï¼Œä¼šå½±å“æ€§èƒ½ï¼Œå¯ä»¥æ”¹ç”¨æè¾¹å½¢å¼ï¼Œç”¨sceneè§‚å¯Ÿäº†åŠŸè€—ï¼Œæœ‰é˜´å½±ç¡®å®åŠŸç‡æœ€å¤§å€¼æ›´é«˜
        //this.context.shadowColor = '#00000050'; // è®¾ç½®é˜´å½±
        //this.context.shadowBlur = roundNumber(0.5 * dpr * sysConfig.pxRatio, 4);
        //this.context.globalCompositeOperation = "destination-over";
        if (params.composite) this.context.globalCompositeOperation = params.composite;

        let roleNoWidth = roundNumber(0.6 * sysConfig.girdSize);
        let bloodLineWidth = roundNumber(2.6 * sysConfig.girdSize - roleNoWidth, 4);
        let bloodLineWidth2 = roundNumber(2.3 * sysConfig.girdSize, 4);
        let bloodLineHeight = roundNumber(0.40 * sysConfig.girdSize, 4);
        let borderRadius = 4;

        this.context.font = 10 * sysConfig.pxRatio * dpr + "px Arial";
        this.context.textAlign = "center";
        this.context.textBaseline = 'middle';

        // è§’è‰²æœ¬ä½“åæ ‡ä½ç½®
        let realPos = { x: this.x, y: this.y };
        if (this.isMainBall && this.roleId === Role.KUILEI.id && this.isMoving && !isKuileiPulling) { // å‚€å„¡ç”»åœ¨æœ¬ä½“ä¸Š
            realPos.x = this.x0 === 0 ? this.x : this.x0;
            realPos.y = this.y0 === 0 ? this.y : this.y0;
        }

        // TODO roundRect å…¼å®¹æ€§æœ‰é—®é¢˜ï¼Œè€æœºå‹/è€æµè§ˆå™¨ä¸æ”¯æŒ
        try {
            // åˆ†èº«æ²¡æœ‰è§’è‰²ç¼–å·ï¼Œåªæœ‰æ™®é€šè¡€é‡æ¡
            // æ²¡æœ‰å¼€å¯æ˜¾ç¤ºè§’è‰²ç¼–å·ï¼Œåªæ˜¾ç¤ºæ™®é€šè¡€é‡æ¡
            if (this.isRoleBuddy() || !userConfig.isShowRoleBloodNo) {
                this.context.beginPath();
                this.context.roundRect(roundNumber(realPos.x - bloodLineWidth2 / 2, 4), roundNumber(realPos.y - this.radiusTmp - 0.3 * sysConfig.girdSize - bloodLineHeight, 4), bloodLineWidth2, bloodLineHeight, borderRadius);
                this.context.stroke();
                this.context.fill();
            } else {
                // è¡€é‡æ¡
                this.context.beginPath();
                this.context.roundRect(roundNumber(realPos.x - (bloodLineWidth - roleNoWidth) / 2 - 1 * dpr, 4), roundNumber(realPos.y - this.radiusTmp - 0.3 * sysConfig.girdSize - bloodLineHeight, 4), bloodLineWidth, bloodLineHeight, borderRadius);
                this.context.stroke();
                this.context.fill();
                // è§’è‰²ç¼–å·æ–¹æ¡†
                this.context.beginPath();
                this.context.roundRect(roundNumber(realPos.x - (bloodLineWidth + roleNoWidth) / 2 + 1 * dpr, 4), roundNumber(realPos.y - this.radiusTmp - 0.3 * sysConfig.girdSize - roleNoWidth + (roleNoWidth - bloodLineHeight) / 2, 4), roleNoWidth, roleNoWidth, borderRadius);
                this.context.stroke();
                this.context.fill();
                // è§’è‰²ç¼–å·æ–‡å­—
                this.context.beginPath();
                this.context.fillStyle = "#fff";
                this.context.strokeText(this.getShowNo(), roundNumber(realPos.x - bloodLineWidth / 2 + 1 * dpr, 4), roundNumber(realPos.y - this.radiusTmp - 0.3 * sysConfig.girdSize - roleNoWidth / 2 + (roleNoWidth - bloodLineHeight) / 2, 4));
                this.context.fillText(this.getShowNo(), roundNumber(realPos.x - bloodLineWidth / 2 + 1 * dpr, 4), roundNumber(realPos.y - this.radiusTmp - 0.3 * sysConfig.girdSize - roleNoWidth / 2 + (roleNoWidth - bloodLineHeight) / 2, 4));
                this.context.stroke();
            }
        } catch (e) {
            doGlobalErrorMsg(e, false);
            //doGlobalError(e, (sysConfig && sysConfig.alertErrorCount)?sysConfig.alertErrorCount:3);
            // ä½¿ç”¨åŸå§‹æ–¹æ³•ç»˜åˆ¶åœ†è§’çŸ©å½¢ fillRoundRect(cxt, x, y, width, height, radius, fillColor)
            this.context.beginPath();
            fillRoundRect(this.context, roundNumber(realPos.x - bloodLineWidth2 / 2, 4), roundNumber(realPos.y - this.radiusTmp - 0.3 * sysConfig.girdSize - bloodLineHeight, 4), bloodLineWidth2, bloodLineHeight, borderRadius, this.context.fillStyle);
            this.context.stroke();
            this.context.fill();
        }
        this.context.restore();
    }

    // canvas å›¾å½¢åŠ¨ç”»çš„è‡´å‘½é—®é¢˜å°±æ˜¯æ¯æ¬¡éƒ½è¦å…¨éƒ¨æ¸…é™¤é‡ç”»ï¼å°±å¥½åƒç”¨ç”µé¥­ç…²ç‚’èœï¼Œèƒ½ç‚’ä½†æ˜¯å¾ˆæ— åŠ›ï¼
    // ç»˜åˆ¶è§’è‰²+è¡€é‡æ¡åŒºåŸŸçŸ©å½¢ï¼Œç”¨äºåç»­ã€è„çŸ©å½¢ã€‘ä¼˜åŒ–
    drawBallRect(params) {
        if (!params) params = GlobalParams.getCleanParams();
        this.context.save();
        this.context.beginPath();
        if (params.composite) this.context.globalCompositeOperation = params.composite;
        if (userConfig.isShowRoleBloodLine)
            this.context.strokeRect(this.x - this.radius, this.y - this.radius, this.radius * 2, this.radius * 2);
        else this.context.strokeRect(this.x - this.radius, this.y - this.radius, this.radius * 2, this.radius * 2);
        this.context.strokeStyle = "#000";
        this.context.lineWidth = 1 * dpr;
        this.context.setLineDash([3 * dpr, 3 * dpr]); // è™šçº¿
        this.context.stroke();
        this.context.restore();
    }

    // ç»˜åˆ¶èµ·ç‚¹ä½ç½®
    drawBeginPoint(params) {
        if (!this.isMainBall) return; // éä¸»çƒä¸ç”»
        if (!params) params = GlobalParams.getCleanParams();
        console.log(">>>> drawBeginPoint " + this.getBallDesc());
        // ç”»åœ†å¿ƒç‚¹
        gamePathContext.save();
        gamePathContext.beginPath();
        //gamePathContext.globalCompositeOperation = "xor";
        if (params.composite) gamePathContext.globalCompositeOperation = params.composite;
        gamePathContext.arc(this.x0, this.y0, this.pathRadius, 0, roundNumber(Math.PI / 180 * 360, 4));
        gamePathContext.fillStyle = this.color;
        gamePathContext.closePath();
        gamePathContext.fill();
        gamePathContext.restore();
        // ç”»å¤–éƒ¨å®çº¿åœ†åœˆ
        gamePathContext.save();
        gamePathContext.beginPath();
        //gamePathContext.globalCompositeOperation = "xor";
        gamePathContext.arc(this.x0, this.y0, this.radiusTmp, 0, roundNumber(Math.PI / 180 * 360, 4));
        gamePathContext.lineWidth = roundNumber(1 * dpr * sysConfig.pxRatio, 4);
        gamePathContext.strokeStyle = this.color;
        gamePathContext.fillStyle = this.color;
        gamePathContext.closePath();
        if (this.isMainBall && this.roleId === Role.KUILEI.id) gamePathContext.fill(); // å‚€å„¡æœ¬ä½“ä¸ä¼šåŠ¨
        else gamePathContext.stroke();
        gamePathContext.restore();
        // é‡ç”»è¢«è¦†ç›–çš„è§’è‰²å›¾æ ‡
        this.drawIcon();
        if (this.isMainBall && this.roleId === Role.KUILEI.id) this.drawBeginIcon(); // ç”»å‚€å„¡æœ¬ä½“å›¾æ ‡
    }

    // ç»˜åˆ¶åˆ†èº«èµ·ç‚¹ä½ç½®
    drawBuddyBeginPoint(params) {
        if (!params) params = GlobalParams.getCleanParams();
        console.log(">>>> drawBuddyBeginPoint " + this.getBallDesc());
        let color = params.color;
        if (!color) color = this.color;
        let ctx = params.ctx;
        if (!ctx) ctx = gamePathContext;
        // ç”»åœ†å¿ƒç‚¹
        ctx.save();
        ctx.beginPath();
        //ctx.globalCompositeOperation = "xor";
        if (params.composite) ctx.globalCompositeOperation = params.composite;
        ctx.arc(this.x0, this.y0, this.pathRadius, 0, roundNumber(Math.PI / 180 * 360, 4));
        ctx.fillStyle = color;
        ctx.closePath();
        ctx.fill();
        ctx.restore();
        // ç”»å¤–éƒ¨å®çº¿åœ†åœˆ
        ctx.save();
        ctx.beginPath();
        //ctx.globalCompositeOperation = "xor";
        ctx.arc(this.x0, this.y0, this.radiusTmp, 0, roundNumber(Math.PI / 180 * 360, 4));
        ctx.lineWidth = roundNumber(1 * dpr * sysConfig.pxRatio, 4);
        ctx.strokeStyle = color;
        ctx.fillStyle = color;
        ctx.closePath();
        ctx.stroke();
        ctx.restore();
    }

    // ç»˜åˆ¶èµ·ç‚¹å›¾æ ‡
    drawBeginIcon(params) {
        if (!this.isMainBall) return; // éä¸»çƒä¸ç”»
        console.log(">>>> drawBeginIcon " + this.getBallDesc());
        if (!params) params = GlobalParams.getCleanParams();
        let ctx = params.context;
        if (!ctx) ctx = gamePathContext;
        let content = Role.getRoleIconById(this.roleId);
        if (!content) return;

        ctx.save();
        ctx.beginPath();
        ctx.textAlign = "center";
        ctx.textBaseline = 'middle';
        ctx.font = this.iconSize + "px Arial";
        ctx.fillText(content, this.x, this.y);
        ctx.restore();
    }

    // ç”»è¿çº¿æ’å‡»è½¨è¿¹ã€ç”»åœ¨è·¯å¾„å±‚ã€‘
    drawLinePath(p1, p2) {
        if (!this.isMoving) return; // æ²¡åœ¨è¿åŠ¨ä¸ç”»
        if (!this.isMainBall && this.roleId !== Role.SHUANGZI.id) return; // éä¸»çƒä¸ç”»ï¼ŒåŒå­åˆ†èº«é™¤å¤–
        if (!this.isMainBall && this.roleId === Role.SHUANGZI.id && !userConfig.isTestOnlyOne && this.no > 1 && this.no < 5) return;
        if (!p1 || !p2) return;
        if (isKuileiPulling) return; // å‚€å„¡æ‹‰å›æ—¶ä¸ç”»
        gamePathContext.save();
        gamePathContext.beginPath();
        gamePathContext.globalCompositeOperation = "source-over";
        gamePathContext.moveTo(roundNumber(p1.x, 4), roundNumber(p1.y, 4));
        gamePathContext.lineTo(roundNumber(p2.x, 4), roundNumber(p2.y, 4));
        gamePathContext.strokeStyle = currTheme.plColor;
        if (userConfig.currRole === Role.SHUANGZI.id && !this.isMainBall && this.roleId === Role.SHUANGZI.id)
            gamePathContext.strokeStyle = currTheme.szbplColor; // åŒå­åˆ†èº«è¿åŠ¨è·¯å¾„é¢œè‰²
        if (this.roleId === Role.KUILEI.id)
            gamePathContext.strokeStyle = currTheme.klplColor; // å‚€å„¡è·¯å¾„é¢œè‰²
        gamePathContext.lineWidth = currTheme.plWidth;
        if (this.roleId === Role.KUILEI.id)
            gamePathContext.lineWidth = currTheme.klplWidth;
        gamePathContext.stroke();
        gamePathContext.restore();
    }

    // ç»˜åˆ¶å°çƒæœ¬ä½“è¿åŠ¨è·¯å¾„
    drawBallPath(p1, p2) {
        //if (!userConfig.isShowBallPath) return; // æ–¹ä¾¿ç›´æ¥æ˜¾ç¤ºè·¯å¾„
        if (this.isMainBall && this.roleId === Role.KUILEI.id) return; // å‚€å„¡ä¸ç”»
        if (!this.isMoving) return;
        if (!this.isMainBall && this.roleId !== Role.SHUANGZI.id) return; // éä¸»çƒä¸ç”»ï¼ŒåŒå­åˆ†èº«é™¤å¤–
        if (!this.isMainBall && this.roleId === Role.SHUANGZI.id && !userConfig.isTestOnlyOne && this.no > 1 && this.no < 5) return;
        if (!p1 || !p2) return;
        if (isKuileiPulling) return; // å‚€å„¡æ‹‰å›æ—¶ä¸ç”»
        gamePathBallContext.save();
        gamePathBallContext.beginPath(); // å¼€å§‹ä¸€æ¡è·¯å¾„ï¼Œæˆ–é‡ç½®å½“å‰çš„è·¯å¾„ã€‚
        gamePathBallContext.globalCompositeOperation = "xor"; // æ˜¾ç¤ºæ–°çš„å›¾å±‚å’Œæ—§çš„å›¾å±‚ï¼Œä¸æ˜¾ç¤ºé‡å çš„å›¾å±‚
        //gamePathBallContext.globalCompositeOperation = "destination-over"; // æ–°çš„å›¾å±‚åœ¨è€çš„å›¾å±‚ä¸‹é¢
        gamePathBallContext.moveTo(roundNumber(p1.x, 4), roundNumber(p1.y, 4));
        gamePathBallContext.lineTo(roundNumber(p2.x, 4), roundNumber(p2.y, 4));
        gamePathBallContext.strokeStyle = currTheme.rlColor;
        if (!this.isMainBall && this.roleId === Role.SHUANGZI.id)
            //gamePathBallContext.strokeStyle = currTheme.szbrlColor; // åŒå­åˆ†èº«æœ¬ä½“è·¯å¾„é¢œè‰²
            gamePathBallContext.strokeStyle = currTheme.rlColor; // åŒå­åˆ†èº«æœ¬ä½“è·¯å¾„é¢œè‰²å¯ä»¥è·Ÿæœ¬ä½“ä¸€è‡´
        gamePathBallContext.lineWidth = roundNumber(this.radius * 2, 4);
        //gamePathBallContext.lineCap = "round"; // åœ†è§’
        gamePathBallContext.stroke();
        gamePathBallContext.restore();
        return;
        // èµ·ç‚¹å¡«å……
        if (p1.x === this.x0 && p1.y === this.y0) { // åæ ‡åˆ¤æ–­ä¼šå¯¼è‡´é‡å¤ç»˜åˆ¶
            gamePathBallContext.save();
            gamePathBallContext.beginPath();
            //gamePathBallContext.globalCompositeOperation = "destination-over";
            gamePathBallContext.globalCompositeOperation = "xor";
            gamePathBallContext.arc(p1.x, p1.y, this.radius, 0, roundNumber(Math.PI / 180 * 360, 4));
            gamePathBallContext.fillStyle = "#cfe0d380";
            gamePathBallContext.fill();
            gamePathBallContext.restore();
            // èµ·ç‚¹é‡æ–°ç»˜åˆ¶
            this.drawBeginPoint();
        }
    }

    // ç”»å°åœ†ç‚¹æ’å‡»è½¨è¿¹
    drawPointPath() {
        if (!this.isMainBall) return;
        if (isKuileiPulling) return; // å‚€å„¡æ‹‰å›æ—¶ä¸ç”»
        gamePathContext.save();
        gamePathContext.beginPath();
        gamePathContext.arc(this.x, this.y, this.pathRadius, 0, roundNumber(Math.PI / 180 * 360, 4));
        gamePathContext.fillStyle = "#cfe0d350";
        gamePathContext.closePath();
        gamePathContext.fill();
        gamePathContext.restore();
    }

    // å•ç‹¬ç»˜åˆ¶ç¢°æ’ä½ç½®ï¼Œåœ¨æ£€æŸ¥ç¢°æ’çš„æ—¶å€™è°ƒç”¨ã€ç”»åœ¨è·¯å¾„å±‚ã€‘
    drawCollidedPos() {
        if (!this.isMainBall && this.roleId !== Role.SHUANGZI.id) return; // éä¸»çƒä¸ç”»ï¼ŒåŒå­åˆ†èº«é™¤å¤–
        if (!this.isMainBall && this.roleId === Role.SHUANGZI.id && !userConfig.isTestOnlyOne && this.no > 1 && this.no < 5) return;
        if (this.isMainBall && this.roleId === Role.KUILEI.id) return; // å‚€å„¡ä¸ç”»ç¢°æ’ç‚¹
        if (this.isMainBall && userConfig.isStopAfter2WallCollided && this.wallCollidedCount >= 2) return; // ç¢°æ’ä¸¤æ¬¡åœæ­¢æ—¶ä¸ç”»
        // ç»˜åˆ¶å¤–è™šçº¿
        gamePathContext.save();
        gamePathContext.beginPath();
        gamePathContext.arc(this.x, this.y, this.radius, 0, roundNumber(Math.PI / 180 * 360, 4));
        gamePathContext.lineWidth = currTheme.ccWidth;
        gamePathContext.strokeStyle = currTheme.ccColor;
        if (userConfig.currRole === Role.SHUANGZI.id && !this.isMainBall && this.roleId === Role.SHUANGZI.id)
            gamePathContext.strokeStyle = currTheme.szccColor; // åŒå­åˆ†èº«ç¢°æ’åœˆé¢œè‰²
        gamePathContext.setLineDash([Math.round(3 * dpr * sysConfig.pxRatio), Math.round(3 * dpr * sysConfig.pxRatio)]); // è™šçº¿
        gamePathContext.closePath();
        gamePathContext.stroke(); // ç©ºå¿ƒ
        gamePathContext.restore();
        // ç»˜åˆ¶åœ†å¿ƒï¼Œä¸å¤ªæ˜æ˜¾ï¼Œå¯ä»¥è·Ÿè·¯å¾„é¢œè‰²ä¸€è‡´
        gamePathContext.save();
        gamePathContext.beginPath();
        gamePathContext.arc(this.x, this.y, roundNumber(this.pathRadius / 2, 4), 0, roundNumber(Math.PI / 180 * 360, 4));
        //gamePathContext.fillStyle = this.color;
        gamePathContext.fillStyle = currTheme.plColor;
        gamePathContext.closePath();
        gamePathContext.fill();
        gamePathContext.restore();

        //if (userConfig.isShowBallPath) {
        // ç»˜åˆ¶å°çƒå®ä½“å¡«å……
        gamePathBallContext.save();
        gamePathBallContext.beginPath();
        //gamePathBallContext.globalCompositeOperation = "destination-over"; // åœ¨ä¸‹æ–¹
        gamePathBallContext.globalCompositeOperation = "xor"; // æ˜¾ç¤ºæ–°çš„å›¾å±‚å’Œæ—§çš„å›¾å±‚ï¼Œä¸æ˜¾ç¤ºé‡å çš„å›¾å±‚
        gamePathBallContext.arc(this.x, this.y, this.radius, 0, roundNumber(Math.PI / 180 * 360, 4));
        //gamePathBallContext.fillStyle = this.color;
        //gamePathBallContext.fillStyle = "#cfe0d385";
        gamePathBallContext.fillStyle = currTheme.plColor;
        gamePathBallContext.closePath();
        gamePathBallContext.fill();
        gamePathBallContext.restore();
        //}
    }
}


// å°†æ‰€æœ‰å°çƒé€Ÿåº¦ç½®é›¶
function stopAllBalls(balls) {
    balls.some(ball => {
        ball.vx = 0;
        ball.vy = 0;
        ball.update();
    });
}


// å°çƒæ˜¯å¦éœ€è¦é‡ç»˜å’Œæ›´æ–°
function isBallDrawAndUpdate(ball, caseNo) {
    // æ¸¸æˆæ²¡å¼€å§‹ï¼Œè‚¯å®šè¦ç”»çš„
    if (!sysConfig.isGameBeginning) return true;

    // ä¸»è§’åœ¨æ‹–åŠ¨å’Œç„å‡†æ—¶ï¼Œæ‰€æœ‰éä¸»è§’ä¸ç”»
    if (caseNo === 2 && isMouseMoving && selectedBall && selectedBall.isMainBall) return false;
    // éä¸»è§’åœ¨æ‹–åŠ¨å’Œç„å‡†æ—¶ï¼Œä¸»è§’ä¹Ÿä¸ç”»
    //if (caseNo === 1 && isMouseMoving && !selectedBall.isMainBall) return false;

    // åƒµå°¸ã€å¹½çµä¸èƒ½æ”¹å˜å…¶ä»–è§’è‰²ä½ç½®ï¼›å‚€å„¡ä¸æ‹‰å›æ—¶ï¼Œä¹Ÿä¸èƒ½æ”¹å˜å…¶ä»–è§’è‰²ä½ç½®
    if (caseNo === 2 && (userConfig.currRole === Role.JIANGJIANG.id || userConfig.currRole === Role.YLPAPA.id
        || (userConfig.currRole === Role.KUILEI.id && !isKuileiPulling))) {
        return checkAnyBallPosChanged(caseNo);
    }

    // åŒå­ä¸ºä¸»è§’æ—¶ï¼Œæœ¬ä½“å’Œåˆ†èº«æ§åˆ¶
    if (userConfig.currRole === Role.SHUANGZI.id && ball && ball.roleId === Role.SHUANGZI.id && ball.teamColor === balls[0].teamColor) { // åŒå­åˆ†èº«è¦åŒæ—¶è¿åŠ¨
        // åŒå­æœ¬ä½“
        if (ball.isMainBall) {

        } else { // åŒå­åˆ†èº«
            return (checkAnyBallPosChanged(caseNo) || checkAnyBallCollided(caseNo)) && !selectedBall;
        }
    }

    // çŒ´å­åŠåˆ†èº«
    if (userConfig.currRole === Role.WUKONG.id && ball && ball.roleId === Role.WUKONG.id && ball.teamColor === balls[0].teamColor) {
        // æœ¬ä½“
        if (ball.isMainBall) {

        } else { // åˆ†èº«
            return !selectedBall;
        }
    }

    return checkAnyBallPosChanged(caseNo) || checkAnyBallCollided(caseNo);
}


// æ£€æµ‹ä»»æ„ä¸€ä¸ªå°çƒæ˜¯å¦æ”¹å˜äº†ä½ç½®
function checkAnyBallPosChanged(caseNo) {
    let result = false;
    if (!caseNo) caseNo = 0;

    // TODO æ³¨æ„ï¼ï¼balls å˜é‡åœ¨å®šä¹‰å‰ä½¿ç”¨ï¼Œéœ€è¦ä½¿ç”¨ var å®šä¹‰æ‰è¡Œï¼Œlet å®šä¹‰ä¹‹å‰ä¼šæŠ¥ undefined
    if (!balls || balls.length < 1) return result;

    let isCheckMain;
    switch (caseNo) {
        case 1: // åªæ£€æµ‹ä¸»çƒ
            return balls[0].isPosChanged();
        case 2: // åªæ£€æµ‹éä¸»çƒ
            isCheckMain = false;
            break;
        default: // æ£€æµ‹æ‰€æœ‰
            isCheckMain = true;
    }

    for (let i = 0, len = balls.length; i < len; i++) {
        if (!isCheckMain && balls[i].isMainBall) continue;
        result = result || balls[i].isPosChanged();
        if (result) break;
    }

    return result;
}


// æ£€æµ‹ä»»æ„ä¸€ä¸ªå°çƒæ˜¯å¦æœ‰ç¢°æ’
function checkAnyBallCollided(caseNo) {
    let result = false;
    if (!caseNo) caseNo = 0;

    if (!balls || balls.length < 1) return result;

    let isCheckMain;
    switch (caseNo) {
        case 1: // åªæ£€æµ‹ä¸»çƒ
            return balls[0].collidedCount > 0;
        case 2: // åªæ£€æµ‹éä¸»çƒ
            isCheckMain = false;
            break;
        default: // æ£€æµ‹æ‰€æœ‰
            isCheckMain = true;
    }

    for (let i = 0, len = balls.length; i < len; i++) {
        if (!isCheckMain && balls[i].isMainBall) continue;
        result = result || balls[i].collidedCount > 0;
        if (result) break;
    }

    return result;
}


// æ£€æµ‹æ˜¯å¦ä¸ºåˆ†èº«åˆå§‹ä½ç½®
function isRoleHideBody(ball) {
    if (!ball || ball.isMainBall) return false;
    //return !(isNumber(ball.x) && isNumber(ball.y) && ball.x0 !== Ball.BODY2POS.x && ball.y0 !== Ball.BODY2POS.y);
    return ball.x0 === Ball.BODY2POS.x && ball.y0 === Ball.BODY2POS.y;
}


// é‡ç½®è§’è‰²å­—æ®µå±æ€§å€¼
function resetRoleField(roles) {
    if (!roles) roles = balls;
    if (!roles || roles.length < 1) return;
    for (let i = 0, len = roles.length; i < len; i++) {
        if (!roles[i]) continue;
        // é‡ç½®é…·é…·åŠ é€Ÿæ¬¡æ•°
        if (roles[i].roleId === Role.KUKU.id && roles[i].addCount) roles[i].addCount = 0;
        // é‡ç½®æ‰€æœ‰è§’è‰²ç¢°æ’æ¬¡æ•°
        if (roles[i].collidedCount) roles[i].collidedCount = 0;
        if (roles[i].wallCollidedCount) roles[i].wallCollidedCount = 0;
        if (roles[i].roleCollidedCount) roles[i].roleCollidedCount = 0;
    }
    // é‡ç½®ç¢°æ’æ ‡å¿—ä½
    setBallCollidingNos(roles);
}


// å¤‡ä»½æˆ–è¿˜åŸåŸå§‹åæ ‡
function setBallsPosBack(isBack) {
    if (!balls || balls.length < 1) return;
    for (let i = 0, len = balls.length; i < len; i++) {
        //if (balls[i].isMainBall) continue;
        if (isBack) {
            balls[i].x0 = balls[i].x;
            balls[i].y0 = balls[i].y;
        } else {
            if (balls[i].x0 > 0 && balls[i].y0 > 0) {
                balls[i].x = balls[i].x0;
                balls[i].y = balls[i].y0;
            }
            balls[i].x0 = 0;
            balls[i].y0 = 0;
        }
    }
}


// åˆå§‹åŒ–å„ä¸ªå°çƒçš„ç¢°æ’æ ‡å¿—ä½
function setBallCollidingNos(roles) {
    if (!roles) roles = balls;
    if (!roles || roles.length < 1) return;
    let len = roles.length;
    if (buddies && buddies.length > 0 && roles !== buddies) len += buddies.length;
    roles.forEach(b => {
        //b.collidingNos = new Array(len).fill(false);  // é¢‘ç¹åˆ›å»ºæ•°ç»„å¯¹è±¡ï¼Œä¼šå¢åŠ  GC æ—¶é—´
        for (let i = 0; i < len; i++) {
            b.collidingNos[i] = false; // TODO b.collidingNos å­˜åœ¨æ‰©å¤§åæ²¡æœ‰æ­£å¸¸ç¼©å°çš„é—®é¢˜
        }
    });
    if (!buddies || buddies.length < 1 || roles === buddies) return;
    buddies.forEach(b => {
        for (let i = 0; i < len; i++) {
            b.collidingNos[i] = false;
        }
    });
}


// åŒå­åŠŸèƒ½
function doTwins(ball) {
    preTwins(ball);
}


// åˆå§‹åŒ–åŒå­åˆ†èº«
function preTwins(ball) {
    //let twinBall = balls[balls.length - 1];
    // ä½ç½®ä¸æœ¬ä½“ä¸€æ ·
    twinBall.x = ball.x;
    twinBall.y = ball.y;
    twinBall.x0 = 0;
    twinBall.y0 = 0;
    // é€Ÿåº¦ä¸æœ¬ä½“ç›¸åï¼Œåˆ†èº«å°±ç¨å¾®åè·‘äº†ä¸€ç‚¹ï¼Œè·ç¦»æ¯”æœ¬ä½“å°‘ï¼Œæ‰‹åŠ¨åŠ ä¸€ç‚¹é€Ÿåº¦
    twinBall.v = ball.v; // checkFriction() æ–¹æ³•éœ€è¦ç”¨äºè®¡ç®—æ‘©æ“¦åŠ›
    twinBall.vx = -ball.vx * 1.0275;
    twinBall.vy = -ball.vy * 1.0275;
    //console.log(">>>> twinBall:", twinBall);
}


// åŒå­æ‰“å®Œåï¼Œåˆ†èº«æ¶ˆå¤±
function afterTwins(isShow) {
    if (userConfig.currRole !== Role.SHUANGZI.id) return;
    //console.log(">>>> afterTwins isShow=" + isShow);
    //let twinBall = balls[balls.length - 1];
    /*
    // ç§»é™¤åˆ†èº«
    let b = balls.pop();
    if (b.roleId === Role.SHUANGZI.id && b.no !== ball.no) {
        // ç¬¦åˆæ¡ä»¶ï¼Œç§»é™¤
    } else {
        balls.push(b); // ä¸ç¬¦åˆæ¡ä»¶ï¼Œæ”¾å›å»
    }
    */
    // ç§»å‡ºç”»å¸ƒä¹‹å¤–å³å¯
    if (!isShow) {
        twinBall.x = Ball.BODY2POS.x;
        twinBall.y = Ball.BODY2POS.y;
        twinBall.x0 = Ball.BODY2POS.x;
        twinBall.y0 = Ball.BODY2POS.y;
    }
    twinBall.vx = 0;
    twinBall.vy = 0;
}


// åŒå­åˆ†èº«æ˜¯å¦è¿˜åœ¨æ˜¾ç¤º
function isTwinBallShowStill() {
    if (!balls || balls.length < 1) return false;
    for (let i = 0, len = balls.length; i < len; i++) {
        if (!balls[i]) continue;
        if (balls[i].isMainBall) continue;
        if (!balls[i].roleId) continue;
        if (balls[i].roleId !== Role.SHUANGZI.id) continue;
        if (balls[i].teamColor !== balls[0].teamColor) continue;
        if (isNumber(balls[i].x) && isNumber(balls[i].y) && balls[i].x > 0 && balls[i].y > 0) return true;
    }
    return false;
}


// æ ¡æ­£è¢«æ‰“å‡ºåœºåœ°ä¹‹å¤–çš„è§’è‰²åæ ‡
// æ³¨æ„ï¼è§’è‰²åˆ†èº«ç­‰ç‰¹æ®Šè§’è‰²ï¼Œå¯èƒ½å°±æ˜¯éœ€è¦è®¾ç½®åœºåœ°å¤–åæ ‡ï¼Œä»¥è¾¾åˆ°å¼€å±€éšè—çš„ç›®çš„
// ã€æ‰“å®Œä¹‹åè°ƒç”¨ã€‘ï¼Œé¿å…åœ¨ onMouseMove è¿™ç§ç›‘å¬ç±»å¤§é‡æ‰§è¡Œçš„æ–¹æ³•ä¸­è°ƒç”¨ï¼Œå‡å°‘æ€§èƒ½å¼€é”€
function adjustBallsPos() {
    if (!balls || balls.length < 1) return;
    let ball;
    for (let i = 0, len = balls.length; i < len; i++) {
        ball = balls[i];
        // åŒå­åˆ†èº«æ’é™¤
        if (!ball.isMainBall && ball.roleId === Role.SHUANGZI.id) continue;
        // å°äº0ï¼›å¤§äºåœºåœ°å®½é«˜ï¼›åœ¨åˆ‡è§’åŒºåŸŸå†…
        if ((ball.x < 0 || ball.y < 0 || !isNumber(ball.x) || !isNumber(ball.y))
            || (ball.x > canvas.width || ball.y > canvas.height)
            //|| isInAngleArea(ball) > -1) {
        ) {
            // é‡æ–°éšæœºä½ç½®
            putBallRandom(ball);
        }
    }
}


// æ¨å¼€é åœ¨ä¸€èµ·çš„è§’è‰²ï¼Œé¿å…ä¸¤è§’è‰²è´´ç€ç¢°æ’ç©¿é€é—®é¢˜
// æ‹–åŠ¨æ”¹å˜ä½ç½®åè°ƒç”¨
function pushCollidedBalls() {
    if (!balls || balls.length < 1) return;
    let ball;
    for (let i = 0, len = balls.length; i < len; i++) {
        ball = balls[i];
        // åŒå­åˆ†èº«æ’é™¤
        if (!ball.isMainBall && ball.roleId === Role.SHUANGZI.id) continue;
        // å°äº0ï¼›å¤§äºåœºåœ°å®½é«˜ï¼›åœ¨åˆ‡è§’åŒºåŸŸå†…
        if ((ball.x < 0 || ball.y < 0 || !isNumber(ball.x) || !isNumber(ball.y))
            || (ball.x > canvas.width || ball.y > canvas.height)
            //|| isInAngleArea(ball) > -1) {
        ) {
            // é‡æ–°éšæœºä½ç½®
            putBallRandom(ball);
        }
    }
}


// è·å–ä¸€ä¸ªçƒå‘å¦ä¸€ä¸ªçƒçš„é€Ÿåº¦
function getPullBackSpeed() {
    if (!balls || balls.length < 1) return;
    let mainBall = balls[0];
    let ball, vxy;
    for (let i = 0, len = balls.length; i < len; i++) {
        if (i === 0) continue;
        ball = balls[i];
        if (ball.roleCollidedCount < 1) continue;
        vxy = getVxVy({ x: mainBall.x, y: mainBall.y }, { x: ball.x, y: ball.y }, null, mainBall);
        if (!vxy) continue;
        ball.vx = vxy.vx;
        ball.vy = vxy.vy;
        //console.log(">>>> getPullBackSpeed " + ball.getBallDesc() + "-vx=" + ball.vx + ", vy=" + ball.vy);
    }
    // å‚€å„¡æ‹‰å›æ—¶ï¼Œè‡ªèº«æ²¡æœ‰é€Ÿåº¦
    if (mainBall.isMainBall && mainBall.roleId === Role.KUILEI.id) {
        mainBall.vx = 0;
        mainBall.vy = 0;
    }
}


// æ˜¯å¦ä¸ºå¯ç©¿é€è§’è‰²ï¼Œåƒµå°¸ã€å‚€å„¡ã€æ¸¸ä¾ ã€å‰‘å£«ç­‰
// ç”¨äºåˆ¤æ–­æ˜¯å¦æ˜¾ç¤ºç„å‡†è·¯å¾„
function isRoleCanPierces() {
    return userConfig.isShowTryFullPath
        && (userConfig.currRole === Role.JIANGJIANG.id || userConfig.currRole === Role.KUILEI.id
            || userConfig.currRole === Role.HEIWA.id || userConfig.currRole === Role.DUODUO.id
            || userConfig.currRole === Role.YLPAPA.id);
}


// ç”¨äºåˆ¤æ–­æ˜¯å¦åœ¨ç„å‡†çš„æ—¶å€™ç©¿é€ä¸€æ¬¡
function isTryCanPierces() {
    return userConfig.isPiercesTry
        && (userConfig.currRole === Role.JIANGJIANG.id || userConfig.currRole === Role.KUILEI.id
            || userConfig.currRole === Role.YLPAPA.id);
}


//////////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////////
// ã€Lineåˆ‡è§’çº¿ç›¸å…³ã€‘ å˜é‡ã€æ–¹æ³•åŒºåŸŸ
//////////////////////////////////////////////////////////////////////

// å››æ ¹åˆ‡è§’çº¿å¯¹è±¡
class Line {
    constructor(context, options = {}) {
        this.context = context;
        this.x1 = options.x1 || 0;
        this.y1 = options.y1 || 0;
        this.x2 = options.x2 || 0;
        this.y2 = options.y2 || 0;
        this.lineWidth = options.lineWidth || 1.0;
        this.color = options.color || '#453678';
        // æ—‹è½¬è§’åº¦ï¼ŒMath.atan2() è¿”å›ä»åŸç‚¹ (0,0) åˆ° (x,y) ç‚¹çš„çº¿æ®µä¸ x è½´æ­£æ–¹å‘ä¹‹é—´çš„å¹³é¢è§’åº¦ (å¼§åº¦å€¼)ï¼Œä¹Ÿå°±æ˜¯ Math.atan2(y,x)
        this.rotation = Math.atan2(this.y2 - this.y1, this.x2 - this.x1);
    }

    draw() {
        this.context.save();
        this.context.lineWidth = this.lineWidth;
        this.context.strokeStyle = this.color;
        this.context.beginPath();
        this.context.moveTo(this.x1, this.y1);
        this.context.lineTo(this.x2, this.y2);
        this.context.closePath();
        this.context.stroke();
        this.context.restore();
    }

    getBounds() {
        let minX = Math.min(this.x1, this.x2);
        let minY = Math.min(this.y1, this.y2);
        let maxX = Math.max(this.x1, this.x2);
        let maxY = Math.max(this.y1, this.y2);
        return {
            x: minX,
            y: minY,
            width: maxX - minX,
            height: maxY - minY
        }
    };
}

//////////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////////
// ã€Roleè§’è‰²ç›¸å…³ã€‘ å˜é‡ã€æ–¹æ³•åŒºåŸŸ
//////////////////////////////////////////////////////////////////////

// è§’è‰²ç±»
class Role {

    constructor(id, icon, fullName, shortName, oneName, cps) {
        this.id = id;
        this.icon = icon;
        this.fullName = fullName;
        this.shortName = shortName;
        this.oneName = oneName;
        this.cps = cps; // å¸¸ç”¨æ­é…
    }

    /*
    æ·»åŠ è§’è‰²è¦ä¿®æ”¹çš„åœ°æ–¹
    1.Role ç±»è§’è‰²å®šä¹‰
    2.initRoleCps è®¾ç½®å¸¸ç”¨æ­é…
    3.initBallByRole é…ç½®è§’è‰²å±æ€§
    */

    //static HEIWA = {id:0, icon:"ğŸ¼", fullName:"åœ£å©´å¤§ç‹", shortName:"é»‘å¨ƒ", oneName:"å¨ƒ", cps:null};
    static HEIWA = new Role(0, "ğŸ‘¶ğŸ½", "åœ£å©´å¤§ç‹", "é»‘å¨ƒ", "å¨ƒ", null);
    static JIANGJIANG = new Role(1, "ğŸ§Ÿâ€â™‚", "æ³¢æ¯”åƒµåƒµ", "åƒµå°¸", "åƒµ", null);
    static DUODUO = new Role(2, "ğŸ¥š", "é£é“ƒæœµæœµ", "æœµæœµ", "æœµ", null);
    static KUILEI = new Role(3, "ğŸ¦Š", "å‚€å„¡å¨ƒå¨ƒ", "å‚€å„¡", "å‚€", null);
    static BAKE = new Role(4, "8g", "ç«ç„°å·´å…‹", "å·´å…‹", "å·´", null); // ğŸ§â€â™‚ï¸ å¤©ç¥é™ä¸´çš®è‚¤ã€å°½å¯èƒ½ä¸ç”¨æ°ªé‡‘çš®è‚¤å›¾æ ‡ã€‘
    static LULU = new Role(5, "ğŸ°", "ç”œå¿ƒéœ²éœ²", "éœ²éœ²", "éœ²", null);
    static KUKU = new Role(6, "ğŸ˜", "ç–¾é€Ÿé…·é…·", "é…·é…·", "é…·", null);
    static YINGYING = new Role(7, "â„", "å†°é›ªè¹è¹", "è¹è¹", "è¹", null);
    static JIUWEIHU = new Role(8, "ğŸ¦Š", "ç‹å°¾çº±", "ç‹å°¾", "çº±", null);
    static SHUANGZI = new Role(9, "ğŸ‘¬", "æ€ªç›—åŒå­", "åŒå­", "åŒ", null);
    static X = new Role(10, "x", "è‡ªå®šè§’è‰²", "è‡ªå®š", "x", null); // è‡ªå®šä¹‰è§’è‰²
    static YOUXIA = new Role(11, "ğŸ¹", "æš—å¤œæ¸¸ä¾ ", "æ¸¸ä¾ ", "ç®­", null);
    static CHUZI = new Role(12, "ğŸ—", "å°é£Ÿç¥", "å¨å­", "å¨", null);
    static HUAQIANJI = new Role(13, "ğŸš€", "èŠ±åƒæœº", "ç‚®å¼¹", "æœº", null);
    static WUGEGE = new Role(14, "ğŸŒ¿", "å·«æ ¼æ ¼", "æ ¼æ ¼", "æ ¼", null);
    static JOKER = new Role(15, "ğŸ¤¡", "å‘½è¿å°ä¸‘", "å°ä¸‘", "ä¸‘", null);
    static RABBIT = new Role(16, "ğŸ‡", "æ³¢æ–¯å…¬ä¸»", "å…”å­", "å…”", null);
    static NURSE = new Role(17, "ğŸ’‰", "å§¬å¤©ä½¿", "å¥¶å¦ˆ", "å¥¶", null);
    static CAPTAIN = new Role(18, "ğŸš¢", "èµ¤ç¿èˆ¹é•¿", "èˆ¹é•¿", "èˆ¹", null);
    static LELE = new Role(19, "ğŸ¥™", "å¤ªå¹³ä¹", "ä¹ä¹", "ä¹", null);
    static MANWANG = new Role(20, "ğŸ’", "è›®ç‹", "è›®ç‹", "è›®", null);
    static LINGLING = new Role(21, "ğŸ””", "æ³¢æ¯”çµçµ", "çµçµ", "çµ", null);
    static HUOWANG = new Role(22, "ğŸ”¥", "çƒˆç„°ç‹å­", "ç«ç‹", "ç«", null);
    static LEIMENG = new Role(23, "ğŸ–", "é›·å¾·è’™çš„", "é›·è’™", "çŒª", null);
    static DIANYIN = new Role(24, "ğŸµ", "ç”µéŸ³å°‘å¥³", "ç”µéŸ³", "éŸ³", null);
    static XIXUEGUI = new Role(25, "ğŸ¦‡", "å¾·å¤å¨œ", "å¸è¡€", "å¨œ", null);
    static GUISHUSHI = new Role(26, "ğŸŒ¸", "è¯¡æœ¯å¸ˆ", "è¯¡æœ¯", "è¯¡", null);
    static MAGICLION = new Role(27, "ğŸ¦", "é­”æ³•ç‹®", "ç‹®å­", "ç‹®", null);
    static LANGZAI = new Role(28, "ğŸº", "ç‹¼å´½", "ç‹¼å´½", "ç‹¼", null);
    static BZGIRL = new Role(29, "ğŸ‘§", "æš´èµ°å¥³å­©", "å¥³å­©", "æš´", null);
    static PUMPKIN = new Role(30, "ğŸƒ", "å—ç“œä¼¯çˆµ", "å—ç“œ", "å—", null);
    static QUANBA = new Role(31, "ğŸ¥Š", "æ‹³éœ¸", "æ‹³éœ¸", "æ‹³", null);
    static HONGZHAJI = new Role(32, "ğŸ”", "è½°ç‚¸é¸¡", "ç‚¸é¸¡", "é¸¡", null);
    static SANTAIZI = new Role(33, "ğŸ‰", "ä¸‰å¤ªå­", "é¾™ä¸‰", "é¾™", null);
    static ZHADANKE = new Role(34, "ğŸ’£", "ç‚¸å¼¹å®¢", "ç‚¸å¼¹", "å®¢", null);
    static HONGSANSAN = new Role(35, "ğŸ„", "çº¢ä¼ä¼", "è˜‘è‡", "è˜‘", null);
    static WUKONG = new Role(36, "ğŸ’", "æ‚Ÿç©º", "çŒ´å­", "çŒ´", null);
    static ZHANAN = new Role(37, "ğŸ—¡ï¸", "å…‰å½±æˆ˜å£«", "æ‰ç”·", "æ‰", null);
    static XIUNV = new Role(38, "ğŸ‘±â€â™€ï¸", "æˆ˜æ–—ä¿®å¥³", "ä¿®å¥³", "ä¿®", null);
    static TONY = new Role(39, "ğŸ’‡â€â™‚ï¸", "æ‰˜å°¼è€å¸ˆ", "æ‰˜å°¼", "æ‰˜", null);
    static RENZHE = new Role(40, "ğŸ¯", "æå°å¿", "å¿è€…", "å¿", null);
    static NUANYANG = new Role(41, "ğŸ", "æš–ç¾Šå·å·", "è‚¥ç¾Š", "ç¾Š", null);
    static QIANGWEI = new Role(42, "ğŸ‘©â€ğŸ¦½", "è”·è–‡å°‘å¥³", "èè", "è”·", null);
    static LANLAN = new Role(43, "ğŸ¤º", "å‰‘å§¬å²šå²š", "å²šå²š", "å²š", null);
    static KAIER = new Role(44, "ğŸ”¨", "åœ£é”¤å‡¯å°”", "å‡¯å°”", "é”¤", null);
    static SHITOUREN = new Role(45, "â›°ï¸", "å²­å—å·¨äºº", "çŸ³å¤´", "çŸ³", null);
    static TIEMIAN = new Role(46, "ğŸ¦", "é“é¢éª‘å£«", "é¾™è™¾", "è™¾", null);
    static MIAOJIANG = new Role(47, "ğŸˆ", "å–µæ³•å¸ˆ", "å–µé…±", "å–µ", null);
    static MUSHI = new Role(48, "â›ª", "åœ£å…‰ç‰§å¸ˆ", "ç‰§å¸ˆ", "ç‰§", null);
    static WUNV = new Role(49, "ğŸ•¯", "åœ£çµå·«å¥³", "å·«å¥³", "å·«", null);
    static LIANGLIANG = new Role(50, "ğŸ§œâ€â™€ï¸", "é“é“é±¼", "é±¼å¥³", "é“", null);
    static LAILAI = new Role(51, "ğŸ§œâ€â™‚ï¸", "ç™ç™é±¼", "é±¼ç”·", "ç™", null);
    static ZHANGYUGE = new Role(52, "ğŸ™", "ç« é±¼å…ˆç”Ÿ", "ç« é±¼", "ç« ", null);
    static HUABANTU = new Role(53, "ğŸ›¹", "æ½®ç©æ˜æ˜Ÿ", "æ»‘æ¿", "å…”", null);
    static NIUXIAOMANG = new Role(54, "ğŸ®", "ç‰›å°è½", "å°ç‰›", "ç‰›", null);
    static LANPANG = new Role(55, "ğŸŒ", "è“èƒ–", "è“èƒ–", "è“", null);
    static JIANSHI = new Role(56, "ğŸ—¡", "æµæµªå‰‘å£«", "å‰‘å£«", "å‰‘", null);
    static JUNDUN = new Role(57, "ğŸ›¡", "å†›å›¢ä¹‹ç›¾", "å†›ç›¾", "ç›¾", null);
    static YOUFANG = new Role(58, "ğŸŒ©ï¸", "æ¸¸æ–¹æœ¯å£«", "é›·ç”µ", "ç”µ", null);
    static MOUSE = new Role(59, "ğŸ­", "çº½æ‰£éª‘å£«", "è€é¼ ", "é¼ ", null);
    static YEREN = new Role(60, "ğŸ§”", "çµåŸŸè¨æ»¡", "é‡äºº", "é‡", null);
    static BAIGUJING = new Role(61, "ğŸ§â€â™€ï¸", "ç™½éª¨å¤«äºº", "ç™½éª¨", "éª¨", null);
    static TUYA = new Role(62, "ğŸ‘¨â€ğŸ¨", "æ¶‚é¸¦æˆ˜å£«", "æ¶‚é¸¦", "æ¶‚", null);
    static YLPAPA = new Role(63, "ğŸ‘»", "å¹½çµå¸•å¸•", "å¹½çµ", "å¹½", null);
    static YURRONG = new Role(64, "ğŸ£", "ç¾½ç»’ç»’", "é¸¡ä»”", "ç»’", null);
    static LINGOU = new Role(65, "ğŸ¦¸â€â™€ï¸", "èŒå¿ƒçµå¶", "çµå¶", "å¶", null);
    static GOLDKING = new Role(66, "é‡‘", "é‡‘è§’å¤§ç‹", "é‡‘è§’", "é‡‘", null);
    static DUDU = new Role(67, "ğŸ•ï¸", "å˜Ÿå˜Ÿä¸Šæ ¡", "å˜Ÿå˜Ÿ", "å˜Ÿ", null);
    static GEJI = new Role(68, "ğŸ‘©â€ğŸ¤", "ç™¾å˜æ­Œå§¬", "æ­Œå§¬", "æ­Œ", null);
    static YUANSU = new Role(69, "ğŸ§™â€â™€", "å…ƒç´ å¸ˆ", "å…ƒç´ ", "å…ƒ", null);
    static TANGSENG = new Role(70, "ğŸ§‘ğŸ¼â€ğŸ¦²", "é‡‘è‰å­", "å”åƒ§", "ç¦…", null);


    // è§’è‰²ç±»å‹åˆ†ç±»ï¼šè¶…è‚‰ã€è‚‰ã€æ€ã€è‚‰æ€ã€ä¹±ç¢°ã€è¢«ä¹±ç¢°ã€é™·é˜±ã€æ ‡è®°ã€è‡ªåŠ¨æ‰“(æ¯’ç´ ã€å–·ç«ç­‰æŠ€èƒ½)ã€å›è¡€ã€å¤æ´»/ååˆ€ã€åŠ é€Ÿã€å‡é€Ÿã€åŠ æŠ¤ç›¾ã€åŠ ä¼¤å®³ã€å‡ä¼¤å®³ã€åå¼¹ä¼¤å®³
    // è‚‰ï¼Œè¡€é‡åœ¨æœ€é«˜è¡€é‡(638) * 80% ä»¥ä¸Šï¼Œæˆ–å¸¦å›è¡€ï¼Œå‡å®š 638 * 0.8 -> 510+ï¼›è¶…è‚‰ï¼Œ90%+ 638 * 0.8 -> 570+ æˆ–å¸¦å›è¡€
    static BLOOD540 = [Role.NURSE.id, Role.CHUZI.id, Role.HONGZHAJI.id, Role.JIUWEIHU.id, Role.BAKE.id, Role.KUKU.id, Role.JUNDUN.id, Role.YINGYING.id,
    Role.HUAQIANJI.id, Role.MANWANG.id, Role.BAIGUJING.id, Role.CAPTAIN.id, Role.NUANYANG.id, Role.QIANGWEI.id, Role.JOKER.id,];
    static BLOOD500 = [Role.MOUSE.id, Role.LIANGLIANG.id, Role.SHITOUREN.id, Role.MAGICLION.id, Role.PUMPKIN.id, Role.BZGIRL.id, Role.KUILEI.id,
    Role.LANPANG.id, Role.YEREN.id, Role.SANTAIZI.id, Role.WUNV.id, Role.LULU.id, Role.XIUNV.id,
    ];

    // è¶…æ€ï¼Œå•å›åˆæœ¬ä½“ä¼¤å®³+æŠ€èƒ½ä¼¤å®³ 180+
    static SUPER_KILLER = [Role.DIANYIN.id, Role.ZHANAN.id, Role.HONGZHAJI.id, Role.HEIWA.id, Role.BZGIRL.id, Role.JIANGJIANG.id,
    Role.LINGLING.id, Role.KUILEI.id, Role.TIEMIAN.id, Role.YLPAPA.id,];
    // æ€ï¼Œå•å›åˆæœ¬ä½“ä¼¤å®³+æŠ€èƒ½ä¼¤å®³ 90+
    static KILLER = [Role.RABBIT.id, Role.RENZHE.id, Role.SHITOUREN.id, Role.MAGICLION.id, Role.KAIER.id, Role.QUANBA.id, Role.YINGYING.id,
    Role.HUABANTU.id, Role.CAPTAIN.id, Role.XIXUEGUI.id, Role.SHUANGZI.id, Role.LANLAN.id, Role.LANGZAI.id, Role.LEIMENG.id, Role.SANTAIZI.id,
    Role.WUGEGE.id, Role.NUANYANG.id, Role.QIANGWEI.id, Role.LINGOU.id,
    ];

    // è‚‰æ€ï¼Œè¡€é‡(ç®—å›è¡€)åœ¨ 500+ï¼Œå•å›åˆèƒ½ç¨³å®šæ‰“å‡ºä¼¤å®³ 140+ è®¡ç®—è¶…è‚‰+è‚‰é›†åˆä¸è¶…æ€+æ€é›†åˆçš„äº¤é›†
    static BLOOOD_KILLER = arrayIntersect(arrayUnionSet(this.BLOOD540, this.BLOOD500), arrayUnionSet(this.SUPER_KILLER, this.KILLER));

    // ä¹±ç¢°
    static CHAOS_MAKER = [Role.DIANYIN.id, Role.BZGIRL.id, Role.SHUANGZI.id, Role.KUILEI.id, Role.LANPANG.id, Role.LELE.id, Role.WUGEGE.id,
    Role.WUKONG.id, Role.HEIWA.id, Role.HUABANTU.id, Role.KUKU.id, Role.YURRONG.id,
    ];
    // è¢«ä¹±ç¢°
    static CHAOS_CONSUMER = [Role.RABBIT.id, Role.DIANYIN.id, Role.ZHANAN.id, Role.RENZHE.id, Role.YOUXIA.id, Role.JOKER.id, Role.NUANYANG.id,
    Role.TUYA.id, Role.YINGYING.id, Role.HEIWA.id, Role.CAPTAIN.id, Role.XIXUEGUI.id, Role.WUNV.id, Role.ZHADANKE.id,
    ];
    // å…‹åˆ¶ä¹±ç¢°
    static CHAOS_BLOCKS = [Role.PUMPKIN.id, Role.HONGZHAJI.id, Role.ZHANAN.id, Role.RENZHE.id, Role.BAIGUJING.id, Role.GUISHUSHI.id, Role.HUOWANG.id,
    Role.HONGSANSAN.id, Role.ZHADANKE.id, Role.HUAQIANJI.id, Role.YEREN.id, Role.TUYA.id,
    ];

    // é™·é˜±
    static TRAP_MAKER = [Role.BAIGUJING.id, Role.GUISHUSHI.id, Role.HUOWANG.id, Role.YEREN.id, Role.JOKER.id, Role.HONGSANSAN.id, Role.ZHADANKE.id,
    Role.TUYA.id, Role.TONY.id,
    ];

    // è‡ªèº«æ ‡è®°
    static MARK_MAKER_SELF = [Role.BAIGUJING.id, Role.CAPTAIN.id, Role.LANLAN.id,
    Role.LANGZAI.id, Role.HUOWANG.id, Role.MIAOJIANG.id, Role.WUNV.id, Role.YOUFANG.id, Role.XIUNV.id, Role.YLPAPA.id,
    ];
    // æœ¬é˜Ÿæ ‡è®°
    static MARK_MAKER = [Role.YINGYING.id, Role.HUAQIANJI.id, Role.JUNDUN.id,];

    // è‡ªåŠ¨æ‰“(æ¯’ç´ ã€å–·ç«ç­‰æŠ€èƒ½)
    static AUTO_ATTACK = [Role.RABBIT.id, Role.LIANGLIANG.id, Role.LAILAI.id, Role.SHITOUREN.id, Role.MAGICLION.id, Role.DUODUO.id,
    Role.MIAOJIANG.id, Role.SANTAIZI.id,
    ];

    // è‡ªèº«å›è¡€
    static BLOOD_BACK_SELF = [Role.CHUZI.id, Role.CAPTAIN.id, Role.XIXUEGUI.id, Role.NUANYANG.id,];
    // æœ¬é˜Ÿå›è¡€ï¼ˆè¦ä¹ˆåªç»™é˜Ÿå‹åŠ ã€è¦ä¹ˆæœ¬é˜Ÿéƒ½åŠ ï¼‰
    static BLOOD_BACK = [Role.ZHANAN.id, Role.NURSE.id, Role.GUISHUSHI.id, Role.JIUWEIHU.id,];

    // å¤æ´»/ååˆ€
    static REBIRTH = [Role.BAKE.id, Role.MUSHI.id,];

    // åŠ é€Ÿè¾…åŠ©
    static FAST_MAKER = [Role.KUKU.id, Role.LULU.id,];
    // ç»™å¯¹æ‰‹å‡é€Ÿ
    static SLOW_MAKER = [Role.HONGSANSAN.id, Role.ZHADANKE.id, Role.MANWANG.id,];

    // è‡ªèº«åŠ æŠ¤ç›¾
    static SHIELD_MAKER_SELF = [];
    // æœ¬é˜ŸåŠ æŠ¤ç›¾ï¼ˆè¦ä¹ˆåªç»™é˜Ÿå‹åŠ ã€è¦ä¹ˆæœ¬é˜Ÿéƒ½åŠ ï¼‰
    static SHIELD_MAKER = [Role.JUNDUN.id, Role.LEIMENG.id, Role.LULU.id, Role.YINGYING.id,];

    // è‡ªèº«æ”»å‡»åŠ›åŠ æˆ
    static ADD_ATTACK_SELF = [Role.KAIER.id, Role.NIUXIAOMANG.id, Role.QUANBA.id, Role.HEIWA.id, Role.BZGIRL.id, Role.JIANGJIANG.id, Role.YLPAPA.id, Role.LINGLING.id,
    Role.SHUANGZI.id, Role.HUAQIANJI.id, Role.LANLAN.id, Role.LEIMENG.id, Role.MUSHI.id, Role.TUYA.id, Role.TONY.id, Role.WUGEGE.id, Role.ZHANGYUGE.id,
    ];
    // æœ¬é˜Ÿæ”»å‡»åŠ›åŠ æˆï¼ˆè¦ä¹ˆåªç»™é˜Ÿå‹åŠ ã€è¦ä¹ˆæœ¬é˜Ÿéƒ½åŠ ï¼‰
    static ADD_ATTACK = [Role.MANWANG.id, Role.TUYA.id, Role.TONY.id, Role.WUGEGE.id, Role.XIUNV.id,];

    // å‡å¯¹æ‰‹ä¼¤å®³
    static SUB_ATTACK = [Role.LELE.id, Role.TUYA.id,];

    // åå¼¹ä¼¤å®³
    static TRANS_ATTACK = [Role.BAKE.id, Role.NUANYANG.id, Role.HONGSANSAN.id, Role.ZHADANKE.id,];


    static maxRoleId = -1;

    static getRoleById(id) {
        for (let item in Role) {
            if (!Role[item] || Role[item].id === undefined || Role[item].id < 0) continue;
            if (Role[item].id === id) return Role[item];
        }
        return null;
    }

    static getFullNameById(id) {
        for (let item in Role) {
            if (!Role[item] || Role[item].id === undefined || Role[item].id < 0) continue;
            //console.log(item + ".id = " + Role[item].id);
            //console.log(item + ".fullName = " + Role[item].fullName);
            if (Role[item].id === id) return Role[item].fullName;
        }
        return "";
    }

    static getIdByFullName(fName) {
        for (let item in Role) {
            if (!Role[item] || Role[item].fullName === undefined || Role[item].id < 0) continue;
            if (Role[item].fullName === fName) return Role[item].id;
        }
        return -1;
    }

    static getFullNameByKeyWord(kw) {
        if (!kw) return "";
        for (let item in Role) {
            if (!Role[item] || !Role[item].fullName || !Role[item].shortName) continue;
            if (Role[item].fullName.includes(kw) || Role[item].shortName.includes(kw)) return Role[item].fullName;
        }
        return "";
    }

    static getIdsByFullNames(fNames) {
        let ids = [];
        for (let i in fNames) {
            //console.log(">>>> Role.getIdsByFullNames fName=" + fNames[i]);
            //console.log(">>>> Role.getIdsByFullNames fName is string=" + (typeof fNames[i] === "string"));
            for (let item in Role) {
                if (!Role[item] || Role[item].fullName === undefined || Role[item].id < 0) continue;
                if (Role[item].fullName === fNames[i]) ids.push(Role[item].id);
            }
        }
        return ids;
    }

    static getFullNamesByIds(ids) {
        let fNames = [];
        for (let i in ids) {
            //console.log(">>>> Role.getFullNamesByIds id=" + ids[i]);
            //console.log(">>>> Role.getFullNamesByIds id is number=" + (typeof ids[i] === "number"));
            for (let item in Role) {
                if (!Role[item] || Role[item].id === undefined || Role[item].id < 0) continue;
                if (Role[item].id === Number(ids[i])) fNames.push(Role[item].fullName);
            }
        }
        //console.log(">>>> Role.getFullNamesByIds fNames=" + fNames);
        return fNames;
    }

    static getShortNameById(id) {
        for (let item in Role) {
            if (!Role[item] || Role[item].id === undefined || Role[item].id < 0) continue;
            if (Role[item].id === id) return Role[item].shortName;
        }
        return "";
    }

    static getRoleIconById(id) {
        for (let item in Role) {
            if (!Role[item] || Role[item].id === undefined || Role[item].id < 0) continue;
            if (Role[item].id === id) return Role[item].icon;
        }
        return "";
    }

    static getRoleArray() {
        let roleArr = [];
        for (let item in Role) {
            if (!Role[item] || Role[item].id === undefined || Role[item].id < 0) continue;
            if (Role[item].id > -1 && Role[item].id != 10) roleArr.push(item);
        }
        return roleArr;
    }

    static getRandomRoleId() {
        if (this.maxRoleId >= 0) return fullCloseInt(0, this.maxRoleId);
        for (let item in Role) {
            if (!Role[item] || Role[item].id === undefined || Role[item].id < 0) continue;
            //console.log(">>>> maxRoleId=" + this.maxRoleId);
            if (Role[item].id > this.maxRoleId) this.maxRoleId = Role[item].id;
        }
        return fullCloseInt(0, this.maxRoleId);
    }

    // åˆå§‹åŒ–åˆé€‚æ­é…ï¼Œæœ€åˆé€‚æ­é… + å…¶ä»–åˆé€‚æ­é…
    static initRoleCps() {
        /*
        // TODO åˆ†ç±»æ‹¼æ¥æ²¡æœ‰è‡ªå®šä¹‰æ•°ç»„é‚£ä¹ˆè‡ªç”±ï¼æ€»ä¼šå‡ºç°ä¸åˆé€‚å´åœ¨é‡Œé¢ï¼Œåˆé€‚çš„åˆä¸åœ¨çš„éº»çƒ¦ï¼å¤§é‡æ‹¼æ¥è¿˜ä¼šæ¶ˆè€—æ›´å¤šæ€§èƒ½å’Œå†…å­˜
        // ä¹±ç¢°+æœ¬é˜Ÿå›è¡€+è¶…è‚‰+è‚‰æ€+æœ¬é˜Ÿæ”»å‡»åŠ æˆ+æœ¬é˜ŸåŠ æŠ¤ç›¾-å»é‡-å»æœ¬èº«
        this.HEIWA.cps = arrayMinus(arrayUnique(this.CHAOS_MAKER.concat(this.BLOOD_BACK).concat(this.BLOOD540).concat(this.BLOOOD_KILLER).concat(this.ADD_ATTACK).concat(this.SHIELD_MAKER).concat(this.REBIRTH)), [Role.HEIWA.id, Role.DIANYIN.id]);
        // åŠ é€Ÿè¾…åŠ©+å¯¹æ‰‹å‡é€Ÿ+æœ¬é˜Ÿå›è¡€+æœ¬é˜Ÿæ ‡è®°+è¶…è‚‰+è‚‰æ€+æœ¬é˜Ÿæ”»å‡»åŠ æˆ+æœ¬é˜ŸåŠ æŠ¤ç›¾+å¤æ´»-å»é‡-å»æœ¬èº«
        this.JIANGJIANG.cps = arrayMinus(arrayUnique(this.FAST_MAKER.concat(this.SLOW_MAKER).concat(this.BLOOD_BACK).concat(this.MARK_MAKER).concat(this.BLOOD540).concat(this.BLOOOD_KILLER).concat(this.ADD_ATTACK).concat(this.SHIELD_MAKER).concat(this.REBIRTH)), [Role.JIANGJIANG.id]);
        // è¶…è‚‰+æœ¬é˜Ÿå›è¡€+å¤æ´»-å»é‡-å»æœ¬èº«
        this.DUODUO.cps = arrayMinus(arrayUnique(this.BLOOD540.concat(this.BLOOD_BACK).concat(this.REBIRTH)), [Role.DUODUO.id, Role.KUKU.id, Role.YINGYING.id, Role.MANWANG.id, Role.BAIGUJING.id]);
        // è¢«ä¹±ç¢°-å»é‡-å»æœ¬èº«
        this.KUILEI.cps = arrayMinus(arrayUnique(this.CHAOS_CONSUMER), [Role.KUILEI.id]);
        // è‡ªåŠ¨æ‰“+è¶…æ€-å»é‡-å»æœ¬èº«
        this.BAKE.cps = arrayMinus(arrayUnique([Role.XIUNV.id].concat(this.SUPER_KILLER).concat(this.AUTO_ATTACK)), [Role.BAKE.id]);
        */
        this.HEIWA.cps = [Role.KUKU.id, Role.LELE.id, Role.LULU.id, Role.JIUWEIHU.id, Role.NURSE.id, Role.CHUZI.id, Role.TONY.id, Role.SHUANGZI.id, Role.WUGEGE.id, Role.WUKONG.id, Role.HUABANTU.id, Role.LANPANG.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id];
        this.JIANGJIANG.cps = [Role.KUKU.id, Role.LULU.id, Role.JIUWEIHU.id, Role.NURSE.id, Role.CHUZI.id, Role.MANWANG.id, Role.HUAQIANJI.id, Role.BAKE.id, Role.YINGYING.id, Role.WUGEGE.id, Role.ZHADANKE.id, Role.HONGSANSAN.id, Role.XIXUEGUI.id, Role.SANTAIZI.id];
        this.DUODUO.cps = [Role.HUAQIANJI.id, Role.BAKE.id, Role.CHUZI.id, Role.JOKER.id, Role.NURSE.id, Role.JIUWEIHU.id, Role.HONGZHAJI.id, Role.MIAOJIANG.id, Role.MUSHI.id];
        this.KUILEI.cps = [Role.YINGYING.id, Role.JOKER.id, Role.LINGLING.id, Role.RABBIT.id, Role.DIANYIN.id, Role.YOUXIA.id, Role.ZHANAN.id, Role.XIXUEGUI.id, Role.ZHADANKE.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.BAKE.cps = [Role.DUODUO.id, Role.LINGLING.id, Role.RABBIT.id, Role.WUGEGE.id, Role.DIANYIN.id, Role.XIUNV.id, Role.JIANGJIANG.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id];
        this.LULU.cps = [Role.JIANGJIANG.id, Role.HEIWA.id, Role.TIEMIAN.id, Role.CAPTAIN.id, Role.SANTAIZI.id];
        this.KUKU.cps = [Role.HEIWA.id, Role.JIANGJIANG.id, Role.RABBIT.id, Role.DIANYIN.id, Role.HUOWANG.id, Role.TIEMIAN.id, Role.ZHANAN.id];
        this.YINGYING.cps = [Role.LELE.id, Role.CAPTAIN.id, Role.KUILEI.id, Role.SHUANGZI.id, Role.WUGEGE.id, Role.LEIMENG.id, Role.JIANGJIANG.id, Role.BZGIRL.id, Role.SANTAIZI.id];
        this.JIUWEIHU.cps = [Role.JIANGJIANG.id, Role.HEIWA.id, Role.ZHANAN.id, Role.DUODUO.id, Role.NURSE.id, Role.CHUZI.id, Role.HONGZHAJI.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id];
        this.SHUANGZI.cps = [Role.JOKER.id, Role.RABBIT.id, Role.YOUXIA.id, Role.HEIWA.id, Role.YINGYING.id, Role.HUOWANG.id, Role.DIANYIN.id, Role.LINGLING.id, Role.LANGZAI.id, Role.ZHANAN.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.ZHADANKE.id, Role.SANTAIZI.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.X.cps = [Role.JOKER.id, Role.WUGEGE.id, Role.RABBIT.id, Role.SHUANGZI.id, Role.KUILEI.id, Role.LELE.id, Role.LEIMENG.id, Role.YINGYING.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id, Role.BAIGUJING.id]; // è‡ªå®šä¹‰è§’è‰²
        this.YOUXIA.cps = [Role.SHUANGZI.id, Role.ZHANAN.id, Role.LELE.id, Role.KUILEI.id, Role.WUGEGE.id, Role.WUKONG.id, Role.HUABANTU.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id];
        this.CHUZI.cps = [Role.HEIWA.id, Role.DIANYIN.id, Role.DUODUO.id, Role.NURSE.id, Role.JIUWEIHU.id, Role.MAGICLION.id, Role.YINGYING.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id];
        this.HUAQIANJI.cps = [Role.DUODUO.id, Role.JIANGJIANG.id, Role.NURSE.id, Role.JIUWEIHU.id, Role.RABBIT.id, Role.DIANYIN.id, Role.PUMPKIN.id, Role.HUOWANG.id, Role.QUANBA.id, Role.MUSHI.id];
        this.WUGEGE.cps = [Role.JOKER.id, Role.HEIWA.id, Role.LINGLING.id, Role.YOUXIA.id, Role.YINGYING.id, Role.JIANGJIANG.id, Role.ZHANAN.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.JOKER.cps = [Role.WUGEGE.id, Role.RABBIT.id, Role.SHUANGZI.id, Role.KUILEI.id, Role.LELE.id, Role.DIANYIN.id, Role.YINGYING.id, Role.LINGLING.id, Role.DUODUO.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.ZHADANKE.id, Role.XIUNV.id, Role.SANTAIZI.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.RABBIT.cps = [Role.LELE.id, Role.JOKER.id, Role.BAKE.id, Role.KUILEI.id, Role.WUKONG.id, Role.SHUANGZI.id, Role.KUKU.id, Role.MAGICLION.id, Role.HUABANTU.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id];
        this.NURSE.cps = [Role.HEIWA.id, Role.JIANGJIANG.id, Role.HUAQIANJI.id, Role.KAIER.id, Role.TIEMIAN.id, Role.DUODUO.id, Role.CHUZI.id, Role.JIUWEIHU.id, Role.LEIMENG.id, Role.BZGIRL.id];
        this.CAPTAIN.cps = [Role.YINGYING.id, Role.CHUZI.id, Role.SHUANGZI.id, Role.LELE.id, Role.KUILEI.id, Role.LULU.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id];
        this.LELE.cps = [Role.HEIWA.id, Role.RABBIT.id, Role.JOKER.id, Role.DIANYIN.id, Role.ZHANAN.id, Role.YINGYING.id, Role.CAPTAIN.id, Role.HUOWANG.id, Role.YOUXIA.id, Role.LANGZAI.id, Role.LINGLING.id, Role.TIEMIAN.id, Role.ZHADANKE.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.MANWANG.cps = [Role.RABBIT.id, Role.HEIWA.id, Role.JIANGJIANG.id, Role.LELE.id, Role.DIANYIN.id];
        this.LINGLING.cps = [Role.BAKE.id, Role.JOKER.id, Role.YINGYING.id, Role.KUILEI.id, Role.CHUZI.id, Role.WUGEGE.id, Role.LEIMENG.id, Role.LANLAN.id, Role.JIUWEIHU.id, Role.GUISHUSHI.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.HUOWANG.cps = [Role.LELE.id, Role.SHUANGZI.id, Role.JOKER.id, Role.GUISHUSHI.id, Role.YINGYING.id, Role.KUKU.id, Role.MAGICLION.id, Role.PUMPKIN.id, Role.HUABANTU.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.LEIMENG.cps = [Role.HEIWA.id, Role.JOKER.id, Role.DIANYIN.id, Role.YINGYING.id, Role.JIUWEIHU.id, Role.RABBIT.id, Role.HUOWANG.id, Role.GUISHUSHI.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.DIANYIN.cps = [Role.LELE.id, Role.SHUANGZI.id, Role.KUILEI.id, Role.JOKER.id, Role.CHUZI.id, Role.QUANBA.id, Role.MAGICLION.id, Role.KUKU.id, Role.LEIMENG.id, Role.HUABANTU.id, Role.BZGIRL.id, Role.SANTAIZI.id];
        this.XIXUEGUI.cps = [Role.CHUZI.id, Role.JOKER.id, Role.BAKE.id, Role.LELE.id, Role.KUILEI.id, Role.SHUANGZI.id, Role.YINGYING.id, Role.HUABANTU.id, Role.JIANGJIANG.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id];
        this.GUISHUSHI.cps = [Role.LELE.id, Role.SHUANGZI.id, Role.JOKER.id, Role.HUOWANG.id, Role.YINGYING.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.MAGICLION.cps = [Role.CHUZI.id, Role.SHITOUREN.id, Role.PUMPKIN.id, Role.DIANYIN.id, Role.JOKER.id, Role.BAKE.id, Role.RABBIT.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id];
        this.LANGZAI.cps = [Role.CHUZI.id, Role.JOKER.id, Role.BAKE.id, Role.YINGYING.id, Role.KUILEI.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.BZGIRL.cps = [Role.ZHANAN.id, Role.CHUZI.id, Role.JOKER.id, Role.BAKE.id, Role.YINGYING.id, Role.KUILEI.id, Role.SHUANGZI.id, Role.LELE.id, Role.DIANYIN.id, Role.RABBIT.id, Role.LANGZAI.id, Role.WUGEGE.id, Role.PUMPKIN.id, Role.LEIMENG.id, Role.SANTAIZI.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.PUMPKIN.cps = [Role.HUAQIANJI.id, Role.MAGICLION.id, Role.QUANBA.id, Role.GUISHUSHI.id, Role.HUOWANG.id, Role.LELE.id, Role.SHUANGZI.id, Role.RABBIT.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.QUANBA.cps = [Role.HUAQIANJI.id, Role.CHUZI.id, Role.PUMPKIN.id, Role.WUGEGE.id, Role.LELE.id, Role.SHUANGZI.id, Role.HUOWANG.id, Role.DIANYIN.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.HONGZHAJI.cps = [Role.JIUWEIHU.id, Role.HUAQIANJI.id, Role.DUODUO.id, Role.WUGEGE.id, Role.RABBIT.id, Role.YOUXIA.id, Role.CHUZI.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.SANTAIZI.cps = [Role.JOKER.id, Role.DIANYIN.id, Role.ZHANAN.id, Role.LELE.id, Role.WUGEGE.id, Role.RABBIT.id, Role.YOUXIA.id, Role.CHUZI.id, Role.HUOWANG.id, Role.GUISHUSHI.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.ZHADANKE.cps = [Role.HONGSANSAN.id, Role.YINGYING.id, Role.JIANGJIANG.id, Role.LELE.id, Role.WUGEGE.id, Role.SHUANGZI.id, Role.HUOWANG.id, Role.GUISHUSHI.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id];
        this.HONGSANSAN.cps = [Role.ZHADANKE.id, Role.PUMPKIN.id, Role.JIANGJIANG.id, Role.HUOWANG.id, Role.GUISHUSHI.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id];
        this.WUKONG.cps = [Role.DIANYIN.id, Role.RABBIT.id, Role.HEIWA.id, Role.XIUNV.id, Role.PUMPKIN.id, Role.ZHANAN.id, Role.HUOWANG.id, Role.GUISHUSHI.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.ZHANAN.cps = [Role.YOUXIA.id, Role.WUGEGE.id, Role.SHUANGZI.id, Role.WUKONG.id, Role.JIUWEIHU.id, Role.ZHANGYUGE.id, Role.HUABANTU.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.XIUNV.cps = [Role.BAKE.id, Role.WUKONG.id, Role.PUMPKIN.id, Role.WUGEGE.id, Role.HUOWANG.id, Role.GUISHUSHI.id, Role.ZHANGYUGE.id, Role.HUABANTU.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.TONY.cps = [Role.HEIWA.id, Role.WUKONG.id, Role.LELE.id, Role.SHUANGZI.id, Role.WUGEGE.id, Role.HUOWANG.id, Role.GUISHUSHI.id, Role.KUKU.id, Role.JIANGJIANG.id, Role.HUABANTU.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id];
        this.RENZHE.cps = [Role.JOKER.id, Role.WUKONG.id, Role.LELE.id, Role.SHUANGZI.id, Role.HUABANTU.id, Role.PUMPKIN.id, Role.WUGEGE.id, Role.YOUXIA.id, Role.KUKU.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id];
        this.NUANYANG.cps = [Role.JOKER.id, Role.YINGYING.id, Role.QIANGWEI.id, Role.CHUZI.id, Role.WUKONG.id, Role.PUMPKIN.id, Role.WUGEGE.id, Role.YOUXIA.id, Role.HUABANTU.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id];
        this.QIANGWEI.cps = [Role.JOKER.id, Role.YINGYING.id, Role.NUANYANG.id, Role.CHUZI.id, Role.WUKONG.id, Role.PUMPKIN.id, Role.WUGEGE.id, Role.YOUXIA.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id];
        this.LANLAN.cps = [Role.JOKER.id, Role.YINGYING.id, Role.LINGLING.id, Role.NUANYANG.id, Role.QIANGWEI.id, Role.CHUZI.id, Role.WUKONG.id, Role.PUMPKIN.id, Role.WUGEGE.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.KAIER.cps = [Role.NURSE.id, Role.JIUWEIHU.id, Role.JOKER.id, Role.QUANBA.id, Role.NUANYANG.id, Role.QIANGWEI.id, Role.CHUZI.id, Role.WUKONG.id, Role.PUMPKIN.id, Role.WUGEGE.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.SHITOUREN.cps = [Role.MAGICLION.id, Role.XIUNV.id, Role.MIAOJIANG.id, Role.NUANYANG.id, Role.QIANGWEI.id, Role.CHUZI.id, Role.PUMPKIN.id, Role.WUGEGE.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.TIEMIAN.cps = [Role.LULU.id, Role.NURSE.id, Role.JIUWEIHU.id, Role.LELE.id, Role.SHUANGZI.id, Role.CHUZI.id, Role.WUKONG.id, Role.PUMPKIN.id, Role.WUGEGE.id, Role.KUKU.id, Role.HUABANTU.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id];
        this.MIAOJIANG.cps = [Role.MAGICLION.id, Role.SHITOUREN.id, Role.NURSE.id, Role.JIUWEIHU.id, Role.DUODUO.id, Role.SHUANGZI.id, Role.CHUZI.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id];
        this.MUSHI.cps = [Role.KAIER.id, Role.QUANBA.id, Role.HUAQIANJI.id, Role.LELE.id, Role.SHUANGZI.id, Role.CHUZI.id, Role.PUMPKIN.id, Role.DIANYIN.id, Role.RABBIT.id, Role.HONGZHAJI.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.WUNV.cps = [Role.YINGYING.id, Role.CAPTAIN.id, Role.LELE.id, Role.SHUANGZI.id, Role.CHUZI.id, Role.WUKONG.id, Role.PUMPKIN.id, Role.JIANGJIANG.id, Role.HUOWANG.id, Role.GUISHUSHI.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.LIANGLIANG.cps = [Role.LAILAI.id, Role.MAGICLION.id, Role.BAKE.id, Role.NUANYANG.id, Role.QIANGWEI.id, Role.CAPTAIN.id, Role.CHUZI.id, Role.LEIMENG.id, Role.BZGIRL.id];
        this.LAILAI.cps = [Role.LIANGLIANG.id, Role.MAGICLION.id, Role.BAKE.id, Role.NUANYANG.id, Role.QIANGWEI.id, Role.CAPTAIN.id, Role.CHUZI.id, Role.LEIMENG.id, Role.BZGIRL.id];
        this.ZHANGYUGE.cps = [Role.HUOWANG.id, Role.GUISHUSHI.id, Role.DIANYIN.id, Role.RABBIT.id, Role.NUANYANG.id, Role.QIANGWEI.id, Role.CAPTAIN.id, Role.YINGYING.id, Role.PUMPKIN.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.HUABANTU.cps = [Role.HUOWANG.id, Role.GUISHUSHI.id, Role.HEIWA.id, Role.DIANYIN.id, Role.RABBIT.id, Role.NUANYANG.id, Role.QIANGWEI.id, Role.CAPTAIN.id, Role.YINGYING.id, Role.LINGLING.id, Role.PUMPKIN.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.NIUXIAOMANG.cps = [Role.HUOWANG.id, Role.GUISHUSHI.id, Role.JOKER.id, Role.DIANYIN.id, Role.RABBIT.id, Role.NUANYANG.id, Role.QIANGWEI.id, Role.CAPTAIN.id, Role.YINGYING.id, Role.LINGLING.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.LANPANG.cps = [Role.HUOWANG.id, Role.GUISHUSHI.id, Role.PUMPKIN.id, Role.HEIWA.id, Role.DIANYIN.id, Role.RABBIT.id, Role.XIXUEGUI.id, Role.NUANYANG.id, Role.QIANGWEI.id, Role.CAPTAIN.id, Role.YINGYING.id, Role.LINGLING.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.JIANSHI.cps = [Role.HUOWANG.id, Role.GUISHUSHI.id, Role.NUANYANG.id, Role.QIANGWEI.id, Role.CAPTAIN.id, Role.JIUWEIHU.id, Role.NURSE.id, Role.CHUZI.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id];
        this.JUNDUN.cps = [Role.DIANYIN.id, Role.RABBIT.id, Role.HEIWA.id, Role.ZHANAN.id, Role.JIANGJIANG.id, Role.NUANYANG.id, Role.QIANGWEI.id, Role.CAPTAIN.id, Role.LANLAN.id, Role.LINGLING.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id];
        this.YOUFANG.cps = [Role.JOKER.id, Role.HUOWANG.id, Role.NUANYANG.id, Role.QIANGWEI.id, Role.CAPTAIN.id, Role.CHUZI.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id];
        this.MOUSE.cps = [Role.DIANYIN.id, Role.RABBIT.id, Role.WUGEGE.id, Role.HUOWANG.id, Role.GUISHUSHI.id, Role.JIANGJIANG.id, Role.NUANYANG.id, Role.CAPTAIN.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id];
        this.YEREN.cps = [Role.DIANYIN.id, Role.RABBIT.id, Role.WUGEGE.id, Role.WUKONG.id, Role.LANPANG.id, Role.HUOWANG.id, Role.GUISHUSHI.id, Role.PUMPKIN.id, Role.LELE.id, Role.SHUANGZI.id, Role.HUABANTU.id, Role.LANPANG.id, Role.MAGICLION.id, Role.JIANGJIANG.id, Role.NUANYANG.id, Role.CAPTAIN.id, Role.XIUNV.id, Role.ZHADANKE.id, Role.HONGSANSAN.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id];
        this.BAIGUJING.cps = [Role.WUGEGE.id, Role.WUKONG.id, Role.LANPANG.id, Role.HUOWANG.id, Role.GUISHUSHI.id, Role.PUMPKIN.id, Role.LELE.id, Role.SHUANGZI.id, Role.KUILEI.id, Role.HUABANTU.id, Role.NIUXIAOMANG.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id];
        this.TUYA.cps = [Role.JIUWEIHU.id, Role.NURSE.id, Role.ZHANAN.id, Role.WUGEGE.id, Role.WUKONG.id, Role.LANPANG.id, Role.HUOWANG.id, Role.GUISHUSHI.id, Role.PUMPKIN.id, Role.LELE.id, Role.SHUANGZI.id, Role.KUILEI.id, Role.HUABANTU.id, Role.NIUXIAOMANG.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id];
        this.YLPAPA.cps = [Role.MANWANG.id, Role.KUKU.id, Role.LULU.id, Role.HUAQIANJI.id, Role.MUSHI.id, Role.DUODUO.id, Role.JIANGJIANG.id, Role.JIANSHI.id, Role.WUGEGE.id, Role.PUMPKIN.id, Role.CAPTAIN.id, Role.ZHADANKE.id];
        this.YURRONG.cps = [Role.DUODUO.id, Role.ZHANAN.id, Role.DIANYIN.id, Role.RABBIT.id, Role.HEIWA.id, Role.HUOWANG.id, Role.GUISHUSHI.id, Role.YEREN.id, Role.PUMPKIN.id, Role.HUAQIANJI.id, Role.YINGYING.id, Role.CAPTAIN.id, Role.JOKER.id, Role.ZHADANKE.id];
        this.LINGOU.cps = [Role.RABBIT.id, Role.DIANYIN.id, Role.HEIWA.id, Role.ZHANAN.id, Role.HUOWANG.id, Role.GUISHUSHI.id, Role.YEREN.id, Role.PUMPKIN.id, Role.YINGYING.id, Role.CAPTAIN.id, Role.JOKER.id, Role.ZHADANKE.id];
        this.GOLDKING.cps = [Role.RABBIT.id, Role.DIANYIN.id, Role.HEIWA.id, Role.LINGLING.id, Role.QUANBA.id, Role.CAPTAIN.id, Role.JOKER.id, Role.ZHADANKE.id];
        this.DUDU.cps = [Role.JUNDUN.id, Role.WUNV.id, Role.XIUNV.id, Role.CHUZI.id, Role.LEIMENG.id, Role.YEREN.id, Role.CAPTAIN.id, Role.JOKER.id, Role.TUYA.id, Role.LINGOU.id, Role.BAKE.id, Role.JIUWEIHU.id, Role.NUANYANG, Role.XIXUEGUI.id.id];
        this.GEJI.cps = [Role.LELE.id, Role.SHUANGZI.id, Role.HEIWA.id, Role.RABBIT.id, Role.DIANYIN.id, Role.RENZHE.id, Role.XIXUEGUI.id];
        this.YUANSU.cps = [Role.LELE.id, Role.SHUANGZI.id, Role.HEIWA.id, Role.RABBIT.id, Role.DIANYIN.id, Role.RENZHE.id, Role.XIXUEGUI.id, Role.WUGEGE.id, Role.KUILEI.id];
        this.TANGSENG.cps = [Role.HONGSANSAN.id, Role.LINGOU.id, Role.KUILEI.id, Role.HUOWANG.id, Role.GUISHUSHI.id, Role.YOUFANG.id, Role.MANWANG.id, Role.PUMPKIN.id, Role.JUNDUN.id, Role.MOUSE.id, Role.NUANYANG.id, Role.QIANGWEI.id, Role.HONGZHAJI.id, Role.BZGIRL.id, Role.CAPTAIN.id];

    }

}
// è®¾ç½®ä¸»è§’å¸¸ç”¨æ­é…
Role.initRoleCps();


// å¸¸ç”¨å¤§å¥–èµ›æ­é…ç±»
class RegularlyCollocation {

    constructor(id, group) {
        this.id = id;
        this.group = group;
    }

    // ğŸ¥šã€ğŸ§Ÿã€â„ï¸ã€ğŸ¤¡ã€8g ç­‰TOPè§’è‰²å¤§å¥–èµ›å¸¸ç”¨ç»„åˆï¼Œæ¯ä¸ªåˆ†é…ä¸€ç™¾ä¸‡ä¸ªid
    // ğŸ¥š
    static group1000000 = new RegularlyCollocation(1000000, [Role.DUODUO.id, Role.BAKE.id]);
    static group1000001 = new RegularlyCollocation(1000001, [Role.DUODUO.id, Role.BAKE.id]);
    static group1000002 = new RegularlyCollocation(1000002, [Role.DUODUO.id, Role.HUAQIANJI.id]);
    static group1000003 = new RegularlyCollocation(1000003, [Role.DUODUO.id, Role.CHUZI.id]);
    static group1000004 = new RegularlyCollocation(1000004, [Role.DUODUO.id, Role.JOKER.id]);
    static group1000005 = new RegularlyCollocation(1000005, [Role.DUODUO.id, Role.HONGZHAJI.id]);
    static group1000006 = new RegularlyCollocation(1000006, [Role.DUODUO.id, Role.MIAOJIANG.id]);
    static group1000007 = new RegularlyCollocation(1000007, [Role.DUODUO.id, Role.NURSE.id]);
    static group1000008 = new RegularlyCollocation(1000008, [Role.DUODUO.id, Role.JIUWEIHU.id]);
    static group1000009 = new RegularlyCollocation(1000009, [Role.DUODUO.id, Role.MUSHI.id]);

    // ğŸ§Ÿ
    static group2000000 = new RegularlyCollocation(2000000, [Role.JIANGJIANG.id, Role.MANWANG.id]);
    static group2000001 = new RegularlyCollocation(2000001, [Role.JIANGJIANG.id, Role.LULU.id]);
    static group2000002 = new RegularlyCollocation(2000002, [Role.JIANGJIANG.id, Role.KUKU.id]);
    static group2000003 = new RegularlyCollocation(2000003, [Role.JIANGJIANG.id, Role.JIUWEIHU.id]);
    static group2000004 = new RegularlyCollocation(2000004, [Role.JIANGJIANG.id, Role.NURSE.id]);
    static group2000005 = new RegularlyCollocation(2000005, [Role.JIANGJIANG.id, Role.BAKE.id]);
    static group2000006 = new RegularlyCollocation(2000006, [Role.JIANGJIANG.id, Role.YINGYING.id]);
    static group2000007 = new RegularlyCollocation(2000007, [Role.JIANGJIANG.id, Role.WUGEGE.id]);
    static group2000008 = new RegularlyCollocation(2000008, [Role.JIANGJIANG.id, Role.HUAQIANJI.id]);
    static group2000009 = new RegularlyCollocation(2000009, [Role.JIANGJIANG.id, Role.MANWANG.id]);
    static group2000010 = new RegularlyCollocation(2000010, [Role.JIANGJIANG.id, Role.ZHADANKE.id]);
    static group2000011 = new RegularlyCollocation(2000011, [Role.JIANGJIANG.id, Role.HONGSANSAN.id]);
    static group2000012 = new RegularlyCollocation(2000012, [Role.JIANGJIANG.id, Role.SANTAIZI.id]);

    // â„ï¸
    static group3000000 = new RegularlyCollocation(3000000, [Role.YINGYING.id, Role.CAPTAIN.id]);
    static group3000001 = new RegularlyCollocation(3000001, [Role.YINGYING.id, Role.LELE.id]);
    static group3000002 = new RegularlyCollocation(3000002, [Role.YINGYING.id, Role.CAPTAIN.id]);
    static group3000003 = new RegularlyCollocation(3000003, [Role.YINGYING.id, Role.KUILEI.id]);
    static group3000004 = new RegularlyCollocation(3000004, [Role.YINGYING.id, Role.WUGEGE.id]);
    static group3000005 = new RegularlyCollocation(3000005, [Role.YINGYING.id, Role.LINGLING.id]);
    static group3000006 = new RegularlyCollocation(3000006, [Role.YINGYING.id, Role.HUOWANG.id]);
    static group3000007 = new RegularlyCollocation(3000007, [Role.YINGYING.id, Role.LEIMENG.id]);
    static group3000008 = new RegularlyCollocation(3000008, [Role.YINGYING.id, Role.BZGIRL.id]);
    static group3000009 = new RegularlyCollocation(3000009, [Role.YINGYING.id, Role.XIXUEGUI.id]);
    static group3000010 = new RegularlyCollocation(3000010, [Role.YINGYING.id, Role.SHUANGZI.id]);
    static group3000011 = new RegularlyCollocation(3000011, [Role.YINGYING.id, Role.JIANGJIANG.id]);
    static group3000012 = new RegularlyCollocation(3000012, [Role.YINGYING.id, Role.ZHADANKE.id]);
    static group3000013 = new RegularlyCollocation(3000013, [Role.YINGYING.id, Role.HONGSANSAN.id]);
    static group3000014 = new RegularlyCollocation(3000014, [Role.YINGYING.id, Role.SANTAIZI.id]);

    // ğŸ¤¡
    static group4000000 = new RegularlyCollocation(4000000, [Role.JOKER.id, Role.KUILEI.id]);
    static group4000001 = new RegularlyCollocation(4000001, [Role.JOKER.id, Role.WUGEGE.id]);
    static group4000002 = new RegularlyCollocation(4000002, [Role.JOKER.id, Role.RABBIT.id]);
    static group4000003 = new RegularlyCollocation(4000003, [Role.JOKER.id, Role.LELE.id]);
    static group4000004 = new RegularlyCollocation(4000004, [Role.JOKER.id, Role.SHUANGZI.id]);
    static group4000005 = new RegularlyCollocation(4000005, [Role.JOKER.id, Role.KUILEI.id]);
    static group4000006 = new RegularlyCollocation(4000006, [Role.JOKER.id, Role.LEIMENG.id]);
    static group4000007 = new RegularlyCollocation(4000007, [Role.JOKER.id, Role.GUISHUSHI.id]);
    static group4000008 = new RegularlyCollocation(4000008, [Role.JOKER.id, Role.DIANYIN.id]);
    static group4000009 = new RegularlyCollocation(4000009, [Role.JOKER.id, Role.XIXUEGUI.id]);
    static group4000010 = new RegularlyCollocation(4000010, [Role.JOKER.id, Role.LANGZAI.id]);
    static group4000011 = new RegularlyCollocation(4000011, [Role.JOKER.id, Role.BZGIRL.id]);
    static group4000012 = new RegularlyCollocation(4000012, [Role.JOKER.id, Role.HUOWANG.id]);
    static group4000013 = new RegularlyCollocation(4000013, [Role.JOKER.id, Role.XIUNV.id]);
    static group4000014 = new RegularlyCollocation(4000014, [Role.JOKER.id, Role.ZHADANKE.id]);
    static group4000015 = new RegularlyCollocation(4000015, [Role.JOKER.id, Role.HONGSANSAN.id]);
    static group4000016 = new RegularlyCollocation(4000016, [Role.JOKER.id, Role.MAGICLION.id]);
    static group4000017 = new RegularlyCollocation(4000017, [Role.JOKER.id, Role.SANTAIZI.id]);
    static group4000018 = new RegularlyCollocation(4000018, [Role.JOKER.id, Role.YINGYING.id]);
    static group4000019 = new RegularlyCollocation(4000019, [Role.JOKER.id, Role.LINGLING.id]);
    static group4000020 = new RegularlyCollocation(4000020, [Role.JOKER.id, Role.LANLAN.id]);
    static group4000021 = new RegularlyCollocation(4000021, [Role.JOKER.id, Role.HUABANTU.id]);
    static group4000022 = new RegularlyCollocation(4000022, [Role.JOKER.id, Role.BAIGUJING.id]);
    static group4000023 = new RegularlyCollocation(4000023, [Role.JOKER.id, Role.NUANYANG.id]);
    static group4000024 = new RegularlyCollocation(4000024, [Role.JOKER.id, Role.QIANGWEI.id]);
    static group4000025 = new RegularlyCollocation(4000025, [Role.JOKER.id, Role.ZHANAN.id]);

    // 8g
    static group5000000 = new RegularlyCollocation(5000000, [Role.BAKE.id, Role.DUODUO.id]);
    static group5000001 = new RegularlyCollocation(5000001, [Role.BAKE.id, Role.WUGEGE.id]);
    static group5000002 = new RegularlyCollocation(5000002, [Role.BAKE.id, Role.RABBIT.id]);
    static group5000003 = new RegularlyCollocation(5000003, [Role.BAKE.id, Role.LINGLING.id]);
    static group5000004 = new RegularlyCollocation(5000004, [Role.BAKE.id, Role.DIANYIN.id]);
    static group5000005 = new RegularlyCollocation(5000005, [Role.BAKE.id, Role.XIXUEGUI.id]);
    static group5000006 = new RegularlyCollocation(5000006, [Role.BAKE.id, Role.LEIMENG.id]);
    static group5000007 = new RegularlyCollocation(5000007, [Role.BAKE.id, Role.BZGIRL.id]);
    static group5000008 = new RegularlyCollocation(5000008, [Role.BAKE.id, Role.LANGZAI.id]);
    static group5000009 = new RegularlyCollocation(5000009, [Role.BAKE.id, Role.MAGICLION.id]);
    static group5000010 = new RegularlyCollocation(5000010, [Role.BAKE.id, Role.XIUNV.id]);
    static group5000011 = new RegularlyCollocation(5000011, [Role.BAKE.id, Role.LANLAN.id]);
    static group5000012 = new RegularlyCollocation(5000012, [Role.BAKE.id, Role.SANTAIZI.id]);

    // ğŸš¢
    static group6000000 = new RegularlyCollocation(6000000, [Role.CAPTAIN.id, Role.YINGYING.id]);
    static group6000001 = new RegularlyCollocation(6000001, [Role.CAPTAIN.id, Role.BZGIRL.id]);
    static group6000002 = new RegularlyCollocation(6000002, [Role.CAPTAIN.id, Role.JOKER.id]);
    static group6000003 = new RegularlyCollocation(6000003, [Role.CAPTAIN.id, Role.JIANGJIANG.id]);
    static group6000004 = new RegularlyCollocation(6000004, [Role.CAPTAIN.id, Role.CHUZI.id]);
    static group6000005 = new RegularlyCollocation(6000005, [Role.CAPTAIN.id, Role.ZHANAN.id]);
    static group6000006 = new RegularlyCollocation(6000006, [Role.CAPTAIN.id, Role.HONGZHAJI.id]);
    static group6000007 = new RegularlyCollocation(6000007, [Role.CAPTAIN.id, Role.NUANYANG.id]);
    static group6000008 = new RegularlyCollocation(6000008, [Role.CAPTAIN.id, Role.QIANGWEI.id]);

    // åŒå­
    static group7000000 = new RegularlyCollocation(7000000, [Role.SHUANGZI.id, Role.JOKER.id]);
    static group7000001 = new RegularlyCollocation(7000001, [Role.SHUANGZI.id, Role.DIANYIN.id]);
    static group7000002 = new RegularlyCollocation(7000002, [Role.SHUANGZI.id, Role.RABBIT.id]);
    static group7000003 = new RegularlyCollocation(7000003, [Role.SHUANGZI.id, Role.HEIWA.id]);
    static group7000004 = new RegularlyCollocation(7000004, [Role.SHUANGZI.id, Role.YOUXIA.id]);
    static group7000005 = new RegularlyCollocation(7000005, [Role.SHUANGZI.id, Role.ZHANAN.id]);
    static group7000006 = new RegularlyCollocation(7000006, [Role.SHUANGZI.id, Role.YINGYING.id]);
    static group7000007 = new RegularlyCollocation(7000007, [Role.SHUANGZI.id, Role.CAPTAIN.id]);
    static group7000008 = new RegularlyCollocation(7000008, [Role.SHUANGZI.id, Role.RENZHE.id]);
    static group7000009 = new RegularlyCollocation(7000009, [Role.SHUANGZI.id, Role.BAIGUJING.id]);
    static group7000010 = new RegularlyCollocation(7000010, [Role.SHUANGZI.id, Role.LINGLING.id]);
    static group7000011 = new RegularlyCollocation(7000011, [Role.SHUANGZI.id, Role.XIXUEGUI.id]);
    static group7000012 = new RegularlyCollocation(7000012, [Role.SHUANGZI.id, Role.HUOWANG.id]);
    static group7000013 = new RegularlyCollocation(7000013, [Role.SHUANGZI.id, Role.YEREN.id]);

    // ğŸ¦Š å‚€å„¡
    static group8000000 = new RegularlyCollocation(8000000, [Role.KUILEI.id, Role.JOKER.id]);
    static group8000001 = new RegularlyCollocation(8000001, [Role.KUILEI.id, Role.YINGYING.id]);
    static group8000002 = new RegularlyCollocation(8000002, [Role.KUILEI.id, Role.DIANYIN.id]);
    static group8000003 = new RegularlyCollocation(8000003, [Role.KUILEI.id, Role.ZHANAN.id]);
    static group8000004 = new RegularlyCollocation(8000004, [Role.KUILEI.id, Role.YOUXIA.id]);
    static group8000005 = new RegularlyCollocation(8000005, [Role.KUILEI.id, Role.LINGLING.id]);
    static group8000006 = new RegularlyCollocation(8000006, [Role.KUILEI.id, Role.XIXUEGUI.id]);
    static group8000007 = new RegularlyCollocation(8000007, [Role.KUILEI.id, Role.RABBIT.id]);
    static group8000008 = new RegularlyCollocation(8000008, [Role.KUILEI.id, Role.BAIGUJING.id]);
    static group8000009 = new RegularlyCollocation(8000009, [Role.KUILEI.id, Role.RENZHE.id]);
    static group8000010 = new RegularlyCollocation(8000010, [Role.KUILEI.id, Role.WUNV.id]);

    // ğŸ¦Š ç‹å°¾
    static group9000000 = new RegularlyCollocation(9000000, [Role.JIUWEIHU.id, Role.JIANGJIANG.id]);
    static group9000001 = new RegularlyCollocation(9000001, [Role.JIUWEIHU.id, Role.NURSE.id]);
    static group9000002 = new RegularlyCollocation(9000002, [Role.JIUWEIHU.id, Role.HEIWA.id]);
    static group9000003 = new RegularlyCollocation(9000003, [Role.JIUWEIHU.id, Role.HONGZHAJI.id]);
    static group9000004 = new RegularlyCollocation(9000004, [Role.JIUWEIHU.id, Role.DUODUO.id]);
    static group9000005 = new RegularlyCollocation(9000005, [Role.JIUWEIHU.id, Role.LEIMENG.id]);
    static group9000006 = new RegularlyCollocation(9000006, [Role.JIUWEIHU.id, Role.ZHANAN.id]);
    static group9000007 = new RegularlyCollocation(9000007, [Role.JIUWEIHU.id, Role.TUYA.id]);
    static group9000008 = new RegularlyCollocation(9000008, [Role.JIUWEIHU.id, Role.CHUZI.id]);
    static group9000009 = new RegularlyCollocation(9000009, [Role.JIUWEIHU.id, Role.RABBIT.id]);
    static group9000010 = new RegularlyCollocation(9000010, [Role.JIUWEIHU.id, Role.BZGIRL.id]);
    static group9000011 = new RegularlyCollocation(9000011, [Role.JIUWEIHU.id, Role.LINGLING.id]);
    static group9000012 = new RegularlyCollocation(9000012, [Role.JIUWEIHU.id, Role.XIXUEGUI.id]);
    static group9000013 = new RegularlyCollocation(9000013, [Role.JIUWEIHU.id, Role.HUAQIANJI.id]);
    static group9000014 = new RegularlyCollocation(9000014, [Role.JIUWEIHU.id, Role.LANLAN.id]);
    static group9000015 = new RegularlyCollocation(9000015, [Role.JIUWEIHU.id, Role.JIANSHI.id]);
    static group9000016 = new RegularlyCollocation(9000016, [Role.JIUWEIHU.id, Role.WUGEGE.id]);

    // å…‰å½± æ‰ç”·
    static group10000000 = new RegularlyCollocation(10000000, [Role.ZHANAN.id, Role.JIUWEIHU.id]);
    static group10000001 = new RegularlyCollocation(10000001, [Role.ZHANAN.id, Role.WUKONG.id]);
    static group10000002 = new RegularlyCollocation(10000002, [Role.ZHANAN.id, Role.TUYA.id]);
    static group10000003 = new RegularlyCollocation(10000003, [Role.ZHANAN.id, Role.BZGIRL.id]);
    static group10000004 = new RegularlyCollocation(10000004, [Role.ZHANAN.id, Role.SHUANGZI.id]);
    static group10000005 = new RegularlyCollocation(10000005, [Role.ZHANAN.id, Role.JIANGJIANG.id]);
    static group10000006 = new RegularlyCollocation(10000006, [Role.ZHANAN.id, Role.HONGZHAJI.id]);
    static group10000007 = new RegularlyCollocation(10000007, [Role.ZHANAN.id, Role.NIUXIAOMANG.id]);
    static group10000008 = new RegularlyCollocation(10000008, [Role.ZHANAN.id, Role.DIANYIN.id]);
    static group10000009 = new RegularlyCollocation(10000009, [Role.ZHANAN.id, Role.RABBIT.id]);
    static group10000010 = new RegularlyCollocation(10000010, [Role.ZHANAN.id, Role.YOUXIA.id]);
    static group10000011 = new RegularlyCollocation(10000011, [Role.ZHANAN.id, Role.HUABANTU.id]);
    static group10000012 = new RegularlyCollocation(10000012, [Role.ZHANAN.id, Role.CAPTAIN.id]);
    static group10000013 = new RegularlyCollocation(10000013, [Role.ZHANAN.id, Role.XIXUEGUI.id]);
    static group10000014 = new RegularlyCollocation(10000014, [Role.ZHANAN.id, Role.WUGEGE.id]);
    static group10000015 = new RegularlyCollocation(10000015, [Role.ZHANAN.id, Role.JIANSHI.id]);
    static group10000016 = new RegularlyCollocation(10000016, [Role.ZHANAN.id, Role.SANTAIZI.id]);
    static group10000017 = new RegularlyCollocation(10000017, [Role.ZHANAN.id, Role.JOKER.id]);
    static group10000018 = new RegularlyCollocation(10000018, [Role.ZHANAN.id, Role.NUANYANG.id]);
    static group10000019 = new RegularlyCollocation(10000019, [Role.ZHANAN.id, Role.QIANGWEI.id]);
    static group10000020 = new RegularlyCollocation(10000020, [Role.ZHANAN.id, Role.WUNV.id]);


    // å…¶ä»–å¼ºåŠ¿æ­é…
    static group10000000000 = new RegularlyCollocation(10000000000, [Role.ZHADANKE.id, Role.HONGSANSAN.id]);
    static group10000000001 = new RegularlyCollocation(10000000001, [Role.CHUZI.id, Role.MAGICLION.id]);
    static group10000000002 = new RegularlyCollocation(10000000002, [Role.CHUZI.id, Role.NURSE.id]);
    static group10000000003 = new RegularlyCollocation(10000000003, [Role.CHUZI.id, Role.QUANBA.id]);
    static group10000000004 = new RegularlyCollocation(10000000004, [Role.LELE.id, Role.HEIWA.id]);
    static group10000000005 = new RegularlyCollocation(10000000005, [Role.LELE.id, Role.RABBIT.id]);
    static group10000000006 = new RegularlyCollocation(10000000006, [Role.LELE.id, Role.DIANYIN.id]);
    static group10000000007 = new RegularlyCollocation(10000000007, [Role.RABBIT.id, Role.MAGICLION.id]);
    static group10000000008 = new RegularlyCollocation(10000000008, [Role.RABBIT.id, Role.PUMPKIN.id]);
    static group10000000009 = new RegularlyCollocation(10000000009, [Role.MUSHI.id, Role.RABBIT.id]);
    static group10000000010 = new RegularlyCollocation(10000000010, [Role.MUSHI.id, Role.QUANBA.id]);
    static group10000000011 = new RegularlyCollocation(10000000011, [Role.HUAQIANJI.id, Role.QUANBA.id]);
    static group10000000012 = new RegularlyCollocation(10000000012, [Role.HUAQIANJI.id, Role.PUMPKIN.id]);
    static group10000000013 = new RegularlyCollocation(10000000013, [Role.HUAQIANJI.id, Role.NURSE.id]);
    static group10000000014 = new RegularlyCollocation(10000000014, [Role.BZGIRL.id, Role.DIANYIN.id]);
    static group10000000015 = new RegularlyCollocation(10000000015, [Role.BZGIRL.id, Role.RABBIT.id]);
    static group10000000016 = new RegularlyCollocation(10000000016, [Role.KUKU.id, Role.HEIWA.id]);
    static group10000000017 = new RegularlyCollocation(10000000017, [Role.KUKU.id, Role.TIEMIAN.id]);
    static group10000000018 = new RegularlyCollocation(10000000018, [Role.KUKU.id, Role.RABBIT.id]);
    static group10000000019 = new RegularlyCollocation(10000000019, [Role.KUKU.id, Role.DIANYIN.id]);
    static group10000000020 = new RegularlyCollocation(10000000020, [Role.LULU.id, Role.CAPTAIN.id]);
    static group10000000021 = new RegularlyCollocation(10000000021, [Role.SANTAIZI.id, Role.LEIMENG.id]);
    static group10000000022 = new RegularlyCollocation(10000000022, [Role.SANTAIZI.id, Role.DIANYIN.id]);
    static group10000000023 = new RegularlyCollocation(10000000023, [Role.SANTAIZI.id, Role.RABBIT.id]);
    // next 24


    static maxGroupId = 0;
    static groupSum = 0;


    static getMaxGroupId() {
        if (this.maxGroupId > 0) return this.maxGroupId;
        for (let item in RegularlyCollocation) {
            if (!RegularlyCollocation[item] || RegularlyCollocation[item].id === undefined || RegularlyCollocation[item].id < 0) continue;
            if (RegularlyCollocation[item].id > this.maxGroupId) this.maxGroupId = RegularlyCollocation[item].id;
        }
        return this.maxGroupId;
    }

    static getGroupSum() {
        if (this.groupSum > 0) return this.groupSum;
        for (let item in RegularlyCollocation) {
            if (!RegularlyCollocation[item] || RegularlyCollocation[item].id === undefined || RegularlyCollocation[item].id < 0) continue;
            if (RegularlyCollocation[item].id > 0) this.groupSum += 1;
        }
        //console.log(">>>> RegularlyCollocation groupSum=" + this.groupSum); // 41
        return this.groupSum;
    }

    static getNextGroupItem(id) {
        let currItem = null;
        let targetItem = null;
        for (let item in RegularlyCollocation) {
            if (!RegularlyCollocation[item] || RegularlyCollocation[item].id === undefined || RegularlyCollocation[item].id < 0) continue;
            if (currItem) {
                targetItem = RegularlyCollocation[item];
                return targetItem;
            }
            if (RegularlyCollocation[item].id === id) currItem = RegularlyCollocation[item];
        }
        return this.group1000000;
    }

    static getRandomGroup() {
        let idx = fullCloseInt(0, this.getGroupSum());
        //console.log(">>>> RegularlyCollocation getRandomGroup idx=" + idx);
        let i = 0;
        for (let item in RegularlyCollocation) {
            if (!RegularlyCollocation[item] || RegularlyCollocation[item].id === undefined || RegularlyCollocation[item].id < 0) continue;
            if (i === idx) return RegularlyCollocation[item].group;
            i++;
        }
        return this.group1000000.group;
    }

}

//////////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////////
// ã€åœºæ™¯ä¸»é¢˜ã€‘ å˜é‡ã€æ–¹æ³•åŒºåŸŸ
//////////////////////////////////////////////////////////////////////    
// ä¸»é¢˜ç±»
class Theme {

    constructor(id, name, bgColor, bgImage, bgImageIdbKey, tbColor, tblColor, tblWidth, glColor, glmColor, glWidth, gnColor, gndColor, gnSize,
        plColor, plWidth, rlColor, klplColor, klplWidth, szbplColor, szbrlColor, ccColor, ccWidth, ccStyle, szccColor, wkShowColor) {
        this.id = id || 0; // ç¼–å·
        this.name = name || "é»˜è®¤ä¸»é¢˜"; // åç§°
        this.bgColor = bgColor || "#7F70C3"; // é¡µé¢èƒŒæ™¯é¢œè‰²
        this.bgImage = bgImage || ""; // é¡µé¢èƒŒæ™¯å›¾ç‰‡
        this.bgImageIdbKey = bgImageIdbKey || sysConfig.bgImageKey + this.id; // é¡µé¢èƒŒæ™¯å›¾ç‰‡indexedDB key
        this.tbColor = tbColor || "#8d93d8"; // table å°é¢èƒŒæ™¯é¢œè‰²
        this.tblColor = tblColor || "#35357A"; // table line å°é¢è¾¹æ¡†çº¿é¢œè‰²
        this.tblWidth = tblWidth || roundNumber(6.00 * dpr); // TODO table line å°é¢è¾¹æ¡†çº¿å®½ï¼Œæ ¹æ®è®¾å¤‡ DPR å†³å®šï¼Œåœ¨ init() åˆå§‹åŒ–çš„æ—¶å€™è®¡ç®—è®¾ç½® 0.27 * sysConfig.girdSizeCss * dpr
        this.glColor = glColor || "#8384D1D0"; // gird line ç –æ ¼çº¿é¢œè‰²
        this.glmColor = glmColor || "#6A6CBFD0"; // gird line middle ç –æ ¼çº¿ä¸­é—´çº¿é¢œè‰²
        this.glWidth = glWidth || roundNumber(1.00 * dpr * (os.isTablet ? 1.618 : 1)); // gird line ç –æ ¼çº¿å®½ï¼Œæ ¹æ®è®¾å¤‡ DPR å†³å®š
        this.gnColor = gnColor || "#D2CCF1"; // gird number ç –æ ¼åæ ‡æ•°å€¼é¢œè‰²
        this.gndColor = gndColor || "#D7D7DC"; // gird number dark ç –æ ¼åæ ‡æ•°å€¼é»‘å¤œæ¨¡å¼é¢œè‰²
        this.gnSize = gnSize || 24; // TODO gird number ç –æ ¼åæ ‡æ•°å€¼æ˜¾ç¤ºå¤§å°ï¼Œåˆå§‹åŒ–çš„æ—¶å€™è®¡ç®— htmlFontSizeNum * dpr * sysConfig.pxRatio + "px serif"
        this.plColor = plColor || "#cfe0d380"; // point line è§’è‰²ä¸­å¿ƒç‚¹è¿åŠ¨è·¯å¾„é¢œè‰²
        this.plWidth = plWidth || roundNumber(5.20 / 2 * dpr * (os.isTablet ? 1.618 : 1)); // point line è§’è‰²ä¸­å¿ƒç‚¹è¿åŠ¨è·¯å¾„å®½åº¦
        this.rlColor = rlColor || "#cfe0d325"; // role line è§’è‰²æœ¬ä½“è¿åŠ¨è·¯å¾„é¢œè‰²
        this.klplColor = klplColor || "#D61C24"; // kuilei point line å‚€å„¡ä¸­å¿ƒç‚¹è¿åŠ¨è·¯å¾„é¢œè‰²
        this.klplWidth = klplWidth || roundNumber(7.00 / 2 * dpr * (os.isTablet ? 1.618 : 1)); // kuilei point line å‚€å„¡ä¸­å¿ƒç‚¹è¿åŠ¨è·¯å¾„å®½åº¦
        this.szbplColor = szbplColor || "#EADF5580"; // shaungzi back role line åŒå­åˆ†èº«ä¸­å¿ƒç‚¹è¿åŠ¨è·¯å¾„é¢œè‰²
        this.szbrlColor = szbrlColor || this.rlColor; // shaungzi back role line åŒå­åˆ†èº«æœ¬ä½“è¿åŠ¨è·¯å¾„é¢œè‰²
        this.ccColor = ccColor || "#000000"; // collide circle ç¢°æ’æŒ‡ç¤ºåœˆé¢œè‰²
        this.ccWidth = ccWidth || roundNumber(1.00 * dpr * (os.isTablet ? 1.618 : 1)); // collide circle ç¢°æ’æŒ‡ç¤ºåœˆå®½åº¦
        this.ccStyle = ccStyle || 0; // collide circle ç¢°æ’æŒ‡ç¤ºåœˆæ ·å¼ï¼Œ0-è™šçº¿ï¼›1-å®çº¿
        this.szccColor = szccColor || "#ffffffaa"; // shuangzi collide circle åŒå­åˆ†èº«ç¢°æ’æŒ‡ç¤ºåœˆé¢œè‰²
        this.wkShowColor = wkShowColor || "#1B1D2230"; // çŒ´å­åˆ†èº«æç¤ºè·¯å¾„é¢œè‰²
    }


    static DEFAULT = new Theme(0, "é»˜è®¤ä¸»é¢˜", "#7F70C3");
    //static WINTER_NEW_YEAR = new Theme(2, "æ–°å¹´ä¸»é¢˜", "#7F70C3");
    static WINTER_SNOW = new Theme(1, "å†°é›ªä¸»é¢˜", "#C7D0E0", "", "", "#4B99C9", "#EEF0F2", 0, "#438EC2", "#3483B7", 0, "#687CA1", "#EEF0F2", 0, "#cfe0d380", 0, "#cfe0d325", "", 0, "#EADF5580", "", "", 0, 0, "", "#1B1D2230");
    static SPRING_RUSTICITY = new Theme(3, "ç”°å›­ä¸»é¢˜", "#E6DD9C", "", "", "#9A9069", "#FBFAD0", 0, "#6B624060", "#6B6240D0", 0, "#252042", "#FBFAD0", 0, "#cfe0d380", 0, "#cfe0d325", "", 0, "#EADF5580", "", "", 0, 0, "", "#1B1D2230");
    static AUTUMN_INTERSTELLAR = new Theme(4, "æ˜Ÿé™…ä¸»é¢˜", "#05132C", "", "", "#808080", "#D7D7DC", 0, "#696969A0", "#2F4F4FA0", 0, "#D7D7DC", "#D7D7DC", 0, "#cfe0d380", 0, "#cfe0d325", "", 0, "#EADF5580", "", "", 0, 0, "", "#1B1D2230");
    static SUMMER_SEASIDE = new Theme(5, "å¤æ—¥ä¸»é¢˜", "#3C8BBB", "", "", "#FFBF6F", "#FAF9CB", 0, "#B7521AA0", "#B7521AD0", 0, "#2B117D", "#FBFAD0", 0, "#F9FBF580", 0, "#F9FBF540", "", 0, "#EADF5580", "", "", 0, 0, "", "#1B1D2230");

    static CURR_THEME_COPY = null;

    static maxId = 0;
    static getMaxId() {
        if (this.maxId) return this.maxId;
        for (let item in Theme) {
            if (!Theme[item] || Theme[item].id === undefined || Theme[item].id < 0) continue;
            if (Theme[item].id > this.maxId) this.maxId = Theme[item].id;
        }
        return this.maxId;
    }

    static getCustomTheme() {
        // ä»ç¼“å­˜è·å–è‡ªå®šä¹‰ä¸»é¢˜
        let customThemeStr = localStorage.getItem("collide-try-custom-theme");
        if (customThemeStr) {
            try {
                let customTheme = JSON.parse(customThemeStr);
                if (customTheme) return customTheme;
            } catch (e) { }
        }
        //return this.getCurrTheme();
        return null;
    }

    static getCurrTheme(id) {
        if (!id && id !== 0) id = userConfig.sceneThemeMode;
        for (let item in Theme) {
            if (!Theme[item] || Theme[item].id === undefined || Theme[item].id < 0) continue;
            if (Theme[item].id === id) return Theme[item];
        }
        return this.DEFAULT;
    }

    static getCurrThemeCopy(id) {
        //this.setCurrThemeCopy(id);
        //return this.CURR_THEME_COPY;
        if (!id && id !== 0) id = userConfig.sceneThemeMode;
        for (let item in Theme) {
            if (!Theme[item] || Theme[item].id === undefined || Theme[item].id < 0) continue;
            if (Theme[item].id === id) {
                return JSON.parse(JSON.stringify(Theme[item]));
            }
        }
        return JSON.parse(JSON.stringify(this.DEFAULT));
    }

    static setCurrThemeCopy(id) {
        if (this.CURR_THEME_COPY) return;
        if (!id && id !== 0) id = userConfig.sceneThemeMode;
        for (let item in Theme) {
            if (!Theme[item] || Theme[item].id === undefined || Theme[item].id < 0) continue;
            if (Theme[item].id === id) {
                this.CURR_THEME_COPY = JSON.parse(JSON.stringify(Theme[item]));
                return;
            }
        }
        this.CURR_THEME_COPY = JSON.parse(JSON.stringify(this.DEFAULT));
    }

    static getNameById(id) {
        for (let item in Theme) {
            if (!Theme[item] || Theme[item].id === undefined || Theme[item].id < 0) continue;
            if (Theme[item].id === id) return Theme[item].name;
        }
        return this.DEFAULT.name;
    }

    static getBgColorById(id) {
        for (let item in Theme) {
            if (!Theme[item] || Theme[item].id === undefined || Theme[item].id < 0) continue;
            if (Theme[item].id === id) return Theme[item].bgColor;
        }
        return this.DEFAULT.bgColor;
    }

    // é‡æ–°è®¡ç®—å±æ€§å€¼
    static reCalculate(theme) {
        if (!theme) return;
        theme.tblWidth = sysConfig.sceneLineWidth; // å°é¢è¾¹æ¡†çº¿å®½
        theme.gnSize = Math.round(htmlFontSizeNum * dpr * sysConfig.pxRatio * 0.8); // ç –æ ¼åæ ‡æ•°å€¼å­—ä½“å¤§å°
        theme.plWidth = roundNumber(0.11 * sysConfig.girdSize); // è§’è‰²è¿åŠ¨è·¯å¾„çº¿å®½
        theme.klplWidth = roundNumber(0.18 * sysConfig.girdSize); // å‚€å„¡è¿åŠ¨è·¯å¾„çº¿å®½
        theme.ccWidth = roundNumber(0.05 * sysConfig.girdSize); // ç„å‡†ã€ç¢°æ’æŒ‡ç¤ºåœˆçº¿å®½

    }

    // åˆ¤æ–­æ˜¯å¦ä¸ºé¢œè‰²ç 
    static isColorCode(str) {
        if (!str || typeof str !== "string" || str.replaceAll(" ", "") === "") return false;
        if (!str.startsWith("#") || !(/^[A-Fa-f0-9]{3,8}$/.test(str.substring(1)))) return false;
        let len = str.substring(1).length; // å»æ‰#ï¼Œ3ã€4ã€6ã€8 æ­£å¸¸å¯ç”¨
        if (len === 5 || len === 7) return false;
        return true;
    }

    // è®¾ç½®å°é¢é¢œè‰²é€æ˜
    static setTbColor00(code) {
        if (!code || !this.isColorCode(code)) return code;
        // ä¸ç®—#ï¼Œ3-è¡¥ä¸€ä½0ï¼›4-æœ€åä¸€ä½æ”¹0ï¼›6-è¡¥ä¸¤ä½0ï¼›8-æœ€åä¸¤ä½æ”¹0
        code = code.slice(1);
        if (code.length === 3) return this.getFullColorCode("#" + code + "0");
        if (code.length === 4) return this.getFullColorCode("#" + code.substring(0, 3) + "0");
        if (code.length === 6) return "#" + code + "00";
        if (code.length === 8) return "#" + code.substring(0, 6) + "00";
        return "#" + code;
    }

    // è·å–ä¸å¸¦é€æ˜åº¦çš„é¢œè‰²ç +å¼€å¤´#
    static getColorCodeNormal(code) {
        if (!code || !this.isColorCode(code)) return code;
        // ä¸ç®—#ï¼Œ3-æ¯ä¸€ä½é‡å¤ä¸€æ¬¡ï¼›4-å‰ä¸‰ä½æ¯ä¸€ä½é‡å¤ä¸€æ¬¡ï¼›6-ç›´æ¥è¿”å›ï¼›8-æˆªå–å‰6ä½
        code = code.slice(1);
        if (code.length === 4) code = code.substring(0, 3);
        if (code.length === 3) return '#' + code[0] + code[0] + code[1] + code[1] + code[2] + code[2];
        if (code.length === 6) return '#' + code;
        if (code.length > 6) return '#' + code.substring(0, 6);
        return "#" + code;
    }

    // é¢œè‰²çŸ­ç è¡¥å…¨ï¼ˆ8ä½å½¢å¼ï¼‰
    static getFullColorCode(code) {
        if (!code || !this.isColorCode(code)) return code;
        // ä¸ç®—#ï¼Œ3ã€4 ä½çŸ­ç ï¼Œæ¯ä¸€ä½é‡å¤ä¸€æ¬¡
        code = code.slice(1);
        if (code.length == 3) return '#' + code[0] + code[0] + code[1] + code[1] + code[2] + code[2] + "ff";
        if (code.length == 4) return '#' + code[0] + code[0] + code[1] + code[1] + code[2] + code[2] + code[3] + code[3];
        if (code.length == 6) return '#' + code + "ff";
        return "#" + code;
    }

}

//////////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////////
// ã€ç‚¹æŒ‰æ¨¡å¼æŒ‰é’®ã€‘ å˜é‡ã€æ–¹æ³•åŒºåŸŸ
////////////////////////////////////////////////////////////////////// 
class ClickPlayBtn {
    constructor(x, y, radius, outRadius, color, outColor, outLineColor,
        fontColor, fontLineColor, content, fontSize, isReady) {
        this.x = x || 0;
        this.y = y || 0;
        this.radius = radius || roundNumber(sysConfig.girdSize * (1.68 - 0.4), 4); // é˜´å½±åŠå¾„
        this.outRadius = outRadius || roundNumber(sysConfig.girdSize * (1.68 - 0.1), 4); // æŒ‰é’®åŠå¾„
        this.color = color || "#DEC27BA0"; // æŒ‰é’®é¢œè‰²
        this.outColor = outColor || "#FAEDCE40"; // é˜´å½±é¢œè‰²
        this.outLineColor = outLineColor || "#5A5963"; // è¾¹ç•Œçº¿é¢œè‰²
        this.fontColor = fontColor || "#FFFFFF"; // æ–‡å­—é¢œè‰²
        this.fontLineColor = fontLineColor || "#000000"; // æ–‡å­—æè¾¹é¢œè‰²
        this.content = content || "å‘å°„"; // æ–‡å­—
        this.fontSize = fontSize || 12; // æ–‡å­—å¤§å°
        this.isReady = isReady || false; // æ˜¯å¦å·²ç»å‡†å¤‡å‘å°„
    }

    // ç‚¹æŒ‰å‘å°„æŒ‰é’®é˜´å½±
    drawClickPlayBtnOut() {
        gameClickPlayContext.save();
        gameClickPlayContext.beginPath();
        gameClickPlayContext.fillStyle = clickPlayBtn.outColor;
        gameClickPlayContext.arc(gameClickPlayCanvas.width / 2, gameClickPlayCanvas.height / 2, clickPlayBtn.outRadius, 0, 2 * Math.PI);
        gameClickPlayContext.fill();
        gameClickPlayContext.closePath();
        gameClickPlayContext.restore();
    }

    // ç‚¹æŒ‰å‘å°„æŒ‰é’®æè¾¹
    drawClickPlayBtnOutLine() {
        gameClickPlayContext.save();
        gameClickPlayContext.beginPath();
        gameClickPlayContext.lineWidth = roundNumber(1 * dpr * sysConfig.pxRatio, 4);
        gameClickPlayContext.setLineDash([Math.round(5 * dpr * sysConfig.pxRatio), Math.round(5 * dpr * sysConfig.pxRatio)]); // è™šçº¿
        gameClickPlayContext.strokeStyle = this.outLineColor;
        gameClickPlayContext.arc(gameClickPlayCanvas.width / 2, gameClickPlayCanvas.height / 2, this.outRadius, 0, 2 * Math.PI);
        gameClickPlayContext.stroke();
        gameClickPlayContext.closePath();
        gameClickPlayContext.restore();
    }

    // ç‚¹æŒ‰å‘å°„æŒ‰é’®
    drawClickPlayBtn() {
        //if (userConfig.currPlayOpt !== 1) return; // 1-ç‚¹æŒ‰æ¨¡å¼

        // ç”»é˜´å½±
        this.drawClickPlayBtnOut();
        // ç”»è¾¹ç•Œçº¿
        this.drawClickPlayBtnOutLine();

        gameClickPlayContext.save();
        gameClickPlayContext.beginPath();
        gameClickPlayContext.fillStyle = this.color;
        //gameClickPlayContext.rect(0, 0, 140, 140);
        gameClickPlayContext.arc(gameClickPlayCanvas.width / 2, gameClickPlayCanvas.height / 2, this.radius, 0, 2 * Math.PI);
        gameClickPlayContext.fill();
        gameClickPlayContext.closePath();
        gameClickPlayContext.restore();

        // æ–‡å­—
        this.drawBtnText();
    }

    // ç»˜åˆ¶æ–‡å­—
    drawBtnText() {
        gameClickPlayContext.save();
        gameClickPlayContext.fillStyle = this.fontColor;
        // æ°´å¹³å¯¹é½æ–¹å¼ (center left right start end)
        gameClickPlayContext.textAlign = "center";
        // å‚ç›´å¯¹é½çš„æ–¹å¼ (top bottom middle)
        gameClickPlayContext.textBaseline = 'middle';

        let fontSize = 16;
        let metrics, width, height;

        gameClickPlayContext.font = fontSize * dpr + "px Arial";
        metrics = gameClickPlayContext.measureText(this.content);
        width = roundNumber(metrics.width, 4);
        height = roundNumber(metrics.actualBoundingBoxAscent + metrics.actualBoundingBoxDescent, 4);

        while (width > 0.5 * gameClickPlayCanvas.width) {
            fontSize -= 1;
            gameClickPlayContext.font = fontSize * dpr + "px Arial";
            metrics = gameClickPlayContext.measureText(this.content);
            width = roundNumber(metrics.width, 4);
            height = roundNumber(metrics.actualBoundingBoxAscent + metrics.actualBoundingBoxDescent, 4);
            if (fontSize < 1) break; // é¿å… height è®¡ç®—å¼‚å¸¸ï¼Œå¯¼è‡´æ­»å¾ªç¯
        }

        while (height < 0.2 * gameClickPlayCanvas.height) {
            fontSize += 1;
            gameClickPlayContext.font = fontSize * dpr + "px Arial";
            metrics = gameClickPlayContext.measureText(this.content);
            width = roundNumber(metrics.width, 4);
            height = roundNumber(metrics.actualBoundingBoxAscent + metrics.actualBoundingBoxDescent, 4);
            if (fontSize > 50) break; // é¿å… height è®¡ç®—å¼‚å¸¸ï¼Œå¯¼è‡´æ­»å¾ªç¯
        }

        if (fontSize < 1 || fontSize > 50) { // å­—ä½“å¤§å°å¼‚å¸¸
            console.error(">>>> drawBtnText fontSize error.");
            fontSize = 16;
            gameClickPlayContext.font = fontSize * dpr + "px Arial";
        }

        console.log(">>>> drawBtnText fontSize=" + fontSize + ", width=" + width + ", height=" + height);

        // æ–‡å­—æ ·å¼
        gameClickPlayContext.font = "bold " + fontSize * dpr + "px Arial";
        //gameClickPlayContext.imageSmoothingEnabled = true; // å¹³æ»‘è¾¹ç¼˜ç»˜åˆ¶ï¼Œæ¶ˆé™¤é”¯é½¿ï¼Œä½†æ˜¯å¯¹æ–‡å­—æè¾¹é”¯é½¿æ²¡ç”¨

        // æ–‡å­—é˜´å½±
        //gameClickPlayContext.shadowColor = '#000'; // é˜´å½±é¢œè‰²
        //gameClickPlayContext.shadowBlur = dpr; // æ¨¡ç³Šç¨‹åº¦
        //gameClickPlayContext.shadowOffsetX = dpr; // æ°´å¹³åç§»
        //gameClickPlayContext.shadowOffsetY = dpr; // å‚ç›´åç§»

        // æ–‡å­—æè¾¹
        gameClickPlayContext.strokeStyle = "#000";
        gameClickPlayContext.lineWidth = roundNumber(2 * dpr * sysConfig.pxRatio, 4);
        gameClickPlayContext.strokeText(this.content, gameClickPlayCanvas.width / 2, gameClickPlayCanvas.height / 2);

        // å†™æ–‡å­—
        gameClickPlayContext.fillStyle = this.fontColor;
        gameClickPlayContext.fillText(this.content, gameClickPlayCanvas.width / 2, gameClickPlayCanvas.height / 2);

        gameClickPlayContext.restore();
    }
}

//////////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////////
// ã€åº”ç”¨åˆå§‹åŒ–ã€‘ å˜é‡ã€æ–¹æ³•åŒºåŸŸ
//////////////////////////////////////////////////////////////////////

// å››æ¡åˆ‡è§’çº¿
var lines = [];
// å››æ¡åˆ‡è§’çº¿ä¸­ç‚¹åæ ‡
var linesMiddlePoints = [];
// å°çƒ/è§’è‰²
var balls = [];
// è›‹
var eggs = [];
// ä¸´æ—¶å°çƒå¯¹è±¡ï¼Œç”¨äºçŸ¥é“åæ ‡ã€åŠå¾„åˆ›å»ºçƒå¯¹è±¡ï¼Œä½¿ç”¨å¸¸é‡é¿å…é¢‘ç¹åˆ›å»ºå¯¹è±¡
var tempCheckBall;
// åˆ†èº«å¯¹è±¡ï¼Œè®¾ç½®è·Ÿä¸»çƒä¸€æ ·çš„contextï¼Œä¾¿äºæ‹–åŠ¨æ—¶æ¸…ç†ç”»å¸ƒ
var twinBall;
// çŒ´å­ç­‰è§’è‰²åˆ†èº«
var buddies = [];
// è§’è‰²æ˜¯å¦å­˜åœ¨åˆ¤æ–­æ ‡è¯†
var isDuoduoExist = false;
var isLuluExist = false;
var isShuangziExist = false;
// åˆ†äº«çš„è§’è‰²å’Œåæ ‡æ•°æ®
var shareData = null;
// htmlæ ¹å…ƒç´ å­—ä½“å¤§å°
var htmlEle, htmlFontSize, htmlFontSizeNum;
// å°é¢åŒºåŸŸ
var tablePolygon = [];
// emoji å¤§å›¾å½¢ size
var largeEmojiSizes = ['s', 'mm', 'm', 'fll', 'll', 'l', 'xl'];
// emoji å¤§å›¾å½¢åæ ‡åˆ—è¡¨ [{x:0,y:0,radius:0,icon:'ğŸ‚',size:'l',posIdx:0}]
var largeEmojiPoints = [];
// å½“å‰ä¸»é¢˜
var currTheme = null;
// çŒ´å­åˆ†èº«åæ ‡
var monkeysPos, monkeysTargetPos;
// ç‚¹æŒ‰å‘å°„æŒ‰é’®ï¼Œå› ä¸ºä¾èµ–ç –æ ¼å¤§å°ï¼Œåˆå§‹åŒ–éœ€è¦æ”¾åˆ°ç –æ ¼å¤§å°è®¡ç®—å®Œæˆä¹‹å
var clickPlayBtn = null;


onMounted(() => {
    tempCheckBall = new Ball(context);
    twinBall = new Ball(gameMainBallContext);
    htmlEle = document.getElementsByTagName('html')[0];
    htmlFontSize = window.getComputedStyle(htmlEle).fontSize || "12px";
    htmlFontSizeNum = Number(htmlFontSize.replace("px", ""));
})


// åˆå§‹åŒ–åº”ç”¨å‚æ•°
function initAppParams() {
    // è®¾ç½®åº”ç”¨å…¨åï¼ˆåç§°+ç‰ˆæœ¬åï¼‰
    setAppFullName();
    // è®¾ç½®åº”ç”¨æ›´æ–°å†…å®¹
    setAppUpdateContent();
    // è®¾ç½®æ›´æ–°æ—¶é—´æ ¼å¼
    setUpdateDateFormat();
    // éšè—å…³é—­æ‰€æœ‰dialogå¼¹çª—ï¼Œä¿è¯ç¦»çº¿ç‰ˆåˆšæ‰“å¼€ä¸ä¼šä¸€ç›´æœ‰å¼¹çª—
    hideAllDialog();
    // æ£€æµ‹ WebStorage æ˜¯å¦æ­£å¸¸å¯ç”¨
    if (!checkWebStorage()) return;
    // ä¿å­˜ä¸€ä»½dpr
    sysConfig.dpr = dpr;
    // ç‰ˆæœ¬å·æ ¡éªŒ
    doVersionThings();
    // ç”¨æˆ·é…ç½®
    setUserConfig();
    // è®¾ç½®åˆå§‹ä¸»é¢˜
    setThemeBySeason();
    if (userConfig.isUseCustomTheme) currTheme = Theme.getCustomTheme();
    if (!currTheme) currTheme = Theme.getCurrThemeCopy();
    // åƒç´ æ¯”ä¾‹
    if (os.isTablet) sysConfig.pxRatio = 1.618;
    console.log(">>>> sysConfig.pxRatio=" + sysConfig.pxRatio);
    // è®¾ç½®å­—ä½“å¤§å°
    setFontSize();
    console.log(">>>> html font size=" + htmlFontSize);
    // æ¸¸æˆå°é¢å å±å¹•å®½åº¦çš„æ¯”ä¾‹
    if (os.isTablet) sysConfig.sceneWidthRatio = 0.618;
    console.log(">>>> sysConfig.sceneWidthRatio=" + sysConfig.sceneWidthRatio);
    // åˆå§‹åŒ–ç”»å¸ƒå¤§å°ã€ç½‘æ ¼å¤§å°
    setPageSize();
    console.log(">>>> sysConfig.girdSize=" + sysConfig.girdSize);
    console.log(">>>> sysConfig.girdSizeCss=" + sysConfig.girdSizeCss);
    // è°ƒæ•´è¾¹æ¡†å®½åº¦ä¸º 0.3 * girdSize
    sysConfig.sceneLineWidth = roundNumber(0.27 * sysConfig.girdSize, 4);
    console.log(">>>> sysConfig.sceneLineWidth=" + sysConfig.sceneLineWidth);
    // æ²¡æœ‰å¯ç”¨è‡ªå®šä¹‰ä¸»é¢˜æ—¶ï¼Œé‡æ–°è®¡ç®—ä¸»é¢˜ä¸­çš„åŠ¨æ€å±æ€§
    if (!userConfig.isUseCustomTheme) Theme.reCalculate(currTheme);
    // è®¾ç½®å¼¹çª—æ»šåŠ¨åŒºåŸŸé«˜åº¦
    setDialogScrollMaxHeight(1.80);
    // ç”»å¸ƒå±…ä¸­
    canvasAutoCenter();
    // è®¾ç½®ç‚¹æŒ‰å‘å°„æŒ‰é’®ç”»å¸ƒå¤§å°å’Œä½ç½®
    clickPlayBtn = new ClickPlayBtn();
    setClickPlayCanvas();
    // å°é¢åŒºåŸŸåˆå§‹åŒ–ï¼Œç”¨äºæ£€æµ‹åˆ¤æ–­æ˜¯å¦ä¸emojiå›¾å½¢é‡å 
    tablePolygon = [
        { x: Math.round(sysConfig.cLeft * dpr + sysConfig.girdSize * 3), y: Math.round(sysConfig.cTop * dpr - currTheme.tblWidth + sysConfig.girdSize * 0) },
        { x: Math.round(sysConfig.cLeft * dpr + sysConfig.girdSize * 11), y: Math.round(sysConfig.cTop * dpr - currTheme.tblWidth + sysConfig.girdSize * 0) },
        { x: Math.round(sysConfig.cLeft * dpr + sysConfig.girdSize * 14 + currTheme.tblWidth), y: Math.round(sysConfig.cTop * dpr + sysConfig.girdSize * 3) },
        { x: Math.round(sysConfig.cLeft * dpr + sysConfig.girdSize * 14 + currTheme.tblWidth), y: Math.round(sysConfig.cTop * dpr + sysConfig.girdSize * 19) },
        { x: Math.round(sysConfig.cLeft * dpr + sysConfig.girdSize * 11), y: Math.round(sysConfig.cTop * dpr + currTheme.tblWidth + sysConfig.girdSize * 22) },
        { x: Math.round(sysConfig.cLeft * dpr + sysConfig.girdSize * 3), y: Math.round(sysConfig.cTop * dpr + currTheme.tblWidth + sysConfig.girdSize * 22) },
        { x: Math.round(sysConfig.cLeft * dpr + sysConfig.girdSize * 0 - currTheme.tblWidth), y: Math.round(sysConfig.cTop * dpr + sysConfig.girdSize * 19) },
        { x: Math.round(sysConfig.cLeft * dpr + sysConfig.girdSize * 0 - currTheme.tblWidth), y: Math.round(sysConfig.cTop * dpr + sysConfig.girdSize * 3) }
    ];
    // çŒ´å­åˆ†èº«åæ ‡åˆå§‹åŒ–
    setMonkeysPos();
    // åˆå§‹åŒ–é¼ æ ‡ä½ç½®
    captureMouse(canvas);
    // åˆå§‹åŒ–å°é¢åˆ‡è§’
    initTableAngle();
}


// åˆå§‹åŒ–å°é¢åˆ‡è§’
function initTableAngle() {
    // è®¾ç½®å°é¢åˆ‡è§’åå·®è·ç¦»ã€‚æ³¨æ„æ”¾åœ¨åˆå§‹åŒ–åˆ‡å‰²æ–œè¾¹ä¹‹å‰
    if (sysConfig.isWan8CocosTable) {
        // ä½¿ç”¨å¤šç‚¹ç²¾ç¡®æ§åˆ¶æ–¹å¼
        setSysWan8CocosTableMoveVals();
    }
    console.log(">>>> sysConfig.wan8CocosTableMoveVals=" + sysConfig.wan8CocosTableMoveVals.toString());
    // åˆå§‹åŒ–åˆ‡å‰²æ–œè¾¹
    set4AngleLine();
    // åˆå§‹åŒ–è®¾ç½®å››æ¡åˆ‡è§’çº¿ä¸­ç‚¹åæ ‡
    set4AngleLineMiddlePoint(lines);
}


// åˆå§‹åŒ–è§’è‰²
function initRoles() {
    // å¯¼å…¥äº†è§’è‰²å’Œåæ ‡æ•°æ®ï¼Œä¸ç”¨é€‰è§’è‰²
    if (userConfig.shareRoleAndPos) {
        try {
            shareData = JSON.parse(userConfig.shareRoleAndPos);
            //console.log(shareData);
        } catch (e) { }
    }
    if (!shareData) setCurrRoleV2();
    if (userConfig.currRole < 0) userConfig.currRole = 0;
    // åªæ˜¾ç¤ºå°é¢ï¼Œéšè—ä¸»è¿åŠ¨å±‚ã€ä¸»çƒè¿åŠ¨å±‚ã€æ¸…ç©ºè·¯å¾„å±‚
    if (userConfig.isJustShowTable) toggleOnlyTable(true);
    try {
        if (!shareData) throw new Error();
        // è®¾ç½®åˆ†äº«è§’è‰²å’Œä½ç½®
        setShareRoleAndPos(shareData);
        // è®¾ç½®å½“å‰ä¸»è§’
        if (balls && balls.length > 0) userConfig.currRole = balls[0].roleId;
        // TODO å¯¼å…¥è§’è‰²ä¹Ÿç®—é€‰æ‹©è§’è‰²
        if (userConfig.currRole > -1) localStorage.setItem('collide-try-role-chose', userConfig.currRole);
        console.log(">>>> å¯¼å…¥è§’è‰²å’Œä½ç½®æ“ä½œå®Œæˆ");
    } catch (e) {
        console.log(">>>> setShareRoleAndPos error: " + e.message);
        // è®¾ç½®ä¸»çƒ
        setBallMain();
        // è®¾ç½®å…¶ä»–å°çƒ
        if (!userConfig.isTestOnlyOne) setBallOthersByRole(userConfig.currRole);
        // è®¾ç½®å°ä¸‘åˆ†èº«ã€æ”¾åœ¨è§’è‰²è®¾ç½®å®Œæˆåã€‘
        setRoleJoker();
    } finally {
        // åŠ è½½ä¹‹åï¼Œæ¸…é™¤å¯¼å…¥æ•°æ®ã€æ”¾åˆ°onMouseMoveæ–¹æ³•å†å¤„ç†ã€‘
        //clearShareRoleAndPos();
        // æ ‡è®°è§’è‰²å·²ç»é€‰æ‹©å®Œæˆ
        if (userConfig.currRole > -1) sysConfig.isRoleChooseFinished = true;
    }
    // è®¾ç½®åŒå­åˆ†èº«
    if (userConfig.currRole === Role.SHUANGZI.id) setTwins();
    // è®¾ç½®çŒ´å­åˆ†èº«
    if (userConfig.currRole === Role.WUKONG.id) setMonkeys();
    // è®¾ç½®å®Œæ‰€æœ‰è§’è‰²ä¹‹åï¼Œè®¾ç½®ä¸»è§’æ‰€å±é˜Ÿé¢œè‰²
    resetMainTeamColorRandom(userConfig.mainTeamColor);
    // åˆå§‹åŒ–è§’è‰²ç¢°æ’æ ‡å¿—ä½
    setBallCollidingNos();
    // è®¾ç½®å®Œè§’è‰²åï¼Œæ£€æµ‹è§’è‰²æ˜¯å¦å­˜åœ¨
    checkRoleExist();
    // éœ²éœ²åŠ é€Ÿ 50%ï¼Œæ‰‹åŠ¨è°ƒæ•´ä¸€ä¸ªè·Ÿå®æˆ˜ç›¸è¿‘çš„æ•°å€¼
    if (isLuluExist) balls[0].vRatio += 0.20;
    // è®¾ç½®è›‹
    if (isDuoduoExist) setEggs();
    // è®¾ç½®é€Ÿåº¦
    setSpeed();
    // è®¾ç½®æ‘©æ“¦åŠ›
    setFriction();
}


// åˆå§‹åŒ–ä¸€æ¬¡
function initOnce() {
    // è§’è‰²è¿åŠ¨è·¯å¾„åˆ¤æ–­æ˜¾ç¤º
    if (userConfig.isShowBallMovePath) gamePathCanvas.style.display = "inherit";
    // è§’è‰²å…¨è·¯å¾„åˆ¤æ–­æ˜¾ç¤º
    if (userConfig.isShowBallPath) gamePathBallCanvas.style.display = "inherit";
    // æ¸¸æˆæ¡Œé¢åœºæ™¯åˆå§‹åŒ–ï¼Œéœ€è¦æ”¾åœ¨è§’è‰²è®¾ç½®ä¹‹åï¼Œå› ä¸ºåœºæ™¯ä¼šæ ¹æ®è§’è‰²å˜åŒ–
    if (sysConfig.isRoleChooseFinished) gameSceneInit(); // é€‰æ‹©è§’è‰²åæ‰æ¸²æŸ“åœºæ™¯ï¼Œä¼˜åŒ–æ€§èƒ½
}


// åˆå§‹åŒ–å…¶ä»–å‚æ•°
function initOthers() {
    // TODO
}


// ä¸åˆ·æ–°é¡µé¢ã€é‡æ–°é€‰è§’è‰²ã€‘ï¼Œé‡æ–°åˆå§‹åŒ–é¡µé¢æ•°æ®
function reInit(isImport, isKeepDialog) {
    // åœæ­¢å½“å‰å›åˆè¿åŠ¨çŠ¶æ€
    resetBallsSpeed(balls);
    // é‡ç½®å…¨å±€å˜é‡
    balls = [];
    eggs = [];
    // é‡ç½®åˆ†äº«æ•°æ®
    shareData = null;
    let isDuoduoExistBak = isDuoduoExist;
    // é‡æ–°åˆå§‹åŒ–è§’è‰²
    initRoles();
    // åˆ¤æ–­æ˜¯å¦éœ€è¦é‡æ–°ç”»å°é¢ï¼Œé€‰æ‹©å‰ååªè¦æœ‰æœµæœµå°±éœ€è¦é‡ç”»
    //if (isDuoduoExistBak || isDuoduoExist) reDrawTableAndEgg();
    // ä¸ºäº†é¿å…åç»­å„ç§åˆ¤æ–­ï¼Œæ¯æ¬¡éƒ½é‡æ–°ç”»
    reDrawTableAndEgg();
    // é‡ç½®åŠ¨ç”»æ¸²æŸ“ç›¸å…³å˜é‡
    resetAnimate();
    // æ¨¡æ‹Ÿé‡æ‰“æ¸…å±é‡æ–°å¼€å§‹æ–°çš„æ¸²æŸ“
    if (isImport) directPlayAgain(true);
    else {
        directPlayAgain(false);
        // è§£é™¤ directPlayAgain() é€‰ä¸­çš„ä¸»çƒ
        selectedBall = null;
    }
    // é‡æ–°æ¸²æŸ“
    //isAnimated = false;
    //if (!isPlaying) animate();
    // å®Œæˆåå…³é—­é€‰æ‹©è§’è‰²å¼¹çª—
    if (!isKeepDialog) switchChooseRoleDialog(false);
}


// TODO åº”ç”¨åˆå§‹åŒ–
function init() {
    // åˆå§‹åŒ–åº”ç”¨å‚æ•°
    initAppParams();
    // åˆå§‹åŒ–é€‰æ‹©è§’è‰²
    initRoles();
    // åˆå§‹åŒ–ä¸€æ¬¡çš„é…ç½®
    initOnce();
    // åˆå§‹åŒ–å…¶ä»–é…ç½®
    initOthers();

    //console.log(">>>> init sysConfig=" + JSON.stringify(sysConfig));
    //alert(">>>> init sysConfig=" + JSON.stringify(sysConfig));
}


onMounted(() => {
    // å½“ HTML æ–‡æ¡£åŠ è½½å®Œæ¯•åï¼Œç«‹åˆ»æ‰§è¡ŒæŸä¸ªæ–¹æ³•
    // é€šå¸¸ç”¨äº <body> å…ƒç´ ï¼Œåœ¨é¡µé¢å®Œå…¨è½½å…¥å(åŒ…æ‹¬å›¾ç‰‡ã€cssæ–‡ä»¶ç­‰ç­‰)æ‰§è¡Œè„šæœ¬ä»£ç 
    // ç­‰å›¾ç‰‡åŠ è½½å®Œæˆï¼Ÿç½‘ç»œä¸å¥½çš„è¯ï¼Œæœ‰ç‚¹æ‚¬å•Š
    //window.onload = function() {
    try {
        init();
    } catch (e) {
        // å¤„ç†é”™è¯¯äº‹é¡¹
        if (e instanceof Error) {
            if (e.message.includes("æ‰‹åŠ¨ç»“æŸç¨‹åº")) { throw e; }
        }
        doGlobalError(e, (sysConfig && sysConfig.alertErrorCount) ? sysConfig.alertErrorCount : 3);
    }
    //}
})


// è®¾ç½®åº”ç”¨åç§°
function setAppFullName() {
    let fullNameEles = document.getElementsByClassName('collide-try-app-full-name');
    if (!fullNameEles) return;
    let fullName = sysConfig.appName + "_" + sysConfig.versionName;
    for (let i = 0, len = fullNameEles.length; i < len; i++) {
        fullNameEles[i].innerText = fullName;
    }
}


// è®¾ç½®æ›´æ–°æ—¶é—´æ ¼å¼
function setUpdateDateFormat() {
    let dateEles = document.getElementsByClassName('collide-try-update-date');
    if (!dateEles) return;
    let y = new Date().getFullYear();
    let result;
    for (let i = 0, len = dateEles.length; i < len; i++) {
        result = dateEles[i].innerText;
        if (result.startsWith(y)) dateEles[i].innerText = result.replaceAll((y + "-"), "");
    }
}


// è®¾ç½®åº”ç”¨æ›´æ–°å†…å®¹
function setAppUpdateContent() {
    let updateTitleEle = document.getElementById("update-content-title");
    if (!updateTitleEle) return;
    updateTitleEle.innerText = "ğŸ†• " + sysConfig.versionName + " æ›´æ–°";
    let updateTargetEle = document.getElementById("collide-try-update-content");
    if (!updateTargetEle) return;
    let updateContentEle = document.getElementById("collide-try-about-app-update-newest");
    if (!updateContentEle) return;
    let updateContentEleClone = updateContentEle.cloneNode(true);
    if (!updateContentEleClone) return;
    // å…ˆæ¸…ç©ºå­å…ƒç´ ï¼Œé¿å…é‡å¤æ·»åŠ 
    let targetChildren = updateTargetEle.childNodes;
    if (targetChildren && targetChildren.length > 0) {
        for (let i = 0, len = targetChildren.length; i < len; i++) {
            updateTargetEle.removeChild(targetChildren[i]);
        }
    }
    updateTargetEle.appendChild(updateContentEleClone);
}


// æ ¡éªŒç‰ˆæœ¬å·ï¼Œå¤„ç†æ–°å¢åŠŸèƒ½é€»è¾‘ï¼Œæ›´æ–°ç‰ˆæœ¬è¦æ›´æ–°ä¹‹å‰çš„ç¼“å­˜
function doVersionThings() {
    let collideTryVersionStr = localStorage.getItem('collide-try-version');
    let collideTryVersion = collideTryVersionStr ? Number(collideTryVersionStr) : 0;
    console.log(">>>> collide-try-version-old=" + collideTryVersion + ", collide-try-version-new=" + sysConfig.version);
    if (sysConfig.version > collideTryVersion) {
        // æ›´æ–° userConfig ç¼“å­˜
        let localUserConfigStr = localStorage.getItem('collide-try-user-settings');
        let userConfigCache = null;
        if (localUserConfigStr) {
            userConfigCache = JSON.parse(localUserConfigStr);
        }
        if (userConfigCache) {
            for (let f in userConfig) {
                //console.log(f + " = " + userConfig[f]);
                // ä¸ªåˆ«ç‰¹æ®Šå­—æ®µä¸å—ç¼“å­˜å½±å“ï¼Œä»¥ä»£ç é…ç½®ä¸ºå‡†
                if (f === 'tryFullPathPointNum') continue;
                if (f === 'animateAutoRestTime') continue;
                if (f === 'wan8CocosTableMoveVals') continue;
                if (f === 'isShowBallMovePath') continue;
                if (f === 'isShowBallPath') continue;
                if (f === 'isKuileiPullBack') continue;
                if (f === 'isShowTryFullPath') continue;
                //if (f === 'isShowRoleBloodLine') continue;
                //if (f === 'isShowRoleBloodNo') continue;
                if (userConfigCache[f] || typeof userConfigCache[f] === "boolean") userConfig[f] = userConfigCache[f];
            }
            // æ›´æ–° localStorage ä¸­çš„ userConfig
            localStorage.setItem('collide-try-user-settings', JSON.stringify(userConfig));
            console.log(">>>> doVersionThings userConfig in localStorage updated.");
        }

        // æ˜¾ç¤ºæ›´æ–°å†…å®¹
        showUpdateContent(true);

        localStorage.setItem('collide-try-version', sysConfig.version); // ç‰ˆæœ¬å·å­˜å…¥ç¼“å­˜
        localStorage.removeItem("collide-try-init-error-count"); // æ›´æ–°ç‰ˆæœ¬åé‡ç½®é”™è¯¯è®¡æ•°
    }
}


// åˆå§‹åŒ–æ–¹æ³•æŠ¥é”™å¤šæ¬¡åï¼Œè¦å¤„ç†çš„äº‹æƒ…
function doGlobalError(e, count) {
    let collideTryInitErrorCountStr = localStorage.getItem('collide-try-init-error-count');
    let collideTryInitErrorCount = collideTryInitErrorCountStr ? Number(collideTryInitErrorCountStr) : 0;
    console.log(">>>> collideTryInitErrorCount=" + collideTryInitErrorCount);
    if (!count || count < 0) count = 3;
    if (collideTryInitErrorCount >= count || !isProd()) { // é”™è¯¯è¾¾åˆ°æŒ‡å®šæ¬¡æ•°
        /*
        // æ¸…ç†æ‰€æœ‰ç¼“å­˜ã€ä¹‹å‰å‚æ•°é…ç½®ä¼šä¸¢å¤±ã€‘
        //localStorage.clear();
        sessionStorage.clear();
        for (let i = 0, len = localStorage.length; i < len; i++) {
            if (!localStorage.key(i)) continue;
            if (localStorage.key(i).includes("access-key")) continue;
            localStorage.removeItem(localStorage.key(i));
        }
        */
        // è¶…è¿‡æ¬¡æ•°å¼¹çª—æç¤º
        if (collideTryInitErrorCount % count === 0 || !isProd()) doGlobalErrorMsg(e, true);
        // è¾¾åˆ°äº”æ¬¡å¼¹çª—æç¤ºå°è¯•æ¢å¤é»˜è®¤è®¾ç½®
        if (collideTryInitErrorCount % 5 === 0)
            alert("ğŸ’¡ æ¸©é¦¨æç¤ºï¼š\nä¸€ç›´æŠ¥é”™ï¼Œå¯ä»¥å°è¯•åœ¨è®¾ç½®é‡Œé¢æ¢å¤é»˜è®¤è®¾ç½®ï¼");

    }

    collideTryInitErrorCount += 1;
    // é‡ç½®åˆå§‹åŒ–é”™è¯¯è®¡æ•°
    if (collideTryInitErrorCount > 10) collideTryInitErrorCount = 0;

    localStorage.setItem('collide-try-init-error-count', collideTryInitErrorCount);
}


// è¯»å–ã€è®¾ç½®ç”¨æˆ·é…ç½®
function setUserConfig() {
    let localUserConfigStr = localStorage.getItem('collide-try-user-settings');
    if (localUserConfigStr) {
        userConfig = JSON.parse(localUserConfigStr);
        // TODO ç‰¹æ®Šå­—æ®µä¸å—ç¼“å­˜å½±å“ï¼Œä»¥ä»£ç é…ç½®ä¸ºå‡†
        userConfig.tryFullPathPointNum = userConfigBack.tryFullPathPointNum;
        console.log(">>>> localStorage userConfig: " + JSON.stringify(userConfig));
    }
}


// è®¾ç½®å½“å‰è§’è‰²
function setCurrRole() {
    // ä» sessionStorage è¯»å–ï¼Œæ³¨æ„å…³é—­é¡µé¢ï¼Œé‡æ–°æ‰“å¼€æ‰ä¼šå¤±æ•ˆï¼Œæµè§ˆå™¨æ ‡é¢˜æ å³é”®â€œé‡æ–°æ‰“å¼€å…³é—­é¡µé¢â€è¿˜æ˜¯èƒ½è·å–åˆ°
    try {
        let roleValStr = sessionStorage.getItem('collide-try-role-chose');
        // å¦‚æœä¸æ˜¯æ•°å­—ç±»å‹
        if (!(!isNaN(parseFloat(roleValStr)) && isFinite(roleValStr))) throw new Error(">>>> è§’è‰²é€‰æ‹©å‡ºç°é”™è¯¯ï¼è¯·é‡æ–°é€‰æ‹©æˆ–è”ç³»å¼€å‘è€…");
        userConfig.currRole = Number(roleValStr);
    } catch (e) {
        //console.log(">>>> sessionStorage getItem error: " + e.message);
        userConfig.currRole = -1;
    }

    //if (!userConfig.currRole) { // æ²¡è·å–åˆ°ï¼Œåˆ™å¼¹å‡ºé€‰æ‹©è§’è‰²æ¡†ã€‚æ³¨æ„ 0 ä¸º false
    if (userConfig.currRole < 0) {
        // sessionStorage æ²¡æ‰¾åˆ°ï¼Œå†ä» localStorage ä¸­å–å€¼
        try {
            let roleValStr = localStorage.getItem('collide-try-role-chose');
            // å¦‚æœä¸æ˜¯æ•°å­—ç±»å‹
            if (!(!isNaN(parseFloat(roleValStr)) && isFinite(roleValStr))) throw new Error(">>>> è§’è‰²é€‰æ‹©å‡ºç°é”™è¯¯ï¼è¯·é‡æ–°é€‰æ‹©æˆ–è”ç³»å¼€å‘è€…");
            userConfig.currRole = Number(roleValStr);
        } catch (e) {
            //console.log(">>>> localStorage getItem error: " + e.message);
            userConfig.currRole = -1;
        }
        // è¿˜æ˜¯æ²¡æ‰¾åˆ°ï¼Œå†å¼¹å‡ºè§’è‰²é€‰æ‹©çª—
        if (userConfig.currRole < 0) {
            dialogMask.style.display = "unset"; // æ˜¾ç¤ºé€‰æ‹©è§’è‰²é®ç½©å±‚
            chooseRoleDialog.style.display = "unset"; // æ˜¾ç¤ºé€‰æ‹©è§’è‰²å¼¹çª—
            //return;
            //alert(">>>> è§’è‰²é€‰æ‹©å‡ºç°é”™è¯¯ï¼è¯·è”ç³»å¼€å‘è€…");
            //throw new Error("è§’è‰²é€‰æ‹©å‡ºç°é”™è¯¯ï¼è¯·è”ç³»å¼€å‘è€…");
        } else {
            // localStorage æ‰¾åˆ°äº†
            localStorage.removeItem("collide-try-role-chose");
            //sessionStorage.setItem('collide-try-role-chose', userConfig.currRole);
        }
    }

    // æ ‡è®°è§’è‰²é€‰æ‹©å®Œæˆ
    if (userConfig.currRole > -1) sysConfig.isRoleChooseFinished = true;

    if (userConfig.isRandomRole || userConfig.isFlashRole) {
        if (userConfig.isRandomRole) userConfig.currRole = Role.getRandomRoleId();
        if (userConfig.isFlashRole) setRolesFlash(userConfig.gameRoleIds, true);
        // å­˜åˆ° sessionStorageã€PCæµè§ˆå™¨åˆ·æ–°ä¸ä¼šå¤±æ•ˆï¼Œå…³é—­é¡µé¢ä¼šå¤±æ•ˆã€‘
        //if (userConfig.currRole > -1) sessionStorage.setItem('collide-try-role-chose', userConfig.currRole);
        // TODO å­˜åˆ° localStorageï¼Œå…¼å®¹ä¸€äº›æµè§ˆå™¨ï¼ˆViaï¼‰åˆ·æ–°å sessionStorage å¤±æ•ˆï¼Œå¯¼è‡´ä¸€ç›´å¼¹å‡ºé€‰æ‹©è§’è‰²é—®é¢˜
        //if (userConfig.currRole > -1) localStorage.setItem('collide-try-role-chose', userConfig.currRole);
        // localStorage å­˜å‚¨æ›´æ–° userConfig å¯¹è±¡
        if (userConfig.currRole > -1) localStorage.setItem('collide-try-user-settings', JSON.stringify(userConfig));
    }

    console.log(">>>> userConfig.currRole=" + userConfig.currRole);
}


// è®¾ç½®å½“å‰è§’è‰²ï¼ˆä¸åˆ·æ–°é¡µé¢ç‰ˆæœ¬ï¼Œé€‰æ‹©çš„è§’è‰²æ°¸ä¹…å­˜å‚¨åœ¨localStorageï¼‰
function setCurrRoleV2() {
    // ä¸€ç›´ä» localStorage è¯»å–
    try {
        let roleValStr = localStorage.getItem('collide-try-role-chose');
        // å¦‚æœä¸æ˜¯æ•°å­—ç±»å‹
        if (!(!isNaN(parseFloat(roleValStr)) && isFinite(roleValStr))) throw new Error(">>>> è§’è‰²é€‰æ‹©å‡ºç°é”™è¯¯ï¼è¯·é‡æ–°é€‰æ‹©æˆ–è”ç³»å¼€å‘è€…");
        userConfig.currRole = Number(roleValStr);
    } catch (e) {
        //console.log(">>>> localStorage getItem error: " + e.message);
        userConfig.currRole = -1;
    }
    // è¿˜æ˜¯æ²¡æ‰¾åˆ°ï¼Œå†å¼¹å‡ºè§’è‰²é€‰æ‹©çª—
    if (userConfig.currRole < 0) {
        switchChooseRoleDialog(true);
        //return;
        //alert(">>>> è§’è‰²é€‰æ‹©å‡ºç°é”™è¯¯ï¼è¯·è”ç³»å¼€å‘è€…");
        //throw new Error("è§’è‰²é€‰æ‹©å‡ºç°é”™è¯¯ï¼è¯·è”ç³»å¼€å‘è€…");
    }

    // æ ‡è®°è§’è‰²é€‰æ‹©å®Œæˆ
    if (userConfig.currRole > -1) sysConfig.isRoleChooseFinished = true;

    if (userConfig.isRandomRole || userConfig.isFlashRole) {
        if (userConfig.isRandomRole) userConfig.currRole = Role.getRandomRoleId();
        if (userConfig.isFlashRole) setRolesFlash(userConfig.gameRoleIds, true);
        // å­˜åˆ° sessionStorage ã€åˆ·æ–°ä¸ä¼šå¤±æ•ˆï¼Œå…³é—­è¿™ä¸ªé¡µé¢ä¼šå¤±æ•ˆã€‘
        //if (userConfig.currRole > -1) sessionStorage.setItem('collide-try-role-chose', userConfig.currRole);
        // TODO å­˜åˆ° localStorageï¼Œå…¼å®¹ä¸€äº›æµè§ˆå™¨ï¼ˆViaï¼‰åˆ·æ–°å sessionStorage å¤±æ•ˆï¼Œå¯¼è‡´ä¸€ç›´å¼¹å‡ºé€‰æ‹©è§’è‰²é—®é¢˜
        //if (userConfig.currRole > -1) localStorage.setItem('collide-try-role-chose', userConfig.currRole);
        // localStorage å­˜å‚¨æ›´æ–° userConfig å¯¹è±¡
        if (userConfig.currRole > -1) localStorage.setItem('collide-try-user-settings', JSON.stringify(userConfig));
    }

    console.log(">>>> userConfig.currRole=" + userConfig.currRole);
}


// userConfig.wan8CocosTableMoveVals ç»“åˆ girdSize è®¡ç®—ï¼Œèµ‹å€¼ç»™ sysConfig.wan8CocosTableMoveVals
function setSysWan8CocosTableMoveVals() {
    if (userConfig.wan8CocosTableMoveVals.length === 1 && Number(userConfig.wan8CocosTableMoveVals[0]) === 0) {
        sysConfig.wan8CocosTableMoveVals = [0, 0, 0, 0, 0, 0, 0, 0];
    } else {
        for (let i = 0; i < userConfig.wan8CocosTableMoveVals.length; i++) {
            sysConfig.wan8CocosTableMoveVals[i] = roundNumber(userConfig.wan8CocosTableMoveVals[i] * sysConfig.girdSize, 4);
        }
    }
}


/*
é¦–æ¬¡è¿›å…¥æ¸¸æˆï¼Œæœªé€‰æ‹©ä»»ä½•ä¸»é¢˜ï¼Œæ ¹æ®æ—¶é—´å­£èŠ‚è®¾ç½®ä¸»é¢˜
å­£èŠ‚å˜åŒ–ï¼Œæ›´æ¢å¯¹åº”ä¸»é¢˜ï¼Œåªæ”¹ä¸€æ¬¡ï¼Œåœ¨è¿™ä¸ªå­£èŠ‚å†…å¯æ‰‹åŠ¨æ›´æ¢å…¶ä»–ä¸»é¢˜

æŒ‰ç…§é˜³å†åˆ’åˆ†ï¼Œæ˜¥å­£é€šå¸¸æ˜¯3ã€4ã€5æœˆï¼Œå¤å­£æ˜¯6ã€7ã€8æœˆï¼Œç§‹å­£æ˜¯9ã€10ã€11æœˆï¼Œå†¬å­£æ˜¯12ã€1ã€2æœˆã€‚
æŒ‰ç…§å†œå†åˆ’åˆ†ï¼Œæ˜¥å­£æ˜¯å†œå†çš„æ­£æœˆè‡³ä¸‰æœˆï¼Œå¤å­£æ˜¯å››æœˆè‡³å…­æœˆï¼Œç§‹å­£æ˜¯ä¸ƒæœˆè‡³ä¹æœˆï¼Œå†¬å­£æ˜¯åæœˆè‡³åäºŒæœˆã€‚
*/
function setThemeBySeason(date) {
    // ä¸Šä¸€æ¬¡è®¾ç½®ä¸»é¢˜æ—¶é—´æœˆä»½
    let collideTryThemeTimeStr = localStorage.getItem('collide-try-theme-time');
    let collideTryThemeTime = collideTryThemeTimeStr ? Number(collideTryThemeTimeStr) : 0;
    console.log(">>>> collide-try-theme-time=" + collideTryThemeTime);
    if (!date) date = new Date();
    let m = date.getMonth() + 1;
    if (isMonthInSameSeason(collideTryThemeTime, m) && userConfig.sceneThemeMode >= 0) return; // ç©å®¶æ‰‹åŠ¨è®¾ç½®äº†ä¸»é¢˜
    let currThemeMode = 0;
    if ([12, 1, 2].indexOf(m) > -1) { // å†¬å­£ï¼Œå†°é›ªä¸»é¢˜
        currThemeMode = 1;
    } else if ([3, 4, 5].indexOf(m) > -1) { // æ˜¥å­£ï¼Œç”°å›­ä¸»é¢˜
        currThemeMode = 3;
    } else if ([6, 7, 8].indexOf(m) > -1) { // å¤å­£ï¼Œå¤æ—¥ä¸»é¢˜
        currThemeMode = 5;
    } else if ([9, 10, 11].indexOf(m) > -1) { // ç§‹å­£ï¼Œæ˜Ÿé™…ä¸»é¢˜ï¼ˆã€Šæ˜Ÿé™…ç©¿è¶Šã€‹ä¸Šæ˜ æ—¶é—´ 2014-11-07 æ­£å¥½æ˜¯ç§‹å­£ï¼‰
        currThemeMode = 4;
    } else { // é»˜è®¤ä¸»é¢˜
        currThemeMode = 0;
    }
    // è®¾ç½®ä¸»é¢˜æ¨¡å¼
    userConfig.sceneThemeMode = currThemeMode;
    // ä¿å­˜è®¾ç½®ä¸»é¢˜çš„æœˆä»½
    localStorage.setItem('collide-try-theme-time', m);
}


// åˆ¤æ–­ä¸¤ä¸ªæœˆä»½æ˜¯å¦åœ¨åŒä¸€ä¸ªå­£èŠ‚ï¼ˆé˜³å†ï¼‰
function isMonthInSameSeason(m1, m2) {
    let idx1 = Math.floor(m1 / 3);
    if (idx1 < 0 || idx1 >= 4) idx1 = 0;
    let idx2 = Math.floor(m2 / 3);
    if (idx2 < 0 || idx2 >= 4) idx2 = 0;
    return idx1 === idx2;
}


// åˆå§‹åŒ–è§’è‰²ã€é¢œè‰²ã€å¤§å°ã€åŠå¾„ã€é€Ÿåº¦ç­‰å‚æ•°
function initBallByRole(ball) {
    if (!ball.roleId) ball.roleId = Role.HEIWA.id;
    console.log(">>>> initBallByRole " + ball.getBallDesc());
    switch (ball.roleId) {
        //case Role.HEIWA.id: // èµ°é»˜è®¤å¤„ç†
        case Role.JIANGJIANG.id:
            ball.color = "#362CBC";
            ball.sizeRatio = Ball.SIZERATIO.S; // å°
            ball.mRatio = Ball.WEIGHTRATIO.M;
            if (ball.isMainBall) ball.vRatio = userConfig.isTestOnlyOne ? 1.05 : Ball.SPEEDRATIO.L; // é€Ÿåº¦æ¯”ç‡ï¼Œæ¯”é»‘å¨ƒæ…¢ä¸€çº§ï¼Œä¸ºäº†æ¨¡æ‹ŸåŠ é€Ÿæ•ˆæœï¼Œé€Ÿåº¦å¯ä»¥è®¾ç½®å¤§ä¸€ç‚¹
            //if (ball.isMainBall) ball.v = 63.00; // åˆå§‹åŒ–çš„æ—¶å€™æ ¹æ® vRatio è®¡ç®—
            break;
        case Role.DUODUO.id:
            ball.color = "#8C5E9D";
            ball.sizeRatio = Ball.SIZERATIO.L; // å¤§
            ball.mRatio = Ball.WEIGHTRATIO.S; // è½»
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.KUILEI.id:
            ball.color = "#E72E38";
            ball.sizeRatio = Ball.SIZERATIO.L; //  å¤§
            ball.pathRadius = roundNumber((currTheme.klplWidth + 0.1 * sysConfig.girdSize) / 2); // + 0.1 * sysConfig.girdSize å¼¥è¡¥åŠå¾„è¿‡å°å¯¼è‡´æ£€æµ‹ä¸åˆ°ç¢°æ’çš„è¯¯å·®ã€‚roundNumber(7.0 / 2 * dpr); // å‚€å„¡ç»³å­è¿åŠ¨è·¯å¾„åŠå¾„
            ball.tryRadius = roundNumber(0.7 * sysConfig.girdSize / 2); // å‚€å„¡ç„å‡†çº¿åŠå¾„
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.L; // å¿«
            //if (ball.isMainBall) userConfig.isShowBallPath = false; // ä¸æ˜¾ç¤ºå…¨è·¯å¾„
            //if (ball.isMainBall) userConfig.isStopAfterCollided = false;
            break;
        case Role.BAKE.id:
            ball.color = "#FD5B2B"; // FD5B2B é»˜è®¤çš®è‚¤é¢œè‰²ï¼›EFE3E5 å¤©ç¥é™ä¸´çš®è‚¤é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.L; //  å¤§
            ball.mRatio = Ball.WEIGHTRATIO.L; // é‡ å®æˆ˜å‘ç°ï¼Œå…¶å®å·´å…‹å’Œé…·é…·ä¸€æ ·é‡
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.S; // æ…¢
            break;
        case Role.LULU.id:
            ball.color = "#C8728B"; // PaleVioletRed è„¸çº¢çš„æ·¡ç´«çº¢
            ball.sizeRatio = Ball.SIZERATIO.M; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.KUKU.id:
            ball.color = "#CB8140"; // å–çš„é»˜è®¤çš®è‚¤æ£’çƒæ£æ·±é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.L; // å¤§
            ball.mRatio = Ball.WEIGHTRATIO.L; // é‡
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.S; // æ…¢
            break;
        case Role.YINGYING.id:
            ball.color = "#2962D9"; // å–çš„é»˜è®¤çš®è‚¤è£™å­æ·±é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.L; // å¤§
            ball.mRatio = Ball.WEIGHTRATIO.S; // è½»
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.JIUWEIHU.id:
            ball.color = "#D76A75"; // å–çš„é»˜è®¤çš®è‚¤å°¾å·´æ·±é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.L; // å¤§
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.S; // æ…¢
            break;
        case Role.SHUANGZI.id:
            if (!ball.color) ball.color = "#3F375A"; // å–çš„é»˜è®¤çš®è‚¤å³è¾¹è§’è‰²çš„è¡£æœé¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.L; // å¤§
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.XL; // å¿«ï¼Œå®æˆ˜è²Œä¼¼æ˜¯æå¿«
            break;
        case Role.X.id: // è‡ªå®šä¹‰è§’è‰²
            ball.color = "#305F6F";
            ball.sizeRatio = Ball.SIZERATIO.M; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.YOUXIA.id:
            ball.color = "#5A5B81"; // å–çš„é»˜è®¤çš®è‚¤è¡£æœé¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.S; // å°
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.L; // å¿«
            break;
        case Role.CHUZI.id:
            ball.color = "#93462A"; // å–çš„é»˜è®¤çš®è‚¤ç«è…¿æ·±é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.M; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.S; // æ…¢
            break;
        case Role.HUAQIANJI.id:
            ball.color = "#4B466C"; // å–çš„é»˜è®¤çš®è‚¤é“ ç”²ä¸­é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.XL; // æå¤§
            ball.mRatio = Ball.WEIGHTRATIO.XL; // æé‡
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // 0.05; // æ— 
            break;
        case Role.WUGEGE.id:
            ball.color = "#784820"; // å–çš„é»˜è®¤çš®è‚¤æƒæ–æ·±é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.S; // å°
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.L; // å¿«
            break;
        case Role.JOKER.id:
            if (!ball.color) ball.color = "#CD1420"; // å–çš„é»˜è®¤çš®è‚¤å¸½å­é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.M; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.RABBIT.id:
            if (!ball.color) ball.color = "#EF5B87"; // å–çš„é»˜è®¤çš®è‚¤è€³æœµä¸­åº¦é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.XS; // æå°
            ball.mRatio = Ball.WEIGHTRATIO.XS; // æè½»
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.XL; // æå¿«
            break;
        case Role.NURSE.id: // å¥¶å¦ˆ
            if (!ball.color) ball.color = "#BFD67B"; // å–çš„é»˜è®¤çš®è‚¤å¤´å‘é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.S; // å°
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.L; // å¿«
            break;
        case Role.CAPTAIN.id:
            if (!ball.color) ball.color = "#4B49BD"; // å–çš„é»˜è®¤çš®è‚¤è¡£æœé¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.L; // å¤§
            ball.mRatio = Ball.WEIGHTRATIO.L; // é‡
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.L; // å¿«
            break;
        case Role.LELE.id:
            if (!ball.color) ball.color = "#CF3B23"; // å–çš„é»˜è®¤çš®è‚¤è¡£æœé¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.M; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.L; // æå¿«ï¼ŒæŒ‡ç¢°åˆ°è§’è‰²åï¼›ä¸åŠ é€Ÿæ—¶æœ€å¤šç®—å¿«
            break;
        case Role.MANWANG.id:
            if (!ball.color) ball.color = "#BE9A8E"; // å–çš„é»˜è®¤çš®è‚¤æŠ¤ç”²æ·±é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.XL; // æå¤§
            ball.mRatio = Ball.WEIGHTRATIO.XL; // æé‡
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.XS; // ææ…¢
            break;
        case Role.LINGLING.id:
            if (!ball.color) ball.color = "#DCD4E5"; // å–çš„é»˜è®¤çš®è‚¤å¤´å‘ä¸­åº¦é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.L; // å¤§
            ball.mRatio = Ball.WEIGHTRATIO.XS; // æè½»
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.HUOWANG.id:
            if (!ball.color) ball.color = "#FCA12E"; // å–çš„é»˜è®¤çš®è‚¤ç«ç„°æ·±é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.M; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.LEIMENG.id:
            if (!ball.color) ball.color = "#FF7896"; // å–é€šè¡Œè¯çš®è‚¤å¤´å‘ä¸­é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.M; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.L; // å¿«
            break;
        case Role.DIANYIN.id:
            if (!ball.color) ball.color = "#98516B"; // å–çš„é»˜è®¤çš®è‚¤å¤´å‘é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.M; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.XS; // æè½»
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.XIXUEGUI.id:
            if (!ball.color) ball.color = "#1C2331"; // å–çš„é»˜è®¤çš®è‚¤è¡£æœé¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.M; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.XS; // æè½»
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.GUISHUSHI.id:
            if (!ball.color) ball.color = "#C47244"; // å–çš„é»˜è®¤çš®è‚¤å¤´å‘é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.M; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.L; // å¿«
            break;
        case Role.MAGICLION.id:
            if (!ball.color) ball.color = "#F3C264"; // å–çš„é»˜è®¤çš®è‚¤è„¸éƒ¨ä¸­åº¦é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.S; // å°
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.XS; // ææ…¢
            break;
        case Role.LANGZAI.id:
            if (!ball.color) ball.color = "#1B1D21"; // å–çš„é»˜è®¤çš®è‚¤æ¯›å‘ä¸­åº¦é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.M; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.L; // å¿«
            break;
        case Role.BZGIRL.id:
            if (!ball.color) ball.color = "#5D524C"; // å–çš„é»˜è®¤çš®è‚¤å¤´å‘é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.S; // å°
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.L; // å¿«
            break;
        case Role.PUMPKIN.id:
            if (!ball.color) ball.color = "#D46E0D"; // ç­¾åˆ°é€çš„çš®è‚¤è„¸éƒ¨é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.M; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.QUANBA.id:
            if (!ball.color) ball.color = "#0282E6"; // å–çš„é»˜è®¤çš®è‚¤æŠ¤å…·é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.S; // å°
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.L; // å¿«
            break;
        case Role.HONGZHAJI.id:
            if (!ball.color) ball.color = "#C0865B"; // å–çš„é»˜è®¤çš®è‚¤TNTç®±å­é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.XL; // æå¤§
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.XS; // ææ…¢
            break;
        case Role.SANTAIZI.id:
            if (!ball.color) ball.color = "#E14039"; // å–é€šè¡Œè¯çš®è‚¤è¡£æœé¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.S; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.ZHADANKE.id:
            if (!ball.color) ball.color = "#9B3620"; // å–çš„é»˜è®¤çš®è‚¤å¤´å‘é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.S; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.HONGSANSAN.id:
            if (!ball.color) ball.color = "#B73B36"; // å–çš„é»˜è®¤çš®è‚¤å¸½å­é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.S; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.WUKONG.id:
            if (!ball.color) ball.color = "#1B1D22"; // å–çš„é»˜è®¤çš®è‚¤å¤´å‘æ·±é¢œè‰²-CC5F22
            ball.sizeRatio = Ball.SIZERATIO.S; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.XL; // å¿«ï¼Œå®æˆ˜æ›´æ¥è¿‘æå¿«
            break;
        case Role.ZHANAN.id:
            if (!ball.color) ball.color = "#4A406D"; // å–çš„é»˜è®¤çš®è‚¤é£è¡Œå™¨ç¿…è†€é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.L; // å¤§
            ball.mRatio = Ball.WEIGHTRATIO.XL; // æé‡
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.S; // æ…¢
            break;
        case Role.XIUNV.id:
            if (!ball.color) ball.color = "#453E3C"; // å–çš„é»˜è®¤çš®è‚¤å¤´å·¾é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.M; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.L; // é‡
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.TONY.id:
            if (!ball.color) ball.color = "#5C4BAD"; // å–çš„é»˜è®¤çš®è‚¤å¤´å‘é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.ML; // å¤§
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.RENZHE.id:
            if (!ball.color) ball.color = "#B0683C"; // å–çš„é»˜è®¤çš®è‚¤æ¯›å‘é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.S; // å°
            ball.mRatio = Ball.WEIGHTRATIO.XS; // æè½»
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.XL; // æå¿«
            break;
        case Role.NUANYANG.id:
            if (!ball.color) ball.color = "#D0C5D5"; // å–çš„é»˜è®¤çš®è‚¤æ¯›å‘é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.L; // å¤§
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.S; // æ…¢
            break;
        case Role.QIANGWEI.id:
            if (!ball.color) ball.color = "#89735E"; // å–çš„é»˜è®¤çš®è‚¤å¤´å‘é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.M; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.XL; // æé‡
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.LANLAN.id:
            if (!ball.color) ball.color = "#B67B73"; // å–çš„é»˜è®¤çš®è‚¤å¤´å‘é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.ML; // åå¤§
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.XL; // æå¿«
            break;
        case Role.KAIER.id:
            if (!ball.color) ball.color = "#855E43"; // å–çš„é»˜è®¤çš®è‚¤å¸½å­é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.ML; // åå¤§
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.SHITOUREN.id:
            if (!ball.color) ball.color = "#75837F"; // å–çš„é»˜è®¤çš®è‚¤çŸ³å¤´é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.XL; // æå¤§
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.XS; // ææ…¢
            break;
        case Role.TIEMIAN.id:
            if (!ball.color) ball.color = "#D69C36"; // å–çš„é»˜è®¤çš®è‚¤é“çš®é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.XL; // æå¤§
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.MIAOJIANG.id:
            if (!ball.color) ball.color = "#FFA9A9"; // å–çš„é»˜è®¤çš®è‚¤è€³æœµé¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.S; // å°
            ball.mRatio = Ball.WEIGHTRATIO.S; // è½»
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.L; // å¿«
            break;
        case Role.MUSHI.id:
            if (!ball.color) ball.color = "#A7B278"; // å–çš„é»˜è®¤çš®è‚¤ä¹¦æœ¬é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.M; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.WUNV.id:
            if (!ball.color) ball.color = "#98747E"; // å–çš„é»˜è®¤çš®è‚¤é¢çº±é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.M; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.LIANGLIANG.id:
            if (!ball.color) ball.color = "#ED736F"; // å–çš„é»˜è®¤çš®è‚¤å¤´å‘é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.S; // å°
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.LAILAI.id:
            if (!ball.color) ball.color = "#AEB34F"; // å–çš„é»˜è®¤çš®è‚¤è„¸éƒ¨é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.S; // å°
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.ZHANGYUGE.id:
            if (!ball.color) ball.color = "#87A8DE"; // å–çš„é»˜è®¤çš®è‚¤è§¦æ‰‹é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.S; // å°
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.XL; // æå¿«
            break;
        case Role.HUABANTU.id:
            if (!ball.color) ball.color = "#403B4A"; // å–çš„é»˜è®¤çš®è‚¤è¡£æœé¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.M; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.L; // å¿«ï¼Œæ”¶å›æ»‘æ¿åæ˜¯æå¿«
            break;
        case Role.NIUXIAOMANG.id:
            if (!ball.color) ball.color = "#E8AC85"; // å–çš„é»˜è®¤çš®è‚¤è„¸éƒ¨é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.ML; // åå¤§
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.XL; // æå¿«
            break;
        case Role.LANPANG.id:
            if (!ball.color) ball.color = "#4B8BE4"; // å–çš„é»˜è®¤çš®è‚¤Tæ¤é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.L; // å¤§
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.XL; // æå¿«
            break;
        case Role.JIANSHI.id:
            if (!ball.color) ball.color = "#48728A"; // å–çš„é»˜è®¤çš®è‚¤å‰‘èº«é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.M; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.S; // è½»
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.L; // å¿«
            break;
        case Role.JUNDUN.id:
            if (!ball.color) ball.color = "#607192"; // å–çš„é»˜è®¤çš®è‚¤å¤´ç›”é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.L; // å¤§
            ball.mRatio = Ball.WEIGHTRATIO.L; // é‡
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.S; // æ…¢
            break;
        case Role.YOUFANG.id:
            if (!ball.color) ball.color = "#D61D38"; // å–é€šè¡Œè¯çš®è‚¤å¤´å‘ä¸­é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.S; // å°
            ball.mRatio = Ball.WEIGHTRATIO.S; // è½»
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.L; // å¿«
            break;
        case Role.MOUSE.id:
            if (!ball.color) ball.color = "#95D850"; // å–çš„é»˜è®¤çš®è‚¤é¢†å·¾é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.XS; // æå°
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.YEREN.id:
            if (!ball.color) ball.color = "#747A51"; // å–é€šè¡Œè¯çš®è‚¤å¤´å‘ä¸­é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.L; // å¤§
            ball.mRatio = Ball.WEIGHTRATIO.L; // é‡
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.BAIGUJING.id:
            if (!ball.color) ball.color = "#D9D7E6"; // å–é€šè¡Œè¯çš®è‚¤å¤´å‘ä¸­é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.M; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.TUYA.id:
            if (!ball.color) ball.color = "#A651EF"; // å–é€šè¡Œè¯çš®è‚¤å¤´å‘ä¸­é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.M; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.XS; // æè½»
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.XL; // æå¿«
            break;
        case Role.YLPAPA.id:
            if (!ball.color) ball.color = "#817CCD"; // å–çš„é»˜è®¤çš®è‚¤è¡£æœæ·±é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.S; // å°
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.XL; // å¿« é€Ÿåº¦åŠ å¿«ä¸€ç‚¹
            break;
        case Role.YURRONG.id:
            if (!ball.color) ball.color = "#DBA9EC"; // å–é€šè¡Œè¯çš®è‚¤æ£‰æœé¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.S; // å°
            ball.mRatio = Ball.WEIGHTRATIO.S; // è½»
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.L; // å¿«
            break;
        case Role.LINGOU.id:
            if (!ball.color) ball.color = "#BAD7FF"; // å–é€šè¡Œè¯çš®è‚¤å¤´å‘é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.M; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.XL; // æå¿«
            break;
        case Role.GOLDKING.id:
            if (!ball.color) ball.color = "#9B9A5A"; // å–é€šè¡Œè¯çš®è‚¤å¤´å·¾é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.M; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.S; // è½»
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.DUDU.id:
            if (!ball.color) ball.color = "#FC3D39"; // å–çš„é€šè¡Œè¯çš®è‚¤é“ ç”²é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.M; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.GEJI.id:
            if (!ball.color) ball.color = "#E4BF93"; // å–é»˜è®¤çš®è‚¤å¤´å‘é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.S; // å°
            ball.mRatio = Ball.WEIGHTRATIO.S; // è½»
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.YUANSU.id:
            if (!ball.color) ball.color = "#E90131"; // å–é»˜è®¤çš®è‚¤å¤´å‘é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.M; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.S; // è½»
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.L; // å¿«
            break;
        case Role.TANGSENG.id:
            if (!ball.color) ball.color = "#B6721C"; // å–é»˜è®¤çš®è‚¤è¢ˆè£Ÿé¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.M; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        default: // é»˜è®¤æ˜¯é»‘å¨ƒ
            ball.color = "#74593A"; // é»˜è®¤çš®è‚¤é¢œè‰²(RosyBrownç«ç‘°æ£•)-CA9480ï¼›è„¸é¢Šè¾¹ç¼˜è„¸çº¢çš„é¢œè‰²(IndianRedå°åº¦çº¢)-A36E5Dï¼›é»‘(Black)-151A14ï¼›æ£•è‰²å¤´å‘(DarkOliveGreenæš—æ©„æ¦„ç»¿)-74593A
            ball.sizeRatio = Ball.SIZERATIO.XS; // æå° é»‘å¨ƒç›´å¾„ 1.8 æ ¼
            ball.mRatio = Ball.WEIGHTRATIO.XS; // æè½»
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.XL; // æå¿«
        //if (ball.isMainBall) ball.v = 60.00;
        //if (ball.isMainBall) userConfig.isShowBallPath = true; // æ˜¯å¦æ˜¾ç¤ºå…¨è·¯å¾„
        //if (ball.isMainBall) userConfig.isStopAfterCollided = true;
    }

    // å…¬å…±å±æ€§è®¾ç½®
    ball.radius = roundNumber((sysConfig.girdSize * ball.sizeRatio / 2), 4);
    if (ball.roleId != Role.KUILEI.id) ball.tryRadius = ball.radius;
    ball.radiusTmp = ball.radius;
    ball.m = roundNumber(ball.mRatio * sysConfig.maxWeightVal, 4);

    console.log(">>>> initBallByRole ball: " + JSON.stringify(ball));

    // localStorage å­˜å‚¨æ›´æ–° userConfig å¯¹è±¡
    //localStorage.setItem('collide-try-user-settings', JSON.stringify(userConfig));
}


// è®¾ç½®å­—ä½“å¤§å°
function setFontSize() {
    if (os.isTablet) {
        // è§’è‰²åæ ‡æ‚¬æµ®æ¡å­—ä½“å¤§å°
        let eles = document.getElementsByClassName("collide-try-role-pos-line-font") || [];
        for (let i = 0, len = eles.length; i < len; i++) {
            eles[i].style.fontSize = Math.round(htmlFontSizeNum * sysConfig.pxRatio) + "px";
        }
    }
}


// æ ¹æ®å®¢æˆ·ç«¯ç±»å‹ï¼Œè‡ªåŠ¨è®¾ç½®é¡µé¢å¤§å°ï¼Œä¿æŒ 14:22 çš„æ¯”ä¾‹
function setPageSize() {
    // æ ¹æ®å®¢æˆ·ç«¯ç±»å‹é€‚é…
    //console.log(">>>> os isPc: " + os.isPc);
    if (os.isPc) {
        canvas.height = document.body.clientHeight * sysConfig.sceneWidthRatio; // ç½‘é¡µå¯è§åŒºåŸŸé«˜ï¼Œé«˜å¤šäº†å¤šä¸€ç‚¹ï¼Œå¯¼è‡´æœ‰å‚ç›´æ»šåŠ¨æ¡ã€‚ç¦ç”¨æ»šåŠ¨å³å¯
        // TODO ç”»å¸ƒæ˜¾ç¤ºå¤§å°ï¼Œé€šè¿‡cssæ ·å¼ç¼©å°ç”»å¸ƒï¼Œè§£å†³å›¾å½¢æ¨¡ç³Šå’Œé”¯é½¿é—®é¢˜
        //sysConfig.girdSizeCss = Math.round(canvas.height / 22);
        //sysConfig.cssWidth = Math.round(sysConfig.girdSizeCss * 14);
        //sysConfig.cssHeight = Math.round(sysConfig.girdSizeCss * 22);
        sysConfig.girdSizeCss = roundNumber(canvas.height / 22, 4);
        sysConfig.cssWidth = roundNumber(sysConfig.girdSizeCss * 14, 4);
        sysConfig.cssHeight = roundNumber(sysConfig.girdSizeCss * 22, 4);
        // ç”»å¸ƒå¤§å°é€‚é… dpr
        //sysConfig.girdSize = Math.round(canvas.height / 22 * dpr);
        //sysConfig.girdSize = Math.round(sysConfig.girdSizeCss * dpr);
        sysConfig.girdSize = roundNumber(sysConfig.girdSizeCss * dpr, 4);
    } else { // å…¶ä»–ï¼Œæ‰‹æœºã€å¹³æ¿
        // TODO æ‰‹æœºæµè§ˆå™¨éå…¨å±æ¨¡å¼ï¼Œé«˜åº¦çœ‹ç€æ²¡å±…ä¸­ï¼Œä½†è¿›å…¥å…¨å±æ¨¡å¼åï¼Œæ°´å¹³ã€å‚ç›´éƒ½æ˜¯å±…ä¸­çš„
        // 400-712-2.7
        //alert(">>>> å±å¹•åˆ†è¾¨ç‡-width: " + window.screen.width + ", å±å¹•åˆ†è¾¨ç‡-height: " + window.screen.height);
        //alert(">>>> ç½‘é¡µå¯è§åŒºåŸŸ-width: " + document.body.clientWidth + ", ç½‘é¡µå¯è§åŒºåŸŸ-height: " + document.body.clientHeight);
        //alert(">>>> å±å¹•å¯ç”¨å·¥ä½œåŒºåŸŸ-width: " + window.screen.availWidth + ", å±å¹•å¯ç”¨å·¥ä½œåŒºåŸŸ-height: " + window.screen.availHeight);
        //canvas.width = window.screen.width * sysConfig.sceneWidthRatio;
        canvas.width = document.body.clientWidth * sysConfig.sceneWidthRatio;
        //canvas.width = document.body.clientWidth * 0.8; // ç½‘é¡µå¯è§åŒºåŸŸå®½
        //canvas.width = window.screen.availWidth * 0.8; // å±å¹•å¯ç”¨å·¥ä½œåŒºåŸŸå®½åº¦
        sysConfig.girdSizeCss = roundNumber(canvas.width / 14, 4);
        sysConfig.cssWidth = roundNumber(sysConfig.girdSizeCss * 14, 4);
        sysConfig.cssHeight = roundNumber(sysConfig.girdSizeCss * 22, 4);
        sysConfig.girdSize = roundNumber(sysConfig.girdSizeCss * dpr, 4);

        /*
        // TODO ä¸åŒæ‰‹æœºæµè§ˆå™¨å·¥å…·æ é«˜åº¦ä¸åŒï¼Œå¾ˆå¯èƒ½å¯¼è‡´å¯è§é«˜åº¦æ˜¾ç¤ºä¸ä¸‹ç”»å¸ƒï¼é€‚é…çš„é«˜åº¦ä¸èƒ½è¶…è¿‡ç½‘é¡µå¯è§é«˜åº¦ï¼Œ
        // è¶…è¿‡åˆ™æŒ‰ç½‘é¡µå¯è§é«˜åº¦é‡æ–°é€‚é…ã€æ­£å¸¸æƒ…å†µé«˜åº¦ä¸ä¼šæ˜¾ç¤ºä¸ä¸‹ã€‘
        let ph = document.body.clientHeight;
        if (canvas.height > ph) {
            console.log(">>>> canvas é«˜åº¦è¶…å‡ºç½‘é¡µå¯è§é«˜åº¦ï¼ŒæŒ‰ç½‘é¡µå¯è§é«˜åº¦é‡æ–°é€‚é…...");
            canvas.height = ph * 0.8;
            sysConfig.girdSizeCss = roundNumber(canvas.height / 22, 4);
            sysConfig.cssWidth = roundNumber(sysConfig.girdSizeCss * 14, 4);
            sysConfig.cssHeight = roundNumber(sysConfig.girdSizeCss * 22, 4);
            sysConfig.girdSize = roundNumber(sysConfig.girdSizeCss * dpr, 4);
        }
        */

        //alert(">>>> canvas width: " + canvas.width + ", canvas height: " + canvas.height);
    }


    canvas.width = roundNumber(sysConfig.girdSize * 14, 4);
    canvas.height = roundNumber(sysConfig.girdSize * 22, 4);
    canvas.style.width = sysConfig.cssWidth + 'px';
    canvas.style.height = sysConfig.cssHeight + 'px';
    // ç›´æ¥ç”¨ scale æ”¾å¤§æ•´ä¸ªåæ ‡ç³»ï¼Œç›¸å¯¹æ¥è¯´å°±æ˜¯æ”¾å¤§äº†æ¯ä¸ªç»˜åˆ¶æ“ä½œ
    //context.scale(dpr, dpr);
    console.log(">>>> canvas width: " + canvas.width + ", canvas height: " + canvas.height);
    console.log(">>>> canvas cssWidth: " + sysConfig.cssWidth + ", canvas cssHeight: " + sysConfig.cssHeight);


    // é™æ€åœºæ™¯å¤§é¢ç§¯åŒºåŸŸæ™¯ç‰©å›¾å½¢å±‚ç”»å¸ƒè®¾ç½®å…¨å±å®½é«˜
    gameSceneGraphCanvas.width = document.body.clientWidth * dpr;
    gameSceneGraphCanvas.height = document.body.clientHeight * dpr;
    gameSceneGraphCanvas.style.width = document.body.clientWidth + 'px';
    gameSceneGraphCanvas.style.height = document.body.clientHeight + 'px';

    // é™æ€åœºæ™¯æ™¯ç‰©å›¾å½¢å±‚ç”»å¸ƒè®¾ç½®å…¨å±å®½é«˜
    gameSceneEmojiCanvas.width = document.body.clientWidth * dpr;
    gameSceneEmojiCanvas.height = document.body.clientHeight * dpr;
    gameSceneEmojiCanvas.style.width = document.body.clientWidth + 'px';
    gameSceneEmojiCanvas.style.height = document.body.clientHeight + 'px';

    // é™æ€åœºæ™¯å±‚ç”»å¸ƒå¤åˆ¶ã€ä¸»è¿åŠ¨å±‚ç”»å¸ƒã€‘å®½é«˜
    gameSceneCanvas.width = canvas.width;
    gameSceneCanvas.height = canvas.height;
    gameSceneCanvas.style.width = sysConfig.cssWidth + 'px';
    gameSceneCanvas.style.height = sysConfig.cssHeight + 'px';

    // é™æ€åœºæ™¯è¾¹ç•Œçº¿ç”»å¸ƒè®¾ç½®å…¨å±å®½é«˜
    gameSceneLinesCanvas.width = document.body.clientWidth * dpr;
    gameSceneLinesCanvas.height = document.body.clientHeight * dpr;
    gameSceneLinesCanvas.style.width = document.body.clientWidth + 'px';
    gameSceneLinesCanvas.style.height = document.body.clientHeight + 'px';

    // é™æ€åœºæ™¯è¾¹ç•Œçº¿èƒŒæ™¯ç”»å¸ƒè®¾ç½®å…¨å±å®½é«˜
    gameSceneLinesBgCanvas.width = document.body.clientWidth * dpr;
    gameSceneLinesBgCanvas.height = document.body.clientHeight * dpr;
    gameSceneLinesBgCanvas.style.width = document.body.clientWidth + 'px';
    gameSceneLinesBgCanvas.style.height = document.body.clientHeight + 'px';

    // é™æ€åœºæ™¯ç –æ ¼è¾¹æ¡†å±‚è®¾ç½®å…¨å±å®½é«˜
    gameSceneCoordinateCanvas.width = document.body.clientWidth * dpr;
    gameSceneCoordinateCanvas.height = document.body.clientHeight * dpr;
    gameSceneCoordinateCanvas.style.width = document.body.clientWidth + 'px';
    gameSceneCoordinateCanvas.style.height = document.body.clientHeight + 'px';

    // ä¸»çƒè¿åŠ¨å±‚ç”»å¸ƒå¤åˆ¶ã€ä¸»è¿åŠ¨å±‚ç”»å¸ƒã€‘å®½é«˜
    gameMainBallCanvas.width = canvas.width;
    gameMainBallCanvas.height = canvas.height;
    gameMainBallCanvas.style.width = sysConfig.cssWidth + 'px';
    gameMainBallCanvas.style.height = sysConfig.cssHeight + 'px';

    // è·¯å¾„å±‚ç”»å¸ƒå¤åˆ¶ã€ä¸»è¿åŠ¨å±‚ç”»å¸ƒã€‘å®½é«˜
    gamePathCanvas.width = canvas.width;
    gamePathCanvas.height = canvas.height;
    gamePathCanvas.style.width = sysConfig.cssWidth + 'px';
    gamePathCanvas.style.height = sysConfig.cssHeight + 'px';

    // å…¨è·¯å¾„å±‚ç”»å¸ƒå¤åˆ¶ã€ä¸»è¿åŠ¨å±‚ç”»å¸ƒã€‘å®½é«˜
    gamePathBallCanvas.width = canvas.width;
    gamePathBallCanvas.height = canvas.height;
    gamePathBallCanvas.style.width = sysConfig.cssWidth + 'px';
    gamePathBallCanvas.style.height = sysConfig.cssHeight + 'px';

    // é®ç½©å±‚ç”»å¸ƒå¤åˆ¶ã€ä¸»è¿åŠ¨å±‚ç”»å¸ƒã€‘å®½é«˜
    gameMaskCanvas.width = canvas.width;
    gameMaskCanvas.height = canvas.height;
    gameMaskCanvas.style.width = sysConfig.cssWidth + 'px';
    gameMaskCanvas.style.height = sysConfig.cssHeight + 'px';


    // é€‰æ‹©è§’è‰²å¼¹çª—å¤åˆ¶å®½åº¦
    chooseRoleDialog.width = canvas.width;
    chooseRoleDialog.style.width = sysConfig.cssWidth + 'px';
    // ç”¨æˆ·è®¾ç½®å¼¹çª—å¤åˆ¶å®½åº¦
    userSettingDialog.width = canvas.width;
    userSettingDialog.style.width = sysConfig.cssWidth + 'px';
    // ä¸»è§’è®¾ç½®æç¤ºå¼¹çª—å¤åˆ¶å®½åº¦
    //gameSettingMainRoleDialog.width = canvas.width;
    //gameSettingMainRoleDialog.style.width = sysConfig.cssWidth + 'px';
    // ç”¨æˆ·è®¾ç½®-å…³äºåº”ç”¨å¼¹çª—å¤åˆ¶å®½åº¦
    aboutAppDialog.width = canvas.width;
    aboutAppDialog.style.width = sysConfig.cssWidth + 'px';
    // æ›´æ–°å†…å®¹æç¤ºå¼¹çª—å¤åˆ¶å®½åº¦
    updateContentDialog.width = canvas.width;
    updateContentDialog.style.width = sysConfig.cssWidth + 'px';
    // æ“ä½œæŒ‡å—æç¤ºå¼¹çª—å¤åˆ¶å®½åº¦
    howToPlayDialog.width = canvas.width;
    howToPlayDialog.style.width = sysConfig.cssWidth + 'px';


    // ç”»å¸ƒæœ€å¼€å§‹æ˜¯éšè—çš„ï¼Œè°ƒæ•´å¤§å°åï¼Œè®¾ç½®ä¸ºé»˜è®¤æ˜¾ç¤º
    gameSceneCanvas.style.display = "unset"; // é™æ€åœºæ™¯å±‚ç”»å¸ƒæ¢å¤æ˜¾ç¤º
    canvas.style.display = "unset"; // ä¸»è¿åŠ¨å±‚æ¢å¤æ˜¾ç¤º
    gameMainBallCanvas.style.display = "unset"; // ä¸»çƒè¿åŠ¨å±‚ç”»å¸ƒæ¢å¤æ˜¾ç¤º
    //gamePathCanvas.style.display = "unset"; // è·¯å¾„å±‚ç”»å¸ƒæ¢å¤æ˜¾ç¤º
    //gamePathBallCanvas.style.display = "unset"; // å…¨è·¯å¾„å±‚ç”»å¸ƒæ¢å¤æ˜¾ç¤º
    gameMaskCanvas.style.display = "unset"; // é®ç½©å±‚æ™¯ç”»å¸ƒæ¢å¤æ˜¾ç¤º
    document.body.style.overflow = 'hidden'; //ç¦æ­¢é¡µé¢æ»šåŠ¨ï¼Œå…è®¸æ˜¯ visible
}


// è®¾ç½®å¼¹çª—å¯æ»šåŠ¨åŒºåŸŸé«˜åº¦ã€ä¾èµ– canvas å®½é«˜ã€‘
// height = Math.round(width * 1.63)
function setDialogScrollMaxHeight(hRadio) {
    //let targetHeight = Math.round(canvas.width * hRadio);
    let targetCssHeight = Math.round(sysConfig.cssWidth * hRadio);
    //let targetCssHeight = Math.round(document.body.clientHeight * hRadio);

    // é«˜åº¦ä¸èƒ½è¶…è¿‡æˆ–å¤ªæ¥è¿‘é¡µé¢å¯è§é«˜åº¦
    //if (targetHeight >= gameSceneCanvas.height - 40) targetHeight = Math.round(gameSceneCanvas.height * 0.85);
    if (targetCssHeight >= document.body.clientHeight * 0.90) targetCssHeight = Math.round(document.body.clientHeight * 0.80);

    // é€‰æ‹©è§’è‰²åˆ—è¡¨
    let targetElm = document.getElementById('role-list-area');
    if (targetElm) {
        targetElm.style.maxHeight = targetCssHeight + 'px';
    }
    // å‚æ•°è®¾ç½®åˆ—è¡¨
    targetElm = document.getElementById('user-setting-area');
    if (targetElm) {
        targetElm.style.maxHeight = targetCssHeight + 'px';
    }
    // å…³äºåº”ç”¨å†…å®¹åˆ—è¡¨
    targetElm = document.getElementById('user-setting-about-app-content');
    if (targetElm) {
        targetElm.style.maxHeight = targetCssHeight + 'px';
    }
}


// canvas ç”»å¸ƒå±…ä¸­æ˜¾ç¤ºï¼Œéœ€è¦ç§»åŠ¨ canvas ç”»å¸ƒåæ ‡
function canvasAutoCenter() {
    if (os.isPc) { // PC ç«¯
        // canvas ç”»å¸ƒæ°´å¹³ã€å‚ç›´ç§»åŠ¨åˆ°ä¸­é—´
        let w = document.body.clientWidth;
        let h = document.body.clientHeight;
        console.log(">>>> clientWidth:" + w + ", clientHeight:" + h);
        sysConfig.cLeft = roundNumber((w - sysConfig.cssWidth) / 2, 4);
        sysConfig.cTop = roundNumber((h - sysConfig.cssHeight) / 2, 4);
        if (sysConfig.cLeft < 0) sysConfig.cLeft = 0;
        if (sysConfig.cTop < 0) sysConfig.cTop = 0;
        canvas.style.left = sysConfig.cLeft + "px";
        canvas.style.top = sysConfig.cTop + "px";
        console.log(">>>> sysConfig.cLeft:" + sysConfig.cLeft + ", sysConfig.cTop:" + sysConfig.cTop);
        //canvas.style.transform = "translate(" + (w - canvas.width) / 2 + "px, " + (h - canvas.height) / 2 + "px)";
        // ç§»åŠ¨ canvas åæ ‡ç³»ï¼Œæš‚æ—¶ä¸å¤ªä¼šæ“ä½œ
        //context.translate(Math.round((w - canvas.width) / 2), Math.round((h - canvas.height) / 2));
    } else { // ç§»åŠ¨ç«¯
        // canvas ç”»å¸ƒæ°´å¹³ã€å‚ç›´ç§»åŠ¨åˆ°ä¸­é—´
        // å±å¹•åˆ†è¾¨ç‡å®½é«˜
        //let w = window.screen.width;
        //let h = window.screen.height;
        // ç½‘é¡µå¯è§åŒºåŸŸå®½é«˜
        let w = document.body.clientWidth;
        let h = document.body.clientHeight;
        console.log(">>>> clientWidth:" + w + ", clientHeight:" + h);
        sysConfig.cLeft = roundNumber((w - sysConfig.cssWidth) / 2, 4);
        sysConfig.cTop = roundNumber((h - sysConfig.cssHeight) / 2, 4);
        if (sysConfig.cLeft < 0) sysConfig.cLeft = 0;
        if (sysConfig.cTop < 0) sysConfig.cTop = 0;
        canvas.style.left = sysConfig.cLeft + "px";
        canvas.style.top = sysConfig.cTop + "px";
        console.log(">>>> sysConfig.cLeft:" + sysConfig.cLeft + ", sysConfig.cTop:" + sysConfig.cTop);
    }

    // é™æ€åœºæ™¯å±‚ç”»å¸ƒå±…ä¸­
    gameSceneCanvas.style.left = sysConfig.cLeft + "px";
    gameSceneCanvas.style.top = sysConfig.cTop + "px";
    // ä¸»çƒè¿åŠ¨å±‚ç”»å¸ƒå±…ä¸­
    gameMainBallCanvas.style.left = sysConfig.cLeft + "px";
    gameMainBallCanvas.style.top = sysConfig.cTop + "px";
    // è·¯å¾„å±‚ç”»å¸ƒå±…ä¸­
    gamePathCanvas.style.left = sysConfig.cLeft + "px";
    gamePathCanvas.style.top = sysConfig.cTop + "px";
    // å…¨è·¯å¾„å±‚ç”»å¸ƒå±…ä¸­
    gamePathBallCanvas.style.left = sysConfig.cLeft + "px";
    gamePathBallCanvas.style.top = sysConfig.cTop + "px";
    // é®ç½©å±‚ç”»å¸ƒå±…ä¸­
    gameMaskCanvas.style.left = sysConfig.cLeft + "px";
    gameMaskCanvas.style.top = sysConfig.cTop + "px";
}


// è®¾ç½®ç‚¹æŒ‰å‘å°„æŒ‰é’®ç”»å¸ƒå¤§å°å’Œä½ç½®
function setClickPlayCanvas() {
    // è®¾ç½®å›¾å±‚ä¸ºæ˜¾ç¤º
    if (userConfig.currPlayOpt === 1) gameClickPlayCanvas.style.display = "unset";
    // è®¾ç½®å¤§å°ä¸º 1.68 * 2 æ ¼
    gameClickPlayCanvas.width = roundNumber(sysConfig.girdSize * 1.68 * 2, 4);
    gameClickPlayCanvas.height = roundNumber(sysConfig.girdSize * 1.68 * 2, 4);
    gameClickPlayCanvas.style.width = roundNumber(sysConfig.girdSizeCss * 1.68 * 2, 4) + "px";
    gameClickPlayCanvas.style.height = roundNumber(sysConfig.girdSizeCss * 1.68 * 2, 4) + "px";

    // è®¾ç½®ä½ç½®ï¼Œå³ä¸‹è§’ï¼Œyè·ç¦»ä¸‹å¢™é¢2.2æ ¼ï¼Œè·ç¦»å³å¢™é¢2.2æ ¼
    gameClickPlayCanvas.style.left = roundNumber(sysConfig.cLeft + sysConfig.girdSizeCss * 11.8, 4) + "px";
    gameClickPlayCanvas.style.top = roundNumber(sysConfig.cTop + sysConfig.girdSizeCss * (19.8 - 1.68 * 2), 4) + "px";
}


// è®¾ç½®å››æ ¹åˆ‡è§’çº¿
function set4AngleLine() {
    lines = []; // é¿å…é‡å¤æ·»åŠ 
    // TODO ä¸Šé¢ä¸¤ä¸ªåˆ‡è§’ï¼Œèµ·ç‚¹é€‰xåæ ‡å°çš„ï¼Œç¡®ä¿æ—‹è½¬åå°çƒç¢°æ’å‰çš„ç›¸å¯¹åæ ‡yä¸ºæ­£
    lines.push(new Line(context, { // å·¦ä¸Š
        x1: 0,
        y1: Math.round(sysConfig.girdSize * 3 + sysConfig.wan8CocosTableMoveVals[0]),
        x2: Math.round(sysConfig.girdSize * 3 + sysConfig.wan8CocosTableMoveVals[1]),
        y2: 0
    }));
    lines.push(new Line(context, { // å³ä¸Š
        x1: Math.round(sysConfig.girdSize * 11 + sysConfig.wan8CocosTableMoveVals[2]),
        y1: 0,
        x2: canvas.width,
        y2: Math.round(sysConfig.girdSize * 3 + sysConfig.wan8CocosTableMoveVals[3])
    }));
    // ä¸‹é¢ä¸¤ä¸ªåˆ‡è§’ï¼Œèµ·ç‚¹é€‰xåæ ‡å¤§çš„
    lines.push(new Line(context, { // å³ä¸‹
        x2: Math.round(sysConfig.girdSize * 11 + sysConfig.wan8CocosTableMoveVals[5]),
        y2: canvas.height,
        x1: canvas.width,
        y1: Math.round(sysConfig.girdSize * 19 + sysConfig.wan8CocosTableMoveVals[4])
    }));
    lines.push(new Line(context, { // å·¦ä¸‹
        x2: 0,
        y2: Math.round(sysConfig.girdSize * 19 + sysConfig.wan8CocosTableMoveVals[7]),
        x1: Math.round(sysConfig.girdSize * 3 + sysConfig.wan8CocosTableMoveVals[6]),
        y1: canvas.height
    }));
}


// è®¾ç½®å››æ¡åˆ‡è§’çº¿ä¸­ç‚¹åæ ‡
function set4AngleLineMiddlePoint(lines) {
    linesMiddlePoints = []; // é¿å…é‡å¤æ·»åŠ 
    lines.some(line => {
        let p = getLineMiddlePoint({ x: line.x1, y: line.y1 }, { x: line.x2, y: line.y2 });
        //console.log(">>>> p=" + JSON.stringify(p));
        linesMiddlePoints.push(p);
    });
}


// æ±‚çº¿æ®µä¸­ç‚¹åæ ‡
function getLineMiddlePoint(p1, p2) {
    let p = { x: 0, y: 0 };
    //p.x = Math.round(Math.min(p1.x, p2.x) + (Math.abs(p1.x - p2.x) / 2)); // ä¼šå¯¼è‡´ä¸€ç‚¹ç‚¹è¯¯å·®
    p.x = Math.min(p1.x, p2.x) + (Math.abs(p1.x - p2.x) / 2);
    //p.y = Math.round(Math.min(p1.y, p2.y) + (Math.abs(p1.y - p2.y) / 2));
    p.y = Math.min(p1.y, p2.y) + (Math.abs(p1.y - p2.y) / 2);
    return p;
}


// æ±‚ä¸¤ç‚¹ä¹‹é—´çš„è·ç¦»
function getDistanceOf2Points(p1, p2) {
    let a = roundNumber(Math.abs(p2.x - p1.x), 4);
    let b = roundNumber(Math.abs(p2.y - p1.y), 4);
    let c = roundNumber(Math.sqrt(a * a + b * b), 4);
    return c;
}


// è·å–ç¦»å°çƒæœ€è¿‘çš„ä¸€æ¡åˆ‡è§’çº¿ä¸‹æ ‡
function getOneAngleLineIndex(ball) {
    let idx = 0;
    let distance = canvas.height;
    for (let i = 0; i < linesMiddlePoints.length; i++) {
        let d = getDistanceOf2Points({ x: ball.x, y: ball.y }, { x: linesMiddlePoints[i].x, y: linesMiddlePoints[i].y });
        //console.log(">>>> distance=" + d);
        if (d < distance) {
            distance = d;
            idx = i;
        }
    }
    //console.log(">>>> line index=" + idx);
    return idx;
}


// æ¸…é™¤è®¾ç½®åˆ†äº«æ•°æ®
function clearShareRoleAndPos() {
    // åŠ è½½ä¹‹åï¼Œæ¸…é™¤å¯¼å…¥æ•°æ®
    shareData = null;
    userConfig.shareRoleAndPos = "";
    localStorage.setItem('collide-try-user-settings', JSON.stringify(userConfig));
    console.log(">>>> clearShareRoleAndPos userConfig in localStorage updated.");
}


// åŠ è½½è®¾ç½®åˆ†äº«æ•°æ®
function setShareRoleAndPos(shareData) {
    balls = [];
    let sBall;
    for (let i = 0, len = shareData.length; i < len; i++) {
        sBall = shareData[i];
        // ç –æ ¼è½¬åƒç´ 
        //let pos = {x:sBall.x, y:sBall.y};
        switchPxOrGird(sBall, 1);
        let ctx = context;
        if (sBall.m) ctx = gameMainBallContext;
        let shareBall = new Ball(ctx, {
            no: sBall.no,
            color: sBall.rc,
            teamColor: sBall.tc,
            roleId: sBall.rid,
            isMainBall: sBall.m ? true : false,
            x: roundNumber(sBall.x, 4),
            y: roundNumber(sBall.y, 4),
        });
        // åˆå§‹åŒ–å…¶ä»–å‚æ•°
        initBallByRole(shareBall);

        shareBall.x0 = shareBall.x;
        shareBall.y0 = shareBall.y;
        balls.push(shareBall);
    }

    // é‡ç½®è§’è‰²ç¼–å·
    //resetMainTeamNo(balls);

    // æ˜¯å¦ä¸ºä¸€ä¸ªè§’è‰²æµ‹è¯•
    if (balls.length < 4) userConfig.isTestOnlyOne = true;
    else userConfig.isTestOnlyOne = false;

    // å•ç‹¬è®¾ç½®å°ä¸‘åˆ†èº«é¢œè‰²ï¼Œå› ä¸ºå¯¼å…¥å¯¼å‡ºæ•°æ®æ²¡æœ‰è®°å½•è§’è‰²é¢œè‰²ï¼ŒroleIdåˆå§‹åŒ–è§’è‰²é‡Œé¢æ²¡æœ‰é…ç½®åˆ†èº«
    setJoker2Color();
}


// è®¾ç½®ä¸»çƒã€æ”¹ä½ç½®ã€‘
function setBallMain() {
    let mainBall = new Ball(gameMainBallContext, {
        no: 1,
        teamColor: 'b',
        roleId: userConfig.currRole, // ä¸»çƒå¯¹åº”è§’è‰²
        isMainBall: true, // ä¸»çƒ
        x: sysConfig.girdSize * 7, // æ°´å¹³å±…ä¸­
        //x: sysConfig.girdSize * 1,
        //x: sysConfig.girdSize * 4,
        //x: sysConfig.girdSize * 5,
        y: sysConfig.girdSize * 11, // å‚ç›´å±…ä¸­
        //y: sysConfig.girdSize * 9,
        //y: sysConfig.girdSize * 4,
        vx: 0,
        vy: 0
    });
    // åˆå§‹åŒ–å…¶ä»–å‚æ•°
    initBallByRole(mainBall);
    // è®¾ç½®éšæœºä½ç½®åæ ‡
    putBallRandom(mainBall);

    mainBall.x0 = mainBall.x;
    mainBall.y0 = mainBall.y;
    balls.push(mainBall);
}


// éšæœºæ”¾ç½®è§’è‰²å°çƒ
function putBallRandom(ball) {
    // è®¾ç½®éšæœºä½ç½®åæ ‡
    let randomPoint = getRandomPoint(ball.radius);
    ball.x = randomPoint.x;
    ball.y = randomPoint.y;

    // ä½ç½®é‡å æ£€æµ‹
    while (checkBallsCollided(ball)) {
        console.log(">>>> putBallRandom checkBallsCollided " + ball.getBallDesc() + " collided.");
        randomPoint = getRandomPoint(ball.radius);
        ball.x = randomPoint.x;
        ball.y = randomPoint.y;
    }

    ball.x = roundNumber(ball.x, 4);
    ball.y = roundNumber(ball.y, 4);
}


// éšæœºæ”¾ç½®æ‰€æœ‰è§’è‰²å°çƒ
function putAllBallsRandom() {
    if (!balls || balls.length < 1) return;
    balls.some(ball => {
        // åŒå­åˆ†èº«é™¤å¤–
        if (ball.roleId === Role.SHUANGZI.id && ball.isRoleBuddy()) return;
        putBallRandom(ball);
    });
}


// éšæœºæ”¾ç½®æ¼©æ¶¡ä½ç½®
function putWhirlpoolRandom() {

}


// æ ¹æ®æ‰€é€‰ä¸»è§’ï¼Œåˆå§‹åŒ–ä¸»è§’ä¹‹å¤–çš„ä¸‰ä¸ªè§’è‰²
function setBallOthersByRole(roleId) {
    if (!roleId) roleId = Role.HEIWA.id;
    let otherRoles = [];

    if (userConfig.isFlashRole) { // æé€Ÿå¼€å§‹ï¼Œå¸¸ç”¨ç»„åˆ
        let flashGroup = setRolesFlash(userConfig.gameRoleIds, false);
        otherRoles = flashGroup.slice(1);
    } else if (userConfig.isRandomRole) { // å…¨éšæœºè§’è‰²
        setRolesRandom(otherRoles);
    } else { // ä¸»è§’+å¸¸ç”¨ç»„åˆ
        switch (roleId) {
            //case Role.HEIWA.id: // èµ°é»˜è®¤
            case Role.JIANGJIANG.id:
                //otherRoles = [Role.JIUWEIHU.id, Role.JIUWEIHU.id, Role.HEIWA.id];
                //otherRoles = [Role.LULU.id, Role.JIANGJIANG.id, Role.LULU.id];
                //otherRoles = [Role.LULU.id, Role.KUILEI.id, Role.YINGYING.id];
                //otherRoles = [Role.LULU.id, Role.DUODUO.id, Role.CHUZI.id];
                //otherRoles = [Role.LULU.id, Role.SHUANGZI.id, Role.YOUXIA.id];
                //otherRoles = [Role.KUKU.id, Role.DUODUO.id, Role.HUAQIANJI.id];
                //otherRoles = [Role.LULU.id, Role.KUILEI.id, Role.JOKER.id];
                //otherRoles = [Role.KUKU.id, Role.JOKER.id, Role.WUGEGE.id];
                //otherRoles = [Role.LULU.id, Role.BAKE.id, Role.DUODUO.id];
                //otherRoles = [Role.KUKU.id, Role.BAKE.id, Role.DUODUO.id];
                //otherRoles = [Role.KUKU.id, Role.JOKER.id, Role.RABBIT.id];
                otherRoles = [];
                let mainCp = Role.JIANGJIANG.cps[fullCloseInt(0, Role.JIANGJIANG.cps.length - 1)]; // ä¸»è§’æ­é…
                //console.log(">>>> mainCp=", mainCp);
                otherRoles.push(mainCp);
                let otherCps = RegularlyCollocation.getRandomGroup(); // å¯¹æ‰‹æ­é…
                //console.log(">>>> otherCps=" + otherCps.toString());
                otherRoles = otherRoles.concat(otherCps);
                //if (sysConfig.isSayGoodbye && !isProd()) otherRoles = [Role.KUKU.id, Role.BAKE.id, Role.RABBIT.id];
                //console.log(">>>> otherRoles=" + otherRoles.toString());
                break;
            case Role.DUODUO.id:
                //otherRoles = [Role.BAKE.id, Role.KUILEI.id, Role.YINGYING.id];
                //otherRoles = [Role.BAKE.id, Role.DUODUO.id, Role.BAKE.id];
                otherRoles = [Role.DUODUO.cps[fullCloseInt(0, Role.DUODUO.cps.length - 1)]].concat(RegularlyCollocation.getRandomGroup());
                //if (sysConfig.isSayGoodbye && !isProd()) otherRoles = [Role.BAKE.id, Role.JOKER.id, Role.DIANYIN.id];
                break;
            case Role.KUILEI.id:
                //otherRoles = [Role.YINGYING.id, Role.BAKE.id, Role.DUODUO.id];
                //otherRoles = [Role.JOKER.id, Role.BAKE.id, Role.DUODUO.id];
                otherRoles = [Role.KUILEI.cps[fullCloseInt(0, Role.KUILEI.cps.length - 1)]].concat(RegularlyCollocation.getRandomGroup());
                //if (sysConfig.isSayGoodbye && !isProd()) otherRoles = [Role.JOKER.id, Role.JIANGJIANG.id, Role.MANWANG.id];
                break;
            case Role.SHUANGZI.id:
                //otherRoles = [Role.JOKER.id, Role.JOKER.id, Role.RABBIT.id];
                //otherRoles = [Role.JOKER.id, Role.SHUANGZI.id, Role.RABBIT.id];
                //otherRoles = [Role.JOKER.id, Role.LEIMENG.id, Role.JIUWEIHU.id];
                otherRoles = [Role.SHUANGZI.cps[fullCloseInt(0, Role.SHUANGZI.cps.length - 1)]].concat(RegularlyCollocation.getRandomGroup());
                //if (sysConfig.isSayGoodbye && !isProd()) otherRoles = [Role.DIANYIN.id, Role.BAKE.id, Role.RABBIT.id];
                break;
            case Role.KUKU.id:
                //otherRoles = [Role.HEIWA.id, Role.BAKE.id, Role.DUODUO.id];
                otherRoles = [Role.HEIWA.id].concat(RegularlyCollocation.getRandomGroup());
                //if (sysConfig.isSayGoodbye && !isProd()) otherRoles = [Role.HEIWA.id, Role.BAKE.id, Role.DUODUO.id];
                break;
            case Role.LELE.id:
                otherRoles = [Role.LELE.cps[fullCloseInt(0, Role.LELE.cps.length - 1)]].concat(RegularlyCollocation.getRandomGroup());
                //if (sysConfig.isSayGoodbye && !isProd()) otherRoles = [Role.HEIWA.id, Role.CAPTAIN.id, Role.YINGYING.id];
                break;
            default:
                //otherRoles = [Role.WUGEGE.id, Role.LULU.id, Role.WUGEGE.id];
                //otherRoles = [Role.KUKU.id, Role.LULU.id, Role.JIANGJIANG.id];
                //otherRoles = [Role.JIUWEIHU.id, Role.JIUWEIHU.id, Role.JIANGJIANG.id];
                //otherRoles = [Role.KUKU.id, Role.BAKE.id, Role.DUODUO.id];
                //otherRoles = [Role.RABBIT.id, Role.RABBIT.id, Role.BAKE.id];
                otherRoles = [Role.HEIWA.cps[fullCloseInt(0, Role.HEIWA.cps.length - 1)]].concat(RegularlyCollocation.getRandomGroup());
            //if (sysConfig.isSayGoodbye && !isProd()) otherRoles = [Role.LULU.id, Role.SANTAIZI.id, Role.LEIMENG.id];
        }
    }

    // ééšæœºæ¨¡å¼ï¼Œæœ‰æŒ‡å®šè§’è‰²ï¼Œåˆ™æ›¿æ¢è§’è‰²id
    if (!userConfig.isRandomRole && isUseGameRoleIds()) {
        for (let i = 0, len = userConfig.gameRoleIds.length; i < len; i++) {
            if (i === 0) continue; // ç¬¬ä¸€ä¸ªä¸ºä¸»è§’ï¼Œè¿™é‡Œæ˜¯è®¾ç½®ä¸»è§’ä¹‹å¤–çš„è§’è‰²ï¼Œæ‰€ä»¥æ’é™¤ä¸»è§’
            //if (userConfig.gameRoleIds[i] < 0) continue;
            otherRoles[i - 1] = userConfig.gameRoleIds[i];
        }
    }

    // æ£€æµ‹è§’è‰²id
    doCkeckOtherRoles(otherRoles);
    console.log(">>>> setBallOthersByRole otherRoles=" + otherRoles);

    // å…¬å…±è®¾ç½®
    setRoleOthers(otherRoles);
}


// ä¸»è§’å·²ç»è®¾ç½®äº†ï¼Œè¿™é‡Œåªç”¨è®¾ç½®å…¶ä»–ä¸‰ä¸ªè¾…åŠ©è§’è‰²åŠåˆ†èº«
function setRolesRandom(otherRoles) {
    let rid;
    for (let i = 2; i <= 4; i++) { // è®¾ç½® 2ã€3ã€4 å·è§’è‰²
        // åŒé˜Ÿè§’è‰²ä¸èƒ½ä¸€æ ·ã€‚å³ç¼–å·1ã€2è§’è‰²ä¸èƒ½ä¸€æ ·ï¼›3ã€4ä¹Ÿä¸èƒ½ä¸€æ ·
        rid = Role.getRandomRoleId();
        while (i === 2 && rid === userConfig.currRole) { // ä¸èƒ½å’Œä¸»è§’ä¸€æ ·
            rid = Role.getRandomRoleId();
        }
        while (i === 4 && rid === otherRoles[1]) { // ä¸èƒ½å’Œé˜Ÿå‹ä¸€æ ·
            rid = Role.getRandomRoleId();
        }
        otherRoles.push(rid);
    }
}


// è®¾ç½®æé€Ÿå¼€å§‹ï¼Œè¡¥å…¨å¸¸ç”¨ç»„åˆ
function setRolesFlash(roleIds, isSetCurrRole) {
    if (!roleIds) roleIds = userConfig.gameRoleIds;
    let flashRoles = [];
    // æœ‰æŒ‡å®šè§’è‰²ï¼Œè¡¥å…¨å¸¸ç”¨ç»„åˆ
    if (isUseGameRoleIds()) {
        // ç¬¬ä¸€é˜Ÿè§’è‰²è¡¥å…¨
        if (isUseGameRoleIdsFull(1)) { // è®¾ç½®äº†ä¿©
            flashRoles.push(roleIds[0]);
            flashRoles.push(roleIds[1]);
        } else if (roleIds[0] < 0 && roleIds[1] < 0) { // ä¿©éƒ½æ²¡è®¾ç½®
            if (isSetCurrRole) { // é‡æ–°é€‰æ‹©ä¸»è§’
                flashRoles = flashRoles.concat(RegularlyCollocation.getRandomGroup()); // concat() æ–¹æ³•ä¸ä¼šæ›´æ”¹ç°æœ‰æ•°ç»„ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªæ–°æ•°ç»„ï¼Œå…¶ä¸­åŒ…å«å·²è¿æ¥æ•°ç»„çš„å€¼ã€‚
            } else {
                flashRoles.push(userConfig.currRole);
                let role = Role.getRoleById(userConfig.currRole);
                flashRoles.push(role.cps[fullCloseInt(0, role.cps.length - 1)]);
            }
        } else if (roleIds[0] > -1) { // è®¾ç½®äº†ç¬¬ä¸€ä¸ª
            // æ‰¾åˆ°è®¾ç½®è§’è‰²çš„å¸¸ç”¨æ­é…
            let role = Role.getRoleById(roleIds[0]);
            flashRoles.push(roleIds[0]);
            flashRoles.push(role.cps[fullCloseInt(0, role.cps.length - 1)]);
        } else if (roleIds[1] > -1) { // è®¾ç½®äº†ç¬¬äºŒä¸ª
            let role = Role.getRoleById(roleIds[1]);
            flashRoles.push(role.cps[fullCloseInt(0, role.cps.length - 1)]);
            flashRoles.push(roleIds[1]);
        }
        // ç¬¬äºŒé˜Ÿè§’è‰²è¡¥å…¨
        if (isUseGameRoleIdsFull(2)) {
            flashRoles.push(roleIds[2]);
            flashRoles.push(roleIds[3]);
        } else if (roleIds[2] < 0 && roleIds[3] < 0) {
            flashRoles = flashRoles.concat(RegularlyCollocation.getRandomGroup());
        } else if (roleIds[2] > -1) {
            let role = Role.getRoleById(roleIds[2]);
            flashRoles.push(roleIds[2]);
            flashRoles.push(role.cps[fullCloseInt(0, role.cps.length - 1)]);
        } else if (roleIds[3] > -1) {
            let role = Role.getRoleById(roleIds[3]);
            flashRoles.push(role.cps[fullCloseInt(0, role.cps.length - 1)]);
            flashRoles.push(roleIds[3]);
        }
    } else { // å…¨æ–°å¸¸ç”¨ç»„åˆ
        // ç¬¬ä¸€é˜Ÿ
        if (isSetCurrRole) { // é‡æ–°é€‰æ‹©ä¸»è§’
            flashRoles = flashRoles.concat(RegularlyCollocation.getRandomGroup());
        } else {
            flashRoles.push(userConfig.currRole);
            let role = Role.getRoleById(userConfig.currRole);
            flashRoles.push(role.cps[fullCloseInt(0, role.cps.length - 1)]);
        }
        // ç¬¬äºŒé˜Ÿ
        flashRoles = flashRoles.concat(RegularlyCollocation.getRandomGroup());
    }

    // è®¾ç½®ä¸»è§’id
    if (isSetCurrRole) userConfig.currRole = flashRoles[0];

    return flashRoles;
}


// è§’è‰²idæ£€æŸ¥ï¼Œé¿å…idä¸ºè´Ÿæ•°ï¼›é¿å…åŒä¸€é˜Ÿé€‰ä¸­ä¸¤ä¸ªä¸€æ ·çš„è§’è‰²
function doCkeckOtherRoles(otherRoles) {
    console.log(">>>> doCkeckOtherRoles before otherRoles=" + otherRoles);
    if (otherRoles.length > 3) otherRoles = otherRoles.slice(0, 3); // slice[tart, end) å¼€åŒºé—´ ä¸æ”¹å˜åŸæ•°ç»„
    // ç¬¬ä¸€é˜Ÿæ ¡éªŒ
    if (otherRoles[0] < 0 || otherRoles[0] === userConfig.currRole) {
        let role = Role.getRoleById(userConfig.currRole);
        otherRoles[0] = role.cps[fullCloseInt(0, role.cps.length - 1)];
    }
    // ç¬¬äºŒé˜Ÿæ ¡éªŒ
    if (otherRoles[1] > -1 && otherRoles[2] > -1) { // ä¸¤ä¸ªéƒ½è®¾ç½®äº†
        if (otherRoles[1] === otherRoles[2]) { // ä¿©è§’è‰²ä¸€æ ·
            let role = Role.getRoleById(otherRoles[1]);
            otherRoles[2] = role.cps[fullCloseInt(0, role.cps.length - 1)];
        }
    } else if (otherRoles[1] < 0 && otherRoles[2] < 0) { // ä¸¤ä¸ªéƒ½æ²¡è®¾ç½®
        let group = RegularlyCollocation.getRandomGroup();
        otherRoles[1] = group[0];
        otherRoles[2] = group[1];
    } else if (otherRoles[1] > -1) { // è®¾ç½®äº†ç¬¬ä¸€ä¸ª
        let role = Role.getRoleById(otherRoles[1]);
        otherRoles[2] = role.cps[fullCloseInt(0, role.cps.length - 1)];
    } else if (otherRoles[2] > -1) { // è®¾ç½®äº†ç¬¬äºŒä¸ª
        let role = Role.getRoleById(otherRoles[2]);
        otherRoles[1] = role.cps[fullCloseInt(0, role.cps.length - 1)];
    }

    //console.log(">>>> doCkeckOtherRoles after otherRoles=" + otherRoles);
}


// è®¾ç½®ä¸»è§’ä¹‹å¤–çš„è§’è‰²
function setRoleOthers(otherRoles) {
    if (!otherRoles || otherRoles.length < 1) return;
    let idx = 2;
    otherRoles.some(rid => {
        // éä¸»çƒåªèƒ½ç§»åŠ¨å’Œè¢«æ’å‡»
        let otherBall = new Ball(context, {
            no: idx,
            teamColor: idx > 2 ? 'r' : 'b',
            roleId: rid,
            isMainBall: false,
            x: 0,
            y: 0,
            vx: 0,
            vy: 0
        });
        // åˆå§‹åŒ–å…¶ä»–å‚æ•°
        initBallByRole(otherBall);
        // è®¾ç½®éšæœºä½ç½®åæ ‡
        putBallRandom(otherBall);
        otherBall.x0 = otherBall.x;
        otherBall.y0 = otherBall.y;
        balls.push(otherBall);
        idx += 1;
    });
}


// è®¾ç½®å°ä¸‘åˆ†èº«
function setRoleJoker() {
    let rid;
    for (let i = 0, len = balls.length; i < len; i++) { // len = balls.length åªå–ä¸€æ¬¡å€¼ï¼Œç›®å‰ len å¯èƒ½ä¸º 1 æˆ– 4
        rid = balls[i].roleId;
        if (rid !== Role.JOKER.id) continue;

        let otherBall = new Ball(context, {
            no: balls.length + 1, // è¿™é‡Œçš„ balls.length ä¼šåœ¨ balls.push ä¹‹åå¢åŠ 
            teamColor: i > 1 ? 'r' : 'b',
            color: '#A8A8A8A8', // å°ä¸‘åˆ†èº«å•ç‹¬é¢œè‰²ï¼Œå–é»˜è®¤çš®è‚¤å¸½å­é¢œè‰²
            roleId: rid,
            isMainBall: false,
            x: 0,
            y: 0,
            vx: 0,
            vy: 0
        });
        // åˆå§‹åŒ–å…¶ä»–å‚æ•°
        initBallByRole(otherBall);
        // è®¾ç½®éšæœºä½ç½®åæ ‡
        putBallRandom(otherBall);
        otherBall.x0 = otherBall.x;
        otherBall.y0 = otherBall.y;
        balls.push(otherBall);
    }
}


// å¯¼å…¥åˆ†äº«æ•°æ®åï¼Œè®¾ç½®å°ä¸‘åˆ†èº«é¢œè‰²
function setJoker2Color() {
    if (!balls || balls.length < 1) return;
    let ball;
    for (let i = 0, len = balls.length; i < len; i++) {
        ball = balls[i];
        if (ball.roleId !== Role.JOKER.id) continue;
        if (ball.isMainBall) continue;

        if (len < 4) { // å•ç‹¬ä¸€ä¸ªè§’è‰²æµ‹è¯•
            ball.color = '#A8A8A8A8';
        } else { // å››ä¸ªè§’è‰²
            if (ball.no < 5) continue;
            ball.color = '#A8A8A8A8';
        }
    }
}


// è®¾ç½®åŒå­åˆ†èº«
function setTwins() {
    if (!balls || balls.length < 1) return;
    // åŒå­åˆ†èº«
    twinBall.no = balls.length + 1;
    twinBall.roleId = Role.SHUANGZI.id;
    twinBall.color = '#CACAE3'; // åˆ†èº«è¡£æœé¢œè‰²
    twinBall.teamColor = balls[0].teamColor;
    twinBall.x = Ball.BODY2POS.x;
    twinBall.y = Ball.BODY2POS.y;
    twinBall.x0 = Ball.BODY2POS.x;
    twinBall.y0 = Ball.BODY2POS.y;
    // åˆå§‹åŒ–å…¶ä»–å‚æ•°
    initBallByRole(twinBall);
    balls.push(twinBall);
}


// åˆå§‹è®¾ç½®çŒ´å­åˆ†èº«åæ ‡
function setMonkeysPos() {
    // çŒ´å­åˆ†èº«ä½ç½®åæ ‡
    monkeysPos = [
        { x: 3.1 * sysConfig.girdSize, y: 2.9 * sysConfig.girdSize },
        { x: 11.5 * sysConfig.girdSize, y: 3.4 * sysConfig.girdSize },
        { x: 2.3 * sysConfig.girdSize, y: 18.4 * sysConfig.girdSize },
        { x: 11.1 * sysConfig.girdSize, y: 18.8 * sysConfig.girdSize }
    ];

    // çŒ´å­åˆ†èº«ç›®æ ‡ç‚¹ä½ç½®åæ ‡
    monkeysTargetPos = [
        { x: 13 * sysConfig.girdSize, y: 11 * sysConfig.girdSize },
        { x: 7 * sysConfig.girdSize, y: 21 * sysConfig.girdSize },
        { x: 7 * sysConfig.girdSize, y: 1 * sysConfig.girdSize },
        { x: 1 * sysConfig.girdSize, y: 11 * sysConfig.girdSize }
    ];
}


// è®¾ç½®çŒ´å­åˆ†èº«
function setMonkeys() {
    if (!balls || balls.length < 1) return;
    // é‡ç½®åˆ†èº«æ•°ç»„
    buddies = [];
    // ç›®å‰çŒ´å­æœ‰4ä¸ªåˆ†èº«
    for (let i = 0, len = 4; i < len; i++) {
        let otherBall = new Ball(gameMainBallContext, {
            no: balls.length + i + 1,
            teamColor: balls[0].teamColor,
            color: '#CC5F22', //ã€Šé»‘ç¥è¯ï¼šæ‚Ÿç©ºã€‹è¡£æœé¢œè‰²-1B1D22
            roleId: Role.WUKONG.id,
            isMainBall: false,
            x: 0,
            y: 0,
            vx: 0,
            vy: 0
        });
        // åˆå§‹åŒ–å…¶ä»–å‚æ•°
        initBallByRole(otherBall);
        // è®¾ç½®éšæœºä½ç½®åæ ‡
        //putBallRandom(otherBall);
        // æŒ‡å®šåˆå§‹ä½ç½®
        otherBall.x = monkeysPos[i].x;
        otherBall.y = monkeysPos[i].y;
        otherBall.x0 = otherBall.x;
        otherBall.y0 = otherBall.y;
        buddies.push(otherBall);
    }
}


// åˆ¤æ–­çŒ´å­åˆ†èº«
function isMonkeys() {
    if (!buddies || buddies.length < 1) return false;
    for (let i = 0, len = buddies.length; i < len; i++) {
        if (buddies[i].roleId != Role.WUKONG.id) return false;
    }
    return true;
}


// åˆ¤æ–­æ˜¯å¦åŒ…å«æ‰€æœ‰çŒ´å­åˆ†èº«
function isContainFullMonkeys() {
    if (!balls || balls.length < 1) return false;
    let count = 0;
    for (let i = 0, len = balls.length; i < len; i++) {
        if (balls[i].roleId == Role.WUKONG.id && !balls[i].isMainBall) count++;
    }
    if (count < 4) return false;
    return true;
}


// é‡ç½®åˆ†èº«å±æ€§å˜é‡
function resetBuddies() {
    if (!buddies || buddies.length < 1) return;
    // é‡ç½®è§’è‰²å­—æ®µå±æ€§å€¼
    resetRoleField(buddies);
    // é‡ç½®é€Ÿåº¦å’Œä½ç½®
    for (let i = 0, len = buddies.length; i < len; i++) {
        buddies[i].v = 0;
        buddies[i].vx = 0;
        buddies[i].vy = 0;
        buddies[i].x = 0
        buddies[i].y = 0
        buddies[i].x0 = 0
        buddies[i].y0 = 0
        if (isMonkeys()) { // çŒ´å­åˆ†èº«
            buddies[i].x = monkeysPos[i].x;
            buddies[i].y = monkeysPos[i].y;
            buddies[i].x0 = buddies[i].x;
            buddies[i].y0 = buddies[i].y;
        }
    }
}


// åˆå§‹åŒ–çŒ´å­åˆ†èº«é€Ÿåº¦
function initBuddiesSpeed() {
    if (!buddies || buddies.length < 1) return;
    if (!isMonkeys()) return;
    if (balls[0].roleId != Role.WUKONG.id) return;
    if (balls[0].v <= 0) return;
    for (let i = 0, len = buddies.length; i < len; i++) {
        buddies[i].v = balls[0].v; // checkFriction() æ–¹æ³•éœ€è¦ç”¨äºè®¡ç®—æ‘©æ“¦åŠ›
        getVxVy({ x: monkeysTargetPos[i].x, y: monkeysTargetPos[i].y }, { x: monkeysPos[i].x, y: monkeysPos[i].y }, balls[0].v, buddies[i]);
    }
}


// å‡†å¤‡çŒ´å­åˆ†èº«
function preMonkeys() {
    if (!balls || balls.length < 1) return;
    // åˆ›å»ºåˆ†èº«ï¼Œballs æ•°ç»„åŠ å…¥ buddies
    if (!buddies || buddies.length < 1) setMonkeys();
    // åˆå§‹åŒ–å‚æ•°
    initBuddiesSpeed();
    // balls æ•°ç»„åŠ å…¥ buddies
    if (!isContainFullMonkeys()) balls = balls.concat(buddies);
}


// çŒ´å­åˆ†èº«è¿åŠ¨å®Œæˆå
function afterMonkeys() {
    // balls æ•°ç»„ç§»é™¤ buddies
    if (isContainFullMonkeys()) balls = balls.splice(0, balls.length - buddies.length);
    // é‡ç½®å‚æ•°
    resetBuddies();
}


// ç”»çŒ´å­åˆ†èº«èµ·å§‹ä½ç½®
function drawMonkeysStart() {
    if (!buddies || buddies.length < 1) return;
    if (!isMonkeys()) return;
    if (balls[0].roleId != Role.WUKONG.id) return;
    for (let i = 0, len = buddies.length; i < len; i++) {
        buddies[i].drawBuddyBeginPoint({ ctx: gameSceneContext, color: currTheme.wkShowColor ? currTheme.wkShowColor : "#1B1D2230" });
    }
}


// ç”»çŒ´å­åˆ†èº«è¿åŠ¨æ–¹å‘
function drawMonkeysMoveLine() {
    if (!buddies || buddies.length < 1) return;
    if (!isMonkeys()) return;
    if (balls[0].roleId != Role.WUKONG.id) return;
    for (let i = 0, len = buddies.length; i < len; i++) {
        drawArrow(gameSceneContext, monkeysPos[i].x, monkeysPos[i].y, monkeysTargetPos[i].x, monkeysTargetPos[i].y, 30, roundNumber(0.80 * sysConfig.girdSize, 4), roundNumber(3.20 * dpr * sysConfig.pxRatio, 4), currTheme.wkShowColor ? currTheme.wkShowColor : "#1B1D2230"); // "#7F726E"
    }
}


// éšæœºè®¾ç½®ä¸»è§’æ‰€åœ¨é˜Ÿé¢œè‰²
function resetMainTeamColorRandom(mtc) {
    if (!balls || balls.length < 1) return;
    if (!mtc) { // main team color
        let n = fullCloseInt(1, 100);
        if (n % 2 === 0) mtc = 'r';
        else mtc = 'b';
    }
    if (balls[0].teamColor === mtc) return;
    // teamColor å–å
    balls.some(ball => {
        if (ball.teamColor === 'r') ball.teamColor = 'b';
        else ball.teamColor = 'r';
    });
    // å‚æ•°è®¾ç½®è§’è‰²è¾“å…¥æ¡†é¢œè‰²è·Ÿç€å˜åŒ–
    let roleInputEles = document.getElementsByClassName("div-input-game-roles");
    if (!roleInputEles || roleInputEles.length !== 4) return;
    let mtcNew = balls[0].teamColor;
    for (let i = 0, len = 4; i < len; i++) {
        // å¦‚æœä¸»è§’åœ¨çº¢é˜Ÿï¼Œåˆ™å‰ä¸¤ä¸ªè¾“å…¥æ¡†çº¢è‰²ã€åä¸¤ä¸ªè“è‰²
        if (mtcNew === 'r') {
            if (i < 2) roleInputEles[i].classList.add("red");
            else roleInputEles[i].classList.remove("red");
        } else { // å¦‚æœä¸»è§’åœ¨è“é˜Ÿï¼Œåˆ™å‰ä¸¤ä¸ªè¾“å…¥æ¡†è“è‰²ã€åä¸¤ä¸ªçº¢è‰²
            if (i < 2) roleInputEles[i].classList.remove("red");
            else roleInputEles[i].classList.add("red");
        }
        // å­˜åœ¨åˆ™åˆ é™¤ï¼Œä¸å­˜åœ¨åˆ™æ·»åŠ 
        //roleInputEles[i].classList.toggle("red");
    }
    // é‡ç½®è§’è‰²ç¼–å·
    //resetMainTeamNo(balls);
}


// TODO è®¾ç½®ä¸»è§’æ‰€åœ¨å¯¹ç¼–å·ã€å¾ˆå¤šåœ°æ–¹ç”¨åˆ°äº†åˆå§‹ç¼–å·åšæ¡ä»¶åˆ¤æ–­ï¼Œä¹‹å‰çš„é€»è¾‘æ˜¯ä¸»çƒç¼–å·ä¸€å®šæ˜¯1ï¼Œæ”¹åŠ¨å½±å“çš„åœ°æ–¹æ¯”è¾ƒå¤šã€‘
function resetMainTeamNo(balls) {
    if (!balls || balls.length < 1) return;
    if (userConfig.isTestOnlyOne) return;
    // ç›®å‰ç¡¬æ€§è§„åˆ™ï¼Œå››ä¸ªè§’è‰²ï¼Œè“é˜Ÿç¼–å·1ã€2ï¼Œçº¢é˜Ÿç¼–å·3ã€4
    for (let i = 0, len = 4; i < len; i++) {
        if (balls[i].teamColor === 'b') {
            if (i % 2 === 0) balls[i].no = 1;
            else balls[i].no = 2;
        } else {
            if (i % 2 === 0) balls[i].no = 3;
            else balls[i].no = 4;
        }
    }
}


// è®¾ç½®è›‹
function setEggs() {
    if (!balls || balls.length < 1) return;
    eggs = [];
    for (let i = 0; i < balls.length; i++) {
        if (balls[i].roleId !== Role.DUODUO.id) continue;
        if (balls[i].teamColor === 'r') {
            eggs.push(new Ball(context, {
                roleId: Ball.SPECIALROLEID.eggId, // è›‹ä¸å¯¹åº”è§’è‰²
                x: 7 * sysConfig.girdSize,
                y: 22 * sysConfig.girdSize,
                vx: 0,
                vy: 0,
                radius: sysConfig.girdSize,
                color: '#CE605B',
                m: sysConfig.maxWeightVal, // è›‹ä¸ä¼šåŠ¨ï¼Œç»™æœ€å¤§è´¨é‡
            }));
        } else {
            eggs.push(new Ball(context, {
                roleId: Ball.SPECIALROLEID.eggId,
                x: 7 * sysConfig.girdSize,
                y: 0 * sysConfig.girdSize,
                vx: 0,
                vy: 0,
                radius: sysConfig.girdSize,
                color: '#2A7CE9',
                m: sysConfig.maxWeightVal,
            }));
        }
    }
}


// ä¸åˆ·æ–°é¡µé¢ï¼Œé‡æ–°è®¾ç½®è›‹
function resetEggs() {
    // é‡æ–°è®¾ç½®è›‹
    setEggs();
    // gameSceneCanvas åœºæ™¯å±‚æ¸…ç©ºé‡ç”»
    clearCanvasAll(gameSceneCanvas);
    // å¡«å……èƒŒæ™¯è‰²
    drawSceneBg();
    // ç”»ç½‘æ ¼ï¼Œåœ¨èƒŒæ™¯è‰²ä¹‹å
    drawSceneGrid();
    // å¤æ—¥ä¸»é¢˜ç”»é—´éš”é¢œè‰²çš„ç –æ ¼
    if (userConfig.sceneThemeMode === 5) drawSceneGridRect();
    // å¢™é¢åˆ‡è§’
    clipTableAngles();
    // ç”»è›‹
    drawEggs();
}


// è·å–éšæœºä½ç½®åæ ‡ç‚¹
function getRandomPoint(radius, targetCanvas) {
    if (!targetCanvas) targetCanvas = canvas;
    let p = { x: 0, y: 0 };
    p.x = randomPos(radius, "x", targetCanvas);
    p.y = randomPos(radius, "y", targetCanvas);
    while (!checkRandomPos(radius, p.x, p.y)) {
        p.x = randomPos(radius, "x", targetCanvas);
        p.y = randomPos(radius, "y", targetCanvas);
    }
    return p;
}


// [n,m)èŒƒå›´éšæœºæ•° Math.random()*(m-n)+n
function randomPos(radius, need, targetCanvas) {
    // x [radius+1, targetCanvas.width-radius)
    if (need === "x") return fullOpen(radius + 1, targetCanvas.width - radius);
    // y [radius+1, targetCanvas.height-radius)
    if (need === "y") return fullOpen(radius + 1, targetCanvas.height - radius);
    return 0;
}


// æ£€æµ‹éšæœºåæ ‡
function checkRandomPos(radius, x, y) {
    //console.log(">>>> checkRandomPos x=" + x + ", y=" + y);
    tempCheckBall.x = x;
    tempCheckBall.y = y;
    tempCheckBall.radius = radius;
    // ç²—ç•¥æ£€æµ‹æ˜¯å¦åœ¨å››æ¡åˆ‡è§’çº¿åŒºåŸŸ
    //if (isInAngleArea(tempCheckBall) > -1) return false;
    // æ£€æµ‹å¢™é¢ç¢°æ’
    if (checkWallCollided(tempCheckBall)) return false;
    // æ£€æµ‹åˆ‡é¢ç¢°æ’
    if (checkLineCollided(tempCheckBall)) return false;
    return true;
}


// æ£€æµ‹æ–°åŠ å…¥è§’è‰²ä¸åœºä¸Šè§’è‰²åæ ‡æ˜¯å¦æœ‰å†²çª
function checkBallsCollided(newBall) {
    let result = false;
    balls.some(ball => {
        if (newBall !== ball) { // ä¸æ˜¯è‡ªå·±
            if (is2CirclesCollided(newBall, ball)) {
                result = true;
                return true; // åªæ˜¯é€€å‡ºäº†å¾ªç¯
            }
        }
    });
    if (result) return result;

    // ç»§ç»­æ£€æµ‹æ˜¯å¦ä¸è›‹çš„ä½ç½®å†²çª
    //if(eggs) console.log(eggs.length); // è®¾ç½®è§’è‰²çš„æ—¶å€™è¿˜æ²¡æœ‰è®¾ç½®è›‹
    /*
    if (eggs && eggs.length > 0) {
        result = isBallAndEggCollided(newBall);
    }
    */

    // å°çƒåŒºåŸŸä¸èƒ½ç¢°åˆ°è›‹çš„åŒºåŸŸ
    if (isInEggArea(newBall)) result = true;
    //console.log(">>>> checkBallsCollided isBallAndEggCollided=" + result + " > " + newBall.getBallDesc());

    return result;
}


// æ ¹æ®æ‰‹æœºDPRè®¾ç½®é€Ÿåº¦
function setSpeed() {
    if (!balls || balls.length < 1) return;
    let speed = 0;
    // æ ¹æ®å±å¹•å¤§å°åŠ¨æ€è®¾ç½®åˆå§‹é€Ÿåº¦ï¼Œå¦‚æœé€Ÿåº¦ä¸å˜ï¼Œåœ¨å°åˆ†è¾¨ç‡å±å¹•ä¸Šè·‘çš„æ›´è¿œã€‚60/644 = x/canvas.width x=60/644*canvas.width
    //speed = roundNumber(60 / 644 * canvas.width, 4);
    // æ ¹æ® dpr åŠ¨æ€è®¾ç½®åˆå§‹é€Ÿåº¦ 74/2.7 = x/dpr >>>> x=74/2.7*dpr
    //sysConfig.bounce = 2;
    console.log(">>>> sysConfig.bounce=" + sysConfig.bounce);
    if (sysConfig.bounce > 0) { // sysConfig.bounce=2ï¼Œç¢°æ’æœ‰æŸè€—ï¼Œæ¨ªå‘ç›´æ‰“è·ç¦»æ­£å¸¸ï¼ˆæ°´å¹³ç¢°æ’æ¬¡æ•°å¤šï¼‰ï¼Œç«–ç›´è·ç¦»åå¤§ä¸€äº›ï¼ˆç«–ç›´ç¢°æ’æ¬¡æ•°å°‘ï¼‰
        // TODO è¿˜éœ€è¦çœŸæœºæ¨¡æ‹Ÿæ ¡å‡†
        speed = getHeiwaSpeedByDpr() * balls[0].vRatio + sysConfig.bounce * 4; // å¨ƒæ¨ªå‘ç›´æ‰“ä¼šç¢°å››æ¬¡ï¼ŒåŠ ä¸ŠæŸè€—çš„å››æ¬¡
    } else { // sysConfig.bounce <= 0ï¼Œç¢°æ’æ— æŸè€—ï¼Œæ¨ªå‘ç›´æ‰“è·ç¦»æ­£å¸¸ï¼Œç«–ç›´è·ç¦»è·Ÿå®æˆ˜æ¥è¿‘ï¼Œä½†å°çƒå‘å°„é€Ÿåº¦ç¨å¾®æ…¢ä¸€ç‚¹
        // è®¾ç½®ä¸»çƒé€Ÿåº¦ï¼Œç›®å‰åªæ”¯æŒä¸»çƒå¯ä»¥å‘å°„
        speed = getHeiwaSpeedByDpr() * balls[0].vRatio;
    }
    // é…ç½®äº†åŠ é€Ÿæˆ–å‡é€Ÿ
    if (userConfig.roleSpeedAddVal) {
        console.log(">>>> userConfig.roleSpeedAddVal=" + userConfig.roleSpeedAddVal);
        speed += userConfig.roleSpeedAddVal;
    }
    speed = roundNumber(speed, 4);
    console.log(">>>> main ball speed=" + speed);
    balls[0].v = speed;
}


// è·å–åŸå§‹é€Ÿåº¦
function getBallSpeed0(ball) {
    let speed = 0;
    // æ ¹æ®å±å¹•å¤§å°åŠ¨æ€è®¾ç½®åˆå§‹é€Ÿåº¦ï¼Œå¦‚æœé€Ÿåº¦ä¸å˜ï¼Œåœ¨å°åˆ†è¾¨ç‡å±å¹•ä¸Šè·‘çš„æ›´è¿œã€‚60/644 = x/canvas.width x=60/644*canvas.width
    //speed = roundNumber(60 / 644 * canvas.width, 4);
    // æ ¹æ® dpr åŠ¨æ€è®¾ç½®åˆå§‹é€Ÿåº¦ 74/2.7 = x/dpr >>>> x=74/2.7*dpr
    //sysConfig.bounce = 2;
    //console.log(">>>> sysConfig.bounce=" + sysConfig.bounce);
    if (sysConfig.bounce > 0) { // sysConfig.bounce=2ï¼Œç¢°æ’æœ‰æŸè€—ï¼Œæ¨ªå‘ç›´æ‰“è·ç¦»æ­£å¸¸ï¼ˆæ°´å¹³ç¢°æ’æ¬¡æ•°å¤šï¼‰ï¼Œç«–ç›´è·ç¦»åå¤§ä¸€äº›ï¼ˆç«–ç›´ç¢°æ’æ¬¡æ•°å°‘ï¼‰
        // TODO è¿˜éœ€è¦çœŸæœºæ¨¡æ‹Ÿæ ¡å‡†
        speed = getHeiwaSpeedByDpr() * ball.vRatio + sysConfig.bounce * 4; // å¨ƒæ¨ªå‘ç›´æ‰“ä¼šç¢°å››æ¬¡ï¼ŒåŠ ä¸ŠæŸè€—çš„å››æ¬¡
    } else { // sysConfig.bounce <= 0ï¼Œç¢°æ’æ— æŸè€—ï¼Œæ¨ªå‘ç›´æ‰“è·ç¦»æ­£å¸¸ï¼Œç«–ç›´è·ç¦»è·Ÿå®æˆ˜æ¥è¿‘ï¼Œä½†å°çƒå‘å°„é€Ÿåº¦ç¨å¾®æ…¢ä¸€ç‚¹
        // è®¾ç½®ä¸»çƒé€Ÿåº¦ï¼Œç›®å‰åªæ”¯æŒä¸»çƒå¯ä»¥å‘å°„
        speed = getHeiwaSpeedByDpr() * ball.vRatio;
    }
    speed = roundNumber(speed, 4);
    return speed;
}


// æ ¹æ®æ‰‹æœºdprè·å–é»‘å¨ƒçš„é€Ÿåº¦ï¼Œå…¶ä»–è§’è‰²é€Ÿåº¦å–é»‘å¨ƒç›¸å¯¹å€¼ï¼Œæ¯”å¦‚åƒµå°¸çš„é€Ÿåº¦æ˜¯é»‘å¨ƒçš„0.9å€
function getHeiwaSpeedByDpr() {
    // ä¸åŒè®¾å¤‡é»‘å¨ƒæ¨ªæ‰“çš„æ—¶é—´ç›¸åŒ t=d/v=46*girdSize/90.00=46*60.1714/99.3498â‰ˆ27.86
    // åˆå§‹åŒ–æ—¶ä¼šæ ¹æ® dpr è®¡ç®— girdSize 
    // v=d/t
    //let v = roundNumber(46 * sysConfig.girdSize / 27.86, 4);
    // 99.3498 / 842 = v / canvas.width
    let v = roundNumber(90.00 / 842 * canvas.width, 4);
    // ä¸å¸§ç‡åç›¸å…³ 60Hz v2 = 60 / fps * v
    //v = roundNumber(60 / fpsCheckRst * v, 4);
    //console.log(">>>> getHeiwaSpeedByDpr v=" + v);
    return v;
}


// æ ¹æ®canvas.widthè®¾ç½®æ‘©æ“¦åŠ›
// f=Î¼Ã—Fn å‡è®¾ Î¼ éƒ½ä¸€æ ·ï¼Œåœ°é¢éƒ½æ˜¯æ°´å¹³æ–¹å‘ï¼ŒFn = Î¼mg
function setFriction() {
    // æ­£ç›¸å…³ 3.20 / 842 = f / canvas.width
    // dpr=2.7 canvas.width=842 sysConfig.friction=3.20
    sysConfig.friction = roundNumber(2.60 / 842 * canvas.width, 4);
    // ä¸å¸§ç‡åç›¸å…³ 60Hz f = 60 / fps * sysConfig.friction
    //sysConfig.friction = roundNumber(60 / fpsCheckRst * sysConfig.friction, 4);
    console.log(">>>> sysConfig.friction=" + sysConfig.friction);
}


// æ£€æµ‹è§’è‰²æ˜¯å¦å­˜åœ¨
function checkRoleExist() {
    isDuoduoExist = checkIsDuoduoExist();
    isLuluExist = checkIsLuluExist();
    isShuangziExist = checkIsShuangziExist();
}


// é™æ€æ¸¸æˆæ¡Œé¢åœºæ™¯åˆå§‹åŒ–
function gameSceneInit() {
    let sceneInitTime0 = new Date().getTime();
    // ç”»æ¸¸æˆå°é¢
    drawTable();
    console.log(">>>> gameSceneInit æ¸¸æˆåœºæ™¯åˆå§‹åŒ–è€—æ—¶ï¼š" + (new Date().getTime() - sceneInitTime0) + " ms");
}


// å››ä¸ªè§’è‰²é‡Œé¢æ˜¯å¦æœ‰æœµæœµï¼Œç”¨äºæ§åˆ¶æ˜¯å¦ç”»è›‹
// è®¾ç½®ä¸€ä¸ªå˜é‡ï¼Œåˆå§‹åŒ–çš„æ—¶å€™åˆ¤æ–­ä¸€æ¬¡ï¼Œä¸å»ºè®®æ¯æ¬¡éƒ½è°ƒç”¨åˆ¤æ–­æ–¹æ³•
function checkIsDuoduoExist() {
    let result = false;
    balls.some(ball => {
        //console.log(">>>> ball.roleId=" + ball.roleId);
        if (ball.roleId === Role.DUODUO.id) {
            result = true;
            return true; // åªæ˜¯é€€å‡ºå¾ªç¯
        }
    });
    return result;
}


// æ˜¯å¦æœ‰éœ²éœ²ï¼Œåˆ¤æ–­æ˜¯å¦ç”»ç»ç’ƒçƒ
function checkIsLuluExist() {
    let result = false;
    balls.some(ball => {
        //console.log(">>>> ball.roleId=" + ball.roleId);
        if (ball.roleId === Role.LULU.id && ball.no === 2) {
            result = true;
            return true; // åªæ˜¯é€€å‡ºå¾ªç¯
        }
    });
    return result;
}


// æ˜¯å¦æœ‰åŒå­ï¼Œä»…é™ä¸»çƒ
function checkIsShuangziExist() {
    let result = false;
    balls.some(ball => {
        //console.log(">>>> ball.roleId=" + ball.roleId);
        if (ball.isMainBall && ball.roleId === Role.SHUANGZI.id) {
            result = true;
            return true; // åªæ˜¯é€€å‡ºå¾ªç¯
        }
    });
    return result;
}


// ç»˜åˆ¶æ¸¸æˆå°é¢
function drawTable() {
    // å¡«å……èƒŒæ™¯è‰²
    drawSceneBg();
    // ç”»ç½‘æ ¼ï¼Œåœ¨èƒŒæ™¯è‰²ä¹‹å
    drawSceneGrid();
    // å¤æ—¥ä¸»é¢˜ç”»é—´éš”é¢œè‰²çš„ç –æ ¼
    if (userConfig.sceneThemeMode === 5) drawSceneGridRect();
    // å¢™é¢åˆ‡è§’
    clipTableAngles();
    // è®¾ç½®åœºæ™¯ä¸»é¢˜
    if (userConfig.currRole > -1) setSceneTheme(); // æœªé€‰æ‹©è§’è‰²ï¼Œä¸æ¸²æŸ“åœºæ™¯ï¼ŒèŠ‚çœæ€§èƒ½
    // ç”»å°é¢è¾¹æ¡†ï¼Œæ”¾åœ¨ä¸»é¢˜è®¾ç½®ä¹‹åï¼Œç¡®ä¿è¾¹æ¡†è¦†ç›–emojiå›¾å½¢
    if (userConfig.isShowTableBorder) doDrawTableLines();
    // ç”»ç –æ ¼åæ ‡
    if (userConfig.isShowGridCoordinate) drawSceneCoordinate();
    // ç”»è›‹
    if (isDuoduoExist) drawEggs();
    // ç”»çŒ´å­åˆ†èº«èµ·ç‚¹å’Œè¿åŠ¨æ–¹å‘
    if (userConfig.currRole == Role.WUKONG.id && userConfig.isShowWkPath) {
        drawMonkeysStart();
        drawMonkeysMoveLine();
    }
    if (userConfig.isShowSceneGraph && !userConfig.isUseCustomTheme) { // æ˜¯å¦æ˜¾ç¤ºåœºæ™¯å›¾å½¢
        // å¤æ—¥ä¸»é¢˜ä¸ªåˆ«åŠ¨ç‰©ä¸Šå°é¢
        if (userConfig.sceneThemeMode === 5) {
            drawIconRandom("ğŸ¦€", "ss", 1, false, true, gameSceneCanvas);
            drawIconRandom("ğŸ¦€", "xxs", 2, false, true, gameSceneCanvas);
        }
    }

    // åœ¨ç‚¹æŒ‰å‘å°„é’®å›¾å±‚ï¼Œç”»å‘å°„æŒ‰é’®ï¼Œå…¨å±€åªç”»ä¸€æ¬¡
    clickPlayBtn.drawClickPlayBtn();
}


// é‡æ–°ç»˜åˆ¶æ¸¸æˆå°é¢å’Œåœºæ™¯
function reDrawTable(drawArr) {
    /*
    // å…ˆæ¸…ç†ç”»å¸ƒ
    clearCanvasAll(gameSceneCanvas); // å°é¢å±‚
    clearCanvasAll(gameSceneLinesCanvas); // å°é¢è¾¹æ¡†å±‚
    clearCanvasAll(gameSceneCoordinateCanvas); // å°é¢ç –æ ¼åæ ‡å±‚
    clearCanvasAll(gameSceneEmojiCanvas); // emojiã€svg å›¾å½¢å±‚
    // å…¶ä»–æ“ä½œ
    // å¤§å›¾å½¢åæ ‡åˆ—è¡¨é‡ç½®ï¼Œç”¨æ¥æ£€æµ‹å›¾å½¢é‡å 
    largeEmojiPoints = [];
    // å†é‡æ–°ç»˜åˆ¶
    drawTable();
    */
    const isAll = (!drawArr || drawArr.length < 1);
    // 1-é‡æ–°ç»˜åˆ¶æ¸¸æˆå°é¢
    if (isAll || drawArr.includes(1)) reDrawTableAndEgg();
    // 2-é‡ç”»å°é¢è¾¹æ¡†å’Œç –æ ¼åæ ‡
    if (isAll || drawArr.includes(2)) reDrawTableLineAndGirdNum();
    // 3-é‡æ–°ç»˜åˆ¶åœºæ™¯å›¾å½¢ï¼ˆemojiã€svgï¼‰
    if (isAll || drawArr.includes(3)) reDrawSceneGraph();
}


// é‡æ–°ç»˜åˆ¶æ¸¸æˆå°é¢
function reDrawTableAndEgg() {
    // å…ˆæ¸…ç†ç”»å¸ƒ
    clearCanvasAll(gameSceneCanvas); // å°é¢å±‚
    // é‡æ–°ç»˜åˆ¶å°é¢
    // å¡«å……èƒŒæ™¯è‰²
    drawSceneBg();
    // ç”»ç½‘æ ¼ï¼Œåœ¨èƒŒæ™¯è‰²ä¹‹å
    drawSceneGrid();
    // å¤æ—¥ä¸»é¢˜ç”»é—´éš”é¢œè‰²çš„ç –æ ¼
    if (userConfig.sceneThemeMode === 5) drawSceneGridRect();
    // å¢™é¢åˆ‡è§’
    clipTableAngles();
    // ç”»è›‹
    if (isDuoduoExist) drawEggs();
    // ç”»çŒ´å­åˆ†èº«èµ·ç‚¹å’Œè¿åŠ¨æ–¹å‘
    if (userConfig.currRole == Role.WUKONG.id && userConfig.isShowWkPath) {
        drawMonkeysStart();
        drawMonkeysMoveLine();
    }
    if (userConfig.isShowSceneGraph && !userConfig.isUseCustomTheme) { // æ˜¯å¦æ˜¾ç¤ºåœºæ™¯å›¾å½¢
        // é‡ç”»åœºæ™¯ä¸­å¿ƒå›¾å½¢
        if (userConfig.sceneThemeMode === 0) drawCenterGraphSvg("svg-default-center");
        if (userConfig.sceneThemeMode === 1) drawCenterGraphSvg("svg-snow");
        // å¤æ—¥ä¸»é¢˜ä¸ªåˆ«åŠ¨ç‰©ä¸Šå°é¢
        if (userConfig.sceneThemeMode === 5) {
            drawIconRandom("ğŸ¦€", "ss", 1, false, true, gameSceneCanvas);
            drawIconRandom("ğŸ¦€", "xxs", 2, false, true, gameSceneCanvas);
        }
    }
}


// é‡æ–°ç»˜åˆ¶åœºæ™¯å›¾å½¢ï¼ˆemojiã€svgï¼‰
function reDrawSceneGraph() {
    // å…ˆæ¸…ç©ºå›¾å½¢å±‚ç”»å¸ƒ
    clearCanvasAll(gameSceneEmojiCanvas); // emojiã€svg å›¾å½¢å±‚
    clearCanvasAll(gameSceneGraphCanvas); // graph ç‰¹æ®Šå›¾å½¢å±‚
    // å¤§å›¾å½¢åæ ‡åˆ—è¡¨é‡ç½®ï¼Œç”¨æ¥æ£€æµ‹å›¾å½¢é‡å 
    largeEmojiPoints = [];
    // è®¾ç½®åœºæ™¯ä¸»é¢˜ï¼Œæœªé€‰æ‹©è§’è‰²ï¼Œä¸æ¸²æŸ“åœºæ™¯ï¼ŒèŠ‚çœæ€§èƒ½
    if (userConfig.currRole > -1) setSceneTheme();
}


// é‡ç”»å°é¢è¾¹æ¡†å’Œç –æ ¼åæ ‡
function reDrawTableLineAndGirdNum() {
    clearCanvasAll(gameSceneLinesCanvas); // å°é¢è¾¹æ¡†å±‚
    clearCanvasAll(gameSceneLinesBgCanvas); // å°é¢è¾¹æ¡†èƒŒæ™¯å±‚
    clearCanvasAll(gameSceneCoordinateCanvas); // å°é¢ç –æ ¼åæ ‡å±‚
    // ç”»å°é¢è¾¹æ¡†ï¼Œæ”¾åœ¨ä¸»é¢˜è®¾ç½®ä¹‹åï¼Œç¡®ä¿è¾¹æ¡†è¦†ç›–emojiå›¾å½¢
    if (userConfig.isShowTableBorder) doDrawTableLines();
    // ç”»ç –æ ¼åæ ‡
    if (userConfig.isShowGridCoordinate) drawSceneCoordinate();
}


// ç”»ç½‘æ ¼
// https://juejin.cn/post/6844904042062151688
function drawSceneGrid() {

    gameSceneContext.save();
    gameSceneContext.beginPath();
    gameSceneContext.lineWidth = currTheme.glWidth;
    //gameSceneContext.shadowColor = '#5A5030';
    //gameSceneContext.shadowBlur = 1 * dpr;

    // 1. è®¾ç½®ç½‘æ ¼å¤§å°
    // girdSize

    // 2. è·å–Canvasçš„widthã€height
    let CanvasWidth = gameSceneCanvas.width;
    let CanvasHeight = gameSceneCanvas.height;

    // 3. é‡‡ç”¨éå†çš„æ–¹å¼ï¼Œç”»æ°´å¹³çº¿æ¡
    //let xLineTotals = Math.floor(CanvasHeight / sysConfig.girdSize); // è®¡ç®—éœ€è¦ç»˜ç”»çš„xè½´æ¡æ•°ã€ä¼šæœ‰ä¸€äº›è¯¯å·®ï¼Œå¯¼è‡´å°‘ç”»çº¿é—®é¢˜ã€‘
    let xLineTotals = 22;
    for (let i = 0; i <= xLineTotals; i++) {
        gameSceneContext.beginPath(); // å¼€å¯è·¯å¾„ï¼Œè®¾ç½®ä¸åŒçš„æ ·å¼
        gameSceneContext.moveTo(0, sysConfig.girdSize * i); // -0.5æ˜¯ä¸ºäº†è§£å†³åƒç´ æ¨¡ç³Šé—®é¢˜
        gameSceneContext.lineTo(CanvasWidth, sysConfig.girdSize * i);
        gameSceneContext.strokeStyle = currTheme.glColor;
        if (i === 11) gameSceneContext.strokeStyle = currTheme.glmColor;
        gameSceneContext.stroke();
    }

    // 4.é‡‡ç”¨éå†çš„æ–¹å¼ï¼Œç”»å‚ç›´çº¿æ¡
    //let yLineTotals = Math.floor(CanvasWidth / sysConfig.girdSize); // è®¡ç®—éœ€è¦ç»˜ç”»yè½´çš„æ¡æ•°
    let yLineTotals = 14;
    for (let j = 0; j <= yLineTotals; j++) {
        gameSceneContext.beginPath(); // å¼€å¯è·¯å¾„ï¼Œè®¾ç½®ä¸åŒçš„æ ·å¼
        gameSceneContext.moveTo(sysConfig.girdSize * j, 0);
        gameSceneContext.lineTo(sysConfig.girdSize * j, CanvasHeight);
        gameSceneContext.strokeStyle = currTheme.glColor;
        if (j === 7) gameSceneContext.strokeStyle = currTheme.glmColor;
        gameSceneContext.stroke();
    }

    gameSceneContext.restore();
}


// ç”»é—´éš”é¢œè‰²çš„ç –æ ¼
function drawSceneGridRect() {
    // è®¾ç½®äº†èƒŒæ™¯å›¾ç‰‡ä¸ç”»
    if (indexedDB && userConfig.isUseCustomTheme) return; // && isAImageFileName(currTheme.bgImage)
    gameSceneContext.save();
    gameSceneContext.beginPath();
    gameSceneContext.lineWidth = roundNumber(1 * dpr * sysConfig.pxRatio, 4);
    //gameSceneContext.shadowColor = '#5A5030';
    //gameSceneContext.shadowBlur = 1 * dpr;

    // 1. è®¾ç½®ç½‘æ ¼å¤§å°
    // girdSize

    // 2. è·å–Canvasçš„widthã€height
    let CanvasWidth = gameSceneCanvas.width;
    let CanvasHeight = gameSceneCanvas.height;

    let xLineTotals = 22;
    let yLineTotals = 14;
    for (let i = 0; i < xLineTotals; i++) {
        for (let j = 0; j < yLineTotals; j++) {
            if (i % 2 === 0) { // å¶æ•°è¡Œ
                if (j % 2 === 0) { // å¶æ•°åˆ—
                    gameSceneContext.fillStyle = "#FFA35D"; // å¤æ—¥ä¸»é¢˜-ç –æ ¼æ·±é¢œè‰²å¡«å……
                } else { // å¥‡æ•°åˆ—
                    gameSceneContext.fillStyle = "#FFC777"; // å¤æ—¥ä¸»é¢˜-ç –æ ¼æµ…é¢œè‰²å¡«å……
                }
            } else { // å¥‡æ•°è¡Œ-ç›¸å
                if (j % 2 !== 0) {
                    gameSceneContext.fillStyle = "#FFA35D"; // å¤æ—¥ä¸»é¢˜-ç –æ ¼æ·±é¢œè‰²å¡«å……
                } else {
                    gameSceneContext.fillStyle = "#FFC777"; // å¤æ—¥ä¸»é¢˜-ç –æ ¼æµ…é¢œè‰²å¡«å……
                }
            }

            gameSceneContext.globalAlpha = Math.random(); // éšæœºé€æ˜åº¦
            //if (gameSceneContext.fillStyle === "#FFC777") gameSceneContext.globalAlpha = 1.0; // æµ…é¢œè‰²å¡«å……ä¸è®¾ç½®é€æ˜åº¦
            gameSceneContext.fillRect(j * sysConfig.girdSize, i * sysConfig.girdSize, sysConfig.girdSize - gameSceneContext.lineWidth * Math.random(), sysConfig.girdSize - gameSceneContext.lineWidth * Math.random());

        }
    }

    gameSceneContext.restore();
}


// ç”»ç –æ ¼åæ ‡
function drawSceneCoordinate() {

    gameSceneCoordinateContext.save();
    gameSceneCoordinateContext.textAlign = "center";
    gameSceneCoordinateContext.textBaseline = 'middle';
    gameSceneCoordinateContext.font = currTheme.gnSize + "px serif";

    // ç§»åŠ¨åæ ‡ç³»åˆ°ç”»å¸ƒä¸­å¿ƒ
    //gameSceneCoordinateContext.translate(roundNumber(gameSceneCoordinateCanvas.width / 2), roundNumber(gameSceneCoordinateCanvas.height / 2));
    gameSceneCoordinateContext.translate(gameSceneCoordinateCanvas.width / 2, gameSceneCoordinateCanvas.height / 2);

    // é—´éš”å®½åº¦
    let sceneLineNumMargin = roundNumber(sysConfig.sceneLineWidth * 1.3, 4);
    if (userConfig.isShowTableBorder) sceneLineNumMargin += roundNumber(currTheme.tblWidth * 1.1);

    let CanvasWidth = gameSceneCanvas.width;
    let CanvasHeight = gameSceneCanvas.height;

    // ç”»å·¦å³è¾¹ç•Œç –æ ¼åæ ‡
    let xLineTotals = 22; // å¤šå°‘ä¸ªæ¨ªæ’
    let xLineNum = 8; // å¼€å§‹å€¼
    if (userConfig.isShowGridCoordinateFull) xLineNum = 11; // æ˜¾ç¤ºå®Œå…¨åæ ‡ï¼ˆåŒ…æ‹¬åˆ‡è§’ç –æ ¼ï¼‰
    for (let i = 1; i <= xLineTotals; i++) {
        // åˆ‡è§’ç –æ ¼åæ ‡ä¸ç”¨ç”»
        if (!userConfig.isShowGridCoordinateFull && ((i > -1 && i < 4) || (i > 19 && i <= 22))) continue;
        gameSceneCoordinateContext.beginPath(); // å¼€å¯è·¯å¾„ï¼Œè®¾ç½®ä¸åŒçš„æ ·å¼
        gameSceneCoordinateContext.fillStyle = currTheme.gnColor; // è®¾ç½®æ¯ä¸ªçº¿æ¡çš„é¢œè‰²
        if (isDarkMode) gameSceneCoordinateContext.fillStyle = currTheme.gndColor;
        gameSceneCoordinateContext.fillText(xLineNum, -(CanvasWidth / 2 + sceneLineNumMargin), -(CanvasHeight / 2 + sysConfig.girdSize / 2) + sysConfig.girdSize * i);
        gameSceneCoordinateContext.fillText(xLineNum, (CanvasWidth / 2 + sceneLineNumMargin), -(CanvasHeight / 2 + sysConfig.girdSize / 2) + sysConfig.girdSize * i);
        if (i < 11) xLineNum--;
        if (i > 11) xLineNum++;
    }

    // ç”»ä¸Šä¸‹è¾¹ç•Œç –æ ¼åæ ‡
    let yLineTotals = 14; // å¤šå°‘ä¸ªç«–æ’
    let yLineNum = 4; // å¼€å§‹å€¼
    if (userConfig.isShowGridCoordinateFull) yLineNum = 7; // æ˜¾ç¤ºå®Œå…¨åæ ‡ï¼ˆåŒ…æ‹¬åˆ‡è§’ç –æ ¼ï¼‰
    for (let j = 1; j <= yLineTotals; j++) {
        // åˆ‡è§’ç –æ ¼åæ ‡ä¸ç”¨ç”»
        if (!userConfig.isShowGridCoordinateFull && ((j > -1 && j < 4) || (j > 11 && j <= 14))) continue;
        gameSceneCoordinateContext.fillText(yLineNum, -(CanvasWidth / 2 + sysConfig.girdSize / 2) + sysConfig.girdSize * j, -(CanvasHeight / 2 + sceneLineNumMargin));
        gameSceneCoordinateContext.fillText(yLineNum, -(CanvasWidth / 2 + sysConfig.girdSize / 2) + sysConfig.girdSize * j, (CanvasHeight / 2 + sceneLineNumMargin));
        if (j < 7) yLineNum--;
        if (j > 7) yLineNum++;
    }

    gameSceneCoordinateContext.restore();
}


// åˆ¤æ–­åæ ‡æ˜¯å¦åœ¨ç –æ ¼åæ ‡åŒºåŸŸ
function isInGirdNumArea(p) {
    if (!p) return false;

    let result = false;

    gameSceneCoordinateContext.save();
    gameSceneCoordinateContext.textAlign = "center";
    gameSceneCoordinateContext.textBaseline = 'middle';
    gameSceneCoordinateContext.font = currTheme.gnSize + "px serif";

    // ç§»åŠ¨åæ ‡ç³»åˆ°ç”»å¸ƒä¸­å¿ƒ
    //gameSceneCoordinateContext.translate(gameSceneCoordinateCanvas.width / 2, gameSceneCoordinateCanvas.height / 2);
    // é—´éš”å®½åº¦
    let sceneLineNumMargin = roundNumber(sysConfig.sceneLineWidth * 1.3, 4);
    if (userConfig.isShowTableBorder) sceneLineNumMargin += roundNumber(currTheme.tblWidth * 1.1);
    sceneLineNumMargin = sceneLineNumMargin / 4;

    // è·å–åæ ‡æ•°å€¼å­—ä½“å®½åº¦
    let metrics, width;
    metrics = gameSceneCoordinateContext.measureText("11");
    width = roundNumber(metrics.width + sysConfig.girdSize * 0.4, 4);
    //console.log(width);

    // æ£€æµ‹ç‚¹å‡»åæ ‡æ˜¯å¦åœ¨ç –æ ¼åæ ‡æ•°å€¼åŒºåŸŸ
    if (
        ((p.y >= (sysConfig.cTop * dpr - sceneLineNumMargin - width) && p.y <= (sysConfig.cTop * dpr + canvas.height + sceneLineNumMargin + width)) // y è½´åŒºåŸŸé™åˆ¶
            && ((p.x >= (sysConfig.cLeft * dpr - sceneLineNumMargin - width) && p.x <= (sysConfig.cLeft * dpr - sceneLineNumMargin)) // x è½´å·¦åŠåŒºåŸŸ
                || (p.x >= (sysConfig.cLeft * dpr + canvas.width + sceneLineNumMargin) && p.x <= (sysConfig.cLeft * dpr + canvas.width + sceneLineNumMargin + width)) // x è½´å³åŠåŒºåŸŸ
            ))
        ||
        ((p.x >= (sysConfig.cLeft * dpr - sceneLineNumMargin - width) && p.x <= (sysConfig.cLeft * dpr + canvas.width + sceneLineNumMargin + width)) // x è½´åŒºåŸŸé™åˆ¶
            && ((p.y >= (sysConfig.cTop * dpr - sceneLineNumMargin - width) && p.y <= (sysConfig.cTop * dpr - sceneLineNumMargin)) // y è½´ä¸ŠåŠåŒºåŸŸ
                || (p.y >= (sysConfig.cTop * dpr + canvas.height + sceneLineNumMargin) && p.y <= (sysConfig.cTop * dpr + canvas.height + sceneLineNumMargin + width)))) // y è½´ä¸‹åŠåŒºåŸŸ
    ) result = true;

    gameSceneCoordinateContext.restore();

    return result;
}


// ç”»åœºæ™¯èƒŒæ™¯è‰²
function drawSceneBg() {
    // è®¾ç½®äº†èƒŒæ™¯å›¾ç‰‡ä¸ç”»
    //if (indexedDB && userConfig.isUseCustomTheme && isAImageFileName(currTheme.bgImage)) return;
    gameSceneContext.save();
    gameSceneContext.fillStyle = currTheme.tbColor;
    gameSceneContext.fillRect(0, 0, gameSceneCanvas.width, gameSceneCanvas.height);
    // è®¾ç½®dialogå¼¹çª—ç¡®è®¤æŒ‰é’®é¢œè‰²ä¸ºåœºæ™¯èƒŒæ™¯è‰²
    setDialogOkColor(gameSceneContext.fillStyle);
    gameSceneContext.restore();
}


// å››ä¸ªåˆ‡è§’å‰ªåˆ‡æ‰
function clipTableAngles() {
    // å·¦ä¸Šè§’
    let p0 = { x: 0, y: 0 };
    let p1 = { x: sysConfig.girdSize * 3 + sysConfig.wan8CocosTableMoveVals[1], y: 0 }; // ç©å§æ’å‡»å°é¢ï¼Œåˆ»æ„æ··æ·†è°ƒæ•´äº†è§’åº¦
    let p2 = { x: 0, y: sysConfig.girdSize * 3 + sysConfig.wan8CocosTableMoveVals[0] };
    let points = [p0, p1, p2];
    doGraphClip(points, gameSceneCanvas);

    // å³ä¸Šè§’
    p0 = { x: sysConfig.girdSize * 11 + sysConfig.wan8CocosTableMoveVals[2], y: 0 };
    p1 = { x: gameSceneCanvas.width, y: 0 };
    p2 = { x: gameSceneCanvas.width, y: sysConfig.girdSize * 3 + sysConfig.wan8CocosTableMoveVals[3] };
    points = [p0, p1, p2];
    doGraphClip(points, gameSceneCanvas);

    // å³ä¸‹è§’
    p0 = { x: gameSceneCanvas.width, y: sysConfig.girdSize * 19 + sysConfig.wan8CocosTableMoveVals[4] };
    p1 = { x: gameSceneCanvas.width, y: gameSceneCanvas.height };
    p2 = { x: sysConfig.girdSize * 11 + sysConfig.wan8CocosTableMoveVals[5], y: gameSceneCanvas.height };
    points = [p0, p1, p2];
    doGraphClip(points, gameSceneCanvas);

    // å·¦ä¸‹è§’
    p0 = { x: sysConfig.girdSize * 3 + sysConfig.wan8CocosTableMoveVals[6], y: gameSceneCanvas.height };
    p1 = { x: 0, y: gameSceneCanvas.height };
    p2 = { x: 0, y: sysConfig.girdSize * 19 + sysConfig.wan8CocosTableMoveVals[7] };
    points = [p0, p1, p2];
    doGraphClip(points, gameSceneCanvas);

}


// é»˜è®¤ä¸»é¢˜å·¦å³ä¸¤ä¸ªè¾¹æ¡†å‰ªåˆ‡æ‰
function clipDefaultTableLines() {
    // å·¦è¾¹æ¡†
    let p0 = { x: 0, y: 0 };
    let p1 = { x: gameSceneLinesCanvas.width / 2 - sysConfig.girdSize * 7, y: 0 };
    let p2 = { x: gameSceneLinesCanvas.width / 2 - sysConfig.girdSize * 7, y: gameSceneLinesCanvas.height };
    let p3 = { x: 0, y: gameSceneLinesCanvas.height };
    let points = [p0, p1, p2, p3];
    doGraphClip(points, gameSceneLinesCanvas);

    // å³è¾¹æ¡†
    p0 = { x: gameSceneLinesCanvas.width / 2 + sysConfig.girdSize * 7, y: 0 };
    p1 = { x: gameSceneLinesCanvas.width, y: 0 };
    p2 = { x: gameSceneLinesCanvas.width, y: gameSceneLinesCanvas.height };
    p3 = { x: gameSceneLinesCanvas.width / 2 + sysConfig.girdSize * 7, y: gameSceneLinesCanvas.height };
    points = [p0, p1, p2, p3];
    doGraphClip(points, gameSceneLinesCanvas);
}


// æ‰§è¡Œå›¾å½¢å‰ªåˆ‡
function doGraphClip(points, tCanvas) {
    if (!points) return; // null [] undefined
    let ctx = tCanvas.getContext('2d');
    ctx.save();
    ctx.fillStyle = "#00000000"; // é€æ˜
    ctx.beginPath();
    for (let i = 0; i < points.length; i++) {
        if (i === 0) ctx.moveTo(points[i].x, points[i].y);
        else ctx.lineTo(points[i].x, points[i].y);
    }
    ctx.clip(); // è£å‰ª
    ctx.clearRect(0, 0, tCanvas.width, tCanvas.height); // clip()æŒ‡å®šäº†å‰ªè¾‘åŒºåŸŸï¼Œè¿™é‡Œåªä¼šæ¸…é™¤æŒ‡å®šåŒºåŸŸå†…å®¹
    ctx.fill();
    ctx.restore();
}


// è®¾ç½®åœºæ™¯ä¸»é¢˜
function setSceneTheme() {
    switch (userConfig.sceneThemeMode) {
        case 1: // å†°é›ªä¸»é¢˜
            if (userConfig.isShowSceneGraph) { // æ˜¯å¦æ˜¾ç¤ºåœºæ™¯å›¾å½¢
                // æ¡Œé¢ä¸­å¿ƒå›¾å½¢
                //drawCenterGraphIcon();
                drawCenterGraphSvg("svg-snow");
                // å†°é›ªä¸»é¢˜æ™¯ç‰©å›¾å½¢
                drawIconUpAndDown("ğŸ„", "l", 1);
                drawIconUpAndDown("ğŸ„", "m", 1, true); // éšæœº
                drawIconUpAndDown("ğŸ„", "mm", 1);
                drawIconUpAndDown("ğŸ", "s", 1, true); // éšæœº
                drawIconUpAndDown("ğŸ", "ss", 1);
                drawIconUpAndDown("ğŸ", "xs", 1);
                drawIconUpAndDown("â›„ï¸", "m", 1);
                drawIconUpAndDown("â›„ï¸", "s", 1, true); // éšæœº
                drawIconUpAndDown("â›„ï¸", "ss", 1, true);
                drawIconUpAndDown("â„ï¸", "xs", 2, true);
                drawIconUpAndDown("â„ï¸", "xxs", 4, true);
                drawIconRandom("â„ï¸", "xs", 10);
                drawIconRandom("â„ï¸", "xxs", 10);
                drawIconRandom("â„ï¸", "xxxs", 20);
                drawIconRandom("ğŸ„", "mm", 1);
                drawIconRandom("ğŸ", "xs", 1);
                drawIconRandom("â›„ï¸", "ss", 1);
            }
            break;
        case 2: // æ–°å¹´ä¸»é¢˜
            break;
        case 3: // ç”°å›­ä¸»é¢˜
            if (userConfig.isShowSceneGraph) {
                // èŠ±è‰æ ‘æœ¨ï¼Œé¸¡é¸­é¹…ç‹—çŒªç‰›ç¾Šã€å…ˆåé¡ºåºå¯æ§åˆ¶å›¾å½¢å åŠ æ•ˆæœã€‘
                drawIconUpAndDown("ğŸŒ¹", "xxs", 4, true);
                drawIconRandom("ğŸŒ¹", "xxs", 8);
                drawIconUpAndDown("ğŸŒ¼", "xxs", 2, true);
                drawIconRandom("ğŸŒ¼", "xxs", 4);
                drawIconUpAndDown("ğŸŒ·", "xxs", 4, true);
                drawIconRandom("ğŸŒ·", "xxs", 8);
                drawIconUpAndDown("ğŸŒ±", "xxs", 4, true);
                drawIconRandom("ğŸŒ±", "xxxs", 4);
                drawIconUpAndDown("ğŸŒ»", "mm", 1);
                drawIconRandom("ğŸŒ»", "s", 2);
                drawIconRandom("ğŸŒ¾", "ss", 2);
                drawIconRandom("ğŸŒµ", "mm", 1);
                drawIconRandom("ğŸŒµ", "ss", 1);
                drawIconRandom("ğŸ¥•", "xs", 4);
                drawIconRandom("ğŸ„", "xxxs", 4);
                if (isWoodIconShow) drawIconRandom("ğŸªµ", "ss", 2);
                drawIconRandom("ğŸ¥š", "xxs", 5);
                drawIconUpAndDown("ğŸ›µ", "fll", 1, true, 2); // éšæœºã€ä¸‹æ–¹
                drawIconUpAndDown("ğŸŒ³", "l", 1);
                drawIconRandom("ğŸŒ³", "s", 1);
                drawIconRandom("ğŸ•", "s", 2);
                drawIconRandom("ğŸ–", "m", 1);
                drawIconRandom("ğŸ–", "mm", 1, true, false);
                drawIconRandom("ğŸ–", "mm", 1);
                drawIconRandom("ğŸ‚", "l", 1);
                drawIconRandom("ğŸ‚", "ll", 1, true, false);
                drawIconRandom("ğŸ„", "l", 1);
                drawIconRandom("ğŸ„", "ll", 1, true, false);
                drawIconRandom("ğŸ", "mm", 1);
                drawIconRandom("ğŸ‘", "mm", 1);
                drawIconRandom("ğŸ‘", "mm", 1, true, false);
                drawIconRandom("ğŸˆ", "ss", 1);
                drawIconRandom("ğŸ‡", "ss", 1);
                drawIconRandom("ğŸ‡", "xs", 1);
                drawIconRandom("ğŸ", "xs", 1);
                drawIconRandom("ğŸ€", "xxs", 1);
                drawIconRandom("ğŸŒ", "xxxs", 4);
                drawIconRandom("ğŸ", "xxxs", 4);
                drawIconRandom("ğŸ¦‹", "xxs", 2);
                drawIconUpAndDown("ğŸ“", "ss", 1, false, 1); // åªç”»ä¸Š/å·¦æ–¹
                drawIconRandom("ğŸ“", "ss", 3);
                drawIconRandom("ğŸ¦ƒ", "ss", 5);
                drawIconUpAndDown("ğŸ¦†", "ss", 1, false, 2); // åªç”»ä¸‹/å³æ–¹
                drawIconRandom("ğŸ¦†", "ss", 3);
            }
            break;
        case 4: // æ˜Ÿé™…ä¸»é¢˜
            if (userConfig.isShowSceneGraph) {
                // ç”»æ˜Ÿç³»å…‰äº®
                //drawGalaxyLight();
                // ç”»éšæœºæ˜Ÿç³»å…‰äº®
                globalParams.shadowColor = "#7F9BC2";
                globalParams.shadowBlur = 100 * dpr;
                drawGalaxyLightRandom(null, "mm", 1);
                drawGalaxyLightRandom(null, "s", 2);
                drawGalaxyLightRandom(null, "ss", 2);
                drawGalaxyLightRandom(null, "xs", 5);
                drawGalaxyLightRandom(null, "xxs", 10);
                drawGalaxyLightRandom(null, "xxxs", 15);
                drawIconUpAndDown("ğŸ›°ï¸", "mm", 1);
                drawIconUpAndDown("ğŸŒ", "s", 1, false, 2); // åªç”»ä¸‹/å³æ–¹
                //drawIconRandom("ğŸŒ", "s", 1);
                //drawIconRandom("ğŸŒ•", "xxs", 1); // æœˆçƒä½ç½®åº”è¯¥è·Ÿéšåœ°çƒ
                if (isRingedIconShow)
                    drawIconUpAndDown("ğŸª", "s", 1, false, 2); // åªç”»ä¸‹/å³æ–¹
                drawIconRandom("â˜„ï¸", "ss", 2);
                drawIconRandom("â˜„ï¸", "xs", 2);
                drawIconRandom("â­", "xxs", 10);
                drawIconRandom("â­", "xxxs", 15);
                drawIconRandom("ğŸ›°ï¸", "s", 2);
                drawIconRandom("ğŸš€", "ss", 2);
                drawIconRandom("ğŸ›¸", "s", 2);
                //drawIconRandom("ğŸ‘¨â€ğŸš€", "ss", 1);
                //drawIconRandom("ğŸ‘©â€ğŸš€", "ss", 1);
                drawIconUpAndDown("ğŸ‘©â€ğŸš€", "ss", 1, true, 1);
                drawIconUpAndDown("ğŸ‘¨â€ğŸš€", "ss", 1, true, 2);
            }
            break;
        case 5: // å¤æ—¥ä¸»é¢˜
            if (userConfig.isShowSceneGraph) {
                // å›¾å½¢å…ˆåé¡ºåºå¯ä»¥æ§åˆ¶å åŠ æ•ˆæœ
                drawIconUpAndDown("ğŸï¸", "l", 1, true);
                //drawIconUpAndDown("ğŸï¸", "xl", 1, false, 1); // åªç”»ä¸Š/å·¦æ–¹
                drawIconUpAndDown("ğŸ›Ÿ", "ss", 1, true); // æ•‘ç”Ÿåœˆ
                drawIconUpAndDown("ğŸŒŠ", "ss", 1, true);
                drawIconUpAndDown("ğŸ–ï¸", "s", 1, true);
                drawIconUpAndDown("ğŸ„", "s", 1, true, 1);
                drawIconUpAndDown("ğŸ„â€â™€ï¸", "s", 1, true, 2);
                drawIconRandom("ğŸ›Ÿ", "ss", 1); // æ•‘ç”Ÿåœˆ
                drawIconRandom("ğŸ„", "s", 1); // ä¸å…è®¸è·Ÿå°é¢é‡å ï¼Œå‡ºç°æ¦‚ç‡ä¼šå°ä¸€äº›
                drawIconRandom("ğŸ„", "s", 1, true, false); // å¢å¤§å‡ºç°çš„æ¦‚ç‡
                drawIconRandom("ğŸ„â€â™€ï¸", "s", 1);
                drawIconRandom("ğŸ„â€â™€ï¸", "s", 1, true, false);
                drawIconRandom("ğŸŠ", "s", 1);
                drawIconRandom("ğŸŠ", "s", 1, true, false);
                drawIconRandom("ğŸŠâ€â™€ï¸", "s", 1);
                drawIconRandom("ğŸŠâ€â™€ï¸", "s", 1, true, false);
                drawIconRandom("ğŸŒŠ", "ss", 2);
                drawIconRandom("ğŸŒŠ", "xxs", 5);
                drawIconRandom("ğŸš", "xxxs", 4);
                drawIconRandom("â›µï¸", "m", 2);
                drawIconRandom("â›µï¸", "m", 1, true, false);
                drawIconRandom("ğŸš¤", "m", 2);
                drawIconRandom("ğŸš¤", "m", 1, true, false);
                drawIconRandom("ğŸª‚", "m", 2);
                drawIconRandom("ğŸª‚", "m", 1, true, false);
                //drawIconRandom("ğŸ³", "m", 1); // åœºåœ°å¤ªæŒ¤äº†
                drawIconRandom("ğŸ‹", "m", 1);
                drawIconRandom("ğŸ¦ˆ", "s", 1);
                drawIconRandom("ğŸ¬", "s", 1);
                drawIconRandom("ğŸŸ", "xxs", 15);
                drawIconRandom("ğŸ¦", "xxs", 2);
                drawIconRandom("ğŸ¦€", "xxs", 4);
                drawIconRandom("ğŸ¡", "xxs", 2);
                drawIconRandom("ğŸ™", "xxs", 2);
                drawIconRandom("ğŸ¦‘", "xxs", 2);
                drawIconRandom("ğŸª¼", "xxs", 2); // æ°´æ¯
                drawIconRandom("ğŸª¸", "ss", 2); // çŠç‘š
                drawIconRandom("ğŸª¸", "xxs", 8); // çŠç‘š
                drawIconRandom("ğŸ¢", "ss", 1);
                drawSvgUpAndDown("svg-yl-duck", "s", 1, true);
            }
            break;
        default: // é»˜è®¤ä¸»é¢˜
            if (userConfig.isShowSceneGraph) {
                // ä¸­å¿ƒå›¾å½¢
                drawCenterGraphSvg("svg-default-center");
                // æŒ‡å®šä½ç½®ç”»çŸ³å¤´å’Œéª¨å¤´
                drawStoneGraphDefault();
                // ç”»éª¨å¤´
                drawSvgUpAndDown("svg-bone", "mm", 1, false, 1);
                drawSvgUpAndDown("svg-bone", "s", 1, false, 2);
                drawSvgUpAndDown("svg-bone", "xxs", 2, true);
                drawSvgRandom("svg-bone", "s", 1, true, true);
                drawSvgRandom("svg-bone", "xs", 2, true, true);
                drawSvgRandom("svg-bone", "xxs", 6, true, true);
                // ç”»çŸ³å¤´
                /*
                if (isRockIconShow) {
                    drawIconUpAndDown("ğŸª¨", "mm", 1);
                    drawIconUpAndDown("ğŸª¨", "s", 1);
                    drawIconRandom("ğŸª¨", "s", 2);
                    drawIconRandom("ğŸª¨", "ss", 6);
                    drawIconRandom("ğŸª¨", "xxs", 15);
                }
                */
                // æ”¹ä¸ºç”»svgçŸ³å¤´
                drawSvgUpAndDown("svg-stone", "s", 2, false, 1);
                drawSvgUpAndDown("svg-stone", "ss", 2, false, 2);
                drawSvgUpAndDown("svg-stone", "xxs", 4, true);
                drawSvgRandom("svg-stone", "ss", 2, false, true);
                drawSvgRandom("svg-stone", "xxs", 6, false, true);
            }
    }

    // é»˜è®¤ä¸»é¢˜å‰ªæ‰å·¦å³è¾¹æ¡†
    //if (userConfig.sceneThemeMode === 0) clipDefaultTableLines();
    // è®¾ç½®ä¸»é¢˜èƒŒæ™¯é¢œè‰²
    setBodyBackgroundColor(Theme.getBgColorById(userConfig.sceneThemeMode));
    // è®¾ç½®è‡ªå®šä¹‰èƒŒæ™¯é¢œè‰²
    setBodyBackgroundColor(currTheme.bgColor);
}


// è®¾ç½®bodyèƒŒæ™¯é¢œè‰²
function setBodyBackgroundColor(hex) {
    if (!Theme.isColorCode(hex)) return; // é¢œè‰²ç æ ¼å¼ä¸æ­£ç¡®
    if (indexedDB && userConfig.isUseCustomTheme && isAImageFileName(currTheme.bgImage)) return; // è®¾ç½®èƒŒæ™¯å›¾ç‰‡åˆ™è¿”å›
    document.body.style.backgroundColor = hex;
}


function doDrawTableLines() {
    globalParams.shadowColor = "#352e6160";
    //if (userConfig.sceneThemeMode === 1 && isLightMode) globalParams.shadowColor = "#819BC3"; // å†°é›ªä¸»é¢˜è¾¹æ¡†é˜´å½±
    // å¡«å……ä¸€æ¬¡å°é¢èƒŒæ™¯é¢œè‰²
    drawTableLines(true);
    globalParams.shadowBlur = 6 * dpr;
    drawTableLines();
    globalParams.shadowBlur = 1 * dpr;
    drawTableLines();
}


// è¾¹æ¡†é˜´å½±åªç”¨ç”»ä¸€æ¬¡ï¼Œæ€§èƒ½å½±å“ä¸å¤§
// gameSceneLinesç”»å¸ƒå…¨å±ï¼Œåæ ‡ç§»åˆ°æ­£ä¸­é—´
function drawTableLines(isFill) {
    gameSceneLinesContext.save();
    if (globalParams) { // è®¾ç½®é˜´å½±
        gameSceneLinesContext.shadowColor = globalParams.shadowColor;
        gameSceneLinesContext.shadowBlur = globalParams.shadowBlur;
    }
    gameSceneLinesContext.strokeStyle = currTheme.tblColor; // è¾¹æ¡†é¢œè‰²
    gameSceneLinesContext.lineWidth = currTheme.tblWidth; // è¾¹æ¡†çº¿å®½
    // ç§»åŠ¨åæ ‡ç³»åˆ°åœºæ™¯ä¸­å¿ƒ
    gameSceneLinesContext.translate(roundNumber(gameSceneLinesCanvas.width / 2, 4), roundNumber(gameSceneLinesCanvas.height / 2, 4));
    gameSceneLinesContext.beginPath();
    gameSceneLinesContext.moveTo(-sysConfig.girdSize * 4 - currTheme.tblWidth / 4 + sysConfig.wan8CocosTableMoveVals[1], -sysConfig.girdSize * 11 - currTheme.tblWidth / 2); // èµ·ç‚¹ï¼Œä¸Šè¾¹æ¡†å·¦ç«¯ç‚¹
    gameSceneLinesContext.lineTo(sysConfig.girdSize * 4 + currTheme.tblWidth / 4 + sysConfig.wan8CocosTableMoveVals[2], -sysConfig.girdSize * 11 - currTheme.tblWidth / 2); // ä¸Šè¾¹æ¡†
    gameSceneLinesContext.lineTo(sysConfig.girdSize * 7 + currTheme.tblWidth / 2, -sysConfig.girdSize * 8 - currTheme.tblWidth / 4 + sysConfig.wan8CocosTableMoveVals[3]); // å³ä¸Šè§’æ–œè¾¹æ¡†
    gameSceneLinesContext.lineTo(sysConfig.girdSize * 7 + currTheme.tblWidth / 2, sysConfig.girdSize * 8 + currTheme.tblWidth / 4 + sysConfig.wan8CocosTableMoveVals[4]); // å³è¾¹æ¡†
    gameSceneLinesContext.lineTo(sysConfig.girdSize * 4 + currTheme.tblWidth / 4 + sysConfig.wan8CocosTableMoveVals[5], sysConfig.girdSize * 11 + currTheme.tblWidth / 2); // å³ä¸‹è§’æ–œè¾¹æ¡†
    gameSceneLinesContext.lineTo(-sysConfig.girdSize * 4 - currTheme.tblWidth / 4 + sysConfig.wan8CocosTableMoveVals[6], sysConfig.girdSize * 11 + currTheme.tblWidth / 2); // ä¸‹è¾¹æ¡†
    gameSceneLinesContext.lineTo(-sysConfig.girdSize * 7 - currTheme.tblWidth / 2, sysConfig.girdSize * 8 + currTheme.tblWidth / 4 + sysConfig.wan8CocosTableMoveVals[7]); // å·¦ä¸‹è§’æ–œè¾¹æ¡†
    gameSceneLinesContext.lineTo(-sysConfig.girdSize * 7 - currTheme.tblWidth / 2, -sysConfig.girdSize * 8 - currTheme.tblWidth / 4 + sysConfig.wan8CocosTableMoveVals[0]); // å·¦è¾¹æ¡†
    gameSceneLinesContext.closePath(); // é—­åˆè·¯å¾„ï¼Œå·¦ä¸Šè§’æ–œè¾¹æ¡†
    if (!isFill) {
        gameSceneLinesContext.stroke();
    } else {
        // ç”±äºè¾¹æ¡†å’Œåœºæ™¯ç”¨çš„ä¸æ˜¯ä¸€ä¸ªåæ ‡ç³»ï¼Œä¸ºäº†é¿å…è¾¹æ¡†è¯¯å·®å‡ºç°ç¼éš™ï¼Œå¡«å……ä¸€å±‚èƒŒæ™¯é¢œè‰²
        // é‡‡ç”¨å†…å®¹å¤åˆ¶çš„æ–¹å¼
        // å…ˆéšè—è¾¹æ¡†å›¾å±‚
        gameSceneLinesCanvas.style.display = "none";
        // æ¸…é™¤ç”»å¸ƒå†…å®¹ï¼Œæ³¨æ„ï¼Œè¿™é‡Œæ¸…ç©ºç”»å¸ƒï¼Œä¼šå¯¼è‡´æ²¡æœ‰å†…å®¹
        //clearCanvasAll(gameSceneLinesCanvas);
        // å¡«å……è¾¹æ¡†èƒŒæ™¯
        gameSceneLinesContext.fillStyle = currTheme.tbColor; // å°é¢èƒŒæ™¯é¢œè‰²
        //gameSceneLinesContext.globalCompositeOperation = "source-over";
        gameSceneLinesContext.fill();

        // å¤åˆ¶åˆ°è¾¹æ¡†èƒŒæ™¯å›¾å±‚ç”»å¸ƒ
        gameSceneLinesBgContext.save();
        const dataURL = gameSceneLinesCanvas.toDataURL();
        const image = new Image();
        image.src = dataURL;
        image.onload = function () {
            gameSceneLinesBgContext.drawImage(image, 0, 0);
        };
        gameSceneLinesBgContext.restore();
        // å†æ¬¡æ¸…ç©ºè¾¹æ¡†å±‚ç”»å¸ƒ
        clearCanvasAll(gameSceneLinesCanvas);
        // è¿˜åŸè¾¹æ¡†å±‚æ˜¾ç¤º
        gameSceneLinesCanvas.style.display = "inherit";
    }
    gameSceneLinesContext.restore();
}


// ã€ä¸­å¿ƒå¸ƒå±€ICONã€‘
// ä¸­å¿ƒé›ªèŠ±â„ï¸ ç”»åœ¨æ¸¸æˆåœºæ™¯ç”»å¸ƒä¸Š  3 * sysConfig.girdSize â‰¤ height â‰¤ 5 * sysConfig.girdSize
// é›ªèŠ±å› ä¸ºå­—ä½“åŸå› ï¼Œä¼šå‡ºç°ä¸èƒ½å®Œå…¨å±…ä¸­
function drawCenterGraphIcon(icon, size, num) {
    gameSceneContext.save();
    gameSceneContext.fillStyle = "#EEF0F220";
    // æ°´å¹³å¯¹é½æ–¹å¼ (center left right start end)
    gameSceneContext.textAlign = "center";
    // å‚ç›´å¯¹é½çš„æ–¹å¼ (top bottom middle)
    gameSceneContext.textBaseline = 'middle';

    let content = "â„";
    let fontSize = 8;
    let metrics, width, height;

    gameSceneContext.font = fontSize * dpr + "px serif";
    metrics = gameSceneContext.measureText(content);
    width = roundNumber(metrics.width, 4);
    height = roundNumber(metrics.actualBoundingBoxAscent + metrics.actualBoundingBoxDescent, 4);

    while (height > 5 * sysConfig.girdSize) {
        fontSize -= 1;
        gameSceneContext.font = fontSize * dpr + "px serif";
        metrics = gameSceneContext.measureText(content);
        width = roundNumber(metrics.width, 4);
        height = roundNumber(metrics.actualBoundingBoxAscent + metrics.actualBoundingBoxDescent, 4);
        if (fontSize < 1) break; // é¿å… height è®¡ç®—å¼‚å¸¸ï¼Œå¯¼è‡´æ­»å¾ªç¯
    }

    while (height < 3 * sysConfig.girdSize) {
        fontSize += 1;
        gameSceneContext.font = fontSize * dpr + "px serif";
        metrics = gameSceneContext.measureText(content);
        width = roundNumber(metrics.width, 4);
        height = roundNumber(metrics.actualBoundingBoxAscent + metrics.actualBoundingBoxDescent, 4);
        if (fontSize > 50) break; // é¿å… height è®¡ç®—å¼‚å¸¸ï¼Œå¯¼è‡´æ­»å¾ªç¯
    }

    if (fontSize < 1 || fontSize > 50) { // å­—ä½“å¤§å°å¼‚å¸¸
        console.error(">>>> drawTableCenterGraph fontSize error.");
        fontSize = 7;
        gameSceneContext.font = fontSize * dpr + "px serif";
    }

    console.log(">>>> center graph fontSize=" + fontSize + ", width=" + width + ", height=" + height);
    gameSceneContext.fillText(content, gameSceneCanvas.width / 2, gameSceneCanvas.height / 2);
    gameSceneContext.restore();
}


// ã€ä¸­å¿ƒå¸ƒå±€SVGã€‘
// ä¸­å¿ƒé›ªèŠ±â„ï¸ ç”»åœ¨æ¸¸æˆåœºæ™¯ç”»å¸ƒä¸Š  3 * sysConfig.girdSize â‰¤ height â‰¤ 5 * sysConfig.girdSize
function drawCenterGraphSvg(svgId) {
    gameSceneContext.save();
    //gameSceneContext.fillStyle = "#EEF0F220"; // åœ¨ svg ä¸­é…ç½® fill é¢œè‰²ï¼Œè¿™é‡Œè®¾ç½®æ²¡ç”¨
    // æ°´å¹³å¯¹é½æ–¹å¼ (center left right start end)
    gameSceneContext.textAlign = "center";
    // å‚ç›´å¯¹é½çš„æ–¹å¼ (top bottom middle)
    gameSceneContext.textBaseline = 'middle';
    //gameSceneContext.globalCompositeOperation = "source-over";

    let svgEle = document.getElementById(svgId);
    if (!svgEle) return;
    let svg_xml = (new XMLSerializer()).serializeToString(svgEle);
    //console.log(">>>> svg_xml:", svg_xml);
    let img = new Image();
    img.src = "data:image/svg+xml;base64," + window.btoa(svg_xml);
    //console.log(">>>> img.src:", img.src);

    // é¿å…è·å–åˆ° widthã€height ä¸º 0
    img.onload = function () {
        if (!img || !img.width || !img.height) return;
        let scale, width, height;
        scale = getCenterImgScale(img);
        if (scale <= 0) return;
        width = roundNumber(img.width * scale, 4);
        height = roundNumber(img.height * scale, 4);

        gameSceneContext.drawImage(img, gameSceneCanvas.width / 2 - width / 2, gameSceneCanvas.height / 2 - height / 2, width, height); // å¤§å›¾ç¼©å°ï¼Œä¸ä¼šå˜æ¨¡ç³Š
    }
    gameSceneContext.restore();
}


// è·å–ä¸­å¿ƒå›¾å½¢ç¼©æ”¾æ¯”ä¾‹
function getCenterImgScale(img) {
    let scale, width, height;
    scale = 0.5;
    width = img.width;
    height = img.height;
    //console.log(">>>> getCenterImgScale origin width=" + width);

    if (width) {
        while (width > 4.6 * sysConfig.girdSize) {
            scale -= 0.05;
            width = roundNumber(img.width * scale, 4);
            height = roundNumber(img.height * scale, 4);
            if (scale <= 0) break; // é¿å…è®¡ç®—å¼‚å¸¸ï¼Œå¯¼è‡´æ­»å¾ªç¯
        }
        while (width < 3 * sysConfig.girdSize) {
            scale += 0.05;
            width = roundNumber(img.width * scale, 4);
            height = roundNumber(img.height * scale, 4);
            if (scale > 1) break;
        }
    }
    scale = roundNumber(scale, 4);

    //console.log(">>>> getCenterImgScale scale=" + scale);
    //console.log(">>>> getCenterImgScale final width=" + width);
    return scale;
}


// è·å–å­—ç¬¦ã€iconæ˜¾ç¤ºå¤§å°
function getFontSize(begin, end, size) {
    let fontSize = { begin: (begin ? begin : 0), end: (end ? end : 0) };
    if (size === "xl") { fontSize.begin = (fontSize.begin + 2.0) * sysConfig.girdSize; fontSize.end = (fontSize.end + 5) * sysConfig.girdSize; }
    if (size === "l") { fontSize.begin = (fontSize.begin + 1.5) * sysConfig.girdSize; fontSize.end = (fontSize.end + 4) * sysConfig.girdSize; }
    if (size === "ll") { fontSize.begin = (fontSize.begin + 1.0) * sysConfig.girdSize; fontSize.end = (fontSize.end + 3) * sysConfig.girdSize; }
    if (size === "fll") { fontSize.begin = (fontSize.begin + 2.0) * sysConfig.girdSize; fontSize.end = (fontSize.end + 3) * sysConfig.girdSize; }
    if (size === "m") { fontSize.begin = (fontSize.begin + 1) * sysConfig.girdSize; fontSize.end = (fontSize.end + 2.3) * sysConfig.girdSize; }
    if (size === "mm") { fontSize.begin = (fontSize.begin + 0.8) * sysConfig.girdSize; fontSize.end = (fontSize.end + 1.8) * sysConfig.girdSize; }
    if (size === "s") { fontSize.begin = (fontSize.begin + 0.6) * sysConfig.girdSize; fontSize.end = (fontSize.end + 1.5) * sysConfig.girdSize; }
    if (size === "ss") { fontSize.begin = (fontSize.begin + 0.4) * sysConfig.girdSize; fontSize.end = (fontSize.end + 0.8) * sysConfig.girdSize; }
    if (size === "xs") { fontSize.begin = (fontSize.begin + 0.3) * sysConfig.girdSize; fontSize.end = (fontSize.end + 0.6) * sysConfig.girdSize; }
    if (size === "xxs") { fontSize.begin = (fontSize.begin + 0.15) * sysConfig.girdSize; fontSize.end = (fontSize.end + 0.4) * sysConfig.girdSize; }
    if (size === "xxxs") { fontSize.begin = (fontSize.begin + 0.10) * sysConfig.girdSize; fontSize.end = (fontSize.end + 0.25) * sysConfig.girdSize; }

    fontSize.begin = Math.round(fontSize.begin);
    fontSize.end = Math.round(fontSize.end);
    return fontSize;
}


// è·å–å›¾å½¢å¯è§†åŒºåŸŸå¤§å°ï¼Œé»˜è®¤ä¸ºåœºåœ°é«˜åº¦çš„ä¸€åŠå·¦å³
function getGraphViewAreaSize() {
    let graphViewAreaSize = roundNumber(sysConfig.girdSize * 5, 4); // 8.5
    if (!os.isPc && sysConfig.cTop * dpr > graphViewAreaSize) graphViewAreaSize = sysConfig.cTop * dpr;
    if (os.isPc && sysConfig.cLeft * dpr > graphViewAreaSize) graphViewAreaSize = sysConfig.cLeft * dpr;
    return Math.round(graphViewAreaSize);
}


// åˆ¤æ–­ã€å…¨å±ã€‘åæ ‡æ˜¯å¦ä¸å°é¢é‡å 
// ä¸ç”»ä¸å°é¢é‡å çš„ emoji å›¾å½¢ï¼Œèƒ½èŠ‚çœå‡ åæ¯«ç§’çš„æ—¶é—´
function isInTableAreaFull(p, width) {
    if (!p) return false;
    if (!isNumber(p.x) || !isNumber(p.y)) return false;
    let x = Math.round(p.x);
    let y = Math.round(p.y);
    //if (x <= sysConfig.cLeft * dpr + gameSceneEmojiCanvas.width / 2) x = Math.round(x + width);
    //else x = Math.round(x - width);
    //if (y <= sysConfig.cTop * dpr + gameSceneEmojiCanvas.height / 2) y = Math.round(y + width);
    //else y = Math.round(y - width);
    //if (x <= 0 || y <= 0) return false;
    //drawTableArea(gameSceneEmojiCanvas);
    let circle = { position: p, radius: width / 2 };
    //return pointInPolygon(p, tablePolygon);
    return polygonCircle(tablePolygon, circle);
}


// å…¨å±ç”»å¸ƒå°é¢ï¼ˆç²—ç•¥ï¼‰
function drawTableArea(targetCanvas) {
    let ctx = targetCanvas.getContext('2d');
    ctx.save();
    ctx.beginPath();
    ctx.lineTo((sysConfig.cLeft * dpr + sysConfig.girdSize * 3), (sysConfig.cTop * dpr - currTheme.tblWidth + sysConfig.girdSize * 0));
    ctx.lineTo((sysConfig.cLeft * dpr + sysConfig.girdSize * 11), (sysConfig.cTop * dpr - currTheme.tblWidth + sysConfig.girdSize * 0));
    ctx.lineTo((sysConfig.cLeft * dpr + sysConfig.girdSize * 14 + currTheme.tblWidth), (sysConfig.cTop * dpr + sysConfig.girdSize * 3));
    ctx.lineTo((sysConfig.cLeft * dpr + sysConfig.girdSize * 14 + currTheme.tblWidth), (sysConfig.cTop * dpr + sysConfig.girdSize * 19));
    ctx.lineTo((sysConfig.cLeft * dpr + sysConfig.girdSize * 11), (sysConfig.cTop * dpr + currTheme.tblWidth + sysConfig.girdSize * 22));
    ctx.lineTo((sysConfig.cLeft * dpr + sysConfig.girdSize * 3), (sysConfig.cTop * dpr + currTheme.tblWidth + sysConfig.girdSize * 22));
    ctx.lineTo((sysConfig.cLeft * dpr + sysConfig.girdSize * 0 - currTheme.tblWidth), (sysConfig.cTop * dpr + sysConfig.girdSize * 19));
    ctx.lineTo((sysConfig.cLeft * dpr + sysConfig.girdSize * 0 - currTheme.tblWidth), (sysConfig.cTop * dpr + sysConfig.girdSize * 3));
    ctx.closePath();

    ctx.strokeStyle = '#000000';
    ctx.lineWidth = 1 * dpr;
    ctx.stroke();
    ctx.restore();
}


// è·å– emoji/svg å›¾å½¢åæ ‡
function getEmojiPos(icon, size, width, height, posIdx, isSvg, targetCanvas, isCheck) {
    if (!targetCanvas) targetCanvas = gameSceneEmojiCanvas;
    let graphViewAreaSize = getGraphViewAreaSize(); // emoji å±•ç¤ºåŒºåŸŸå¤§å°
    let diam = width > height ? width : height; // ç›´å¾„å–æœ€å¤§çš„
    let pos = { x: 0, y: 0, radius: Math.round(diam / 2), icon: icon, size: size, posIdx: posIdx };
    let centerPointPer = isSvg ? 1 : 2;
    switch (posIdx) {
        case 1: // ä¸Š/å·¦æ–¹
            if (!os.isPc) { // ç§»åŠ¨ç«¯/å¹³æ¿
                pos.x = Math.round(fullOpen(width / 2, targetCanvas.width - width / 2));
                pos.y = Math.round(fullOpen(sysConfig.cTop * dpr - graphViewAreaSize + height / 2, sysConfig.cTop * dpr - height / centerPointPer - currTheme.tblWidth));
            } else { // PC
                pos.x = Math.round(fullOpen(sysConfig.cLeft * dpr - graphViewAreaSize + width / 2, sysConfig.cLeft * dpr - width / centerPointPer - currTheme.tblWidth));
                pos.y = Math.round(fullOpen(height / 2, targetCanvas.height - height / 2));
            }
            break;
        case 2: // ä¸‹/å³æ–¹
            if (!os.isPc) { // ç§»åŠ¨ç«¯/å¹³æ¿
                pos.x = Math.round(fullOpen(width / 2, targetCanvas.width - width / 2));
                pos.y = Math.round(fullOpen(targetCanvas.height - sysConfig.cTop * dpr + height / centerPointPer + currTheme.tblWidth, targetCanvas.height + (graphViewAreaSize - sysConfig.cTop * dpr) - height / 2));
            } else { // PC
                pos.x = Math.round(fullOpen(targetCanvas.width - sysConfig.cLeft * dpr + width / centerPointPer + currTheme.tblWidth, targetCanvas.width + (graphViewAreaSize - sysConfig.cLeft * dpr) - width / 2));
                pos.y = Math.round(fullOpen(height / 2, targetCanvas.height - height / 2));
            }
            break;
        default: // å…¨å±
            pos.x = Math.round(fullOpen(width / 2, targetCanvas.width - width / 2));
            pos.y = Math.round(fullOpen(height / 2, targetCanvas.height - height / 2));

    }
    if (isSvg) { // SVG å›¾å½¢åŸç‚¹åœ¨å·¦ä¸Šè§’ï¼Œæ£€æµ‹ç›¸äº¤éœ€è¦æŠŠåæ ‡ç§»è‡³ä¸­å¿ƒ
        pos.x = Math.round(pos.x + width / 2);
        pos.y = Math.round(pos.y + height / 2);
    }

    // å¤§å›¾å½¢é‡å æ£€æµ‹ é»˜è®¤ä¸»é¢˜ä¸æ£€æµ‹
    if (userConfig.sceneThemeMode > 0 && largeEmojiSizes.indexOf(size) > -1 && largeEmojiPoints && largeEmojiPoints.length > 0) {
        for (let i = 0, len = largeEmojiPoints.length; i < len; i++) {
            if (is2CirclesCollided(pos, largeEmojiPoints[i])) {
                console.log(">>>> " + posIdx + "-" + icon + "-" + size + "-å›¾å½¢é‡å  -> " + i + "-" + JSON.stringify(largeEmojiPoints[i]));
                sysConfig.emojiCrossRetryCount -= 1;
                if (sysConfig.emojiCrossRetryCount < 1) {
                    sysConfig.emojiCrossRetryCount = 3;
                    return null;
                }
                pos = getEmojiPos(icon, size, width, height, posIdx, isSvg, targetCanvas, true);
                break;
            }
        }
    }

    if (isCheck) return pos; // é€’å½’æ£€æµ‹ï¼Œç›´æ¥è¿”å›åæ ‡
    if (!pos) return pos;

    if (largeEmojiSizes.indexOf(size) > -1)
        largeEmojiPoints.push(pos); // æ²¡æœ‰é‡å åˆ™åŠ å…¥åˆ—è¡¨

    if (isSvg) { // SVG å›¾å½¢æ£€æµ‹å®Œä¹‹åï¼ŒåŸç‚¹è¿˜åŸè‡³å·¦ä¸Šè§’
        pos.x = Math.round(pos.x - width / 2);
        pos.y = Math.round(pos.y - height / 2);
    }

    // æ£€æµ‹æ¬¡æ•°é‡ç½®
    sysConfig.emojiCrossRetryCount = 3;

    return pos;
}


// ã€ä¸Šä¸‹å¸ƒå±€ICONã€‘
function drawIconUpAndDown(icon, size, num, isNumRd, posIdx) {
    if (!posIdx) posIdx = 0; // 1-åªç”»ä¸Š/å·¦æ–¹ï¼›2-åªç”»ä¸‹/å³æ–¹ï¼›å…¶ä»–-éƒ½ç”»

    gameSceneEmojiContext.save();
    //gameSceneEmojiContext.fillStyle = "#3ACC57"; // è¿™ä¸ªé¢œè‰²ä¼šè¦†ç›–å›¾å½¢åŸæœ‰é¢œè‰²
    // æ°´å¹³å¯¹é½æ–¹å¼ (center left right start end)
    gameSceneEmojiContext.textAlign = "center";
    // å‚ç›´å¯¹é½çš„æ–¹å¼ (top,bottom,middle)
    gameSceneEmojiContext.textBaseline = 'middle';

    let fontSize = getFontSize(0, 0, size);
    let graphViewAreaSize = getGraphViewAreaSize();
    let metrics, width, height, count;

    if (posIdx !== 2) {
        // ä¸Š/å·¦æ–¹ç©ºç™½åŒºåŸŸ
        if (isNumRd) num = fullCloseInt(0, num);
        for (let i = 0; i < num; i++) {
            gameSceneEmojiContext.font = fullOpen(fontSize.begin, fontSize.end) + "px serif";
            metrics = gameSceneEmojiContext.measureText(icon);
            width = roundNumber(metrics.width, 4);
            if (!width || width < 0) continue;
            height = roundNumber(metrics.actualBoundingBoxAscent + metrics.actualBoundingBoxDescent, 4);
            //console.log(">>>> graph width=" + width + ", height=" + height);
            count = Math.round(sysConfig.cTop * dpr / height); // èƒ½å®¹çº³å¤šå°‘ä¸ª
            if (os.isPc) count = Math.round(sysConfig.cLeft * dpr / width);
            //console.log(">>>> count=" + count);
            // if (count < 1) continue; // ä¸è€ƒè™‘ countï¼Œåˆ™å›¾å½¢å¯ä»¥è¶…å‡ºè¾¹ç•Œ
            // emoji å›¾å½¢åŸç‚¹åœ¨ä¸­å¿ƒ
            //gameSceneEmojiContext.fillText(icon, 0, 0);
            //if (!os.isPc) gameSceneEmojiContext.fillText(icon, fullOpen(width / 2, gameSceneEmojiCanvas.width - width / 2), fullOpen(sysConfig.cTop * dpr - graphViewAreaSize + height / 2, sysConfig.cTop * dpr - height / 2 - currTheme.tblWidth));
            //if (os.isPc) gameSceneEmojiContext.fillText(icon, fullOpen(sysConfig.cLeft * dpr - graphViewAreaSize + width / 2, sysConfig.cLeft * dpr - width / 2 - currTheme.tblWidth), fullOpen(height / 2, gameSceneEmojiCanvas.height - height / 2));
            let fillPos = getEmojiPos(icon, size, width, height, 1, false, gameSceneEmojiCanvas);
            if (!fillPos) continue;
            gameSceneEmojiContext.fillText(icon, fillPos.x, fillPos.y);
            gameSceneEmojiContext.beginPath();
        }
    }

    if (posIdx !== 1) {
        // ä¸‹/å³æ–¹ç©ºç™½åŒºåŸŸ
        if (isNumRd) num = fullCloseInt(0, num);
        for (let i = 0; i < num; i++) {
            gameSceneEmojiContext.font = fullOpen(fontSize.begin, fontSize.end) + "px serif";
            metrics = gameSceneEmojiContext.measureText(icon);
            width = roundNumber(metrics.width, 4);
            if (!width || width < 0) continue;
            height = roundNumber(metrics.actualBoundingBoxAscent + metrics.actualBoundingBoxDescent, 4);
            count = Math.round(sysConfig.cTop * dpr / height);
            if (os.isPc) count = Math.round(sysConfig.cLeft * dpr / width);
            //if (count < 1) continue;
            //if (!os.isPc) gameSceneEmojiContext.fillText(icon, fullOpen(width / 2, gameSceneEmojiCanvas.width - width / 2), fullOpen(gameSceneEmojiCanvas.height - sysConfig.cTop * dpr + height / 2 + currTheme.tblWidth, gameSceneEmojiCanvas.height + (graphViewAreaSize - sysConfig.cTop * dpr) - height / 2));
            //if (os.isPc) gameSceneEmojiContext.fillText(icon, fullOpen(gameSceneEmojiCanvas.width - sysConfig.cLeft * dpr + width / 2 + currTheme.tblWidth, gameSceneEmojiCanvas.width + (graphViewAreaSize - sysConfig.cLeft * dpr) - width / 2), fullOpen(height / 2, gameSceneEmojiCanvas.height - height / 2));
            let fillPos = getEmojiPos(icon, size, width, height, 2, false, gameSceneEmojiCanvas);
            if (!fillPos) continue;
            gameSceneEmojiContext.fillText(icon, fillPos.x, fillPos.y);
            gameSceneEmojiContext.beginPath();
        }
    }

    gameSceneEmojiContext.restore();
}


// ã€å…¨å±éšæœºå¸ƒå±€ICONã€‘
function drawIconRandom(icon, size, num, isNumRd, isInner, targetCanvas) {
    if (!targetCanvas) targetCanvas = gameSceneEmojiCanvas;
    let ctx = targetCanvas ? targetCanvas.getContext('2d') : gameSceneEmojiContext;
    ctx.save();
    //ctx.fillStyle = "#3ACC57";
    // æ°´å¹³å¯¹é½æ–¹å¼ (center left right start end)
    ctx.textAlign = "center";
    // å‚ç›´å¯¹é½çš„æ–¹å¼ (top,bottom,middle)
    ctx.textBaseline = 'middle';

    // ä¿æŒè·Ÿä¸Šä¸‹å¸ƒå±€ä¸€æ ·
    let fontSize = getFontSize(0, 0, size);

    let metrics, width, height, count;
    if (isNumRd) num = fullCloseInt(1, num);
    for (let i = 0; i < num; i++) {
        ctx.font = fullOpen(fontSize.begin, fontSize.end) + "px serif";
        metrics = ctx.measureText(icon);
        width = roundNumber(metrics.width, 4);
        if (!width || width < 0) continue;
        height = roundNumber(metrics.actualBoundingBoxAscent + metrics.actualBoundingBoxDescent, 4);
        count = Math.round(sysConfig.cTop / height);
        if (count < 1) continue;
        //let fillPos = {x:fullOpen(width / 2, targetCanvas.width - width / 2), y:fullOpen(height / 2, targetCanvas.height - height / 2)};
        let fillPos = getEmojiPos(icon, size, width, height, 0, false, targetCanvas);
        if (!fillPos) continue;
        // ä¸ç”»åœ¨å°é¢å†…éƒ¨ä¸”å›¾å½¢ä¸å°é¢æœ‰é‡å ï¼Œåˆ™ä¸ç”»
        //if (isInner === undefined) isInner = true;
        if (!isInner && isInTableAreaFull(fillPos, width)) continue;
        //gameSceneCanvas.style.display = "none";
        //console.log(fillPos);
        //console.log(width);
        //if (icon === 'ğŸ„') fillPos = {x:0, y:0}; // emoji å›¾å½¢çš„åŸç‚¹åœ¨ä¸­å¿ƒ
        ctx.fillText(icon, fillPos.x, fillPos.y);
        ctx.beginPath();
    }
    ctx.restore();
}


// ã€ä¸Šä¸‹å¸ƒå±€SVGã€‘
function drawSvgUpAndDown(svgId, size, num, isNumRd, posIdx) {
    if (!posIdx) posIdx = 0;

    gameSceneEmojiContext.save();
    gameSceneEmojiContext.fillStyle = "#FAF8F9"; // åœ¨ svg ä¸­é…ç½® fill é¢œè‰²
    // æ°´å¹³å¯¹é½æ–¹å¼ (center left right start end)
    gameSceneEmojiContext.textAlign = "center";
    // å‚ç›´å¯¹é½çš„æ–¹å¼ (top,bottom,middle)
    gameSceneEmojiContext.textBaseline = 'middle';

    let fontSize = getFontSize(0, 0, size);
    let graphViewAreaSize = getGraphViewAreaSize();

    let svg_xml = (new XMLSerializer()).serializeToString(document.getElementById(svgId));
    //console.log(">>>> svg_xml:", svg_xml);
    let img = new Image();
    img.src = "data:image/svg+xml;base64," + window.btoa(svg_xml);
    //console.log(">>>> img.src:", img.src);

    img.onload = function () {
        let scale, width, height, count;
        scale = 1;
        width = img.width;
        height = img.height;

        if (height) {
            if (posIdx !== 2) {
                // ä¸Š/å·¦æ–¹ç©ºç™½åŒºåŸŸ
                if (isNumRd) num = fullCloseInt(1, num);
                for (let i = 0; i < num; i++) {
                    if (i === 0)
                        scale = roundNumber(fullOpen(fontSize.begin, fontSize.end) / (sysConfig.girdSize * 8), 4);
                    else
                        scale = roundNumber(fullOpen(fontSize.begin, fontSize.end) / (sysConfig.girdSize * 10), 4);
                    width = roundNumber(img.width * scale, 4);
                    if (!width || width < 0) continue;
                    height = roundNumber(img.height * scale, 4);
                    count = Math.round(sysConfig.cTop * dpr / height);
                    if (os.isPc) count = Math.round(sysConfig.cLeft * dpr / width);
                    //if (count < 1) continue;
                    // éšæœºæ—‹è½¬è§’åº¦ï¼Œ0 ~ 360
                    //let rotate = fullCloseInt(0, 360);
                    //gameSceneEmojiContext.rotate((rotate * Math.PI) / 180);
                    //if (!os.isPc) gameSceneEmojiContext.drawImage(img, 0, 0, img.width, img.height, fullOpen(width / 2, gameSceneEmojiCanvas.width - width / 2), fullOpen(sysConfig.cTop * dpr / 4, sysConfig.cTop * dpr - height / 2), width, height);
                    //if (os.isPc) gameSceneEmojiContext.drawImage(img, 0, 0, img.width, img.height, fullOpen(width / 2, sysConfig.cLeft * dpr - width / 2), fullOpen(height / 2, gameSceneEmojiCanvas.height - height / 2), width, height);
                    // SVG å›¾å½¢åŸç‚¹åœ¨å·¦ä¸Šè§’
                    //gameSceneEmojiContext.drawImage(img, 0, 0, img.width, img.height, 0, 0, width, height);
                    //if (!os.isPc) gameSceneEmojiContext.drawImage(img, 0, 0, img.width, img.height, fullOpen(width / 2, gameSceneEmojiCanvas.width - width / 2), fullOpen(sysConfig.cTop * dpr - graphViewAreaSize + height / 2, sysConfig.cTop * dpr - height - currTheme.tblWidth), width, height);
                    //if (os.isPc) gameSceneEmojiContext.drawImage(img, 0, 0, img.width, img.height, fullOpen(sysConfig.cLeft * dpr - graphViewAreaSize + width / 2, sysConfig.cLeft * dpr - width - currTheme.tblWidth), fullOpen(height / 2, gameSceneEmojiCanvas.height - height / 2), width, height);
                    let fillPos = getEmojiPos(svgId, size, width, height, 1, true, gameSceneEmojiCanvas);
                    if (!fillPos) continue;
                    gameSceneEmojiContext.drawImage(img, 0, 0, img.width, img.height, fillPos.x, fillPos.y, width, height);
                    //gameSceneEmojiContext.rotate((-rotate * Math.PI) / 180); // ç”»å®Œä¹‹åæ—‹è½¬å›å»
                    gameSceneEmojiContext.beginPath();
                }
            }

            if (posIdx !== 1) {
                // ä¸‹/å³æ–¹ç©ºç™½åŒºåŸŸ
                if (isNumRd) num = fullCloseInt(1, num);
                for (let i = 0; i < num; i++) {
                    scale = roundNumber(fullOpen(fontSize.begin, fontSize.end) / (sysConfig.girdSize * 10), 4);
                    width = roundNumber(img.width * scale, 4);
                    if (!width || width < 0) continue;
                    height = roundNumber(img.height * scale, 4);
                    count = Math.round(sysConfig.cTop * dpr / height);
                    if (os.isPc) count = Math.round(sysConfig.cLeft * dpr / width);
                    //if (count < 1) continue;
                    //if (!os.isPc) gameSceneEmojiContext.drawImage(img, 0, 0, img.width, img.height, fullOpen(width / 2, gameSceneEmojiCanvas.width - width / 2), fullOpen(gameSceneEmojiCanvas.height - sysConfig.cTop * dpr + height + currTheme.tblWidth, gameSceneEmojiCanvas.height + (graphViewAreaSize - sysConfig.cTop * dpr) - height / 2), width, height);
                    //if (os.isPc) gameSceneEmojiContext.drawImage(img, 0, 0, img.width, img.height, fullOpen(gameSceneEmojiCanvas.width - sysConfig.cLeft * dpr + width + currTheme.tblWidth, gameSceneEmojiCanvas.width + (graphViewAreaSize - sysConfig.cLeft * dpr) - width / 2), fullOpen(height / 2, gameSceneEmojiCanvas.height - height / 2), width, height)
                    let fillPos = getEmojiPos(svgId, size, width, height, 2, true, gameSceneEmojiCanvas);
                    if (!fillPos) continue;
                    gameSceneEmojiContext.drawImage(img, 0, 0, img.width, img.height, fillPos.x, fillPos.y, width, height);
                    gameSceneEmojiContext.beginPath();
                }
            }
        }
    }

    gameSceneEmojiContext.restore();
}


// ã€å…¨å±éšæœºå¸ƒå±€SVGã€‘
function drawSvgRandom(svgId, size, num, isNumRd, isInner, targetCanvas) {
    gameSceneEmojiContext.save();
    gameSceneEmojiContext.fillStyle = "#FAF8F9"; // åœ¨ svg ä¸­é…ç½® fill é¢œè‰²
    // æ°´å¹³å¯¹é½æ–¹å¼ (center left right start end)
    gameSceneEmojiContext.textAlign = "center";
    // å‚ç›´å¯¹é½çš„æ–¹å¼ (top,bottom,middle)
    gameSceneEmojiContext.textBaseline = 'middle';

    let fontSize = getFontSize(0, 0, size);

    let svg_xml = (new XMLSerializer()).serializeToString(document.getElementById(svgId));
    //console.log(">>>> svg_xml:", svg_xml);
    let img = new Image();
    img.src = "data:image/svg+xml;base64," + window.btoa(svg_xml);
    //console.log(">>>> img.src:", img.src);

    img.onload = function () {
        let scale, width, height, count;
        scale = 1;
        width = img.width;
        height = img.height;

        if (height) {
            if (isNumRd) num = fullCloseInt(1, num);
            for (let i = 0; i < num; i++) {
                if (i % 5 === 1)
                    scale = roundNumber(fullOpen(fontSize.begin, fontSize.end) / (sysConfig.girdSize * 8), 4);
                else
                    scale = roundNumber(fullOpen(fontSize.begin, fontSize.end) / (sysConfig.girdSize * 10), 4);
                width = roundNumber(img.width * scale, 4);
                if (!width || width < 0) continue;
                height = roundNumber(img.height * scale, 4);
                count = Math.round(sysConfig.cTop * dpr / height);
                if (os.isPc) count = Math.round(sysConfig.cLeft * dpr / width);
                //if (count < 1) continue;
                //let fillPos = {x:fullOpen(width / 2, gameSceneEmojiCanvas.width - width / 2), y:fullOpen(height / 2, gameSceneEmojiCanvas.height - height / 2)};
                let fillPos = getEmojiPos(svgId, size, width, height, 0, true, gameSceneEmojiCanvas);
                if (!fillPos) continue;
                // ä¸ç”»åœ¨å°é¢å†…éƒ¨ä¸”å›¾å½¢ä¸å°é¢æœ‰é‡å ï¼Œåˆ™ä¸ç”»
                if (!isInner && isInTableAreaFull(fillPos, width)) continue;
                gameSceneEmojiContext.drawImage(img, 0, 0, img.width, img.height, fillPos.x, fillPos.y, width, height);
                gameSceneEmojiContext.beginPath();
            }
        }
    }

    gameSceneEmojiContext.restore();
}


// ã€æŒ‡å®šä½ç½®ç”»SVGã€‘
function drawSvgWithPos(svgId, size, pos) {
    gameSceneEmojiContext.save();
    // æ°´å¹³å¯¹é½æ–¹å¼ (center left right start end)
    gameSceneEmojiContext.textAlign = "center";
    // å‚ç›´å¯¹é½çš„æ–¹å¼ (top,bottom,middle)
    gameSceneEmojiContext.textBaseline = 'middle';
    gameSceneEmojiContext.beginPath();

    // åæ ‡ç³»ç§»åŠ¨åˆ°ä¸­å¿ƒ
    gameSceneEmojiContext.translate(roundNumber(gameSceneEmojiCanvas.width / 2, 4), roundNumber(gameSceneEmojiCanvas.height / 2, 4));
    // å…·ä½“æ“ä½œ
    doDrawSvgWithPos(svgId, size, pos);

    gameSceneEmojiContext.restore();
}

function doDrawSvgWithPos(svgId, size, pos) {
    let svg_xml = (new XMLSerializer()).serializeToString(document.getElementById(svgId));
    //console.log(">>>> svg_xml:", svg_xml);
    let img = new Image();
    img.src = "data:image/svg+xml;base64," + window.btoa(svg_xml);
    //console.log(">>>> img.src:", img.src);

    img.onload = function () {
        let scale, width, height;
        scale = roundNumber(size / (sysConfig.girdSize * 10), 4);
        width = roundNumber(img.width * scale, 4);
        if (!width || width < 0) return;
        height = roundNumber(img.height * scale, 4);
        gameSceneEmojiContext.drawImage(img, pos.x, pos.y, width, height);
    }
}


// é»˜è®¤ä¸»é¢˜æŒ‡å®šä½ç½®ç”»çŸ³å¤´
function drawStoneGraphDefault() {
    gameSceneEmojiContext.save();
    // æ°´å¹³å¯¹é½æ–¹å¼ (center left right start end)
    gameSceneEmojiContext.textAlign = "center";
    // å‚ç›´å¯¹é½çš„æ–¹å¼ (top,bottom,middle)
    gameSceneEmojiContext.textBaseline = 'middle';
    gameSceneEmojiContext.beginPath();
    // è®¾ç½®é˜´å½±
    gameSceneEmojiContext.shadowColor = "#2D2560";
    gameSceneEmojiContext.shadowBlur = 20 * dpr;

    // å·¦ä¸Šè§’
    // åŸå§‹åæ ‡ç‚¹
    let pos0 = { x: sysConfig.cLeft * dpr - sysConfig.girdSize * 0.8, y: sysConfig.cTop * dpr + sysConfig.girdSize * 0.5 };
    doDrawSvgWithPos("svg-stone", sysConfig.girdSize * fullOpen(1, 2), pos0);
    // ç›¸å¯¹åŸå§‹åæ ‡ç§»åŠ¨
    let pos01 = { x: pos0.x + sysConfig.girdSize * 1.6, y: pos0.y + sysConfig.girdSize * 0.1 };
    doDrawSvgWithPos("svg-stone", sysConfig.girdSize * fullOpen(0, 1.4), pos01);
    let pos02 = { x: pos0.x - sysConfig.girdSize * 0.2, y: pos0.y + sysConfig.girdSize * 1.4 };
    doDrawSvgWithPos("svg-stone", sysConfig.girdSize * fullOpen(0, 1.4), pos02);
    // å³ä¸Šè§’
    pos0 = { x: sysConfig.cLeft * dpr + sysConfig.girdSize * 11, y: sysConfig.cTop * dpr - sysConfig.girdSize * 0.5 };
    doDrawSvgWithPos("svg-stone", sysConfig.girdSize * fullOpen(1, 2), pos0);
    // ç›¸å¯¹åŸå§‹åæ ‡ç§»åŠ¨
    pos01 = { x: pos0.x - sysConfig.girdSize * 0.6, y: pos0.y - sysConfig.girdSize * 0.2 };
    doDrawSvgWithPos("svg-stone", sysConfig.girdSize * fullOpen(0, 1.4), pos01);
    pos02 = { x: pos0.x + sysConfig.girdSize * 1.6, y: pos0.y + sysConfig.girdSize * 1.4 };
    //doDrawSvgWithPos("svg-stone", sysConfig.girdSize * fullOpen(0, 1.2), pos02);
    // å·¦ä¸‹è§’
    pos0 = { x: sysConfig.cLeft * dpr + sysConfig.girdSize * 0.2, y: sysConfig.cTop * dpr + sysConfig.girdSize * 20 };
    doDrawSvgWithPos("svg-stone", sysConfig.girdSize * fullOpen(1, 2), pos0);
    // ç›¸å¯¹åŸå§‹åæ ‡ç§»åŠ¨
    pos01 = { x: pos0.x - sysConfig.girdSize * 1.0, y: pos0.y + sysConfig.girdSize * 1.3 };
    //doDrawSvgWithPos("svg-stone", sysConfig.girdSize * fullOpen(0, 1.4), pos01);
    pos02 = { x: pos0.x + sysConfig.girdSize * 1.2, y: pos0.y + sysConfig.girdSize * 1.0 };
    doDrawSvgWithPos("svg-stone", sysConfig.girdSize * fullOpen(0, 1.2), pos02);
    // å³ä¸‹è§’
    pos0 = { x: sysConfig.cLeft * dpr + sysConfig.girdSize * 13, y: sysConfig.cTop * dpr + sysConfig.girdSize * 18 };
    doDrawSvgWithPos("svg-stone", sysConfig.girdSize * fullOpen(1, 2), pos0);
    // ç›¸å¯¹åŸå§‹åæ ‡ç§»åŠ¨
    pos01 = { x: pos0.x - sysConfig.girdSize * 1.0, y: pos0.y + sysConfig.girdSize * 1.2 };
    doDrawSvgWithPos("svg-stone", sysConfig.girdSize * fullOpen(0, 1.4), pos01);
    pos02 = { x: pos0.x - sysConfig.girdSize * 0.6, y: pos0.y + sysConfig.girdSize * 2 };
    //doDrawSvgWithPos("svg-stone", sysConfig.girdSize * fullOpen(0, 1.0), pos02);

    gameSceneEmojiContext.restore();
}


// é»˜è®¤ä¸»é¢˜æŒ‡å®šä½ç½®ç”»éª¨å¤´
function drawBoneGraphDefault() {

}


// æ˜Ÿé™…ä¸»é¢˜ç”»æ˜Ÿç³»å…‰äº®
function drawGalaxyLight() {
    gameSceneGraphContext.save();
    // éšæœºæ—‹è½¬è§’åº¦ï¼Œ0 ~ 360
    let rotate = fullCloseInt(0, 360);
    gameSceneGraphContext.rotate((rotate * Math.PI) / 180);
    // é˜´å½±
    gameSceneGraphContext.shadowColor = '#7F9BC2';
    gameSceneGraphContext.shadowBlur = 700;
    // æ¸å˜
    //let grd = gameSceneGraphContext.createLinearGradient(0.9 * gameSceneGraphCanvas.width, 0.1 * gameSceneGraphCanvas.height,0.1 * gameSceneGraphCanvas.width, 0.9 * gameSceneGraphCanvas.height);
    //grd.addColorStop(0, "#05132C");
    //grd.addColorStop(0.5, "#05132C");
    //grd.addColorStop(1, "#EEF0F2");
    gameSceneGraphContext.beginPath();
    gameSceneGraphContext.moveTo(0.9 * gameSceneGraphCanvas.width, 0.01 * gameSceneGraphCanvas.height); // èµ·ç‚¹
    gameSceneGraphContext.quadraticCurveTo(0.8 * gameSceneGraphCanvas.width, 0.4 * gameSceneGraphCanvas.height, 0.01 * gameSceneGraphCanvas.width, 0.6 * gameSceneGraphCanvas.height);
    gameSceneGraphContext.quadraticCurveTo(0.78 * gameSceneGraphCanvas.width, 0.4 * gameSceneGraphCanvas.height, 0.9 * gameSceneGraphCanvas.width, 0.01 * gameSceneGraphCanvas.height);

    gameSceneGraphContext.lineWidth = 2 * dpr; // è®¾ç½®çº¿å®½
    gameSceneGraphContext.fillStyle = "#EEF0F2"; // è®¾ç½®é¢œè‰²
    //gameSceneGraphContext.fillStyle = grd; // ä½¿ç”¨æ¸å˜
    //gameSceneGraphContext.strokeStyle = "#EEF0F2"; // è®¾ç½®é¢œè‰²
    //gameSceneGraphContext.stroke();
    gameSceneGraphContext.fill();
    gameSceneGraphContext.restore();
}


// æ˜Ÿé™…ä¸»é¢˜å…¨å±éšæœºç”»æ˜Ÿç³»å…‰äº®
function drawGalaxyLightRandom(icon, size, num, isNumRd) {
    gameSceneGraphContext.save();

    let fontSize = getFontSize(0, 0, size);

    if (globalParams) { // è®¾ç½®é˜´å½±
        gameSceneGraphContext.shadowColor = globalParams.shadowColor;
        gameSceneGraphContext.shadowBlur = globalParams.shadowBlur;
    }
    // æ¸å˜
    //let grd = gameSceneGraphContext.createLinearGradient(0.9 * gameSceneGraphCanvas.width, 0.1 * gameSceneGraphCanvas.height,0.1 * gameSceneGraphCanvas.width, 0.9 * gameSceneGraphCanvas.height);
    let grd, x, y, r;
    if (isNumRd) num = fullCloseInt(1, num);
    for (let i = 0; i < num; i++) {
        r = roundNumber(fullOpen(fontSize.begin, fontSize.end) / 2, 4);
        x = fullOpen(r, gameSceneEmojiCanvas.width - r);
        y = fullOpen(r, gameSceneEmojiCanvas.height - r);
        grd = gameSceneGraphContext.createRadialGradient(x, y, 0.1 * r, x, y, r);
        grd.addColorStop(0.1, "#EEF0F2F0");
        grd.addColorStop(0.5, "#EEF0F280");
        grd.addColorStop(1, "#EEF0F200");
        gameSceneGraphContext.beginPath();
        //gameSceneGraphContext.arc(this.x0, this.y0, this.pathRadius, Math.PI / 180 * 0, Math.PI / 180 * 360);
        gameSceneGraphContext.arc(x, y, r, 0, Math.PI * 2, true);
        //gameSceneGraphContext.fillStyle = "#EEF0F2"; // è®¾ç½®é¢œè‰²
        gameSceneGraphContext.fillStyle = grd; // ä½¿ç”¨æ¸å˜
        gameSceneGraphContext.fill();
    }
    gameSceneGraphContext.restore();
}


// ç”»åœºåœ°ä¸Šå¤§é¢ç§¯æ™¯ç‰©å›¾å½¢ã€ä¸å¥½ç”»ï¼Œä»¥åå†æã€‘
function drawSceneGraph(icon, size) {
    gameSceneGraphContext.save();
    let topLeftRatio = roundNumber(sysConfig.cTop / sysConfig.cLeft * 1.6, 4);
    //console.log(">>>> topLeftRatio=" + topLeftRatio);
    // é˜´å½±
    gameSceneGraphContext.shadowColor = '#7F9BC2';
    gameSceneGraphContext.shadowBlur = 15;
    gameSceneGraphContext.beginPath();
    //gameSceneGraphContext.moveTo(0.4 * sysConfig.cLeft, 0.4 * sysConfig.cLeft * topLeftRatio); // èµ·ç‚¹
    //gameSceneGraphContext.quadraticCurveTo(gameSceneGraphCanvas.width / 8 - 0.4 * sysConfig.cLeft, 0.3 * sysConfig.cLeft * topLeftRatio, gameSceneGraphCanvas.width / 2.4 - 0.4 * sysConfig.cLeft, 0.35 * sysConfig.cLeft * topLeftRatio);

    gameSceneGraphContext.fillStyle = "#EEF0F2"; // è®¾ç½®é¢œè‰²
    //gameSceneGraphContext.strokeStyle = "#EEF0F2"; // è®¾ç½®é¢œè‰²
    //gameSceneGraphContext.stroke();
    gameSceneGraphContext.fill();
    gameSceneGraphContext.restore();
}


// ç”»è›‹
function drawEggs() {
    //console.log(eggs);
    if (!eggs || eggs.length < 1) return;
    for (let i = 0; i < eggs.length; i++) {
        gameSceneContext.save();
        gameSceneContext.beginPath();
        gameSceneContext.arc(eggs[i].x, eggs[i].y, eggs[i].radius, Math.PI / 180 * 0, Math.PI / 180 * 360);
        gameSceneContext.lineWidth = 2 * dpr;
        gameSceneContext.strokeStyle = eggs[i].color;
        //gameSceneContext.setLineDash([3, 3]); // è™šçº¿
        gameSceneContext.closePath();
        gameSceneContext.stroke(); // ç©ºå¿ƒ
        gameSceneContext.restore();
    }
}


//////////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////////
// ã€é€‰æ‹©è§’è‰²ã€å‚æ•°è®¾ç½®ã€‘ å˜é‡ã€æ–¹æ³•åŒºåŸŸ
//////////////////////////////////////////////////////////////////////

// é€‰æ‹©è§’è‰²
function chooseRole(ele, roleId) {

    // é€‰è§’è‰²å¼€å§‹ä¹‹å‰ï¼Œå…ˆè¾“å…¥è®¿é—®å¯†é’¥ï¼Œæˆæƒè®¿é—®
    if (!checkCoreCode("do2BallsCollidedMV2", true)) return;

    //console.log(">>>> collide-try-role-chose: " + roleId);
    //if (roleId === Role.SHUANGZI.id) {alert("ğŸ‘¬ï¼šæ•¬è¯·æœŸå¾…~å“ˆå“ˆå“ˆå“ˆğŸ˜„"); return;}
    if (roleId === Role.YOUXIA.id) { alert("ğŸ¹ï¼šå’±æœ‰ç»ƒçš„å¿…è¦å—ï¼ŸğŸ¤”"); return; }
    if (roleId === Role.HUAQIANJI.id) { alert("ğŸš€ï¼šç‚®å¼¹åå¼¹ä¸€æ¬¡éƒ½ä¸ä¼šå—ï¼ŸğŸ˜‚"); return; }

    userConfig.currRole = roleId;
    userConfig.isRandomRole = false;
    userConfig.isFlashRole = false;

    if (roleId === -2) { // æé€Ÿå¼€å§‹ï¼Œé‡‡ç”¨è®¾ç½®é‡Œé¢é…ç½®çš„è§’è‰²ã€‚å¦‚æœæ²¡æœ‰é…ç½®ï¼Œåˆ™ä½¿ç”¨å¸¸ç”¨ç»„åˆ
        userConfig.isFlashRole = true;
        setRolesFlash(userConfig.gameRoleIds, true);
    } else if (roleId < 0) { // éšæœºè§’è‰²ï¼Œå®Œå…¨éšæœº
        roleId = Role.getRandomRoleId();
        userConfig.currRole = roleId;
        userConfig.isRandomRole = true;
    }

    // å­˜åˆ° sessionStorageã€PCæµè§ˆå™¨åˆ·æ–°ä¸ä¼šå¤±æ•ˆï¼Œå…³é—­é¡µé¢ä¼šå¤±æ•ˆã€‘
    //if (userConfig.currRole > -1) sessionStorage.setItem('collide-try-role-chose', userConfig.currRole);
    // TODO å­˜åˆ° localStorageï¼Œå…¼å®¹ä¸€äº›æµè§ˆå™¨ï¼ˆViaï¼‰åˆ·æ–°å sessionStorage å¤±æ•ˆï¼Œå¯¼è‡´ä¸€ç›´å¼¹å‡ºé€‰æ‹©è§’è‰²é—®é¢˜
    if (userConfig.currRole > -1) localStorage.setItem('collide-try-role-chose', userConfig.currRole);
    // æ›´æ–° localStorage ä¸­çš„ userConfig
    if (userConfig.currRole > -1) localStorage.setItem('collide-try-user-settings', JSON.stringify(userConfig));
    // åˆ·æ–°é¡µé¢
    //location.reload();
    // ä¸åˆ·æ–°é¡µé¢é‡æ–°é€‰è§’è‰²
    reInit();
    // æ˜¾ç¤ºæ“ä½œæŒ‡å—å¼¹çª—
    if (sysConfig.isRoleChooseFinished) showHowToPlay(true);
    // æ˜¾ç¤ºå·¦ä¸Šè§’é‡æ–°é€‰æ‹©è§’è‰²æç¤º
    if (sysConfig.isRoleChooseFinished) showReChooseRoleEntryDialog();
}


// å¼¹çª—é€‰æ‹©è§’è‰²æ˜¯å¦å®Œæˆ
function isRoleChooseFinished() {
    let choseRoleIdStr = sessionStorage.getItem('collide-try-role-chose');
    if (!choseRoleIdStr) choseRoleIdStr = localStorage.getItem('collide-try-role-chose');
    if (!choseRoleIdStr) return false;
    if (Number(choseRoleIdStr) > -1) return true;
    return false;
}


// åˆ¤æ–­æŒ‡å®šå¼¹çª—æ˜¯å¦æ­£åœ¨æ˜¾ç¤º
function isDialogShowing(dialogEle) {
    let isShowing = false;
    if (dialogEle && dialogEle.style.display && dialogEle.style.display !== "none") { // æ­£åœ¨æ˜¾ç¤º
        isShowing = true;
    }
    return isShowing;
}


// åˆ‡æ¢å¼¹çª—æ˜¾ç¤ºæˆ–éšè—
function switchDialogShow(dialogEle, isShow, params) {
    //console.log(dialogEle);
    if (!params) params = { display: "unset" };
    if (!params.display) params.display = "unset";
    if (!dialogEle && params.dialogEleId) dialogEle = document.getElementById(params.dialogEleId);
    if (!dialogEle) return;
    if (isShow) { // æ˜¾ç¤ºï¼Œdisplay æœ‰å¤šç§å€¼å¯ä»¥è®©å…ƒç´ æ˜¾ç¤º
        dialogEle.style.display = params.display;
    } else { // å…³é—­
        dialogEle.style.display = "none";
    }
}


// æ˜¾ç¤ºå·¦ä¸Šè§’é‡æ–°é€‰æ‹©è§’è‰²å…¥å£æç¤º
function showReChooseRoleEntryDialog() {
    // æœ‰å…¶ä»–å¼¹çª—æ—¶ï¼Œä¸æ˜¾ç¤º
    if (isDialogShowing(chooseRoleDialog) || isDialogShowing(userSettingDialog) || isDialogShowing(howToPlayDialog)) return;
    let t0 = localStorage.getItem('collide-try-re-choose-role-entry-time');
    if (!t0) t0 = "0";
    t0 = Number(t0);
    if (t0 > 0) { // å·²ç»å¼¹è¿‡æç¤ºäº†ï¼Œä¸å†æç¤º
        return;
    }
    switchDialogShow(reChooseRoleEntryDialog, true);
}

// å…³é—­å·¦ä¸Šè§’é‡æ–°é€‰æ‹©è§’è‰²å…¥å£æç¤ºï¼Œä¸å†æç¤º
function closeReChooseRoleEntryDialog() {
    switchDialogShow(reChooseRoleEntryDialog, false, { display: "none" });
    localStorage.setItem('collide-try-re-choose-role-entry-time', new Date().getTime());
    // æç¤ºå®Œå·¦è¾¹é‡é€‰è§’è‰²å…¥å£ï¼Œå†æç¤ºå³è¾¹çš„è®¾ç½®å…¥å£
    showGameSettingEntryDialog();
}


// æ˜¾ç¤ºå³ä¸Šè§’è®¾ç½®å…¥å£æç¤º
function showGameSettingEntryDialog() {
    // æœ‰å…¶ä»–å¼¹çª—æ—¶ï¼Œä¸æ˜¾ç¤º
    if (isDialogShowing(chooseRoleDialog) || isDialogShowing(userSettingDialog)) return;
    let t0 = localStorage.getItem('collide-try-game-settings-entry-time');
    if (!t0) t0 = "0";
    t0 = Number(t0);
    if (t0 > 0) { // å·²ç»å¼¹è¿‡æç¤ºäº†ï¼Œä¸å†æç¤º
        return;
    }
    switchDialogShow(gameSettingEntryDialog, true);
}


// å…³é—­å³ä¸Šè§’è®¾ç½®å…¥å£æç¤ºï¼Œä¸å†æç¤º
function closeGameSettingEntryDialog() {
    switchDialogShow(gameSettingEntryDialog, false, { display: "none" });
    localStorage.setItem('collide-try-game-settings-entry-time', new Date().getTime());
}


// æ˜¾ç¤ºè®¾ç½®ä¸»è§’æç¤º
function showGameSettingMainRoleDialog() {
    // æœ‰å‚æ•°è®¾ç½®å¼¹çª—æ—¶ï¼Œæ‰æ˜¾ç¤º
    if (!isDialogShowing(userSettingDialog)) return;
    let t0 = localStorage.getItem('collide-try-game-settings-main-role-time');
    if (!t0) t0 = "0";
    t0 = Number(t0);
    if (t0 > 0) { // å·²ç»å¼¹è¿‡æç¤ºäº†ï¼Œä¸å†æç¤º
        return;
    }
    switchDialogShow(gameSettingMainRoleDialog, true);
}


// å…³é—­è®¾ç½®ä¸»è§’æç¤ºï¼Œä¸å†æç¤º
function closeGameSettingMainRoleDialog() {
    switchDialogShow(gameSettingMainRoleDialog, false, { display: "none" });
    localStorage.setItem('collide-try-game-settings-main-role-time', new Date().getTime());
}


// æ˜¾ç¤ºæ›´æ–°å†…å®¹
function showUpdateContent(isShow) {
    if (isShow) { // æ˜¾ç¤º
        // å…ˆå‡å°‘æ˜¾ç¤ºé€‰æ‹©è§’è‰²å¼¹çª—é«˜åº¦ï¼Œé¿å…å†…å®¹é‡å 
        chooseRoleDialog.style.height = "0%";
        updateContentDialog.style.display = "unset";
    } else { // å…³é—­
        updateContentDialog.style.display = "none";
        chooseRoleDialog.style.height = "max-content";
    }
}


// æ˜¾ç¤ºä¸€æ¬¡æ“ä½œæŒ‡å—å¼¹çª—
function showHowToPlay(isShow) {
    if (isShow) { // æ˜¾ç¤º
        // åªæç¤ºä¸€æ¬¡
        let howToPlayTimeStr = localStorage.getItem('collide-try-how-to-play-time');
        if (howToPlayTimeStr) return;
        // æœ‰å…¶ä»–å¼¹çª—æ—¶ï¼Œä¸æ˜¾ç¤º
        if (isDialogShowing(chooseRoleDialog) || isDialogShowing(userSettingDialog)) return;
        howToPlayDialog.style.display = "unset";
        dialogMask.style.display = "unset";
    } else { // å…³é—­
        howToPlayDialog.style.display = "none";
        dialogMask.style.display = "none";
        // è®¾ç½®å¼¹çª—æ—¶é—´ï¼Œç”¨æ¥åˆ¤æ–­æ˜¯å¦æ˜¾ç¤ºè¿‡
        localStorage.setItem('collide-try-how-to-play-time', new Date().getTime());
        /*
        // é¦–æ¬¡è¿›å…¥æ¸¸æˆï¼Œæ“ä½œæŒ‡å—å…³é—­ä¹‹åï¼Œç›´æ¥è¿›å…¥ä¸€æ¬¡è®¾ç½®
        let localUserConfigTimeStr = localStorage.getItem('collide-try-user-settings-time');
        if (!localUserConfigTimeStr) {
            switchUserSettingDialog(true);
        }
        */
        // æ˜¾ç¤ºå·¦ä¸Šè§’é‡é€‰è§’è‰²å…¥å£æç¤º
        showReChooseRoleEntryDialog();
    }
}


// åˆ‡æ¢æ˜¾ç¤ºé€‰æ‹©è§’è‰²å¼¹çª—
function switchChooseRoleDialog(isShow) {
    // å¼¹çª—å³ä¸Šè§’æ˜¾ç¤ºæŒ‰é’®åˆ¤æ–­
    switchChooseRoleBtnShow();
    if (isShow) { // æ˜¾ç¤º
        dialogMask.style.display = "unset"; // æ˜¾ç¤ºé€‰æ‹©è§’è‰²é®ç½©å±‚
        chooseRoleDialog.style.display = "unset"; // æ˜¾ç¤ºé€‰æ‹©è§’è‰²å¼¹çª—
    } else { // å…³é—­
        if (userConfig.currRole < 0) return; // æ²¡é€‰æ‹©è§’è‰²ä¸èƒ½å…³é—­
        dialogMask.style.display = "none"; // éšè—é€‰æ‹©è§’è‰²é®ç½©å±‚
        chooseRoleDialog.style.display = "none"; // éšè—é€‰æ‹©è§’è‰²å¼¹çª—
    }
}


// æ ¹æ®æ˜¯å¦å·²ç»é€‰è¿‡è§’è‰²ï¼Œåˆ¤æ–­é€‰æ‹©è§’è‰²å¼¹çª—å³ä¸Šè§’æ˜¯è®¾ç½®âš™å…¥å£ï¼Œè¿˜æ˜¯å…³é—­âæŒ‰é’®
function switchChooseRoleBtnShow() {
    if (userConfig.currRole < 0) { // ç¬¬ä¸€æ¬¡è¿›å…¥é¡µé¢æˆ–è€…æ¸…ç¼“å­˜é‡ç½®åï¼Œæ˜¾ç¤ºè®¾ç½®å…¥å£
        document.getElementById("choose-role-to-setting-entry").style.display = "unset";
        document.getElementById("choose-role-close-btn").style.display = "none";
    } else { // ç‚¹å‡»å·¦ä¸Šè§’è¿›å…¥çš„é‡æ–°é€‰æ‹©è§’è‰²ï¼Œæ˜¾ç¤ºå…³é—­æŒ‰é’®
        document.getElementById("choose-role-to-setting-entry").style.display = "none";
        document.getElementById("choose-role-close-btn").style.display = "unset";
    }
}


// åˆ‡æ¢æ˜¾ç¤ºç”¨æˆ·è®¾ç½®å¼¹çª—
function switchUserSettingDialog(isShow) {
    if (isShow) { // æ˜¾ç¤º
        // åˆå§‹åŒ–é¡µé¢é»˜è®¤å€¼
        initUserSettingDialogVal();
        dialogMask.style.display = "unset";
        userSettingDialog.style.display = "unset";
        if (isDialogShowing(chooseRoleDialog)) { // æ­£åœ¨æ˜¾ç¤ºé€‰è§’è‰²å¼¹çª—
            // å…ˆå‡å°‘æ˜¾ç¤ºé€‰æ‹©è§’è‰²å¼¹çª—é«˜åº¦ï¼Œé¿å…å†…å®¹é‡å 
            chooseRoleDialog.style.height = "1%";
        }
    } else { // å…³é—­
        userSettingDialog.style.display = "none";
        if (isDialogShowing(chooseRoleDialog)) {
            // åªæ›´æ–°è®¾ç½®æ—¶é—´ï¼Œä½†ä¸åˆ·æ–°é¡µé¢
            reloadAfterUserConfigSettingFinished(new Date().getTime(), false);
            // å…³é—­å‚æ•°è®¾ç½®å¼¹çª—åï¼Œå†é‡æ–°æ¢å¤é€‰æ‹©è§’è‰²å¼¹çª—åŸæœ¬é«˜åº¦
            chooseRoleDialog.style.height = "max-content";
        } else {
            // å…³é—­é®ç½©
            dialogMask.style.display = "none";
            // æ›´æ–°è®¾ç½®æ—¶é—´ï¼Œåˆ·æ–°é¡µé¢
            reloadAfterUserConfigSettingFinished(new Date().getTime(), true);
        }
        // è‡ªåŠ¨æ”¶èµ·è‡ªå®šä¹‰ä¸»é¢˜å‚æ•°
        //toggleCustomTheme(null, false);
    }
}


// åˆ‡æ¢æ˜¾ç¤ºcanvaså›¾å±‚å…ƒç´ 
function switchCanvasShow(canvasEle, isShow) {
    if (!canvasEle) return;

    // å¼€å¯æˆ–å…³é—­åœºæ™¯è¾¹æ¡†ï¼Œå¦‚æœç –æ ¼åæ ‡å·²ç»åœ¨æ˜¾ç¤ºï¼Œç –æ ¼åæ ‡éœ€è¦æ¸…ç©ºé‡ç”»
    if (canvasEle === gameSceneLinesCanvas) {
        if (userConfig.isShowGridCoordinate) {
            clearCanvasAll(gameSceneCoordinateCanvas);
            drawSceneCoordinate();
        }
    }

    if (isShow) { // æ˜¾ç¤º
        // å¼€å¯åœºæ™¯è¾¹æ¡†ï¼Œæœ€å¥½æ¸…ç©ºé‡ç”»ä¸€æ¬¡ï¼Œé¿å…ä¹‹å‰æ²¡ç”»
        if (canvasEle === gameSceneLinesCanvas) {
            clearCanvasAll(gameSceneLinesCanvas);
            clearCanvasAll(gameSceneLinesBgCanvas);
            doDrawTableLines();
            // æ˜¾ç¤ºè¾¹æ¡†èƒŒæ™¯å±‚
            switchCanvasShow(gameSceneLinesBgCanvas, true);
        }
        // å¼€å¯ç –æ ¼åæ ‡ï¼Œæœ€å¥½æ¸…ç©ºé‡ç”»ä¸€æ¬¡ï¼Œé¿å…æ˜¾ç¤ºæ²¡æœ‰è¾¹æ¡†æ—¶ä½ç½®
        if (canvasEle === gameSceneCoordinateCanvas) {
            clearCanvasAll(gameSceneCoordinateCanvas);
            drawSceneCoordinate();
        }
        canvasEle.style.display = "inherit";
    } else { // å…³é—­
        // å…³é—­åœºæ™¯è¾¹æ¡†ï¼ŒæŠŠè¾¹æ¡†èƒŒæ™¯å›¾å±‚æ¸…ç©ºéšè—
        if (canvasEle === gameSceneLinesCanvas) {
            clearCanvasAll(gameSceneLinesBgCanvas);
            switchCanvasShow(gameSceneLinesBgCanvas, false);
        }
        canvasEle.style.display = "none";
    }
}


// åˆå§‹åŒ–è§’è‰²å‚æ•°å¼¹çª—å˜é‡å€¼
function initUserSettingDialogVal() {
    try {
        let ele;
        for (let f in userConfig) {
            //console.log(f + " = " + userConfig[f]);
            ele = document.getElementById(f);
            if (f === "currRole") {

            } else if (f === "sceneThemeMode") { // ä¸»é¢˜åç§°
                setSceneThemeText(userConfig[f]);
            } else if (f === "currPlayOpt") { // å½“å‰æ“ä½œæ–¹å¼
                setCurrPlayOptText(userConfig[f]);
            } else if (f === "mainTeamColor") { // ä¸»è§’æ‰€åœ¨é˜Ÿé¢œè‰²
                setMainTeamColorText(userConfig[f]);
            } else if (f === "gameRoleIds") { // æŒ‡å®šè§’è‰²åç§°
                setGameRoleIdsText(userConfig[f]);
            } else if (f === "shareRoleAndPos") { // å¯¼å…¥/å¯¼å‡ºè§’è‰²å’Œåæ ‡
                setShareContent(userConfig[f]);
            } else if (typeof userConfig[f] === "string" || typeof userConfig[f] === "number" || userConfig[f] instanceof Array) { // å­—ç¬¦ä¸²ã€æ•°å€¼ã€æ•°ç»„ç±»å‹
                if (ele && userConfig[f]) ele.value = userConfig[f].toString();
            } else if (typeof userConfig[f] === "boolean") { // å¸ƒå°”ç±»å‹
                if (f === "isShowBallMovePath") togglePathBallMoveShow(userConfig[f]); // åˆ‡æ¢è¿åŠ¨è·¯å¾„å±‚æ˜¾ç¤ºæˆ–éšè—
                if (f === "isShowBallPath") togglePathBallShow(userConfig[f]); // åˆ‡æ¢å…¨è·¯å¾„å±‚æ˜¾ç¤ºæˆ–éšè—
                if (f === "isUseCustomTheme" && userConfig[f]) switchCustomThemeCheckbox(userConfig[f]); // åˆ‡æ¢è‡ªå®šä¹‰ä¸»é¢˜å¼€å…³
                if (!ele) continue;
                if (userConfig[f]) ele.setAttribute("checked", true);
                else ele.removeAttribute("checked");
            }
        }

        // è¾“å…¥äº†æ­£ç¡®çš„è®¿é—®å¯†é’¥æ‰æ˜¾ç¤ºã€ä¸‹è½½ç¦»çº¿ç‰ˆã€‘
        // vue æš‚æ—¶ä¸æ”¯æŒä¿å­˜  && !isVue()
        if (checkAccessKey()) {
            document.getElementById("collide-try-save-html").style.display = "list-item";
        } else {
            document.getElementById("collide-try-save-html").style.display = "none";
        }

        // å‘Šåˆ«ä¿¡æ¯
        if (sysConfig.isSayGoodbye) {
            let eles = document.getElementsByClassName("collide-try-goodbye") || [];
            for (let i = 0, len = eles.length; i < len; i++) {
                eles[i].style.display = "inherit"; // ç»§æ‰¿çˆ¶æ ‡ç­¾displayå±æ€§
            }
        }

    } catch (e) { // userConfig é…ç½®ä¸­ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰å­—æ®µéƒ½å¯¹åº”äº†é¡µé¢è®¾ç½®ï¼Œdocument.getElementById(f) æ‰¾ä¸åˆ°ä¼šæŠ¥å¼‚å¸¸ï¼Œå¯ä»¥å¿½ç•¥
        doGlobalError(e, (sysConfig && sysConfig.alertErrorCount) ? sysConfig.alertErrorCount : 3);
    }
}


// åˆ‡æ¢è‡ªå®šä¹‰ä¸»é¢˜å‚æ•°è®¾ç½®æ˜¾ç¤º/éšè—
function toggleCustomTheme(ele, isShow) {
    let oneCustomThemeLi = document.querySelector(".user-setting-item-expand");
    if (!oneCustomThemeLi) return;
    let customThemeItems = document.getElementsByClassName("user-setting-item-expand");
    if (!customThemeItems || customThemeItems.length < 1) return;
    let svgArrow = document.getElementById("toggleCustomThemeSvgArrow");
    let isShowing = oneCustomThemeLi.style.display && oneCustomThemeLi.style.display !== "none";
    if (isShowing) { // æ˜¾ç¤º->å…³é—­
        if (isShow === false || typeof isShow === 'undefined') {
            for (let i = 0, len = customThemeItems.length; i < len; i++) {
                customThemeItems[i].style.display = "none";
            }
            // ç®­å¤´æ—‹è½¬åˆ°æŒ‡å‘ä¸‹
            svgArrow.style.transform = 'inherit';
        }
    } else { // å…³é—­->æ˜¾ç¤º
        if (isShow === true || typeof isShow === 'undefined') {
            for (let i = 0, len = customThemeItems.length; i < len; i++) {
                customThemeItems[i].style.display = "flex";
            }
            // è®¾ç½®é»˜è®¤é¢œè‰²å’Œå–è‰²å™¨
            setColorPicker();
            // ç®­å¤´æ—‹è½¬åˆ°æŒ‡å‘ä¸Š
            svgArrow.style.transform = 'rotate(180deg)';
        }
    }
}


// è®¾ç½®é»˜è®¤é¢œè‰²å’Œå–è‰²å™¨
function setColorPicker() {
    var colorItems = document.getElementsByClassName("theme-color-item");
    if (!colorItems || colorItems.length < 1)
        return;
    // è®¾ç½®é»˜è®¤é¢œè‰²
    /*
    for (let i = 0, len = colorItems.length; i < len; i++) {
        if (colorItems[i].value)
            colorItems[i].style.backgroundColor = colorItems[i].value;
        //colorItems[i].value = "";
    }
    */
    // è®¾ç½®å–è‰²å™¨
    Colorpicker.create({
        bindClass: 'theme-color-item',
        //initColor: '',
        change: function (elem, hex) {
            // console.log(elem, hex);
            //elem.style.backgroundColor = hex;
            elem.value = hex;
            if (elem.fireEvent) {
                elem.fireEvent('onchange');
            } else { // google chrome
                let ev = document.createEvent("HTMLEvents");
                //event.initEvent(eventType,canBubble,cancelable)
                //eventType:å­—ç¬¦ä¸²å€¼ï¼Œäº‹ä»¶çš„ç±»å‹
                //canBubbleï¼šäº‹ä»¶æ˜¯å¦å†’æ³¡
                //cancelableï¼šæ˜¯å¦å¯ä»¥ç”¨preventDefault()æ–¹æ³•å–æ¶ˆäº‹ä»¶
                ev.initEvent("change", false, true);
                elem.dispatchEvent(ev);
            }
        },
        show: function (elem, hex) {
            // æ‰“å¼€å–è‰²å™¨ï¼Œæš‚æ—¶éšè—è®¾ç½®å¼¹çª—
            dialogMask.style.display = "none";
            userSettingDialog.style.display = "none";
        },
        hide: function (elem, hex) {
            // å…³é—­å–è‰²å™¨ï¼Œæ¢å¤è®¾ç½®å¼¹çª—æ˜¾ç¤º
            dialogMask.style.display = "unset";
            userSettingDialog.style.display = "unset";
        }
    });
}


// æ ¹æ® currThemeï¼Œåˆå§‹åŒ–è®¾ç½®è‡ªå®šä¹‰ä¸»é¢˜çš„å‚æ•°å€¼
function setCustomThemeVals() {
    if (!userConfig.isUseCustomTheme) return;
    if (!currTheme) return;
    try {
        let ele;
        for (let f in currTheme) {
            ele = document.getElementById(f);
            if (!ele) continue;
            // é¢œè‰²ç è½¬å°å†™
            if (currTheme[f] && typeof currTheme[f] === "string" && currTheme[f].startsWith("#")) currTheme[f] = currTheme[f].toLocaleLowerCase();
            ele.value = currTheme[f];
        }
    } catch (e) {
        console.log(e.message);
    }
}


// é‡ç½®ä¸»é¢˜
function resetThemeDefault() {
    if (confirm("âš ï¸ ç¡®å®šè¦é‡ç½®è‡ªå®šä¹‰ä¸»é¢˜å‚æ•°å—ï¼Ÿï¼ˆå»ºè®®å…ˆå¯¼å‡ºå½“å‰å‚æ•°é…ç½®ï¼Œä»¥ä¾¿ä¸‹æ¬¡é‡æ–°è°ƒæ•´ï¼‰")) { // ç¡®è®¤
        // é‡ç”»åœºæ™¯ æ–¹æ³•å†…éƒ¨ä¼šè®¾ç½®ä¸ºä¹‹å‰é€‰æ‹©çš„ä¸»é¢˜
        resetPageBg();
        // åˆ›å»ºä¸€ä¸ªæ–°ä¸»é¢˜
        currTheme = Theme.getCurrThemeCopy();
        currTheme.id = Theme.getMaxId() + 1;
        currTheme.name = "è‡ªå®šä¹‰ä¸»é¢˜01";
        currTheme.bgImageIdbKey = sysConfig.bgImageKey + currTheme.id;
        //currTheme.tbColor = Theme.setTbColor00(currTheme.tbColor); // å°é¢èƒŒæ™¯é€æ˜
        // æ›´æ–°é¡µé¢æ˜¾ç¤º
        setCustomThemeVals();
        // æ¸…ç©º indexedDB å›¾ç‰‡å­˜å‚¨
        if (indexedDB) clearTable(tbName);
        // æ›´æ–°å­˜å‚¨
        localStorage.setItem("collide-try-custom-theme", JSON.stringify(currTheme));
        localStorage.setItem("collide-try-user-settings", JSON.stringify(userConfig));
    } else { // å–æ¶ˆ

    }
}


// åˆ‡æ¢ã€å¯ç”¨è‡ªå®šä¹‰ä¸»é¢˜ã€‘å¼€å…³
function switchCustomThemeCheckbox(isShow) {
    let customThemeItems = document.getElementsByClassName("custom-theme-item");
    if (!customThemeItems || customThemeItems.length < 1) return;
    let pageBgImageIcon = document.getElementById("pageBgImageIcon");
    let customThemeInOut = document.getElementById("customThemeInOut");
    let customThemeInitStatus = document.getElementById("customThemeInitStatus");
    let resetThemeDefault = document.getElementById("resetThemeDefault");
    if (isShow) {
        // æ–‡å­—é¢œè‰²ã€è¾“å…¥æ¡†ã€æ–‡ä»¶å›¾æ ‡æ¢å¤æ­£å¸¸ã€æ˜¾ç¤ºä¸»é¢˜å¯¼å…¥å¯¼å‡º
        for (let i = 0, len = customThemeItems.length; i < len; i++) {
            customThemeItems[i].classList.remove("user-setting-item-disabled");
            customThemeItems[i].removeAttribute("disabled");
        }
        pageBgImageIcon.style.display = "inherit";
        customThemeInOut.style.display = "inherit";
        resetThemeDefault.style.display = "unset";
        // å¯ç”¨è‡ªå®šä¹‰ä¸»é¢˜
        userConfig.isUseCustomTheme = true;
        // ä»å½“å‰å¯¹è±¡æ–°å»ºä¸€ä¸ªè‡ªå®šä¹‰ä¸»é¢˜å¯¹è±¡
        let customTheme = Theme.getCustomTheme();
        if (!customTheme) { // ç¼“å­˜æ²¡æ‰¾åˆ°ï¼Œåˆ›å»ºæ–°çš„ä¸»é¢˜
            customTheme = Theme.getCurrThemeCopy();
            customTheme.id = Theme.getMaxId() + 1; // è¿™é‡Œçš„ customTheme.id è·Ÿ customTheme.bgImageIdbKey å…³è”
            customTheme.name = "è‡ªå®šä¹‰ä¸»é¢˜01";
            customTheme.bgImageIdbKey = sysConfig.bgImageKey + customTheme.id;
            customTheme.tbColor = Theme.setTbColor00(customTheme.tbColor); // å°é¢èƒŒæ™¯é€æ˜
        }
        // åˆ¤æ–­ä½¿ç”¨æ–°idï¼Œé¿å…è·Ÿåº”ç”¨è‡ªå¸¦ä¸»é¢˜idå†²çª
        if (customTheme.id <= Theme.getMaxId()) customTheme.id = Theme.getMaxId() + 1;
        //if (currTheme.id === customTheme.id) return; // ä¸»é¢˜ç›¸åŒï¼Œä¸é‡å¤è®¾ç½®
        // æ ¹æ®è‡ªå®šä¹‰ä¸»é¢˜å‚æ•°æ˜¯å¦åˆå§‹åŒ–å®Œæˆ
        // ä»¥åŠåˆ¤æ–­ currTheme å’Œç¼“å­˜ä¸­çš„ customTheme æ˜¯å¦æœ‰å˜åŒ–ï¼Œæœ‰å˜åŒ–æ‰æ‰§è¡Œè®¾ç½®
        if (customThemeInitStatus.value === "1" && isObjEquals(currTheme, customTheme)) return;
        currTheme = customTheme;
        // currTheme åŒæ­¥åˆ°è‡ªå®šä¹‰ä¸»é¢˜
        setCustomThemeVals();
        // æ›´æ–°æ˜¾ç¤ºè‡ªå®šä¹‰ä¸»é¢˜
        reDrawTableAndEgg(); // é‡ç”»å°é¢å’Œè›‹
        reDrawTableLineAndGirdNum(); // é‡ç”»å°é¢è¾¹æ¡†å’Œç –æ ¼åæ ‡
        resetPageBgColor(currTheme.bgColor); // é‡ç½®é¡µé¢èƒŒæ™¯é¢œè‰²
        doPageBgImage(currTheme.bgImage); // èƒŒæ™¯å›¾ç‰‡åœ¨è¯»å–æ•°æ®åº“æˆåŠŸçš„æ—¶å€™ä¼šè®¾ç½®
        // æ ‡è®°è‡ªå®šä¹‰ä¸»é¢˜å‚æ•°åˆå§‹åŒ–å®Œæˆ
        customThemeInitStatus.value = "1";
        // å­˜å‚¨è‡ªå®šä¹‰ä¸»é¢˜
        localStorage.setItem("collide-try-custom-theme", JSON.stringify(currTheme));
        // localStorage å­˜å‚¨æ›´æ–° userConfig å¯¹è±¡
        //localStorage.setItem('collide-try-user-settings', JSON.stringify(userConfig));
    } else {
        // æ–‡å­—å˜ç°è‰²ï¼Œè¾“å…¥æ¡†ä¸èƒ½ç‚¹å‡»ï¼Œéšè—æ–‡ä»¶å›¾æ ‡ã€éšè—ä¸»é¢˜å¯¼å…¥å¯¼å‡º
        for (let i = 0, len = customThemeItems.length; i < len; i++) {
            customThemeItems[i].classList.add("user-setting-item-disabled");
            customThemeItems[i].setAttribute("disabled", "disabled");
        }
        pageBgImageIcon.style.display = "none";
        customThemeInOut.style.display = "none";
        resetThemeDefault.style.display = "none";
        // åœç”¨è‡ªå®šä¹‰ä¸»é¢˜
        //userConfig.isUseCustomTheme = false;
        // é‡ç½®é¡µé¢èƒŒæ™¯
        resetPageBg();
        // é‡ç½®è‡ªå®šä¹‰ä¸»é¢˜å‚æ•°æ˜¾ç¤º
        //setCustomThemeVals();
        // åˆ é™¤è‡ªå®šä¹‰ä¸»é¢˜å­˜å‚¨ï¼Œå¯ä»¥ç•™ç€ï¼Œæ–¹ä¾¿ä¸‹æ¬¡å¯ç”¨æ—¶ç»§ç»­ç¼–è¾‘
        //localStorage.removeItem('collide-try-custom-theme');
        // localStorage å­˜å‚¨æ›´æ–° userConfig å¯¹è±¡
        //localStorage.setItem('collide-try-user-settings', JSON.stringify(userConfig));
    }
}


// åˆ‡æ¢æ˜¾ç¤ºswitchå¼€å…³ï¼Œå¹¶è®¾ç½®å‚æ•°å€¼
function switchCheckbox(label, key, params) {
    if (!label) return;
    //console.log(label);
    // åˆ¤æ–­æ˜¯å¦å·²é€‰æ‹©
    //let switchEle = document.getElementById(key);
    //let switchEle = label.firstElementChild;
    //let switchEle = label.target.firstElementChild;
    let switchEle = document.getElementById(key);
    let checked = switchEle.getAttribute("checked");
    //console.log(checked);
    //console.log(">>>> userConfig: ", userConfig);
    let isShow = false;
    if (checked) { // å¼€å…³å·²æ‰“å¼€ï¼Œç‚¹å‡»åå…³é—­
        switchEle.removeAttribute("checked");
        isShow = false;
        userConfig[key] = false;
        if (key === "isKuileiPullBack") userConfig.isKuileiPullBack = false;
        if (key === "isShowBallMovePath") { // è§’è‰²è¿åŠ¨è·¯å¾„å…³é—­ï¼Œå…³è”çš„è§’è‰²å…¨è·¯å¾„ä¹Ÿä¸€èµ·å…³é—­
            userConfig.isShowBallPath = false;
            document.getElementById("isShowBallPath").removeAttribute("checked");
            togglePathBallShow(isShow);
        }
        if (key === "isShowGridCoordinate") { // ç –æ ¼åæ ‡æ€»å¼€å…³å…³é—­ï¼Œå…³è”çš„ç –æ ¼å…¨åæ ‡å¼€å…³ä¹Ÿå…³é—­
            userConfig.isShowGridCoordinateFull = false;
            //document.getElementById("isShowGridCoordinateFull").removeAttribute("checked");
        }
        if (key === "isShowGridCoordinateFull") { // ç –æ ¼å…¨åæ ‡å¼€å…³å…³é—­ï¼Œå…³è”çš„ç –æ ¼åæ ‡æ€»å¼€å…³ä¿æŒåŸæ ·ï¼Œå¹¶åˆ¤æ–­æ˜¯å¦æ˜¾ç¤ºåæ ‡
            if (userConfig.isShowGridCoordinate) isShow = true;
        }
    } else { // å¼€å…³æœªæ‰“å¼€ï¼Œç‚¹å‡»åæ‰“å¼€
        switchEle.setAttribute("checked", true);
        isShow = true;
        userConfig[key] = true;
        if (key === "isShowBallPath") { // è§’è‰²å…¨è·¯å¾„æ‰“å¼€ï¼Œä¾èµ–çš„è§’è‰²è¿åŠ¨è·¯å¾„ä¹Ÿä¸€èµ·æ‰“å¼€
            userConfig.isShowBallMovePath = true;
            document.getElementById("isShowBallMovePath").setAttribute("checked", true);
            togglePathBallMoveShow(isShow);
        }
        if (key === "isShowGridCoordinateFull") { // ç –æ ¼å…¨åæ ‡å¼€å…³æ‰“å¼€ï¼Œå…³è”çš„ç –æ ¼åæ ‡æ€»å¼€å…³ä¹Ÿå¾—æ‰“å¼€
            userConfig.isShowGridCoordinate = true;
            document.getElementById("isShowGridCoordinate").setAttribute("checked", true);
        }
    }

    // canvaså›¾å±‚åˆ‡æ¢æ˜¾ç¤º
    if (params && params.canvasEle) switchCanvasShow(params.canvasEle, isShow);
    // è§’è‰²è¿åŠ¨è·¯å¾„
    if (key === "isShowBallMovePath") togglePathBallMoveShow(isShow);
    // è§’è‰²çƒä½“è·¯å¾„
    if (key === "isShowBallPath") togglePathBallShow(isShow);
    // è¡€é‡æ¡åˆ‡æ¢æ˜¾ç¤º
    if (key === "isShowRoleBloodLine" || key === "isShowRoleBloodNo")
        flushAllRoleOnce();
    // å¯ç”¨è‡ªå®šä¹‰ä¸»é¢˜å¼€å…³
    if (key === "isUseCustomTheme") switchCustomThemeCheckbox(isShow);
    // æ˜¾ç¤ºçŒ´å­åˆ†èº«æç¤º
    if (key === "isShowWkPath") reDrawTableAndEgg();

    // åªæ˜¾ç¤ºæ’å‡»å°é¢
    if (key === "isJustShowTable") {
        // éšè—/æ˜¾ç¤ºå›¾å±‚çš„æ–¹å¼
        toggleOnlyTable(isShow);
        //if (!balls || balls.length < 1) sysConfig.isNeedReload = true;
        // é‡æ–°åˆå§‹åŒ–
        //reInit(false, true);
        // é‡æ–°æ¸²æŸ“
        //animate();
    }
    // åˆ‡æ¢æ˜¾ç¤ºåœºæ™¯å›¾å½¢
    if (key === "isShowSceneGraph") toggleSceneGraph(isShow, true);

    // åˆ‡æ¢åˆ°å•ä¸ªè§’è‰²æµ‹è¯•ï¼Œéœ€è¦åˆ·æ–°é¡µé¢çš„è®¾ç½®
    //if (key === "isTestOnlyOne") sysConfig.isNeedReload = true;
    if (key === "isTestOnlyOne") {
        clearCanvasAll(canvas); // æ¸…ç©ºä¸»è¿åŠ¨å±‚ç”»å¸ƒ
        // é‡æ–°åˆå§‹åŒ–
        reInit(false, true);
    }

    // localStorage å­˜å‚¨æ›´æ–° userConfig å¯¹è±¡
    localStorage.setItem('collide-try-user-settings', JSON.stringify(userConfig));

}


// ç‚¹å‡»æŒ‰é’®ï¼Œä¸‹æ‹‰èœå•åœ¨ æ˜¾ç¤º/éšè— ä¹‹é—´åˆ‡æ¢
function toggleDropdown() {
    document.getElementById("themeDropdown").classList.toggle("show");
}


// åˆ‡æ¢æ“ä½œæ–¹å¼ï¼Œæ‹–æ‹½æˆ–ç‚¹æŒ‰ï¼Œé»˜è®¤æ‹–æ‹½
function toggleCurrPlayOpt() {
    let val = userConfig.currPlayOpt;
    if (!isNumber(val)) return;
    if (val === 1) { // 1-ç‚¹æŒ‰
        // å½“å‰ä¸ºç‚¹æŒ‰ï¼Œç‚¹å‡»ååˆ‡æ¢ä¸ºé»˜è®¤çš„æ‹–æ‹½
        val = 0;
        // éšè—å‘å°„æŒ‰é’®
        gameClickPlayCanvas.style.display = "none";
    } else { // å…¶ä»–é»˜è®¤ä¸ºæ‹–æ‹½
        // å½“å‰ä¸ºæ‹–æ‹½ï¼Œç‚¹å‡»ååˆ‡æ¢ä¸ºç‚¹æŒ‰
        val = 1;
        // æ˜¾ç¤ºå‘å°„æŒ‰é’®
        gameClickPlayCanvas.style.display = "unset";
    }

    setCurrPlayOptText(val);
    userConfig.currPlayOpt = val;
    localStorage.setItem('collide-try-user-settings', JSON.stringify(userConfig));
}


// åˆ‡æ¢ä¸»è§’æ‰€åœ¨é˜Ÿé¢œè‰²
function toggleTeamColor() {

    let val = userConfig.mainTeamColor;
    if (val === 'r') val = 'b';
    else val = 'r';

    /*
    let colorTxt = "çº¢è‰²";
    if (val === 'b') colorTxt = "è“è‰²";
    // æç¤ºç¡®è®¤
    if (confirm("ğŸ’¡ ç‚¹å‡»ç¡®å®šï¼Œå³å¯å°†ä¸»è§’é˜Ÿé¢œè‰²åˆ‡æ¢åˆ°ã€" + colorTxt + "ã€‘")) { // ç¡®è®¤
        
    } else { // å–æ¶ˆ
        return;
    }
    */

    // å‚æ•°è®¾ç½®é¡¹æ–‡å­—
    setMainTeamColorText(val);
    // è§’è‰²é˜Ÿå‹é¢œè‰²ã€è®¾ç½®è§’è‰²æ¡†é¢œè‰²
    resetMainTeamColorRandom(val);
    // æœ‰æœµæœµï¼Œéœ€è¦é‡æ–°ç”»è›‹
    if (isDuoduoExist) resetEggs();

    // è§’è‰²è¡€é‡æ¡å¼€å¯ï¼Œéœ€è¦é‡æ–°æ¸²æŸ“è§’è‰²
    if (userConfig.isShowRoleBloodLine) {
        /*
        if (selectedBall && selectedBall.isChgPosFinished) 
            selectedBall.isChgPosFinished = false; // æ ‡è®°ä¸ºæœªæ‹–åŠ¨å®Œæˆ
        directPlayAgain(false);
        */
        // é‡ç”»ä¸€æ¬¡è§’è‰²å³å¯
        flushAllRoleOnce();
    }

    // æ›´æ–°è®¾ç½®
    userConfig.mainTeamColor = val;
    localStorage.setItem('collide-try-user-settings', JSON.stringify(userConfig));
}


// åˆ‡æ¢åªæ˜¾ç¤ºæ’å‡»å°é¢ï¼Œéšè—è§’è‰²å±‚
function toggleOnlyTable(isShow) {
    // æ¸…ç©ºè·¯å¾„å±‚
    //clearCanvasAll(gamePathCanvas);
    //clearCanvasAll(gamePathBallCanvas);
    if (isShow) { // åªæ˜¾ç¤ºå°é¢
        canvas.style.display = "none";
        gameMainBallCanvas.style.display = "none";
        gamePathCanvas.style.display = "none";
        gamePathBallCanvas.style.display = "none";
    } else { // å–æ¶ˆåªæ˜¾ç¤ºå°é¢
        canvas.style.display = "unset";
        gameMainBallCanvas.style.display = "unset";
        gamePathCanvas.style.display = "unset";
        gamePathBallCanvas.style.display = "unset";
    }
}


// åˆ‡æ¢æ˜¾ç¤ºåœºæ™¯å›¾å½¢ï¼Œéšè—emojiç­‰å›¾å½¢å±‚
function toggleSceneGraph(isShow, isReDraw) {
    if (isShow) { // æ˜¾ç¤º
        gameSceneGraphCanvas.style.display = "unset";
        gameSceneEmojiCanvas.style.display = "unset";
        if (isReDraw && isCanvasBlank(gameSceneEmojiCanvas)) { // éœ€è¦é‡ç”»ä¸”ç”»å¸ƒä¸ºç©ºï¼Œå†é‡æ–°ç»˜åˆ¶å›¾å½¢
            setSceneTheme();
        }
    } else { // ä¸æ˜¾ç¤º
        gameSceneGraphCanvas.style.display = "none";
        gameSceneEmojiCanvas.style.display = "none";
    }
}


// è®¾ç½®åœºæ™¯ä¸»é¢˜å€¼
function setSceneThemeVal(ele, val) {
    //console.log(ele);
    if (!ele) return;
    if (val === undefined || val < 0) return;
    if (val === userConfig.sceneThemeMode) return;

    if (val === 2) { // æ–°å¹´ä¸»é¢˜æš‚æœªå®ç°
        alert("ğŸ®ï¼šæ•¬è¯·æœŸå¾…å“¦~");
        return;
    }

    userConfig.sceneThemeMode = val;
    setSceneThemeText(val);

    // localStorage å­˜å‚¨æ›´æ–° userConfig å¯¹è±¡
    localStorage.setItem('collide-try-user-settings', JSON.stringify(userConfig));

    // ä¿®æ”¹äº†ä¸»é¢˜ï¼Œéœ€è¦åˆ·æ–°é¡µé¢
    //sysConfig.isNeedReload = true;
    // ä¸åˆ·æ–°é‡ç”»ä¸»é¢˜
    resetPageBg();
}


// è®¾ç½®åœºæ™¯ä¸»é¢˜æ–‡å­—
function setSceneThemeText(val) {
    switch (val) {
        case 1:
            document.getElementById("sceneThemeMode").innerText = "å†°é›ªä¸»é¢˜";
            break;
        case 2:
            document.getElementById("sceneThemeMode").innerText = "æ–°å¹´ä¸»é¢˜";
            break;
        case 3:
            document.getElementById("sceneThemeMode").innerText = "ç”°å›­ä¸»é¢˜";
            break;
        case 4:
            document.getElementById("sceneThemeMode").innerText = "æ˜Ÿé™…ä¸»é¢˜";
            break;
        case 5:
            document.getElementById("sceneThemeMode").innerText = "å¤æ—¥ä¸»é¢˜";
            break;
        default:
            document.getElementById("sceneThemeMode").innerText = "é»˜è®¤ä¸»é¢˜";
    }
}


// è®¾ç½®å½“å‰æ“ä½œæ–¹å¼æ–‡å­—
function setCurrPlayOptText(val) {
    let ele = document.getElementById("currPlayOpt");
    if (val === 1) { // 1-ç‚¹æŒ‰
        ele.innerText = "ç‚¹æŒ‰";
    } else { // å…¶ä»–-é»˜è®¤æ‹–æ‹½
        ele.innerText = "æ‹–æ‹½";
    }
}


// è®¾ç½®ä¸»è§’æ‰€åœ¨é˜Ÿé¢œè‰²æ–‡å­—
function setMainTeamColorText(val) {
    //if (!val) return; // è¿™ç§æ ¡éªŒè¿”å›ï¼Œå› ä¸ºçœ‹ä¸åˆ°åç»­çš„æŠ¥é”™ä¿¡æ¯ï¼Œåè€Œå½±å“æ’æŸ¥
    let ele = document.getElementById("mainTeamColor");
    if (val === 'r') {
        ele.innerText = "çº¢è‰²";
        ele.classList.add("red");
    } else {
        ele.innerText = "è“è‰²";
        ele.classList.remove("red");
    }
}


// åˆ‡æ¢æ˜¾ç¤ºè¿åŠ¨è·¯å¾„å±‚ç”»å¸ƒ
function togglePathBallMoveShow(isShow) {
    if (isShow && userConfig.isJustShowTable) return; // åªæ˜¾ç¤ºå°é¢æ—¶ï¼Œä¸æ˜¾ç¤ºè·¯å¾„
    switchCanvasShow(gamePathCanvas, isShow);
}


// åˆ‡æ¢æ˜¾ç¤ºæœ¬ä½“è·¯å¾„å±‚ç”»å¸ƒ
function togglePathBallShow(isShow) {
    if (isShow && userConfig.isJustShowTable) return; // åªæ˜¾ç¤ºå°é¢æ—¶ï¼Œä¸æ˜¾ç¤ºè·¯å¾„
    switchCanvasShow(gamePathBallCanvas, isShow);
}


// è®¾ç½®æœ‰å˜åŠ¨ï¼Œæ‰åˆ·æ–°é¡µé¢
function reloadAfterUserConfigSettingFinished(time, isReload) {
    let t0 = localStorage.getItem('collide-try-user-settings-time');
    if (!t0) t0 = "0";
    t0 = Number(t0);
    if (time > t0) {
        localStorage.setItem('collide-try-user-settings-time', time);
        if (isReload && sysConfig.isNeedReload) location.reload();
    }
}


// æŒ‡å®šæ¸¸æˆè§’è‰²æ–‡æœ¬æ˜¾ç¤º
function setGameRoleIdsText(val) {
    //console.log(">>>> setGameRoleIdsText val=" + val);
    //console.log(">>>> setGameRoleIdsText instanceof Array=" + (val instanceof Array));
    if (!val || val.length < 1) return;
    let ele, fName;
    for (let i = 0, len = val.length; i < len; i++) {
        //console.log(">>>> setGameRoleIdsText id=" + val[i]);
        if (val[i] < 0) continue;
        ele = document.getElementById("gameRoleId" + (i + 1));
        if (!ele) continue;
        fName = Role.getFullNameById(val[i]);
        if (!fName) continue;
        ele.innerText = fName;
        //ele.setAttribute("placeholder", fName);
        ele.setAttribute("value", fName);
    }
}


// æ˜¯å¦å¯ç”¨ã€æŒ‡å®šæ¸¸æˆè§’è‰²ã€‘
function isUseGameRoleIds() {
    let result = false;
    userConfig.gameRoleIds.some(id => {
        if (id > -1) {
            result = true;
            return true; // é€€å‡ºå¾ªç¯ return false ä¹Ÿæ˜¯é€€å‡ºå¾ªç¯ï¼Œsome éå†æ²¡æœ‰ continue
        }
    });
    return result;
}


// æŒ‡å®šæ¸¸æˆè§’è‰²æ˜¯å¦å®Œæ•´ï¼Œ1-çº¢é˜Ÿä¿©ï¼›2-è“é˜Ÿä¿©ï¼›3-å…¨éƒ¨
function isUseGameRoleIdsFull(no) {
    let result = false;

    switch (no) {
        case 1:
            if (userConfig.gameRoleIds[0] > -1 && userConfig.gameRoleIds[1] > -1) result = true;
            break;
        case 2:
            if (userConfig.gameRoleIds[2] > -1 && userConfig.gameRoleIds[3] > -1) result = true;
            break;
        default:
            if (userConfig.gameRoleIds[0] > -1 && userConfig.gameRoleIds[1] > -1 && userConfig.gameRoleIds[2] > -1 && userConfig.gameRoleIds[3] > -1) result = true;
    }

    return result;
}


// å¯¼å…¥/å¯¼å‡ºè§’è‰²å’Œåæ ‡
var rolePosInput = document.getElementById("shareRoleAndPos");
var rpShareCopy = document.getElementById("rpShareCopy");
var rpShareImport = document.getElementById("rpShareImport");

onMounted(() => {
    if (!rolePosInput) rolePosInput = document.getElementById("shareRoleAndPos");
    if (!rpShareCopy) rpShareCopy = document.getElementById("rpShareCopy");
    if (!rpShareImport) rpShareImport = document.getElementById("rpShareImport");
})

// é‡ç½®åˆ†äº«å†…å®¹
function resetShareContent() {
    rolePosInput.removeAttribute('readonly', 'readonly');
    rolePosInput.value = "";
    // åˆ‡æ¢åˆ°æ˜¾ç¤ºã€å¯¼å…¥ã€‘æŒ‰é’®
    rpShareCopy.style.display = "none";
    rpShareImport.style.display = "unset";
}

// è®¾ç½®æ˜¾ç¤ºå†…å®¹
function setShareContent() {
    if (!balls || balls.length < 1) return;
    let shareObjArr = [];
    balls.some(ball => {
        // åŒå­åˆ†èº«ä¸ç”¨è®¾ç½®
        if (ball.roleId === Role.SHUANGZI.id && ball === twinBall) return;
        let shareObj = { rid: -1, x: 0, y: 0, m: 0, no: 0, tc: 'r' };
        shareObj.rid = ball.roleId;
        // åƒç´ è½¬ç –æ ¼
        let pos = { x: ball.x, y: ball.y };
        switchPxOrGird(pos, 0);
        shareObj.x = pos.x;
        shareObj.y = pos.y;
        shareObj.m = ball.isMainBall ? 1 : 0;
        shareObj.no = ball.no;
        shareObj.tc = ball.teamColor;
        shareObjArr.push(shareObj);
    });
    rolePosInput.value = JSON.stringify(shareObjArr);
    // åˆ‡æ¢åˆ°æ˜¾ç¤ºã€å¤åˆ¶ã€‘æŒ‰é’®
    rpShareCopy.style.display = "unset";
    rpShareImport.style.display = "none";
}

// å¤åˆ¶åˆ†äº«å†…å®¹
function copyShareContent() {
    rolePosInput.setAttribute('readonly', 'readonly');
    rolePosInput.setSelectionRange(0, 9999);
    rolePosInput.select();
    document.execCommand('copy');
    rpShareCopy.innerText = "âœ“";
    rpShareCopy.disabled = true;
    setTimeout(() => {
        rpShareCopy.innerText = "å¤åˆ¶";
        rpShareCopy.disabled = false;
        rolePosInput.removeAttribute('readonly', 'readonly');
    }, 5000);
}

// æ£€æŸ¥å¯¼å…¥å†…å®¹
function checkShareContent() {
    if (!rolePosInput.value || rolePosInput.value.replaceAll(" ", "") === "") return false;
    let result = false;
    try {
        let shareObjArr = JSON.parse(rolePosInput.value);
        result = true;
    } catch (e) { }
    return result;
}

// ç¡®è®¤å¯¼å…¥è§’è‰²å’Œåæ ‡
function importShareContent() {
    if (!checkShareContent()) {
        alert("è¯·æ£€æŸ¥ç²˜è´´å†…å®¹æ˜¯å¦å®Œæ•´ï¼Œæˆ–è€…æ”¹åŠ¨æ˜¯å¦æ­£ç¡®ï¼");
        return;
    }
    userConfig.shareRoleAndPos = rolePosInput.value;
    // æ›´æ–°ç¼“å­˜
    localStorage.setItem('collide-try-user-settings', JSON.stringify(userConfig));
    console.log(">>>> importShareContent userConfig in localStorage updated.");
    rpShareImport.innerText = "âœ“";
    rpShareImport.disabled = true;

    // éœ€è¦é‡æ–°åˆ·æ–°é¡µé¢
    //sysConfig.isNeedReload = true;
    // ä¸åˆ·æ–°é¡µé¢å¯¼å…¥è§’è‰²å’Œåæ ‡
    reInit(true, true);

    setTimeout(() => {
        rpShareImport.innerText = "å¯¼å…¥";
        rpShareImport.disabled = false;
    }, 5000);
}


// æµ‹è¯• some éå†
function testSomeList() {
    let arr = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9];
    console.log(">>>> testSomeList arr:", arr);
    arr.some(id => {
        if (id === 6) {
            //return true; // é€€å‡ºå¾ªç¯ï¼Œåé¢ä¸å†æ‰§è¡Œ
            return false; // continue
            //return; // continue
        }
        console.log(">>>> testSomeList:", id);
    });
    console.log(">>>> testSomeList end.");
}
//testSomeList();


// æµ‹è¯• forEach éå†
function testForEachList() {
    let arr = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9];
    console.log(">>>> testForEachList arr:", arr);
    arr.forEach(id => {
        if (id === 6) {
            //return true; // continue
            return false; // continue
            //return; // continue
        }
        console.log(">>>> testForEachList:", id);
    });
    console.log(">>>> testForEachList end.");
}
//testForEachList()


// gameRoleIds è¾“å…¥æ§åˆ¶
var gameRoleIdEles;
onMounted(() => {
    gameRoleIdEles = document.getElementsByClassName('div-input-game-roles');
    for (let i = 0, len = gameRoleIdEles.length; i < len; i++) {
        let ele = gameRoleIdEles[i];
        // è¾“å…¥ç›‘å¬
        ele.addEventListener("input", (e) => { // æ³¨æ„ï¼Œinput äº‹ä»¶æ¯æ¬¡æ¥æ”¶åˆ°çš„æ˜¯æ–°å†…å®¹
            // å¤„ç†äº‹ä»¶é»˜è®¤è¡Œä¸ºï¼Œé˜²æ­¢äº‹ä»¶å†’æ³¡
            doEventDefault(e);
            //console.log(e.target);
            // è·å–è¾“å…¥æ¡†å†…å®¹
            let inVal = e.target.innerText;
            inVal = inVal.replaceAll(" ", "");
            e.target.innerText = inVal;

            // é™åˆ¶é•¿åº¦
            if (inVal.length > 10) {
                inVal = inVal.slice(0, 11);
            }

            // è§’è‰²å…¨ç§°è‡ªåŠ¨è¡¥å…¨
            let newVal = Role.getFullNameByKeyWord(inVal);
            console.log(">>>> e.target newVal=" + newVal);
            inVal = newVal;
            e.target.innerText = inVal;
            if (!newVal) return;

            // é»˜è®¤å€¼æ›´æ–°
            e.target.setAttribute("value", inVal);

            // æ—§å€¼
            let oldVal = userConfig.gameRoleIds[i];
            //console.log(">>>> e.target oldVal=" + oldVal);
            // idè½¬å…¨ç§°
            let oldFName = Role.getFullNameById(oldVal);
            //console.log(">>>> e.target oldFName=" + oldFName);
            // ä¸¤å€¼ç›¸ç­‰ä¸å¤„ç†
            if (inVal === oldFName) return;
            // åŒé˜Ÿè§’è‰²æ ¡éªŒ
            if (!checkSomeRoleInTeam(inVal, i)) { // ä¸é€šè¿‡
                inVal = "";
                e.target.innerText = inVal;
                alert("åŒé˜Ÿè§’è‰²ä¸èƒ½ä¸€æ ·å“¦ï¼");
                return;
            }

            doGameRoleIds(inVal, i);
        });

        // æŒ‰é”®æŒ‰ä¸‹æ¾æ‰‹ç›‘å¬ï¼ŒæŒ‰ä¸‹èšç„¦ï¼›é€€æ ¼é”®åˆ é™¤é€‰æ‹©
        ele.addEventListener("keydown", (e) => { // focus ç§»åŠ¨ç«¯ä¸èƒ½è‡ªåŠ¨èšç„¦ï¼›keydown é•¿æŒ‰ä¼šè§¦å‘å¤šæ¬¡ï¼Œkeyup åªè§¦å‘ä¸€æ¬¡
            // å¤„ç†äº‹ä»¶é»˜è®¤è¡Œä¸ºï¼Œé˜²æ­¢äº‹ä»¶å†’æ³¡
            doEventDefault(e);
            //console.log(e.target);
            e.target.innerText = "";
            //ele.innerText = "";
            e.target.focus();
            //ele.focus();

            //console.log(">>>> e.keyCode=" + e.keyCode);
            // é€€æ ¼é”®åˆ é™¤é€‰æ‹©è§’è‰²ï¼Œå¹¶æ›´æ–°å­˜å‚¨
            if (e.keyCode === 8) {
                e.target.innerText = "";
                e.target.setAttribute("value", "");
                if (userConfig.gameRoleIds[i] !== -1) doGameRoleIds("", i);
            }
        });

        // å¤±ç„¦ç›‘å¬ï¼Œä¸ºç©ºè®¾ç½®é»˜è®¤å€¼
        ele.addEventListener("blur", (e) => {
            // å¤„ç†äº‹ä»¶é»˜è®¤è¡Œä¸ºï¼Œé˜²æ­¢äº‹ä»¶å†’æ³¡
            doEventDefault(e);
            //console.log(e.target);
            let text = e.target.innerText;
            if (text) return;
            let value = e.target.getAttribute("value");
            let placeholder = e.target.getAttribute("placeholder");
            if (placeholder) e.target.innerText = placeholder;
            //if (value) e.target.innerText = value;
        });

    }
})


// æ ¡éªŒåŒé˜Ÿè§’è‰²æ˜¯å¦å¯è¡Œï¼ŒåŒé˜Ÿè§’è‰²ä¸èƒ½ä¸€æ ·
function checkSomeRoleInTeam(val, idx) {
    let roleName1, roleName2, roleName3, roleName4;
    roleName1 = gameRoleIdEles[0].innerText;//.replaceAll(" ", "");
    roleName2 = gameRoleIdEles[1].innerText;
    roleName3 = gameRoleIdEles[2].innerText;
    roleName4 = gameRoleIdEles[3].innerText;

    if (idx < 2 && roleName1 && roleName2 && !roleName1.includes("è¾“å…¥") && !roleName2.includes("è¾“å…¥")) { // ä¸ä¸ºç©ºæ ¼ï¼Œä¸”ä¸æ˜¯é»˜è®¤å€¼
        if (roleName1 === roleName2) return false;
    }
    if (idx > 1 && roleName3 && roleName4 && !roleName3.includes("è¾“å…¥") && !roleName4.includes("è¾“å…¥")) {
        if (roleName3 === roleName4) return false;
    }
    return true;
}


// gameRoleIds ä¿å­˜
function doGameRoleIds(val, idx) {
    console.log(">>>> doGameRoleIds gameRoleIds input=" + val);
    // æ›´æ–°é…ç½®å€¼
    userConfig.gameRoleIds[idx] = Role.getIdByFullName(val);

    // localStorage å­˜å‚¨æ›´æ–° userConfig å¯¹è±¡
    localStorage.setItem('collide-try-user-settings', JSON.stringify(userConfig));
    console.log(">>>> doGameRoleIds userConfig.gameRoleIds in localStorage updated.");

    // æŒ‡å®šäº†æ¸¸æˆè§’è‰²ï¼Œéœ€è¦åˆ·æ–°é¡µé¢
    //sysConfig.isNeedReload = true;

    // å¦‚æœè®¾ç½®äº†ä¸»è§’ï¼Œä¸åˆ·æ–°ç›´æ¥è¿›æé€Ÿæ¨¡å¼
    if (val && idx === 0) {
        // æç¤ºä¸»è§’éœ€è¦åœ¨ã€æé€Ÿå¼€å§‹ã€‘é€‰é¡¹æ‰ä¼šç”Ÿæ•ˆ
        showGameSettingMainRoleDialog();
        userConfig.isFlashRole = true;
        setRolesFlash(userConfig.gameRoleIds, true);
    }
    // æ”¹å˜äº†éä¸»è§’ï¼Œä¸åˆ·æ–°é‡æ–°åˆå§‹åŒ–è§’è‰²æ•°æ®
    reInit(false, true);
}


// é‡ç½®æŒ‡å®šè§’è‰²
function resetGameRoleIds(ele) {
    let hasValue = false;
    for (let i = 0, len = gameRoleIdEles.length; i < len; i++) {
        let ele = gameRoleIdEles[i];
        let value = ele.getAttribute("value");
        hasValue = hasValue || value;
        let placeholder = ele.getAttribute("placeholder");
        ele.innerText = placeholder;
        ele.setAttribute("value", "");
        userConfig.gameRoleIds[i] = -1;
    }
    if (!hasValue) return;

    // localStorage å­˜å‚¨æ›´æ–° userConfig å¯¹è±¡
    localStorage.setItem('collide-try-user-settings', JSON.stringify(userConfig));
    console.log(">>>> resetGameRoleIds userConfig.gameRoleIds in localStorage updated.");

    // é‡ç½®æŒ‡å®šæ¸¸æˆè§’è‰²ï¼Œéœ€è¦åˆ·æ–°é¡µé¢
    //sysConfig.isNeedReload = true;

    // ä¸åˆ·æ–°ï¼ŒæŒ‰å½“å‰é€‰æ‹©ä¸»è§’æˆ–æ¨¡å¼é‡æ–°åˆå§‹åŒ–è§’è‰²æ•°æ®
    reInit(false, true);
}


// roleSpeedAddVal è§’è‰²åŠ é€Ÿæˆ–å‡é€Ÿ
onMounted(() => {
    const roleSpeedAddValInput = document.getElementById("roleSpeedAddVal");
    roleSpeedAddValInput.addEventListener("change", (e) => {
        // å¤„ç†äº‹ä»¶é»˜è®¤è¡Œä¸ºï¼Œé˜²æ­¢äº‹ä»¶å†’æ³¡
        doEventDefault(e);
        // è·å–è¾“å…¥æ¡†å†…å®¹
        let inVal = e.target.value;
        inVal = inVal.replaceAll(" ", "");
        e.target.value = inVal;
        if (!inVal) {
            inVal = "0";
            e.target.value = inVal;
        }
        if (!Number.isInteger(Number(inVal))) {
            alert("è¯·è¾“å…¥æ•´æ•°");
            return;
        }
        if (Number(inVal) < -20 || Number(inVal) > 200) {
            alert("æ•°å€¼èŒƒå›´ï¼š-20~200");
            return;
        }
        // æ—§å€¼
        let oldVal = userConfig.roleSpeedAddVal.toString();
        // ä¸¤å€¼ç›¸ç­‰ä¸å¤„ç†
        if (inVal === oldVal) return;

        doRoleSpeedAddVal(inVal);
    });
})


// æ‰§è¡Œå¤„ç†è§’è‰²åŠ é€Ÿ/å‡é€Ÿ
function doRoleSpeedAddVal(str) {
    //console.log(">>>> doRoleSpeedAddVal roleSpeedAddVal input=" + str);
    // æ›´æ–°é…ç½®å€¼
    userConfig.roleSpeedAddVal = Number(str);
    // localStorage å­˜å‚¨æ›´æ–° userConfig å¯¹è±¡
    localStorage.setItem('collide-try-user-settings', JSON.stringify(userConfig));
    console.log(">>>> doRoleSpeedAddVal userConfig.roleSpeedAddVal in localStorage updated.");

    // æ›´æ–°ä¸»çƒé€Ÿåº¦ï¼Œä¸ç”¨åˆ·æ–°é¡µé¢
    setSpeed();
}


// animate æ­»å¾ªç¯è‡ªåŠ¨é€€å‡º
onMounted(() => {
    const animateAutoRestTimeInput = document.getElementById("animateAutoRestTime");
    animateAutoRestTimeInput.addEventListener("change", (e) => {
        // å¤„ç†äº‹ä»¶é»˜è®¤è¡Œä¸ºï¼Œé˜²æ­¢äº‹ä»¶å†’æ³¡
        doEventDefault(e);
        // è·å–è¾“å…¥æ¡†å†…å®¹
        let inVal = e.target.value;
        inVal = inVal.replaceAll(" ", "");
        e.target.value = inVal;
        if (!inVal) {
            alert("è‡ªåŠ¨æ¢å¤æ—¶é—´ä¸èƒ½ä¸ºç©º");
            return;
        }
        if (!isATimeValValidByRegExp(inVal)) {
            alert("è¯·è¾“å…¥å¤§äºé›¶çš„æ•´æ•°");
            return;
        }
        if (Number(inVal) < 5) {
            inVal = "5";
            e.target.value = inVal;
        }
        // æ—§å€¼
        let oldVal = userConfig.animateAutoRestTime.toString();
        // ä¸¤å€¼ç›¸ç­‰ä¸å¤„ç†
        if (inVal === oldVal) return;

        doAnimateAutoRestTime(inVal);
    });
})


// å¤„ç†è‡ªåŠ¨æ¢å¤æ—¶é—´è¾“å…¥å†…å®¹
function doAnimateAutoRestTime(str) {
    //console.log(">>>> doAnimateAutoRestTime animateAutoRestTime input=" + str);
    // æ›´æ–°é…ç½®å€¼
    userConfig.animateAutoRestTime = Number(str);
    // localStorage å­˜å‚¨æ›´æ–° userConfig å¯¹è±¡
    localStorage.setItem('collide-try-user-settings', JSON.stringify(userConfig));
    console.log(">>>> doAnimateAutoRestTime userConfig.animateAutoRestTime in localStorage updated.");
}


// è‡ªå®šä¹‰ä¸»é¢˜inputè¾“å…¥æ¡†
onMounted(() => {
    const themeParamInputItems = document.getElementsByClassName("custom-theme-item-input");
    for (let i = 0, len = themeParamInputItems.length; i < len; i++) {
        let ele = themeParamInputItems[i];
        ele.addEventListener("click", (e) => {
            if (!e || !e.target || !e.target.id) return;
            doEventDefault(e);
            if (!userConfig.isUseCustomTheme) return;

        });
        ele.addEventListener("change", (e) => {
            //console.log(e.target.id);
            if (!e || !e.target || !e.target.id) return;
            doEventDefault(e);
            if (!userConfig.isUseCustomTheme) return;
            let inVal = e.target.value;
            inVal = inVal.replaceAll(" ", "");
            e.target.value = inVal;
            if (e.target.id === "name") { // ä¸»é¢˜åç§°
                if (inVal.length < 1) {
                    alert("ä¸»é¢˜åç§°ä¸èƒ½ä¸ºç©º");
                    return;
                }
                if (inVal.length > 7) {
                    alert("ä¸»é¢˜åç§°é•¿åº¦ä¸èƒ½è¶…è¿‡7");
                    return;
                }
            } else if (e.target.id === "bgImage") { // ä¸»é¢˜èƒŒæ™¯å›¾ç‰‡
                if (!isAImageFileName(inVal)) {
                    alert("è¯·æ£€æŸ¥èƒŒæ™¯å›¾ç‰‡æ ¼å¼(jpg/jpeg/png/gif)");
                    return;
                }
            } else if (["tblWidth", "glWidth", "gnSize", "plWidth", "ccWidth"].includes(e.target.id)) { // æ•°å€¼è¾“å…¥æ¡†
                if (inVal.length < 1) {
                    inVal = 0;
                    e.target.value = inVal;
                }
                if (!isNumber(inVal)) {
                    alert("è¯·è¾“å…¥æ­£ç¡®çš„æ•°å€¼");
                    return;
                }
                if (inVal.length > 5) {
                    alert("æ•°å€¼é•¿åº¦ä¸èƒ½è¶…è¿‡5");
                    return;
                }
                // è¾“å…¥æ¡†é»˜è®¤å­—ç¬¦ç±»å‹è½¬æ¢ä¸ºæ•°å€¼ç±»å‹
                inVal = Number(inVal);
                inVal = roundNumber(inVal);
            } else if (e.target.id.toLocaleLowerCase().indexOf("color")) { // é¢œè‰²ç ç±»å‹è¾“å…¥æ¡†
                if (inVal !== "" && !Theme.isColorCode(inVal)) {
                    alert("è¯·è¾“å…¥æ­£ç¡®çš„é¢œè‰²ç ï¼ˆæ ¼å¼ï¼š#ffffffffï¼‰");
                    return;
                }
                // é¢œè‰²ç ç»Ÿä¸€å°å†™
                inVal = inVal.toLocaleLowerCase();
                e.target.value = inVal;
            }
            else if (e.target.id.toLocaleLowerCase().indexOf("color")) { // é¢œè‰²ç ç±»å‹è¾“å…¥æ¡†
                if (inVal !== "" && !Theme.isColorCode(inVal)) {
                    alert("è¯·è¾“å…¥æ­£ç¡®çš„é¢œè‰²ç ï¼ˆæ ¼å¼ï¼š#ffffffffï¼‰");
                    return;
                }
                // é¢œè‰²ç ç»Ÿä¸€å°å†™
                inVal = inVal.toLocaleLowerCase();
                e.target.value = inVal;
            }
            // æ—§å€¼
            let oldVal = currTheme[e.target.id];
            // ä¸¤å€¼ç›¸ç­‰ä¸å¤„ç†
            if (inVal === oldVal) return;
            // æ›´æ–°åˆ° currTheme
            currTheme[e.target.id] = inVal;

            if (e.target.id === "name") { // ä¸»é¢˜åç§°ï¼Œä¸å¤„ç†

            } else if (e.target.id === "bgColor") { // å¤„ç†èƒŒæ™¯é¢œè‰²
                doPageBg(inVal);
            } else if (["tbColor", "glColor", "glmColor", "wkShowColor", "glWidth"].includes(e.target.id)) { // å¤„ç†å°é¢å‚æ•°å˜åŠ¨
                // æ›´æ–°ä¸»é¢˜å‚æ•°ï¼Œåªé‡ç”»å°é¢
                doUpdateCustomTheme([1]);
            } else if (["tblColor", "tblWidth"].includes(e.target.id)) { // å¤„ç†å°é¢è¾¹æ¡†å‚æ•°å˜åŠ¨
                // æ›´æ–°ä¸»é¢˜å‚æ•°ï¼Œåªé‡ç”»è¾¹æ¡†
                doUpdateCustomTheme([2]);
            } else if (["gnColor", "gndColor", "gnSize"].includes(e.target.id)) { // å¤„ç†å°é¢ç –æ ¼åæ ‡å‚æ•°å˜åŠ¨
                // æ›´æ–°ä¸»é¢˜å‚æ•°ï¼Œåªé‡ç”»ç –æ ¼åæ ‡æ•°å€¼
                doUpdateCustomTheme([2]);
            }

            // å­˜å‚¨æ›´æ–° localStorage
            localStorage.setItem("collide-try-custom-theme", JSON.stringify(currTheme));
            console.log(">>>> è‡ªå®šä¹‰ä¸»é¢˜å‚æ•° currTheme." + e.target.id + " å·²æ›´æ–°å­˜å‚¨åˆ° localStorage");
            //localStorage.setItem("collide-try-user-settings", JSON.stringify(userConfig));
            //console.log(">>>> è‡ªå®šä¹‰ä¸»é¢˜å‚æ•° userConfig in localStorage updated.");
        });
    }
})

/*
// å¤„ç†è¾“å…¥æ³•æŠŠå¼¹çª—é¡¶ä¸Šå»çš„é—®é¢˜
const vh = window.visualViewport.height;
if (!os.isPc) window.visualViewport.addEventListener('resize', function () {
    // å˜åŠ¨å¤§äº 10%ï¼Œä¸”inputèšç„¦ï¼Œæ‰è°ƒæ•´
    if ((vh - window.visualViewport.height) / vh >= 0.10
        && pageBgInput == document.activeElement) {
        userSettingDialog.style.top = "50vh";
    } else {
        userSettingDialog.style.top = "0";
    }
});
*/

// å¤„ç†ä¿®æ”¹èƒŒæ™¯é¢œè‰²
function doPageBg(code) {
    if (typeof code !== "string") {
        //if (isAImageFileName(currTheme.bgImage)) { // ä¹‹å‰æ˜¯å›¾ç‰‡èƒŒæ™¯
        // æ¢å¤è®¾ç½®å›¾ç‰‡èƒŒæ™¯æ—¶å…³é—­çš„åœºæ™¯å›¾å½¢
        userConfig.isShowSceneGraph = true;
        // åœºæ™¯å›¾å½¢å±‚æ˜¾ç¤º
        toggleSceneGraph(true);
        // æ¢å¤åˆ°è‡ªå¸¦ä¸»é¢˜
        currTheme = Theme.getCurrTheme();
        // é‡æ–°è®¡ç®—å˜åŒ–å±æ€§å€¼
        Theme.reCalculate(currTheme);
        // é‡æ–°ç»˜åˆ¶æ¸¸æˆå°é¢
        reDrawTable(code);
        // è®¾ç½®å®Œæˆ
        console.log(">>>> resetPageBg finished.");
        //}
    }

    // é‡ç½®bodyèƒŒæ™¯å›¾ç‰‡
    resetBodyImage(code, false);
}

// é‡ç½®é¡µé¢èƒŒæ™¯å›¾ç‰‡
function resetBodyImage(bgColor, isStore) {
    currTheme.bgImage = ""; // ä¸»é¢˜å›¾ç‰‡æ¸…ç©º
    document.body.style.backgroundImage = null; // bodyå›¾ç‰‡æ¸…ç©º
    // é‡ç½®é¡µé¢èƒŒæ™¯é¢œè‰²
    resetPageBgColor(bgColor);
    if (isStore) {
        localStorage.setItem("collide-try-custom-theme", JSON.stringify(currTheme));
    }
}

// é‡ç½®é¡µé¢èƒŒæ™¯
function resetPageBg(code) {
    doPageBg(code);
}


// é‡ç½®é¡µé¢èƒŒæ™¯é¢œè‰²
function resetPageBgColor(code) {
    if (Theme.isColorCode(code)) setBodyBackgroundColor(code); // è®¾ç½®èƒŒæ™¯é¢œè‰²
    else setBodyBackgroundColor(Theme.getBgColorById(userConfig.sceneThemeMode)); // æ¢å¤æ‰€é€‰ä¸»é¢˜é»˜è®¤çš„èƒŒæ™¯é¢œè‰²
}


// æ›´æ–°ä¸»é¢˜ä¿®æ”¹
function doUpdateCustomTheme(code) {
    // é‡æ–°ç»˜åˆ¶æ¸¸æˆå°é¢
    reDrawTable(code);
}


// å¯¼å…¥å¯¼å‡ºä¸»é¢˜é…ç½®
onMounted(() => {
    const customThemeInputFile = document.getElementById("customThemeInputFile");
    const customThemeConfigItems = document.getElementsByClassName("custom-theme-conf-inout");
    for (let i = 0, len = customThemeConfigItems.length; i < len; i++) {
        let ele = customThemeConfigItems[i];
        ele.addEventListener("click", (e) => {
            //console.log(e.target.id);
            if (!e || !e.target || !e.target.id) return;
            doEventDefault(e);
            if (!userConfig.isUseCustomTheme) return;
            if (e.target.id === "customThemeInput") { // å¯¼å…¥
                customThemeInputFile.click();
            } else if (e.target.id === "customThemeOutput") { // å¯¼å‡º
                saveStringContentToFile(JSON.stringify(currTheme));
            }
        });
    }
    customThemeInputFile.addEventListener("click", (e) => {
        // å¤„ç†äº‹ä»¶é»˜è®¤è¡Œä¸ºï¼Œé˜²æ­¢äº‹ä»¶å†’æ³¡ ã€ä¼šå¯¼è‡´ä¸èƒ½å¼¹å‡ºæ–‡ä»¶ç®¡ç†å™¨ã€‘
        //doEventDefault(e);

    });
    customThemeInputFile.addEventListener("change", function () {
        if (customThemeInputFile.files[0]) {
            let fName = customThemeInputFile.files[0].name;
            //fName = getFileShortName(fName, 5);
            //console.log(fName);
            if (!fName) {
                alert("ä¸»é¢˜é…ç½®æ–‡ä»¶åç§°è¯†åˆ«å¤±è´¥");
                return;
            }
            let size = customThemeInputFile.files[0].size;
            if (size > 1 * 1024 * 1024) { // é™åˆ¶1Mä»¥å†…
                alert("ä¸»é¢˜é…ç½®æ–‡ä»¶ä¸å¤§äº1M");
                return;
            }

            try {
                importThemeConfig(customThemeInputFile.files[0]);
            } catch (e) {
                alert("å¯¼å…¥ä¸»é¢˜é…ç½®å¤±è´¥");
                console.log(">>>> å¯¼å…¥ä¸»é¢˜é…ç½®å¤±è´¥ï¼š" + e.message);
            }
        } else {
            //console.log("æœªé€‰æ‹©æ–‡ä»¶");
        }
    });
})


// æŒ‡å®šé¡µé¢èƒŒæ™¯å›¾ç‰‡
onMounted(() => {
    const pageBgImageIcon = document.getElementById("pageBgImageIcon");
    const pageBgImageFile = document.getElementById("pageBgImageFile");
    pageBgImageIcon.addEventListener("click", (e) => {
        // å¤„ç†äº‹ä»¶é»˜è®¤è¡Œä¸ºï¼Œé˜²æ­¢äº‹ä»¶å†’æ³¡
        doEventDefault(e);
        // ç‚¹å‡»æ–‡ä»¶å›¾æ ‡è§¦å‘é€‰æ‹©æ–‡ä»¶ç‚¹å‡»äº‹ä»¶
        pageBgImageFile.click();
    });
    pageBgImageFile.addEventListener("click", (e) => {
        // å¤„ç†äº‹ä»¶é»˜è®¤è¡Œä¸ºï¼Œé˜²æ­¢äº‹ä»¶å†’æ³¡ ã€ä¼šå¯¼è‡´ä¸èƒ½å¼¹å‡ºæ–‡ä»¶ç®¡ç†å™¨ã€‘
        //doEventDefault(e);
        //alert("è¯·é€‰æ‹©ä¸€å¼ å›¾ç‰‡");
        pageBgImageFile.value = ""; // æ¸…ç©ºå·²é€‰æ‹©çš„æ–‡ä»¶ï¼Œæ²¡æ•ˆæœ
        if (!userConfig.isUseCustomTheme) return;
        if (!indexedDB) {
            alert("ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒ IndexedDB V" + dbVersion + "ï¼Œè¯·æ›´æ¢å…¶ä»–æµè§ˆå™¨é‡è¯•");
        }
    });
    if (indexedDB) pageBgImageFile.addEventListener("change", (event) => {
        if (pageBgImageFile.files[0]) {
            let fName = pageBgImageFile.files[0].name;
            fName = getFileShortName(fName, 5);
            //console.log(fName);
            if (!fName) {
                alert("å›¾ç‰‡åç§°è¯†åˆ«å¤±è´¥");
                return;
            }
            let size = pageBgImageFile.files[0].size;
            if (size > 10 * 1024 * 1024) { // é™åˆ¶10Mä»¥å†…
                alert("å›¾ç‰‡ä¸èƒ½å¤§äº10M");
                return;
            }

            try {
                // å­˜å…¥IndexedDB
                //alert(pageBgImageFile.files[0] instanceof Blob);
                putImageInDb(pageBgImageFile.files[0], currTheme.bgImageIdbKey);
                // ä»IndexedDBè¯»å–å›¾ç‰‡ï¼Œå¹¶è®¾ç½®bodyå›¾ç‰‡èƒŒæ™¯
                doPageBgImage(fName, false);
                // æ¸…ç©ºå·²é€‰æ‹©çš„æ–‡ä»¶ï¼Œè§£å†³ç¬¬äºŒæ¬¡é€‰æ‹©ç›¸åŒçš„æ–‡ä»¶ä¸ä¼šè§¦å‘change
                event.target.value = ""; // æ²¡æ•ˆæœ
                pageBgImageFile.value = ""; // æ²¡æ•ˆæœ
            } catch (e) {
                alert("è®¾ç½®èƒŒæ™¯å›¾ç‰‡å¤±è´¥ï¼š\n" + e.stack);
                doGlobalErrorMsg(e, false);
            }
        } else {
            //console.log("æœªé€‰æ‹©æ–‡ä»¶");
        }
    });
})


// å¤„ç†ä¿®æ”¹èƒŒæ™¯å›¾ç‰‡
function doPageBgImage(fName, isOnlySetBg) {

    if (!userConfig.isUseCustomTheme || !isAImageFileName(fName)) return;

    let transaction = IDB.transaction([tbName], 'readwrite');
    let tableStore = transaction.objectStore(tbName);
    // ä»indexedDBè¯»å–å›¾ç‰‡è®¾ç½®èƒŒæ™¯
    doSetBodyBgImage(tableStore, fName);

    if (!isOnlySetBg) {
        //if (!isAImageFileName(currTheme.bgImage)) { // ä¹‹å‰ä¸æ˜¯å›¾ç‰‡èƒŒæ™¯
        // æ›´æ–°å­˜å‚¨èƒŒæ™¯å›¾ç‰‡
        currTheme.bgImage = fName;
        // å°é¢è®¾ç½®ä¸ºé€æ˜
        currTheme.tbColor = Theme.setTbColor00(currTheme.tbColor);
        // è®¾ç½®åœºæ™¯å›¾å½¢ä¸æ˜¾ç¤º
        userConfig.isShowSceneGraph = false;
        // åœºæ™¯å›¾å½¢å±‚éšè—
        toggleSceneGraph(false);
        // é‡æ–°ç»˜åˆ¶æ¸¸æˆå°é¢
        reDrawTable();
        // è®¾ç½®å®Œæˆ
        console.log(">>>> doPageBgImage finished.");
        //}
    }

    // æ›´æ–°è‡ªå®šä¹‰ä¸»é¢˜å­˜å‚¨
    localStorage.setItem("collide-try-custom-theme", JSON.stringify(currTheme));
    // localStorage å­˜å‚¨æ›´æ–° userConfig å¯¹è±¡
    localStorage.setItem('collide-try-user-settings', JSON.stringify(userConfig));
}


// æ‰§è¡Œè®¾ç½®å›¾ç‰‡èƒŒæ™¯æ“ä½œ
function doSetBodyBgImage(tableStore, fName) {
    let getKeyReq = tableStore.get(currTheme.bgImageIdbKey);
    getKeyReq.onsuccess = (event) => {
        // æ³¨æ„æ˜¯å¼‚æ­¥å›è°ƒï¼Œä¸é˜»å¡ä¸»çº¿ç¨‹
        let blob = event.target.result;
        if (blob) {
            let url = window.URL.createObjectURL(blob);
            //console.log(url);
            // è®¾ç½® body å›¾ç‰‡èƒŒæ™¯
            document.body.style.backgroundImage = `url('${url}')`; // å›¾ç‰‡åœ°å€
            document.body.style.backgroundPosition = "center"; // å›¾ç‰‡ä½ç½®
            if (os.isPc) {
                document.body.style.backgroundRepeat = "repeat"; // å›¾ç‰‡å¹³é“º
                document.body.style.backgroundSize = "contain"; // å¡«å……é¡µé¢
            } else {
                document.body.style.backgroundRepeat = "no-repeat"; // å›¾ç‰‡ä¸å¹³é“º
                document.body.style.backgroundSize = "cover"; // å•ä¸ªå°é¢
            }
            // è®¾ç½®æ–‡ä»¶åç§°æ˜¾ç¤º
            document.getElementById("bgImage").value = fName;
        } else { // æ–‡ä»¶è·å–å¤±è´¥
            document.getElementById("bgImage").value = "";
        }
    }
    getKeyReq.onerror = function (event) {
        document.getElementById("bgImage").value = "";
    }
}


// æ–œè¾¹å€¾æ–œåå·®è¾“å…¥æ¡†å¤±å»ç„¦ç‚¹æ—¶ï¼Œä¿å­˜æ•°æ®
onMounted(() => {
    const wan8CocosTableMoveValsInput = document.getElementById("wan8CocosTableMoveVals");
    wan8CocosTableMoveValsInput.addEventListener("change", (e) => {
        // å¤„ç†äº‹ä»¶é»˜è®¤è¡Œä¸ºï¼Œé˜²æ­¢äº‹ä»¶å†’æ³¡
        doEventDefault(e);
        // è·å–è¾“å…¥æ¡†å†…å®¹
        let inVal = e.target.value;
        inVal = inVal.replaceAll(" ", "");
        e.target.value = inVal;
        if (!inVal) {
            alert("æ–œè¾¹å€¾æ–œåå·®è¾“å…¥å†…å®¹ä¸èƒ½ä¸ºç©º");
            return;
        }
        // æ—§å€¼
        let oldVal = userConfig.wan8CocosTableMoveVals.toString();
        // ä¸¤å€¼ç›¸ç­‰ä¸å¤„ç†
        if (inVal === oldVal) return;

        doWan8CocosTableMoveVals(inVal);
    });
})


// å¤„ç†æ–œè¾¹å€¾æ–œåå·®è¾“å…¥å†…å®¹
function doWan8CocosTableMoveVals(str) {
    //console.log(">>>> doWan8CocosTableMoveVals wan8CocosTableMoveVals input=" + str);
    if (!isMoveValValidByRegExp(str)) {
        alert("æ–œè¾¹å€¾æ–œåå·®è¾“å…¥å†…å®¹æ ¼å¼ä¸ç¬¦åˆè¦æ±‚");
        return;
    }
    if (!isMoveValValidBySplit(str)) return;

    // æ›´æ–°é…ç½®å€¼
    userConfig.wan8CocosTableMoveVals = str.split(",");
    // localStorage å­˜å‚¨æ›´æ–° userConfig å¯¹è±¡
    localStorage.setItem('collide-try-user-settings', JSON.stringify(userConfig));
    console.log(">>>> doWan8CocosTableMoveVals userConfig.wan8CocosTableMoveVals in localStorage updated.");

    // ä¿®æ”¹äº†å°é¢æ–œè¾¹å€¾æ–œè§’åº¦ï¼Œéœ€è¦åˆ·æ–°é¡µé¢
    //sysConfig.isNeedReload = true;

    // åˆå§‹åŒ–å°é¢åˆ‡è§’
    initTableAngle();
    // é‡ç”»å°é¢
    reDrawTableAndEgg();
    clearCanvasAll(gameSceneLinesCanvas);
    clearCanvasAll(gameSceneLinesBgCanvas);
    if (userConfig.isShowTableBorder) doDrawTableLines();
}


// æ­£åˆ™æ ¡éªŒæ–œè¾¹å€¾æ–œåå·®è¾“å…¥å†…å®¹
function isMoveValValidByRegExp(str) {
    return /^([\-]?[0]{1}[\.]?[\d]*[\,]?[\s]*)*$/.test(str);
}


// æ­£åˆ™æ ¡éªŒå¤§äº0çš„æ­£æ•´æ•°
function isATimeValValidByRegExp(str) {
    return /^[1-9]\d*$/.test(str);
}


// åˆ†å‰²æ ¡éªŒæ–œè¾¹å€¾æ–œåå·®è¾“å…¥å†…å®¹
function isMoveValValidBySplit(str) {
    //str = str.replaceAll(" ", "");
    let wan8CocosTableMoveValsIn = str.split(",");
    // åˆ†å‰²åæ˜¯å¦æœ‰å€¼
    if (!wan8CocosTableMoveValsIn) {
        alert("æ–œè¾¹å€¾æ–œåå·®è¾“å…¥å†…å®¹æœ‰è¯¯");
        return false;
    }
    // æ˜¯å¦åªè®¾ç½®äº†ä¸€ä¸ª0
    if (wan8CocosTableMoveValsIn.length === 1 && Number(wan8CocosTableMoveValsIn[0]) === 0) {
        // å…è®¸è®¾ç½®ä¸€ä¸ª0
    } else if (wan8CocosTableMoveValsIn.length != 8) {
        alert("æ–œè¾¹å€¾æ–œåå·®å€¼ä¸ªæ•°æœ‰è¯¯");
        return false;
    }
    // å•ä¸ªå€¼æ˜¯å¦ç¬¦åˆè¦æ±‚
    for (let i = 0; i < wan8CocosTableMoveValsIn.length; i++) {
        let num = Number(wan8CocosTableMoveValsIn[i]);
        //console.log(">>>> num[" + i + "]=" + num);
        if (!num && num !== 0) {
            alert("æ–œè¾¹å€¾æ–œåå·®å¿…é¡»ä¸ºæ•°å€¼");
            return false;
        }
        if (num < -0.5 || num > 0.5) {
            alert("æ–œè¾¹å€¾æ–œåå·®ç»å¯¹å€¼ä¸èƒ½è¶…è¿‡0.5");
            return false;
        }
    }
    return true;
}


// æ¢å¤é»˜è®¤è®¾ç½®
function resetUserSettings() {
    if (confirm("âš ï¸ ç¡®å®šè¦æ¢å¤é»˜è®¤è®¾ç½®å—ï¼Ÿ")) { // ç¡®è®¤
        // æ¸…é™¤ localStorage sessionStorage ä¸­ï¼Œç«™ç‚¹è‡ªèº«å­˜å‚¨çš„æ•°æ®
        Object.keys(localStorage).forEach(item => item.startsWith('collide-try') ? localStorage.removeItem(item) : '');
        Object.keys(sessionStorage).forEach(item => item.startsWith('collide-try') ? sessionStorage.removeItem(item) : '');
        // clear() ä¼šæ¸…é™¤å½“å‰ç½‘é¡µåŸŸåä¸‹çš„ç¼“å­˜æ•°æ®ï¼å½±å“æœ¬ç«™å…¶ä»–åº”ç”¨ç¼“å­˜æ•°æ®ï¼æ³¨æ„ï¼Œæ‰€æœ‰ html æœ¬åœ°æ–‡ä»¶ï¼Œåªç®—ä¸€ä¸ª file:// åŸŸ
        //localStorage.clear();
        //sessionStorage.clear();
        // åˆ é™¤ IndexedDB æ•°æ®åº“ã€ä¼šå¯¼è‡´IDB undefinedï¼Œåˆ·æ–°é¡µé¢æ²¡ç”¨ï¼Œé‡å¯æµè§ˆå™¨æ‰èƒ½æ¢å¤æ­£å¸¸ã€‘
        // TODO æœ€å¥½æ˜¯æ¸…é™¤è¡¨æ•°æ®å°±è¡Œäº†ï¼Œæ•°æ®åº“å’Œè¡¨ç•™ç€ï¼Œé¿å…é‡æ–°åˆ›å»º
        if (indexedDB) clearTable(tbName);
        // åˆ·æ–°é¡µé¢ã€vue é‡æ–°åŠ è½½åï¼Œå†å²è®°å½•æ¸…ç©ºã€‘
        location.reload();
        // href æˆ– replace éƒ½å¯ä»¥æ›¿æ¢å½“å‰ history è·³è½¬é¡µé¢ï¼Œé¿å…ä¸€æ­¥ä¸€æ­¥è¿”å›
        //window.location.href = "#";
        //window.location.replace("#");
        // replaceState æ›¿æ¢ history ä¸­çš„ state
        //window.history.replaceState(null, "", "#");
        //window.history.go(0);
    } else { // å–æ¶ˆ

    }
}


// å¯¼å…¥ä¸»é¢˜é…ç½®
function importThemeConfig(file) {
    let reader = new FileReader();
    reader.readAsText(file, "UTF-8"); // TODO æ³¨æ„æ˜¯å¼‚æ­¥è¯»å–æ–‡ä»¶å†…å®¹ï¼Œå‡  KB çš„å°æ–‡ä»¶è¿˜æ˜¯å¾ˆå¿«çš„
    reader.onload = function (e) {
        //let content = e.target.result;
        let content = reader.result;
        //console.log(content);
        if (!content) return;
        let customThemeIn;
        try {
            customThemeIn = JSON.parse(content);
            console.log(">>>> importThemeConfig: " + content);
            if (customThemeIn.id <= Theme.getMaxId()) {
                alert("å¯¼å…¥ä¸»é¢˜ä¸åº”ç”¨è‡ªå¸¦ä¸»é¢˜å†²çª");
                console.log(">>>> å¯¼å…¥ä¸»é¢˜ä¸åº”ç”¨è‡ªå¸¦ä¸»é¢˜å†²çª id: " + customThemeIn.id + "-" + Theme.getNameById(customThemeIn.id));
                return;
            }
        } catch (e2) {
            alert("é…ç½®æ–‡ä»¶è§£æå¤±è´¥");
            console.log(">>>> importThemeConfig JSON.parse error: " + e.message);
            return;
        }

        if (currTheme.id <= Theme.getMaxId()) {
            alert("åº”ç”¨è‡ªå¸¦çš„ä¸»é¢˜ä¸æ”¯æŒä¿®æ”¹");
            console.log(">>>> åº”ç”¨è‡ªå¸¦çš„ä¸»é¢˜ä¸æ”¯æŒä¿®æ”¹ id: " + currTheme.id + "-" + Theme.getNameById(currTheme.id));
            return;
        }

        for (let f in currTheme) {
            currTheme[f] = customThemeIn[f];
        }

        // æœ‰å›¾ç‰‡åˆ™è®¾ç½®èƒŒæ™¯å›¾ç‰‡å¹¶é‡ç”»å°é¢
        if (isAImageFileName(currTheme.bgImage) && currTheme.bgImageIdbKey) doPageBgImage(currTheme.bgImage);
        // æ²¡æœ‰å›¾ç‰‡åˆ™æ¸…ç©ºä¹‹å‰çš„å›¾ç‰‡ï¼Œå¹¶é‡ç”»å°é¢
        else {
            // é‡ç½®bodyèƒŒæ™¯å›¾ç‰‡
            resetBodyImage(currTheme.bgColor, false);
            // é‡ç”»æ•´ä¸ªå°é¢ï¼ˆå°é¢ã€è¾¹æ¡†ã€åæ ‡ã€å›¾å½¢ï¼‰
            reDrawTable();
        }

        // åˆ·æ–°é¡µé¢æ•°æ®æ˜¾ç¤º
        setCustomThemeVals();

        // æ›´æ–° localStorage ä¸­çš„ currTheme
        localStorage.setItem('collide-try-custom-theme', JSON.stringify(currTheme));
        console.log(">>>> importThemeConfig currTheme in localStorage updated.");

        alert("ä¸»é¢˜é…ç½®å¯¼å…¥å®Œæˆ");
        //location.reload();
        // è®¾ç½®å®Œæˆ
        console.log(">>>> importThemeConfig finished.");
    }
    reader.onerror = function (e) {
        //console.log(reader.error);
        console.log(">>>> importThemeConfig error: " + e.message);
    }
}


// ä¿å­˜æ–‡æœ¬å†…å®¹åˆ°æ–‡ä»¶
function saveStringContentToFile(content) {
    if (!content) return;
    let objectURL, aTag, blob, file;
    try {
        let fName = "collide-try-theme-" + currTheme.name + "-" + sysConfig.version + ".txt";
        if (!objectURL) file = new File([content], {
            type: "text/plain;charset=utf-8"
        });
        // ç”Ÿæˆé“¾æ¥
        if (!objectURL) objectURL = (window.URL || window.webkitURL).createObjectURL(file);
        // åˆ›å»ºä¸€ä¸ª a æ ‡ç­¾Tag
        aTag = document.createElement('a');
        //aTag.style.display = 'none';
        //aTag.setAttribute('id', 'blob-download-save-to-local');
        // è®¾ç½®æ–‡ä»¶çš„ä¸‹è½½åœ°å€
        aTag.href = objectURL;
        console.log(">>>> saveStringContentToFile aTag.href=" + aTag.href);
        //aTag.target = '_blank';
        //document.body.appendChild(aTag);
        // è®¾ç½®ä¿å­˜åçš„æ–‡ä»¶åç§°
        aTag.download = fName;
        console.log(">>>> saveStringContentToFile aTag.download=" + aTag.download);
        //if (!os.isPc) alert(">>>> saveLocalHtml aTag.download=" + aTag.download);
        // ç‚¹å‡»è§¦å‘
        aTag.click();
        //aTag.remove();
        //document.body.removeChild(aTag);
    } catch (e) {
        doGlobalError(e, (sysConfig && sysConfig.alertErrorCount) ? sysConfig.alertErrorCount : 3);
    } finally {
        setTimeout(function () {
            // é‡Šæ”¾æ‰blobå¯¹è±¡ï¼Œå‡å°‘å†…å­˜å ç”¨ TODO ã€ç§»åŠ¨ç«¯å› ä¸ºå¤ªå¿«é‡Šæ”¾äº†èµ„æºï¼Œå¯¼è‡´ä¸€ç›´æç¤ºâ€œå¤„ç† blob æ•°æ®ä¸­...â€ï¼Œä¸èƒ½æ­£å¸¸ä¸‹è½½ã€‘
            if (objectURL) URL.revokeObjectURL(objectURL);
            // ç§»é™¤å…ƒç´ ï¼Œbodyæ²¡æœ‰æ·»åŠ å°±ä¸ç”¨ç§»é™¤
            //if (aTag) aTag.remove();
        }, 20000); // 20 ç§’åå†æ‰§è¡Œ
    }
}


// ä¿å­˜å½“å‰ç½‘é¡µ
// https://blog.csdn.net/qq_45677671/article/details/125905454
// https://www.jianshu.com/p/ee5e2963f243
function saveLocalHtml(ele) {

    if (!checkAccessKey()) return;

    let isConfirm = false;
    let t0 = localStorage.getItem('collide-try-save-remote-html-time');
    if (!t0) t0 = "0";
    t0 = Number(t0);
    if (t0 <= 0) { // æç¤ºå¦å¤–ä¿å­˜æ–¹æ³•
        let titleEle = document.getElementsByTagName("title")[0];
        let fileFullName = "xxxx.html";
        if (titleEle) fileFullName = titleEle.innerText + ".html";
        if (!fileFullName.includes("è§’åº¦ç»ƒä¹ ")) fileFullName = "xxxx.html";
        //if (confirm("ğŸ’¡ æ¸©é¦¨æç¤ºï¼š\nå¦‚æœé•¿æ—¶é—´æ²¡ååº”ï¼Œå¯èƒ½æ˜¯é“¾æ¥ä¸å¯ç”¨äº†ï¼Œä½¿ç”¨ç”µè„‘æµè§ˆå™¨ Ctrl+S ä¹Ÿå¯ä»¥ä¿å­˜ç¦»çº¿ç‰ˆå“¦ï¼")) { // ç¡®è®¤
        if (confirm("ğŸ’¡ æ¸©é¦¨æç¤ºï¼š\nç‚¹ã€ç¡®å®šã€‘åï¼Œä¼šå¼¹å‡ºä¸‹è½½å¯¹è¯æ¡†ï¼Œè¯·è‡ªè¡Œå°†å¯¹è¯æ¡†ä¸­çš„æ–‡ä»¶æ ¼å¼æ”¹ä¸ºã€" + fileFullName + "ã€‘ï¼Œæ–‡ä»¶åå¯ä»¥éšæ„ï¼Œä½†æ–‡ä»¶åç¼€ä¸€å®šè¦ä¸º â€œ.htmlâ€ æ‰èƒ½æ‰“å¼€è¿è¡Œå“¦ï¼")) { // ç¡®è®¤
            //localStorage.setItem('collide-try-save-remote-html-time', new Date().getTime());
            isConfirm = true;
        } else { // å–æ¶ˆ
            isConfirm = false;
        }
    }
    if (!isConfirm) return;

    // ç§»é™¤bodyçš„styleå±æ€§
    let bodyStyle = document.body.getAttribute('style');
    if (bodyStyle) document.body.removeAttribute('style');
    // é€‰æ‹©è§’è‰²å¼¹çª—æ˜¯å¦æ­£åœ¨æ˜¾ç¤º
    let chooseShowing = isDialogShowing(chooseRoleDialog);
    // åˆ‡æ¢å‚æ•°è®¾ç½®ä¸é€‰æ‹©è§’è‰²å¼¹çª—
    switchUserSettingDialog(false);
    // éšè—å…³é—­æ‰€æœ‰dialogå¼¹çª—ï¼Œä¿è¯ç¦»çº¿ç‰ˆåˆšæ‰“å¼€ä¸ä¼šä¸€ç›´æœ‰å¼¹çª—
    hideAllDialog();

    // æ²¡æœ‰è¾“å…¥æ­£ç¡®çš„è®¿é—®å¯†é’¥ï¼Œç§»é™¤æ ¸å¿ƒæ–¹æ³•
    if (!checkAccessKey()) {
        let eles = document.getElementsByClassName("collide-try-core-code");
        if (eles) removeCoreScript(eles, null);
    }

    let objectURL, aTag;
    try {
        let titleEle = document.getElementsByTagName('title')[0];
        let htmlStr = htmlEle.outerHTML;
        let blob, file;
        /*
        if (!objectURL) blob = new Blob([htmlStr], {
            type: "text/plain;charset=utf-8"
        });
        */
        if (!objectURL) file = new File([htmlStr], titleEle.innerText + ".html", {
            type: "text/plain;charset=utf-8"
        });
        // ç”Ÿæˆé“¾æ¥
        if (!objectURL) objectURL = (window.URL || window.webkitURL).createObjectURL(file);
        // åˆ›å»ºä¸€ä¸ª a æ ‡ç­¾Tag
        aTag = document.createElement('a');
        //aTag.style.display = 'none';
        //aTag.setAttribute('id', 'blob-download-save-to-local');
        // è®¾ç½®æ–‡ä»¶çš„ä¸‹è½½åœ°å€
        aTag.href = objectURL;
        console.log(">>>> saveLocalHtml aTag.href=" + aTag.href);
        //aTag.target = '_blank';
        //document.body.appendChild(aTag);
        // è®¾ç½®ä¿å­˜åçš„æ–‡ä»¶åç§°
        aTag.download = document.getElementsByTagName('title')[0].innerText + ".html";
        //aTag.download = file.name;
        console.log(">>>> saveLocalHtml aTag.download=" + aTag.download);
        //if (!os.isPc) alert(">>>> saveLocalHtml aTag.download=" + aTag.download);
        // ç‚¹å‡»è§¦å‘
        aTag.click();
        //aTag.remove();
        //document.body.removeChild(aTag);
    } catch (e) {
        doGlobalError(e, (sysConfig && sysConfig.alertErrorCount) ? sysConfig.alertErrorCount : 3);
    } finally {
        setTimeout(function () {
            // é‡Šæ”¾æ‰blobå¯¹è±¡ï¼Œå‡å°‘å†…å­˜å ç”¨ TODO ã€ç§»åŠ¨ç«¯å› ä¸ºå¤ªå¿«é‡Šæ”¾äº†èµ„æºï¼Œå¯¼è‡´ä¸€ç›´æç¤ºâ€œå¤„ç† blob æ•°æ®ä¸­...â€ï¼Œä¸èƒ½æ­£å¸¸ä¸‹è½½ã€‘
            if (objectURL) URL.revokeObjectURL(objectURL);
            // ç§»é™¤å…ƒç´ ï¼Œbodyæ²¡æœ‰æ·»åŠ å°±ä¸ç”¨ç§»é™¤
            //if (aTag) aTag.remove();
        }, 20000); // 20 ç§’åå†æ‰§è¡Œ
    }

    // æ“ä½œå®Œæˆåï¼Œå†æ¢å¤åŸæ ·
    if (bodyStyle) document.body.setAttribute('style', bodyStyle);
    if (chooseShowing) switchDialogShow(chooseRoleDialog, true);
    switchUserSettingDialog(true);

}


// ä¸‹è½½ç½‘ç»œæ–‡ä»¶
function saveRemoteHtml(ele) {

    if (!checkAccessKey()) {
        alert("è¯·å…ˆè¾“å…¥æ­£ç¡®çš„è®¿é—®å¯†é’¥ï¼");
        return;
    }

    let isConfirm = false;
    let t0 = localStorage.getItem('collide-try-save-remote-html-time');
    if (!t0) t0 = "0";
    t0 = Number(t0);
    if (t0 <= 0) { // æç¤ºå¦å¤–ä¿å­˜æ–¹æ³•
        //alert("ğŸ’¡ æ¸©é¦¨æç¤ºï¼š\nè”ç½‘è¯·æ±‚ä¸‹è½½ä¸€ä¸ªç¦»çº¿ç‰ˆæ–‡ä»¶ï¼ˆå‡ ç™¾KBï¼‰ï¼Œå¦‚æœé•¿æ—¶é—´æ²¡ååº”ï¼Œå¯èƒ½æ˜¯é“¾æ¥ä¸å¯ç”¨äº†ï¼Œä½¿ç”¨ç”µè„‘æµè§ˆå™¨ Ctrl+S ä¹Ÿå¯ä»¥ä¿å­˜ç¦»çº¿ç‰ˆå“¦ï¼");
        if (confirm("ğŸ’¡ æ¸©é¦¨æç¤ºï¼š\nè”ç½‘è¯·æ±‚ä¸‹è½½ä¸€ä¸ªç¦»çº¿ç‰ˆæ–‡ä»¶ï¼ˆå‡ ç™¾KBï¼‰ï¼Œå¦‚æœé•¿æ—¶é—´æ²¡ååº”ï¼Œå¯èƒ½æ˜¯é“¾æ¥ä¸å¯ç”¨äº†ï¼Œä½¿ç”¨ç”µè„‘æµè§ˆå™¨ Ctrl+S ä¹Ÿå¯ä»¥ä¿å­˜ç¦»çº¿ç‰ˆå“¦ï¼")) { // ç¡®è®¤
            //localStorage.setItem('collide-try-save-remote-html-time', new Date().getTime());
            isConfirm = true;
        } else { // å–æ¶ˆ
            isConfirm = false;
        }
    }
    if (!isConfirm) return;

    let titleEle = document.getElementsByTagName('title')[0];
    let accessKey = localStorage.getItem('collide-try-access-key'); // TODO accessKey æ›´æ–°åï¼Œnginx ä¹Ÿè¦åŒæ­¥æ›´æ–° hashCode
    let url = "https://www.m1yellow.cn/collide-try?k=" + hashCode(accessKey) + "&f=" + titleEle.innerText + ".html"; // collide-try æœ«å°¾ä¼šè‡ªåŠ¨åŠ ä¸Š /
    console.log(">>>> saveRemoteHtml url=" + url);
    window.location.href = url; // æ‰‹æœºç§»åŠ¨ç«¯ä¸‹è½½åä¼šåœç•™åœ¨ç©ºç™½é¡µé¢
    // è¿”å›åŸæ¥åœ°å€ï¼Œç§»åŠ¨ç«¯è¿˜æ˜¯æ²¡ç”¨
    //history.back();
}


// éšè—å…³é—­æ‰€æœ‰dialogå¼¹çª—
function hideAllDialog() {
    let dialogs = document.getElementsByClassName("collide-try-dialog");
    //console.log(dialogs);
    if (!dialogs || dialogs.length < 1) return;
    for (let i = 0, len = dialogs.length; i < len; i++) {
        dialogs[i].style.display = "none";
    }
}


// ç›®å‰å·²æœ‰çš„è‡ªå®šä¹‰dialogå¼¹çª—ç¡®è®¤æŒ‰é’®é¢œè‰²ï¼Œè®¾ç½®ä¸ºè·Ÿæ’å‡»å°é¢ä¸€æ ·çš„é¢œè‰²
// åœ¨ drawSceneBg() è®¾ç½®å®ŒèƒŒæ™¯è‰²çš„æ—¶å€™è°ƒç”¨
function setDialogOkColor(cVal) {
    let dialogOks = document.getElementsByClassName("collide-try-dialog-ok");
    //console.log(dialogOks);
    if (!dialogOks || dialogOks.length < 1) return;
    if (!cVal) cVal = "chartreuse";
    for (let i = 0, len = dialogOks.length; i < len; i++) {
        dialogOks[i].style.background = cVal;
    }
}


//////////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////////
// ã€å·¥å…·ç±»ç›¸å…³ã€‘ å˜é‡ã€æ–¹æ³•åŒºåŸŸ å…±ç”¨å‡½æ•° é€šç”¨å‡½æ•° å…¬å…±å‡½æ•° å‡½æ•°åŒºåŸŸ
//////////////////////////////////////////////////////////////////////

// æ˜¯å¦ä¸ºæ•°å€¼ç±»å‹
function isNumber(value) {
    return !isNaN(parseFloat(value)) && isFinite(value);
}

// ä¿ç•™æŒ‡å®šå°æ•°ä½æ•°ï¼Œé»˜è®¤ä¸¤ä½
function roundNumber(num, decimals = 2) {
    if (isNaN(num)) return -1;
    if (typeof num === 'string') num = Number(num);
    if (num === 0) return 0;
    return Math.round(num * Math.pow(10, decimals)) / Math.pow(10, decimals);
}


// æŒ‡å®šå°æ•°ä½ï¼Œä¸å¤Ÿè¡¥0
function roundNumberStr(num, decimals = 2) {
    let f = Math.round(num * Math.pow(10, decimals)) / Math.pow(10, decimals);
    let s = f.toString();
    let rs = s.indexOf('.');
    if (rs < 0) {
        s += '.';
    }
    for (let i = s.length - s.indexOf('.'); i <= decimals; i++) {
        s += "0";
    }
    return s;
}


// è·å–(n,m)èŒƒå›´éšæœºæ•°
// https://cloud.tencent.com/developer/article/1629795
function fullOpen(n, m) {
    if (m <= n) return n;
    let result = Math.random() * (m - n) + n;
    while (result === n) {
        result = Math.random() * (m - n) + n;
    }
    return result;
}


// [n, m] æ•´æ•° Math.random() -> [0, 1) ä¹‹é—´çš„ä¼ªéšæœºæµ®ç‚¹æ•°
function fullCloseInt(n, m) {
    return Math.floor(Math.random() * (m - n + 1)) + n;
}
/*
for (let i = 0; i < 100; i++) {
    console.log(Role.getRandomRoleId());
}
*/


// éšæœºç”ŸæˆæŒ‡å®šé•¿åº¦å­—ç¬¦ä¸²
function randomString(len) {
    var str = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
    var result = '';
    for (var i = 0; i < len; i++)
        result += str[Math.floor(Math.random() * str.length)];
    return result;
}


// å­—ç¬¦ä¸²å“ˆå¸Œ
// https://segmentfault.com/q/1010000042400796
function hashCode(str) {
    var hash = 0, i, chr;
    if (str.length === 0) return hash;
    for (i = 0; i < str.length; i++) {
        chr = str.charCodeAt(i);
        hash = ((hash << 5) - hash) + chr;
        hash |= 0; // Convert to 32bit integer
    }
    return Math.abs(hash);
}


//https://blog.csdn.net/qq_45039540/article/details/112554604
//äº¤é›†
function arrayIntersect(a, b) {
    return a.filter(function (v) { return b.indexOf(v) > -1 });
}
//å·®é›†
function arrayMinus(a, b) {
    return a.filter(function (v) { return b.indexOf(v) == -1 });
}
//è¡¥é›†
function arrayComplement(a, b) {
    return a.filter(function (v) { return !(b.indexOf(v) > -1) }).concat(b.filter(function (v) { return !(a.indexOf(v) > -1) }));
}
//å¹¶é›†
function arrayUnionSet(a, b) {
    return a.concat(b.filter(function (v) { return !(a.indexOf(v) > -1) }));
}
//å»é‡
function arrayUnique(array) {
    let n = [];
    for (let i = 0; i < array.length; i++) {
        if (n.indexOf(array[i]) == -1) n.push(array[i]);
    }
    return n;
}


// ä¸¤å¹³é¢âšªæ˜¯å¦ç¢°æ’ ä¸¤åœ†ç¢°æ’ ä¸¤çƒç¢°æ’
function is2CirclesCollided(ball0, ball1) {
    return (ball0.x - ball1.x) ** 2 + (ball0.y - ball1.y) ** 2 <= (ball0.radius + ball1.radius) ** 2 + sysConfig.epsilon;
}


// åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰
function isObjEquals(s, t) {
    return !isObjectChanged(s, t);
}

// åˆ¤æ–­å¯¹è±¡æ˜¯å¦æ”¹å˜
// https://blog.csdn.net/qq_25742631/article/details/105581625
function isObjectChanged(source, comparison) {
    const iterable = (data) => ['Object', 'Array'].includes(getDataType(data));
    if (!iterable(source)) {
        throw new Error(`source should be a Object or Array , but got ${getDataType(source)}`);
    }

    if (getDataType(source) !== getDataType(comparison)) {
        return true;
    }

    const sourceKeys = Object.keys(source);

    const comparisonKeys = Object.keys({
        ...source,
        ...comparison
    });

    if (sourceKeys.length !== comparisonKeys.length) {
        return true;
    }

    return comparisonKeys.some(key => {
        if (iterable(source[key])) {
            return isObjectChanged(source[key], comparison[key]);
        } else {
            return source[key] !== comparison[key];
        }
    });
}

// åˆ¤æ–­æ•°æ®ç±»å‹
function getDataType(data) {
    const temp = Object.prototype.toString.call(data);
    const type = temp.match(/\b\w+\b/g);
    return (type.length < 2) ? 'Undefined' : type[1];
}


// https://juejin.cn/post/6844904025587105800
// https://docs.cocos.com/creator/3.8/api/zh/class/Intersection2D?id=polygonCircle
/**
 * !#en Test polygon and circle
 * !#zh å¤šè¾¹å½¢ä¸åœ†å½¢æ˜¯å¦ç›¸äº¤
 * @method polygonCircle
 * @param {Vec2[]} polygon - The Polygon, a set of points
 * @param {Object} circle - Object contains position and radius
 * @return {boolean}
 * @typescript polygonCircle(polygon: Vec2[], circle: {position: Vec2, radius: number}): boolean
 */
function polygonCircle(polygon, circle) {
    // å…ˆåˆ¤æ–­åœ†å¿ƒæœ‰æ²¡æœ‰åœ¨å¤šè¾¹å½¢å†…ï¼Œå¦‚æœåœ¨ï¼Œä¸€å®šç›¸äº¤
    var position = circle.position;
    if (pointInPolygon(position, polygon)) {
        return true;
    }
    // å¦åˆ™éå†å¤šè¾¹å½¢çš„æ¯ä¸€æ¡è¾¹ï¼Œå¦‚æœåœ†å½¢åˆ°è¾¹çš„è·ç¦»å°äºåœ†çš„åŠå¾„ï¼Œåˆ™ç›¸äº¤
    for (var i = 0, l = polygon.length; i < l; i++) {
        var start = i === 0 ? polygon[polygon.length - 1] : polygon[i - 1];
        var end = polygon[i];

        if (pointLineDistance(position, start, end, true) < circle.radius) {
            return true;
        }
    }

    return false;
}


/**
 * !#en Test whether the point is in the polygon
 * !#zh æµ‹è¯•ä¸€ä¸ªç‚¹æ˜¯å¦åœ¨ä¸€ä¸ªå¤šè¾¹å½¢ä¸­
 * @method pointInPolygon
 * @param {Vec2} point - The point
 * @param {Vec2[]} polygon - The polygon, a set of points
 * @return {boolean}
 */
function pointInPolygon(point, polygon) {
    // å°„çº¿æ³•åˆ¤æ–­ç‚¹æ˜¯å¦åœ¨å¤šè¾¹å½¢å†…
    // ç‚¹å°„çº¿ï¼ˆå‘å³æ°´å¹³ï¼‰ä¸å¤šè¾¹å½¢ç›¸äº¤ç‚¹çš„ä¸ªæ•°ä¸ºå¥‡æ•°åˆ™è®¤ä¸ºè¯¥ç‚¹åœ¨å¤šè¾¹å½¢å†…
    // ç‚¹å°„çº¿ï¼ˆå‘å³æ°´å¹³ï¼‰ä¸å¤šè¾¹å½¢ç›¸äº¤ç‚¹çš„ä¸ªæ•°ä¸ºå¶æ•°åˆ™è®¤ä¸ºè¯¥ç‚¹ä¸åœ¨å¤šè¾¹å½¢å†…
    var inside = false;
    var x = point.x;
    var y = point.y;

    // use some raycasting to test hits
    // https://github.com/substack/point-in-polygon/blob/master/index.js
    var length = polygon.length;

    for (var i = 0, j = length - 1; i < length; j = i++) {
        var xi = polygon[i].x, yi = polygon[i].y,
            xj = polygon[j].x, yj = polygon[j].y,
            intersect = ((yi > y) !== (yj > y)) && (x < (xj - xi) * (y - yi) / (yj - yi) + xi);
        if (intersect) inside = !inside;
    }

    return inside;
}


/**
 * !#en Calculate the distance of point to line.
 * !#zh è®¡ç®—ç‚¹åˆ°ç›´çº¿çš„è·ç¦»ã€‚å¦‚æœè¿™æ˜¯ä¸€æ¡çº¿æ®µå¹¶ä¸”å‚è¶³ä¸åœ¨çº¿æ®µå†…ï¼Œåˆ™ä¼šè®¡ç®—ç‚¹åˆ°çº¿æ®µç«¯ç‚¹çš„è·ç¦»ã€‚
 * @method pointLineDistance
 * @param {Vec2} point - The point
 * @param {Vec2} start - The start point of line
 * @param {Vec2} end - The end point of line
 * @param {boolean} isSegment - whether this line is a segment
 * @return {number}
 */
function pointLineDistance0(point, start, end, isSegment) {
    var dx = end.x - start.x;
    var dy = end.y - start.y;
    var d = dx * dx + dy * dy;
    var t = ((point.x - start.x) * dx + (point.y - start.y) * dy) / d;
    var p;

    if (!isSegment) {
        p = cc.v2(start.x + t * dx, start.y + t * dy);
    } else {
        if (d) {
            if (t < 0) p = start;
            else if (t > 1) p = end;
            else p = cc.v2(start.x + t * dx, start.y + t * dy);
        } else {
            p = start;
        }
    }

    dx = point.x - p.x;
    dy = point.y - p.y;

    return Math.sqrt(dx * dx + dy * dy);
}


// https://wenku.csdn.net/answer/c6b3a1a81b2048048988115b13bd5e74#:~:text=%E5%88%A4%E6%96%AD%E5%9C%86%E6%98%AF%E5%90%A6%E4%B8%8E%E5%A4%9A%E8%BE%B9%E5%BD%A2%E7%9A%84%E8%BE%B9%E7%9B%B8%E4%BA%A4%E3%80%82%20%E5%A6%82%E6%9E%9C%E5%9C%86%E5%BF%83%E5%88%B0%E8%BE%B9%E7%9A%84%E8%B7%9D%E7%A6%BB%E5%B0%8F%E4%BA%8E%E7%AD%89%E4%BA%8E%E5%8D%8A%E5%BE%84%EF%BC%8C%E5%88%99%E8%A1%A8%E7%A4%BA%E7%9B%B8%E4%BA%A4%E3%80%82%20%E5%88%A4%E6%96%AD%E5%9C%86%E6%98%AF%E5%90%A6%E5%9C%A8%E5%A4%9A%E8%BE%B9%E5%BD%A2%E5%86%85%E9%83%A8%E3%80%82,%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%E5%B0%84%E7%BA%BF%E6%B3%95%EF%BC%8C%E4%BB%8E%E5%9C%86%E5%BF%83%E5%8F%91%E5%87%BA%E4%B8%80%E6%9D%A1%E5%B0%84%E7%BA%BF%EF%BC%8C%E5%A6%82%E6%9E%9C%E4%B8%8E%E5%A4%9A%E8%BE%B9%E5%BD%A2%E7%9A%84%E8%BE%B9%E4%BA%A4%E7%82%B9%E7%9A%84%E6%95%B0%E9%87%8F%E4%B8%BA%E5%A5%87%E6%95%B0%EF%BC%8C%E5%88%99%E8%A1%A8%E7%A4%BA%E5%9C%86%E5%9C%A8%E5%A4%9A%E8%BE%B9%E5%BD%A2%E5%86%85%E9%83%A8%E3%80%82%20%E6%A0%B9%E6%8D%AE%E6%AD%A5%E9%AA%A42%E5%92%8C%E6%AD%A5%E9%AA%A43%E7%9A%84%E7%BB%93%E6%9E%9C%E6%9D%A5%E5%88%A4%E6%96%AD%E5%9C%86%E4%B8%8E%E5%A4%9A%E8%BE%B9%E5%BD%A2%E6%98%AF%E5%90%A6%E7%9B%B8%E4%BA%A4%E3%80%82%20%E5%A6%82%E6%9E%9C%E6%9C%89%E4%B8%80%E6%9D%A1%E8%BE%B9%E7%9B%B8%E4%BA%A4%E6%88%96%E5%9C%86%E5%9C%A8%E5%A4%9A%E8%BE%B9%E5%BD%A2%E5%86%85%E9%83%A8%EF%BC%8C%E5%88%99%E8%A1%A8%E7%A4%BA%E7%9B%B8%E4%BA%A4%EF%BC%8C%E5%90%A6%E5%88%99%E4%B8%8D%E7%9B%B8%E4%BA%A4%E3%80%82
function pointLineDistance(point, start, end) {
    let x = point.x;
    let y = point.y;
    let x1 = start.x;
    let y1 = start.y;
    let x2 = end.x;
    let y2 = end.y;
    let cross = (x2 - x1) * (x - x1) + (y2 - y1) * (y - y1);
    if (cross <= 0) {
        return Math.sqrt((x - x1) * (x - x1) + (y - y1) * (y - y1));
    }
    let d2 = (x2 - x1) * (x2 - x1) + (y2 - y1) * (y2 - y1);
    if (cross >= d2) {
        return Math.sqrt((x - x2) * (x - x2) + (y - y2) * (y - y2));
    }
    let r = cross / d2;
    let px = x1 + (x2 - x1) * r;
    let py = y1 + (y2 - y1) * r;
    return Math.sqrt((x - px) * (x - px) + (y - py) * (y - py));
}


// https://codereview.stackexchange.com/questions/192477/circle-line-segment-collision
// çº¿æ®µä¸åœ†æ˜¯å¦ç›¸äº¤ï¼Œç”±äºçº¿æ®µæ˜¯å®šé•¿çš„ï¼Œæ£€æµ‹ä¸å‡†ç¡®ã€‚å‘é‡å½¢å¼çš„æ£€æµ‹åç»­å†ç ”ç©¶
// Function to check intercept of line seg and circle
// A,B end points of line segment
// C center of circle
// radius of circle
// returns true if touching or crossing else false   
function doesLineInterceptCircle(A, B, C, radius) {
    var dist;
    const v1x = B.x - A.x;
    const v1y = B.y - A.y;
    const v2x = C.x - A.x;
    const v2y = C.y - A.y;
    // get the unit distance along the line of the closest point to
    // circle center
    const u = (v2x * v1x + v2y * v1y) / (v1y * v1y + v1x * v1x);


    // if the point is on the line segment get the distance squared
    // from that point to the circle center
    if (u >= 0 && u <= 1) {
        dist = (A.x + v1x * u - C.x) ** 2 + (A.y + v1y * u - C.y) ** 2;
    } else {
        // if closest point not on the line segment
        // use the unit distance to determine which end is closest
        // and get dist square to circle
        dist = u < 0 ?
            (A.x - C.x) ** 2 + (A.y - C.y) ** 2 :
            (B.x - C.x) ** 2 + (B.y - C.y) ** 2;
    }
    return dist < radius * radius;
}


// canvasåˆ¶ä½œåœ†è§’çŸ©å½¢ï¼ˆåŒ…æ‹¬å¡«å……çŸ©å½¢çš„åŠŸèƒ½ï¼‰å…¼å®¹æ—§æœºå‹å’Œæµè§ˆå™¨
// https://juejin.cn/post/6977212150439739423
/**è¯¥æ–¹æ³•ç”¨æ¥ç»˜åˆ¶ä¸€ä¸ªæœ‰å¡«å……è‰²çš„åœ†è§’çŸ©å½¢ 
*@param cxt:canvasçš„ä¸Šä¸‹æ–‡ç¯å¢ƒ 
*@param x:å·¦ä¸Šè§’xè½´åæ ‡ 
*@param y:å·¦ä¸Šè§’yè½´åæ ‡ 
*@param width:çŸ©å½¢çš„å®½åº¦ 
*@param height:çŸ©å½¢çš„é«˜åº¦ 
*@param radius:åœ†çš„åŠå¾„ 
*@param fillColor:å¡«å……é¢œè‰² 
**/
function fillRoundRect(cxt, x, y, width, height, radius, /*optional*/ fillColor) {
    //åœ†çš„ç›´å¾„å¿…ç„¶è¦å°äºçŸ©å½¢çš„å®½é«˜          
    if (2 * radius > width || 2 * radius > height) { return false; }

    cxt.save();
    cxt.translate(x, y);
    //ç»˜åˆ¶åœ†è§’çŸ©å½¢çš„å„ä¸ªè¾¹  
    drawRoundRectPath(cxt, width, height, radius);
    cxt.fillStyle = fillColor || "#000"; //è‹¥æ˜¯ç»™å®šäº†å€¼å°±ç”¨ç»™å®šçš„å€¼å¦åˆ™ç»™äºˆé»˜è®¤å€¼  
    cxt.fill();
    cxt.restore();
}


/**è¯¥æ–¹æ³•ç”¨æ¥ç»˜åˆ¶åœ†è§’çŸ©å½¢ 
 *@param cxt:canvasçš„ä¸Šä¸‹æ–‡ç¯å¢ƒ 
 *@param x:å·¦ä¸Šè§’xè½´åæ ‡ 
 *@param y:å·¦ä¸Šè§’yè½´åæ ‡ 
 *@param width:çŸ©å½¢çš„å®½åº¦ 
 *@param height:çŸ©å½¢çš„é«˜åº¦ 
 *@param radius:åœ†çš„åŠå¾„ 
 *@param lineWidth:çº¿æ¡ç²—ç»† 
 *@param strokeColor:çº¿æ¡é¢œè‰² 
 **/
function strokeRoundRect(cxt, x, y, width, height, radius, /*optional*/ lineWidth, /*optional*/ strokeColor) {
    //åœ†çš„ç›´å¾„å¿…ç„¶è¦å°äºçŸ©å½¢çš„å®½é«˜          
    if (2 * radius > width || 2 * radius > height) { return false; }

    cxt.save();
    cxt.translate(x, y);
    //ç»˜åˆ¶åœ†è§’çŸ©å½¢çš„å„ä¸ªè¾¹  
    drawRoundRectPath(cxt, width, height, radius);
    cxt.lineWidth = lineWidth || 2; //è‹¥æ˜¯ç»™å®šäº†å€¼å°±ç”¨ç»™å®šçš„å€¼å¦åˆ™ç»™äºˆé»˜è®¤å€¼2  
    cxt.strokeStyle = strokeColor || "#000";
    cxt.stroke();
    cxt.restore();
}

function drawRoundRectPath(cxt, width, height, radius) {
    cxt.beginPath(0);
    //ä»å³ä¸‹è§’é¡ºæ—¶é’ˆç»˜åˆ¶ï¼Œå¼§åº¦ä»0åˆ°1/2PI  
    cxt.arc(width - radius, height - radius, radius, 0, Math.PI / 2);

    //çŸ©å½¢ä¸‹è¾¹çº¿  
    cxt.lineTo(radius, height);

    //å·¦ä¸‹è§’åœ†å¼§ï¼Œå¼§åº¦ä»1/2PIåˆ°PI  
    cxt.arc(radius, height - radius, radius, Math.PI / 2, Math.PI);

    //çŸ©å½¢å·¦è¾¹çº¿  
    cxt.lineTo(0, radius);

    //å·¦ä¸Šè§’åœ†å¼§ï¼Œå¼§åº¦ä»PIåˆ°3/2PI  
    cxt.arc(radius, radius, radius, Math.PI, Math.PI * 3 / 2);

    //ä¸Šè¾¹çº¿  
    cxt.lineTo(width - radius, 0);

    //å³ä¸Šè§’åœ†å¼§  
    cxt.arc(width - radius, radius, radius, Math.PI * 3 / 2, Math.PI * 2);

    //å³è¾¹çº¿  
    cxt.lineTo(width, height - radius);
    cxt.closePath();
}


/**
 * å°†é¢œè‰²å€¼rgbæ ¼å¼è½¬æ¢ä¸ºhexçš„æ ¼å¼
 * @param {rgb} rgb éœ€è¦è½¬æ¢çš„rgbå­—ç¬¦ä¸²
 * @return {string} å¸¦#çš„é¢œè‰²ç 
 */
function rgbToHex(rgb) {
    if (!rgb) return "";
    let arr = rgb
        .replace("rgb", "")
        .replace("(", "")
        .replace(")", "")
        .replaceAll(" ", "")
        .split(",");
    // è½¬åå…­è¿›åˆ¶
    let h = parseInt(arr[0]).toString(16).padStart(2, '0');
    let e = parseInt(arr[1]).toString(16).padStart(2, '0');
    let x = parseInt(arr[2]).toString(16).padStart(2, '0');
    let a = arr[3] ? (Math.round(255 * Number(arr[3])).toString(16).padStart(2, '0')) : "ff";
    return ("#" + h + e + x + a).toLocaleLowerCase();
}
//let rgb = "rgb(5, 19, 44)";
//console.log(rgbToHex(rgb)); // #05132c
//let rgb = "rgb(5, 19, 44, 0.5)";
//console.log(rgbToHex(rgb)); // #05132c80


/**
 * å°†é¢œè‰²å€¼hexæ ¼å¼è½¬æ¢ä¸ºrgbçš„æ ¼å¼
 * @param {hex} hex å­—ç¬¦ä¸²
 * @return {string} rgb å­—ç¬¦ä¸²
 */
function hexToRgb(hex) {
    var a = parseInt(((hex.indexOf('#') > -1 && hex.length == 9) ? hex.substring(7, 9) : "FF"), 16) * (1 / 255);
    var hex = parseInt(((hex.indexOf('#') > -1) ? hex.substring(1, 7) : hex), 16);
    //return {r: hex >> 16, g: (hex & 0x00FF00) >> 8, b: (hex & 0x0000FF), a: Number(a.toFixed(2))};
    return `rgb(${hex >> 16}, ${(hex & 0x00FF00) >> 8}, ${(hex & 0x0000FF)}, ${a.toFixed(2)})`;
}
//let hex = "#05132c";
//console.log(hexToRgb(hex)); // rgb(5, 19, 44, 1.00)
//let hex = "#05132c80";
//console.log(hexToRgb(hex)); // rgb(5, 19, 44, 0.50)


// æ–‡ä»¶åç¼©çŸ­
function getFileShortName(name, len) {
    if (!name || typeof name !== 'string' || name.replaceAll(" ", "") === "") return "";
    if (name.length <= len) return name;
    let nameSegs = name.split(".");
    if (nameSegs.length < 2) return name;
    let suffix = nameSegs[nameSegs.length - 1].replaceAll(" ", "");
    if (suffix) suffix = "." + suffix;
    if (name.length - suffix.length <= len) return name;
    let result = name.substring(0, len) + "~" + suffix;
    return result;
}


// åˆ¤æ–­æ˜¯å¦ä¸ºå›¾ç‰‡ï¼Œç®€å•ä»æ–‡ä»¶ååç¼€åˆ¤æ–­
function isAImageFileName(name) {
    if (!name || typeof name !== 'string' || name.replaceAll(" ", "") === "") return false;
    let nameSegs = name.split(".");
    if (nameSegs.length < 2) return false;
    let suffix = nameSegs[nameSegs.length - 1];
    suffix = suffix.replaceAll(" ", "").toLowerCase();
    if (["jpg", "jpeg", "png", "gif"].indexOf(suffix) < 0) return false;
    return true;
}


// ç”»ç®­å¤´
//https://fedev.cn/canvas/drawing-arrow.html
function drawArrow(ctx, fromX, fromY, toX, toY, theta, headlen, width, color) {

    theta = typeof (theta) != 'undefined' ? theta : 30;
    headlen = typeof (theta) != 'undefined' ? headlen : 10;
    width = typeof (width) != 'undefined' ? width : 1;
    color = typeof (color) != 'color' ? color : '#000';

    // è®¡ç®—å„è§’åº¦å’Œå¯¹åº”çš„P2,P3åæ ‡
    var angle = Math.atan2(fromY - toY, fromX - toX) * 180 / Math.PI,
        angle1 = (angle + theta) * Math.PI / 180,
        angle2 = (angle - theta) * Math.PI / 180,
        topX = headlen * Math.cos(angle1),
        topY = headlen * Math.sin(angle1),
        botX = headlen * Math.cos(angle2),
        botY = headlen * Math.sin(angle2);

    ctx.save();
    ctx.beginPath();

    var arrowX = fromX - topX,
        arrowY = fromY - topY;

    ctx.moveTo(arrowX, arrowY);
    ctx.moveTo(fromX, fromY);
    ctx.lineTo(toX, toY);
    arrowX = toX + topX;
    arrowY = toY + topY;
    ctx.moveTo(arrowX, arrowY);
    ctx.lineTo(toX, toY);
    arrowX = toX + botX;
    arrowY = toY + botY;
    ctx.lineTo(arrowX, arrowY);
    ctx.strokeStyle = color;
    ctx.lineWidth = width;
    ctx.stroke();
    ctx.restore();
}


//////////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////////
// ã€ç¢°æ’è¾¹ç•Œæ£€æµ‹ã€‘ å˜é‡ã€æ–¹æ³•åŒºåŸŸ
//////////////////////////////////////////////////////////////////////

let concurrentCollided = false;

// å¢™é¢ç¢°æ’æ£€æµ‹
// isCheck è¡¨ç¤ºæ˜¯å¦ä¸ºè·¯å¾„æ£€æµ‹ï¼Œç›®å‰è·¯å¾„æ£€æµ‹åªéœ€è¦æ‹¿åˆ°ç¬¬ä¸€ä¸ªç¢°æ’ç‚¹å³å¯è¿”å›
function checkWalls(ball, isCheck) {

    ball.isWallCollided = false; // é‡ç½®ç¢°æ’æ ‡å¿—

    // å¤‡ä»½ç¢°æ’ç‚¹åæ ‡å’Œé€Ÿåº¦
    ball.collidedP0.x = ball.x;
    ball.collidedP0.y = ball.y;
    // é€Ÿåº¦åªåœ¨ç¬¬ä¸€ä¸ªæ£€æµ‹ä¸­å¤‡ä»½
    ball.collidedV0.x = ball.vx;
    ball.collidedV0.y = ball.vy;

    // å¢™é¢ç¢°æ’äº†ï¼Œè¿˜è¦åˆ¤æ–­åˆ‡é¢ã€è›‹åˆ‡é¢æ˜¯å¦ä¹Ÿç¢°æ’äº†
    let lc = false; // åˆ‡çº¿ç¢°æ’æ£€æµ‹
    let ec = false; // è›‹åˆ‡é¢ç¢°æ’æ£€æµ‹

    // åˆå§‹åæ ‡æ£€æµ‹ï¼Œåˆ†èº«åˆå§‹ä½ç½®ï¼Œä¸æ£€æµ‹ç¢°æ’
    if (!isRoleHideBody(ball)) {
        // è¾¹ç•Œåå¼¹ã€ç¢°æ’åé€Ÿåº¦åå‘ã€‘
        //console.log(">>>> ball.x - ball.radius = " + (ball.x - ball.radius));
        if (ball.x - ball.radius <= 0) { // å·¦å¢™é¢
            ball.isCollided = true; // ç¢°æ’
            ball.isWallCollided = true;
            if (!isCheck) ball.collidedCount += 1; // æ€»ç¢°æ’æ¬¡æ•° +1
            if (!isCheck) ball.wallCollidedCount += 1; // å¢™å£ç¢°æ’æ¬¡æ•° +1
            ball.x = ball.radius + 1 * dpr; // 1 * dpr é¿å…ç¢°æ’åœˆç”»å‡ºå¢™é¢
            // æ”¹å˜äº†xçš„ä½ç½®ï¼Œè¿˜è¦æ‰¾åˆ°å¯¹åº”çš„yä½ç½®
            setXOrY(ball, ball.collidedP0, false);
            console.log(">>>> å·¦å¢™é¢-" + ball.getBallDesc() + "-æ’å‡»ç‚¹åæ ‡ï¼šx=" + ball.x + ", y=" + ball.y);
            // TODO å¢™é¢ç¢°æ’åæ ‡æ›´æ–°åï¼Œè¿˜è¦è·å–åˆ‡é¢ç¢°æ’çŠ¶æ€ï¼Œå¦‚æœåˆ‡é¢ä¹Ÿç¢°æ’äº†ï¼Œåˆ«æ”¹å˜è¿åŠ¨é€Ÿåº¦æ–¹å‘
            lc = checkLineCollided(ball);
            //if (isDuoduoExist) ec = checkEggCollided(ball);
            // ç¢°æ’æ£€æµ‹æˆ–è€…æ¨¡æ‹Ÿè¿åŠ¨ï¼Œæ‹¿åˆ°ç¬¬ä¸€ä¸ªç¢°æ’ç‚¹ï¼Œå°±å¯ä»¥ç›´æ¥è¿”å›äº†
            if (isCheck && !lc && !ec && recordCollidedPoint(ball) && !isRoleCanPierces()) return true;
            // ç»˜ç”»ç¢°æ’è™šçº¿åœ†åœˆ
            if (!lc && !ec && (!selectedBall || !isRoleCanPierces())) ball.drawCollidedPos();
            // TODO èƒ½é‡æŸè€—ã€åªæ”¹å˜ä¸€ä¸ªæ–¹å‘çš„é€Ÿåº¦å¤§å°ï¼Œä¼šå¯¼è‡´å…¥å°„ã€å‡ºå°„è§’åº¦ä¸æ»¡è¶³åå°„å®šå¾‹ã€‘
            //ball.vx *= -sysConfig.bounce;
            if (!lc && !ec) ball.vx *= -1; // é€Ÿåº¦åå‘
            // åå¼¹ç³»æ•°ä½œç”¨åœ¨åˆé€Ÿåº¦ä¸Š
            checkBounce(ball);
        } else if (ball.x + ball.radius >= canvas.width) { // å³å¢™é¢
            ball.isCollided = true;
            ball.isWallCollided = true;
            if (!isCheck) ball.collidedCount += 1;
            if (!isCheck) ball.wallCollidedCount += 1;
            ball.x = canvas.width - ball.radius - 1 * dpr;
            setXOrY(ball, ball.collidedP0, false);
            console.log(">>>> å³å¢™é¢-" + ball.getBallDesc() + "-æ’å‡»ç‚¹åæ ‡ï¼šx=" + ball.x + ", y=" + ball.y);
            lc = checkLineCollided(ball);
            //if (isDuoduoExist) ec = checkEggCollided(ball);
            if (isCheck && !lc && !ec && recordCollidedPoint(ball) && !isRoleCanPierces()) return true;
            if (!lc && !ec && (!selectedBall || !isRoleCanPierces())) ball.drawCollidedPos();
            if (!lc && !ec) ball.vx *= -1;
            checkBounce(ball);
        }

        if (ball.y - ball.radius <= 0) { // ä¸Šå¢™é¢
            ball.isCollided = true;
            ball.isWallCollided = true;
            if (!isCheck) ball.collidedCount += 1;
            if (!isCheck) ball.wallCollidedCount += 1;
            ball.y = ball.radius + 1 * dpr;
            setXOrY(ball, ball.collidedP0, true);
            console.log(">>>> ä¸Šå¢™é¢-" + ball.getBallDesc() + "-æ’å‡»ç‚¹åæ ‡ï¼šx=" + ball.x + ", y=" + ball.y);
            lc = checkLineCollided(ball);
            if (isDuoduoExist && isCheckEgg(ball, isCheck)) ec = checkEggCollided(ball);
            if (isCheck && !lc && !ec && recordCollidedPoint(ball) && !isRoleCanPierces()) return true;
            if (!lc && !ec && (!selectedBall || !isRoleCanPierces())) ball.drawCollidedPos();
            if (!lc && !ec) ball.vy *= -1;
            checkBounce(ball);
        } else if (ball.y + ball.radius >= canvas.height) { // ä¸‹å¢™é¢
            //console.log(">>>> ä¸‹å¢™é¢-æ’å‡»ç‚¹ï¼š" + ball.radius);
            ball.isCollided = true;
            ball.isWallCollided = true;
            if (!isCheck) ball.collidedCount += 1;
            if (!isCheck) ball.wallCollidedCount += 1;
            ball.y = canvas.height - ball.radius - 1 * dpr;
            setXOrY(ball, ball.collidedP0, true);
            console.log(">>>> ä¸‹å¢™é¢-" + ball.getBallDesc() + "-æ’å‡»ç‚¹åæ ‡ï¼šx=" + ball.x + ", y=" + ball.y);
            lc = checkLineCollided(ball);
            if (isDuoduoExist && isCheckEgg(ball, isCheck)) ec = checkEggCollided(ball);
            if (isCheck && !lc && !ec && recordCollidedPoint(ball) && !isRoleCanPierces()) return true;
            if (!lc && !ec && (!selectedBall || !isRoleCanPierces())) ball.drawCollidedPos();
            if (!lc && !ec) ball.vy *= -1;
            checkBounce(ball);
        }
    }

    ball.isCheckFinished = false;
    //console.log(">>>> checkWalls isCheckFinished=" + ball.isCheckFinished);
    drawAndUpdate(ball, isCheck); // ç»˜åˆ¶å°çƒå¹¶æ›´æ–°é€Ÿåº¦
}


// å•ç‹¬æ£€æµ‹å¢™é¢æ˜¯å¦ç¢°æ’
function checkWallCollided(ball, isChPos) {
    // è§’è‰²åˆ†èº«åˆå§‹ä½ç½®ï¼Œä¸ç”¨ç®¡
    if (isRoleHideBody(ball)) return false;

    if (ball.x - ball.radius <= 0) { // å·¦å¢™é¢
        //console.log(">>>> å·¦å¢™é¢-æ’å‡»ç‚¹åæ ‡ï¼šx=" + ball.x + ", y=" + ball.y);
        if (isChPos) ball.x = ball.radius + 1 * dpr;
        return true;
    } else if (ball.x + ball.radius >= canvas.width) { // å³å¢™é¢
        //console.log(">>>> å³å¢™é¢-æ’å‡»ç‚¹åæ ‡ï¼šx=" + ball.x + ", y=" + ball.y);
        if (isChPos) ball.x = canvas.width - ball.radius - 1 * dpr;
        return true;
    }

    if (ball.y - ball.radius <= 0) { // ä¸Šå¢™é¢
        //console.log(">>>> ä¸Šå¢™é¢-æ’å‡»ç‚¹åæ ‡ï¼šx=" + ball.x + ", y=" + ball.y);
        if (isChPos) ball.y = ball.radius + 1 * dpr;
        return true;
    } else if (ball.y + ball.radius >= canvas.height) { // ä¸‹å¢™é¢
        //console.log(">>>> ä¸‹å¢™é¢-æ’å‡»ç‚¹åæ ‡ï¼šx=" + ball.x + ", y=" + ball.y);
        if (isChPos) ball.y = canvas.height - ball.radius - 1 * dpr;
        return true;
    }
    return false;
}


// åˆ‡è§’è¾¹ç¢°æ’æ£€æµ‹
function checkLines(ball, isCheck) {
    //console.log(">>>> checkLines ball: " + JSON.stringify(ball));
    ball.isLineCollided = false; // ç¢°æ’æ ‡è¯†é‡ç½®

    // åˆ¤æ–­æ˜¯å¦åœ¨åˆ‡è§’èŒƒå›´å†…
    let angleIdx = isInAngleArea(ball);
    if (angleIdx > -1 && !isRoleHideBody(ball)) {
        console.log(">>>> angleIdx=" + angleIdx);
        let lineIndex = getOneAngleLineIndex(ball);
        let line = lines[lineIndex];
        // TODO æ¯æ¬¡éƒ½å¾ªç¯æ£€æµ‹å››æ¡çº¿ï¼Œæœ‰äº›æµªè´¹æ€§èƒ½ï¼Œåç»­æœ‰æ—¶é—´å¯ä»¥æ ¹æ®è¿åŠ¨æ–¹å‘/è§’åº¦ï¼Œåªæ£€æµ‹å¯èƒ½ç¢°åˆ°çš„è¾¹
        //lines.some(line => {
        let bounds = line.getBounds();
        // åˆ¤æ–­å°çƒæ˜¯å¦åœ¨çº¿æ®µåŒºåŸŸå†…
        if (ball.x + ball.radius > bounds.x && ball.x - ball.radius < bounds.x + bounds.width) {
            //console.log(">>>> ball in dounds.");
            let cos = Math.cos(line.rotation);
            let sin = Math.sin(line.rotation);
            // ä½ç½®ä»¥ï¼ˆline.x1ï¼Œline.y1ï¼‰ä¸ºåæ ‡åŸç‚¹æ¥æ—‹è½¬åæ ‡
            let pos = rotate(ball.x - line.x1, ball.y - line.y1, sin, cos, true); // åˆ‡è§’æ–œè¾¹åæ ‡ç³»æ—‹è½¬åˆ°æ°´å¹³
            let vel = rotate(ball.vx, ball.vy, sin, cos, true); // å°çƒé€Ÿåº¦æ–¹å‘åŒæ ·è¦æ—‹è½¬

            ball.collidedP0.x = pos.x;
            ball.collidedP0.y = pos.y;

            // å½“å°çƒä¸­å¿ƒè·ç¦»æ–œé¢çš„è·ç¦»å°äºåŠå¾„çš„æ—¶è¯´æ˜å·²ç»ç›¸ç¢°æ’äº†
            //console.log(">>>> Math.abs(pos.y)=" + Math.abs(pos.y));
            console.log(">>>> line" + lineIndex + " pos.y=" + pos.y);
            // TODO å°çƒç¢°æ’å‰ååœ¨è¾¹ç•Œä¸Šä¸‹çš„è·ç¦»éƒ½å¤§äºåŠå¾„ï¼Œå¯¼è‡´è®¤ä¸ºæ²¡ç¢°æ’ï¼Œå…¶å®æ˜¯é€Ÿåº¦å¤§äºåŠå¾„å¯¼è‡´ â€”â€”> âšª|âšª
            //if (Math.abs(pos.y) < ball.radius) { // è¿™ä¸ªåˆ¤æ–­åªé€‚ç”¨åœ¨çŸ©å½¢å†…çš„çº¿æ®µï¼Œä¸é€‚ç”¨åˆ‡è§’è¾¹ç•Œ
            if (pos.y - ball.radius <= 0) {
                console.log(">>>> line" + lineIndex + " ball Collided.");
                ball.isCollided = true; // ç¢°æ’
                ball.isLineCollided = true;
                if (!isCheck) ball.collidedCount += 1;
                if (!isCheck) ball.wallCollidedCount += 1;

                // åˆ¤æ–­å°çƒæ˜¯ä¸Šé¢ç¢°æ’è¿˜æ˜¯ä¸‹é¢ç¢°æ’
                if (pos.y - vel.y <= 0) { // ä¸‹ï¼Ÿ
                    //pos.y = -ball.radius;
                    console.log(">>>> line" + lineIndex + "-ä¸‹å¢™é¢");
                    // åˆ‡è§’è¾¹ç•Œåªå–æ­£æ•°ï¼Œæ‰“ä¸åˆ°ä¸‹å¢™é¢
                    pos.y = ball.radius + 1 * dpr;
                } else { // ä¸Š
                    console.log(">>>> line" + lineIndex + "-ä¸Šå¢™é¢");
                    pos.y = ball.radius + 1 * dpr;
                }

                // TODO ç§»åŠ¨å°çƒä½ç½®æ—¶ï¼Œå°çƒæ²¡æœ‰é€Ÿåº¦
                // æ”¹å˜äº†yçš„ä½ç½®ï¼Œè¿˜è¦æ‰¾åˆ°å¯¹åº”çš„xä½ç½®
                //console.log(">>>> vel.x=" + vel.x + ", vel.y=" + vel.y);
                let angle = Math.atan2(vel.y, vel.x);
                //console.log(">>>> angle=" + angle);
                let x = (ball.collidedP0.y - pos.y) / Math.tan(angle);
                //console.log(">>>> x=" + x);
                if (isNumber(x) && isNumber(pos.x - x)) pos.x -= x;
                //console.log(">>>> pos.x=" + pos.x + ", pos.y=" + pos.y);

                //vel.y *= -sysConfig.bounce; // èƒ½é‡æŸè€—
                vel.y *= -1; // åå‘
                // æ—‹è½¬å›å»
                let velF = rotate(vel.x, vel.y, sin, cos, false);
                let posF = rotate(pos.x, pos.y, sin, cos, false);
                ball.x = line.x1 + posF.x;
                ball.y = line.y1 + posF.y;

                // å¦‚æœåªæ˜¯æ£€æµ‹ç¢°æ’ï¼Œæˆ–è€…æ¨¡æ‹Ÿæ’å‡»è·¯çº¿ï¼Œå¯ä»¥ç›´æ¥è¿”å›äº†ï¼Œé¿å…ä¸‹é¢ç»˜åˆ¶åŠ¨ç”»æµªè´¹æ€§èƒ½
                // æ³¨æ„ï¼Œè¿™é‡Œçš„ return true åªæ˜¯é€€å‡ºäº†å¾ªç¯éå†ï¼Œæ²¡æœ‰é€€å‡º checkLines æ–¹æ³•
                //if (isCheck && recordCollidedPoint(ball)) throw new Error("æ£€æµ‹ç¢°æ’å®Œæˆ-ä¸­æ–­å¾ªç¯", {cause:1000}); // cause çš„å€¼å¯ä»¥æ˜¯ä»»ä½•ç±»å‹
                console.log(">>>> line" + lineIndex + "-" + ball.getBallDesc() + "-æ’å‡»ç‚¹åæ ‡ï¼šx=" + ball.x + ", y=" + ball.y);
                if (isCheck && recordCollidedPoint(ball) && !isRoleCanPierces()) return true; // éå¾ªç¯æ–¹æ³•ï¼Œç›´æ¥è¿”å›ç»“æŸæ•´ä¸ªæ–¹æ³•

                // è¿åŠ¨çŠ¶æ€åœ¨æ£€æµ‹ç¢°æ’ä¹‹åå†æ”¹å˜
                // åˆ‡è§’è¾¹æ˜¯åé¢æ£€æµ‹çš„ï¼Œå¢™é¢&åˆ‡é¢éƒ½æ£€æµ‹å®Œæˆåï¼Œåˆ¤æ–­æ˜¯å¦åŒæ—¶ç¢°æ’ä¸¤ä¸ªå¢™é¢
                if (concurrentCollided && ball.isMainBall && checkWallCollided(ball)) { // åŒæ—¶ç¢°æ’äº†åˆ‡é¢ã€å¢™é¢ï¼Œé€Ÿåº¦ç›´æ¥åå‘
                    console.log(">>>> æ’å¢™è§’ï¼ŒåŒæ—¶ç¢°æ’äº†å¢™é¢å’Œåˆ‡é¢ï¼Œé€Ÿåº¦ç›´æ¥åå‘");
                    ball.vx = -ball.collidedV0.x;
                    ball.vy = -ball.collidedV0.y;
                    // å› ä¸ºæ˜¯æ¢å¤äº†å¢™é¢ç¢°æ’å‰çš„å¤‡ä»½å€¼ï¼Œéœ€è¦å•ç‹¬è®¡ç®—ä¸€æ¬¡ç¢°æ’æŸè€—
                    checkBounce(ball);
                } else {
                    ball.vx = velF.x;
                    ball.vy = velF.y;
                    // TODO æ²¡æœ‰åŒæ—¶ç¢°æ’ï¼ŒçŸ«æ­£é€Ÿåº¦è¿‡å¿«ï¼Œç©¿é€æ–œé¢ç¢°åˆ°å¢™çš„é—®é¢˜
                    if (!isCheck && ball.isWallCollided) ball.collidedCount -= 1;
                    if (!isCheck && ball.isWallCollided) ball.wallCollidedCount -= 1;
                }

                // åå¼¹ç³»æ•°ä½œç”¨åœ¨åˆé€Ÿåº¦ä¸Š
                checkBounce(ball);
                // ç»˜ç”»ç¢°æ’è™šçº¿åœ†åœˆ
                if (!selectedBall || !isRoleCanPierces()) ball.drawCollidedPos();

                // å››æ¡åˆ‡è§’çº¿ä¸€æ¬¡åªä¼šç¢°åˆ°ä¸€æ¡ï¼Œç¢°æ’åç›´æ¥é€€å‡ºå¾ªç¯æ£€æµ‹
                //return true; // TODO åªæœ‰ä¸€æ¡çº¿çš„è¯ä¸ç”¨è¿”å›

            }
        }
        //});
    }

    ball.isCheckFinished = false;
    drawAndUpdate(ball, isCheck); // ç»˜åˆ¶å°çƒå¹¶æ›´æ–°é€Ÿåº¦
}


// å•ç‹¬æ£€æµ‹åˆ‡é¢æ˜¯å¦ç¢°æ’
function checkLineCollided(ball, isChPos) {

    // åˆ¤æ–­æ˜¯å¦åœ¨åˆ‡è§’èŒƒå›´å†…
    let angleIdx = isInAngleArea(ball);
    if (angleIdx > -1 && !isRoleHideBody(ball)) {
        let lineIndex = getOneAngleLineIndex(ball);
        let line = lines[lineIndex];
        // TODO æ¯æ¬¡éƒ½å¾ªç¯æ£€æµ‹å››æ¡çº¿ï¼Œæœ‰äº›æµªè´¹æ€§èƒ½ï¼Œåç»­æœ‰æ—¶é—´å¯ä»¥æ ¹æ®è¿åŠ¨æ–¹å‘/è§’åº¦ï¼Œåªæ£€æµ‹å¯èƒ½ç¢°åˆ°çš„è¾¹
        //lines.some(line => {
        let bounds = line.getBounds();
        // åˆ¤æ–­å°çƒæ˜¯å¦åœ¨çº¿æ®µåŒºåŸŸå†…
        if (ball.x + ball.radius > bounds.x && ball.x - ball.radius < bounds.x + bounds.width) {
            //console.log(">>>> ball in dounds.");
            let cos = Math.cos(line.rotation);
            let sin = Math.sin(line.rotation);
            // ä½ç½®ä»¥ï¼ˆline.x1ï¼Œline.y1ï¼‰ä¸ºåæ ‡åŸç‚¹æ¥æ—‹è½¬åæ ‡
            let pos = rotate(ball.x - line.x1, ball.y - line.y1, sin, cos, true); // åˆ‡è§’æ–œè¾¹åæ ‡ç³»æ—‹è½¬åˆ°æ°´å¹³
            let vel = rotate(ball.vx, ball.vy, sin, cos, true); // å°çƒé€Ÿåº¦æ–¹å‘åŒæ ·è¦æ—‹è½¬

            // å½“å°çƒä¸­å¿ƒè·ç¦»æ–œé¢çš„è·ç¦»å°äºåŠå¾„çš„æ—¶è¯´æ˜å·²ç»ç›¸ç¢°æ’äº†
            //console.log(">>>> line" + lineIndex + " pos.y=" + pos.y);
            // TODO å°çƒç¢°æ’å‰ååœ¨è¾¹ç•Œä¸Šä¸‹çš„è·ç¦»éƒ½å¤§äºåŠå¾„ï¼Œå¯¼è‡´è®¤ä¸ºæ²¡ç¢°æ’ï¼Œå…¶å®æ˜¯é€Ÿåº¦å¤§äºåŠå¾„å¯¼è‡´ â€”â€”> âšª|âšª
            //if (Math.abs(pos.y) < ball.radius) { // è¿™ä¸ªåˆ¤æ–­åªé€‚ç”¨åœ¨çŸ©å½¢å†…çš„çº¿æ®µï¼Œä¸é€‚ç”¨åˆ‡è§’è¾¹ç•Œ
            if (pos.y - ball.radius <= 0) {
                //console.log(">>>> checkLineCollided line" + lineIndex + " ball Collided.");
                // åˆ¤æ–­å°çƒæ˜¯ä¸Šé¢ç¢°æ’è¿˜æ˜¯ä¸‹é¢ç¢°æ’
                if (pos.y - vel.y <= 0) { // ä¸‹ï¼Ÿ
                    //pos.y = -ball.radius;
                    //console.log(">>>> checkLineCollided line" + lineIndex + "-ä¸‹å¢™é¢");
                    // åˆ‡è§’è¾¹ç•Œåªå–æ­£æ•°ï¼Œæ‰“ä¸åˆ°ä¸‹å¢™é¢
                    pos.y = ball.radius + 1 * dpr;
                } else { // ä¸Š
                    //console.log(">>>> checkLineCollided line" + lineIndex + "-ä¸Šå¢™é¢");
                    pos.y = ball.radius + 1 * dpr;
                }

                if (isChPos) {
                    // æ—‹è½¬å›å»
                    let velF = rotate(vel.x, vel.y, sin, cos, false);
                    let posF = rotate(pos.x, pos.y, sin, cos, false);
                    ball.x = line.x1 + posF.x;
                    ball.y = line.y1 + posF.y;
                }

                return true;
            }
        }
        //});
    }

    return false;
}


// æ£€æµ‹çƒä¸çƒç¢°æ’
// animate balls.forEach å¾ªç¯è°ƒç”¨
function checkOtherBalls(ball, isCheck) {
    //console.log(">>>> checkOtherBalls out " + ball.getBallDesc());

    ball.isBallCollided = false; // ç¢°æ’æ ‡è¯†é‡ç½®

    // ç„å‡†é˜¶æ®µï¼Œå¯ç©¿é€è§’è‰²ï¼Œæˆ–è€…å¼€å¯äº†ç„å‡†ç©¿é€ï¼Œä¸æ£€æµ‹ç¢°æ’
    if (!selectedBall || !isRoleCanPierces() && !isTryCanPierces())
        balls.forEach(b => {
            /*
            åªæ£€æµ‹åºå·æ¯”ballå¤§çš„ï¼Œå³å¯ä¿è¯ç»„åˆä¸é‡å¤ï¼Œ12 å’Œ 21 ç®—é‡å¤
            å¤–å±‚ 1 2 3 4
            å†…å±‚ 2 3 4
            */
            if (b.no <= ball.no) return;
            //console.log(">>>> checkOtherBalls in " + b.getBallDesc());

            // ball å¯ä»¥æ˜¯ balls æ•°ç»„ä¸­çš„çƒï¼Œä¹Ÿå¯ä»¥æ˜¯ tryMoveBallï¼ŒtryMoveBall æ˜¯æ–°çš„å¯¹è±¡ï¼Œé»˜è®¤ä¸ºã€ä¸»çƒã€‘ï¼Œä¸åœ¨ balls æ•°ç»„ä¸­
            // ç›®å‰åªæ”¯æŒä¸»çƒã€å‰¯çƒç¢°æ’ï¼Œä¸å­˜åœ¨ä¸¤ä¸»çƒç¢°æ’çš„æƒ…å†µ
            if (ball === tryMoveBall && b.isMainBall) return; // é€€å‡ºå•æ¬¡å¾ªç¯ï¼Œç›¸å½“äº continue
            // è‡ªå·±ç¢°è‡ªå·±ä¹Ÿä¸ç®—
            if (ball !== tryMoveBall && b === ball) return;

            //console.log(">>>> checkOtherBalls " + ball.getBallDesc() + "-" + b.collidingNos[ball.no - 1]);
            if (isCollisionBallAndBall(ball, b) || isCrossedCollision(ball, b, isCheck)) { // TODO å¤„ç†æ­£åœ¨ç¢°æ’è¢«å½“æˆå¾ˆå¤šæ¬¡ç¢°æ’é—®é¢˜ã€‚animate 60 å¸§å†…ä¼šè°ƒç”¨å¾ˆå¤šæ¬¡æ–¹æ³•ï¼Œå¯¼è‡´ç©¿ä¸€æ¬¡è¢«è®¡ç®—æˆå¾ˆå¤šæ¬¡
                if (!isCheck) console.log(">>>> checkOtherBalls ball Collided > " + b.getBallDesc());
                ball.isBallCollided = true;
                ball.isCollided = true;
                if (!isCheck) ball.collidedCount += 1;
                if (!isCheck) ball.roleCollidedCount += 1;
                if (!isCheck) b.collidedCount += 1;
                if (!isCheck) b.roleCollidedCount += 1;

                // TODO çŸ«æ­£ç¢°æ’æ—¶ä½ç½®ï¼Œè§£å†³é‡å é—®é¢˜
                /*
                //if (isCheck || userConfig.currRole != Role.JIANGJIANG.id && userConfig.currRole != Role.KUILEI.id) {
                if (userConfig.currRole != Role.JIANGJIANG.id && userConfig.currRole != Role.KUILEI.id) {
                    let angle = getAngleOf2BallCollided(ball, b); // æ­£æ•°ã€å°çƒé¡ºåºæœ‰å½±å“ã€‘
                    let collidedPoint = get2BallCollidedXYByAngle(angle, ball.radius + b.radius);
                    //console.log(">>>> get2BallCollidedXYByAngle, x=" + collidedPoint.x + ", y=" + collidedPoint.y);
                    // é‡æ–°è®¾ç½®å°çƒä½ç½®
                    ball.x = b.x - collidedPoint.x;
                    ball.y = b.y - collidedPoint.y;
                }
                */

                // æœ‰ä¸€ä¸ªå°çƒæ²¡æœ‰é€Ÿåº¦çš„æƒ…å†µï¼Œåªè°ƒæ•´æœ‰é€Ÿåº¦å°çƒçš„åæ ‡ä½ç½®
                adjustMovingBallPos(ball, b);

                /*
                //console.log(">>>> do2BallsCollidedMV2 params=" + JSON.stringify(collideParams));
                if (userConfig.currRole === Role.JIANGJIANG.id || userConfig.currRole === Role.YLPAPA.id) {
                    //do2BallsCollidedMV2(ball, b, isCheck, false, collideParams);
                    doBackToBorderBallsCollided(ball, b, isCheck);
                } else if (userConfig.currRole === Role.KUILEI.id) {
                    if (isKuileiPulling) do2BallsCollidedMV2(ball, b, true, false, collideParams);
                    //else do2BallsCollidedMV2(ball, b, isCheck, false, collideParams);
                    else doBackToBorderBallsCollided(ball, b, isCheck);
                } else {
                    doBackToBorderBallsCollided(ball, b, isCheck);
                    //if (ball.isMainBall) doBackToBorderBallsCollided(ball, b, true);
                }
                */

                // TODO æ˜¾ç¤ºç„å‡†ç¢°æ’æŒ‡ç¤ºåœˆã€ç„å‡†æ—¶ä¼šä¸åœåœ°æ‹–åŠ¨æ£€æµ‹ï¼Œå¯¼è‡´æŒ‡ç¤ºåœˆæœ‰é—ªåŠ¨ï¼Œåç»­å†æã€‘
                // è¿˜è¦è€ƒè™‘åŒæ—¶ç¢°å¢™ã€ç¢°è›‹ã€ç¢°å¤šä¸ªè§’è‰²æ—¶æ€ä¹ˆæ˜¾ç¤º
                //if (isCheck) b.drawAimCircle();

                console.log(">>>> checkOtherBalls-" + ball.getBallDesc() + "-æ’å‡»ç‚¹åæ ‡ï¼šx=" + ball.x + ", y=" + ball.y);
                if (isCheck && recordCollidedPoint(ball)) return true; // æ³¨æ„åªæ˜¯ç»“æŸå¾ªç¯

                // ç¢°åˆ°å°±åœæ­¢
                if (userConfig.isStopAfterCollided) {
                    // è°ƒæ•´ç¢°æ’ä½ç½®
                    //doBackToBorderBallsCollided(ball, b, true);
                    b.vx = 0;
                    b.vy = 0;
                    //b.isMoving = false;
                    // ä½¿ç”¨æ–°æ–¹å¼è°ƒæ•´ç¢°æ’ä½ç½®
                    adjustMovingBallPos(ball, b);
                    ball.vx = 0;
                    ball.vy = 0;
                    //ball.isMoving = false;
                    return true;
                }

                // ä¸»è§’åªç¢°ä¸€æ¬¡è§’è‰²
                if (userConfig.isRoleCollidedOnce) {
                    // åªæœ‰å¤–å±‚ä¼ å…¥çš„ballæ‰å¯èƒ½ä¸ºä¸»çƒï¼Œå†…å±‚bä¸ä¼šæ˜¯ä¸»çƒ
                    if (ball.isMainBall && ball.roleCollidedCount >= 2 || b.isMainBall && b.roleCollidedCount >= 2) {
                        // è°ƒæ•´ç¢°æ’ä½ç½®
                        //doBackToBorderBallsCollided(ball, b, true);
                        ball.vx = 0;
                        ball.vy = 0;
                        //ball.isMoving = false;
                        // å¦‚æœè¿™æ—¶å€™ballçš„é€Ÿåº¦åˆšå¥½åœæ­¢ï¼Œè¿™ä¸ªè°ƒæ•´åæ ‡æ–¹æ³•ä¸ä¼šæ‰§è¡Œï¼Œä¼šå‡ºç°é‡å 
                        adjustMovingBallPos(ball, b);
                        b.vx = 0;
                        b.vy = 0;
                        //b.isMoving = false;
                        return true;
                    }
                }

                // å¤„ç†å°çƒç¢°æ’åé€Ÿåº¦                
                if (userConfig.currRole === Role.JIANGJIANG.id) {
                    // ç®€å•æ¨¡æ‹Ÿåƒµå°¸ç©¿é€åŠ é€Ÿã€å‡é€Ÿ
                    doJiangjiangSpeed(ball, b);
                } else if (userConfig.currRole === Role.YLPAPA.id) {
                    // å¤„ç†å¸•å¸•é€Ÿåº¦
                    doPapaSpeed(ball, b);
                } else if (userConfig.currRole === Role.KUILEI.id) {
                    //console.log(">>>> checkOtherBalls isKuileiPulling=" + isKuileiPulling);
                    if (isKuileiPulling) do2BallsCollidedMV2(ball, b, false, true, collideParams);
                } else {
                    do2BallsCollidedMV2(ball, b, false, true, collideParams);
                }

                // é…·é…·åŠ é€Ÿ
                doKukuSpeed(ball, b);
                // ç”µéŸ³çªç ´åŠ é€Ÿ
                doDianyinSpeed(ball, b);
                // å¤ªå¹³ä¹åŠ é€Ÿ
                doLeleSpeed(ball, b);

                // ç¢°æ’é€Ÿåº¦å‰Šå‡
                checkBounce(ball); // TODO è‡ªå®šä¹‰ä¸€ä¸ªæŸè€—ï¼Œé¿å…æ‰“å®Œè´´ç€ä¸€ç›´ä¸åœçš„é—®é¢˜
                // ç»˜ç”»ç¢°æ’è™šçº¿åœ†åœˆ
                //if (!isCheck) ball.drawCollidedPos();
            }
        });

    if (!isDuoduoExist) ball.isCheckFinished = true; // ä¸æ£€æµ‹è›‹ï¼Œåˆ™æ£€æµ‹å®Œçƒç¢°æ’ä¹‹åï¼Œæ‰€æœ‰æ£€æµ‹å®Œæˆ
    drawAndUpdate(ball, isCheck); // ç»˜åˆ¶å°çƒå¹¶æ›´æ–°é€Ÿåº¦
}


// åˆ¤æ–­æ˜¯å¦ä¸ºé€Ÿåº¦è¿‡å¿«ç©¿é€å¯¼è‡´æœªæ£€æµ‹åˆ°ç¢°æ’ã€‚æ²¡æœ‰ç¢°æ’çš„æ—¶æœºå¤ªå¤šäº†ï¼Œæ—¶åˆ»æ£€æµ‹è€—ç”µå¾ˆå¤§
// ç©¿é€æ£€æµ‹ï¼šå½“å‰å¸§æ²¡ç¢°æ’ä½†ç»§ç»­è¿åŠ¨ä¼šæœ‰ç¢°æ’ç‚¹ï¼Œä¸‹ä¸€å¸§ä¹Ÿæ²¡ç¢°æ’ï¼Œä½†æ‰¾ä¸åˆ°ç¢°æ’ç‚¹
function isCrossedCollision(ball, b, isCheck) {
    if (!isCheck) return false; // åªåœ¨ç„å‡†é˜¶æ®µåˆ¤æ–­
    if (!ball || !b) return false;
    if (!ball.isMainBall) return false; // åªæ£€æµ‹å¤–å±‚ballä¸ºä¸»çƒçš„æƒ…å†µï¼Œå…¶ä»–éä¸»çƒç©¿é€çš„æ¦‚ç‡å¾ˆå°ï¼ŒèŠ‚çœæ€§èƒ½
    // åªæœ‰ä¸€ä¸ªå°çƒæœ‰é€Ÿåº¦æ‰æ£€æµ‹
    const targetBall = getMovingBall(ball, b);
    if (!targetBall) return false;

    // å½“å‰å¸§ä¸èƒ½ä¸ºç©¿é€åçš„ä½ç½®ï¼Œè°ƒæ•´ä½ç½®åå›åˆ°ç©¿é€å‰ï¼Œç„¶ååˆæ£€æµ‹åˆ°ç©¿é€ï¼Œé™·å…¥æ­»å¾ªç¯ã€ç„å‡†æ—¶ç¨³å®šæ²¡å•¥é—®é¢˜ï¼Œå¼€æ‰“æ—¶ä¼šå¡åœ¨åŸåœ°å¾ªç¯ã€‘
    // å½“å‰å¸§ä¸¤å°çƒæ²¡æœ‰ç¢°æ’ï¼ŒisCollisionBallAndBall å·²ç»æ£€æµ‹äº†
    //const cFlag = is2CirclesCollided(ball, b);
    //if (cFlag) return false;
    // åˆ¤æ–­å½“å‰å¸§ä½ç½®æ˜¯å¦å¯èƒ½ç¢°æ’
    const currCollidedPos = getCurrFrameCollidedPos(ball, b);
    if (currCollidedPos) return false;
    // è·å–ä¸Šä¸€å¸§ç¢°æ’åæ ‡
    const preCollidedPos = getPreOrNextFrameCollidedPos(ball, b, 0);
    // å¦‚æœä¸Šä¸€å¸§ä¹Ÿæ²¡æœ‰ç¢°æ’åæ ‡åˆ™ä¸ç”¨æ£€æµ‹ï¼Œæœ‰åˆ™è¯´æ˜æ˜¯ç©¿é€è¿‡æ¥çš„ï¼Œè°ƒæ•´åæ ‡ä½ç½®å›é€€åˆ°ä¸Šä¸€ä¸ªç¢°æ’ç‚¹ï¼Œæ‰§è¡Œç¢°æ’é€»è¾‘
    if (!preCollidedPos) return false;
    return isCheck;

    /*
    // å½“å‰å¸§ä¸ºç¢°æ’å‰çš„ä½ç½®ï¼Œåˆ¤æ–­ä¸‹ä¸€å¸§æ˜¯å¦ä¸ºç©¿é€ã€ç„å‡†æ—¶ä¸ç¨³å®šæœ‰é—ªåŠ¨ï¼Œå¼€æ‰“æ—¶ä¼šå‡ºç°ä¹±è°ƒæ•´ä½ç½®ã€‘
    // å½“å‰å¸§ä¸¤å°çƒæ²¡æœ‰ç¢°æ’ï¼ŒisCollisionBallAndBall å·²ç»æ£€æµ‹äº†
    //const cFlag = is2CirclesCollided(ball, b);
    //if (cFlag) return false;
    // åˆ¤æ–­å½“å‰å¸§ä½ç½®æ˜¯å¦å¯èƒ½ç¢°æ’ï¼Œæ²¡æœ‰ç¢°æ’ç‚¹åˆ™ä¸ç”¨ç®¡
    const currCollidedPos = getCurrFrameCollidedPos(ball, b);
    if (!currCollidedPos) return false;
    
    // ä¸‹ä¸€å¸§æ— ç¢°æ’ä¸”ä¸å¯èƒ½ä¼šç¢°æ’ï¼Œå®é™…åªéœ€è¦æ»¡è¶³ä¸å¯èƒ½ç¢°æ’å°±è¡Œäº†
    // è·å–ä¸‹ä¸€å¸§åæ ‡ä½ç½®
    //const targetBall = getMovingBall(ball, b);
    //const nextPos = getPreOrNextFramePos(targetBall, 1);
    //const nFlag = is2CirclesCollided(nextPos, targetBall.no === ball.no ? b : ball);
    //if (nFlag) return false;
    // è·å–ä¸‹ä¸€å¸§ç¢°æ’ç‚¹åæ ‡ä½ç½®ï¼Œå·²ç»é‡å ç¢°æ’ä¸è¿”å›ç¢°æ’ç‚¹
    const nextCollidedPos = getPreOrNextFrameCollidedPos(ball, b, 1);
    // ä¸‹ä¸€å¸§èƒ½æ‰¾åˆ°ç¢°æ’ç‚¹ï¼Œè¯´æ˜è¿˜æ²¡æœ‰ç©¿é€
    if (nextCollidedPos) return false;
    return true;
    */
}


// å•ç‹¬æ£€æµ‹çƒä¸çƒç¢°æ’
function checkOtherBallCollided(ball, isChPos) {
    let result = false;
    balls.some(b => {
        if (ball === tryMoveBall && b.isMainBall) return; // ç±»ä¼¼äºcontinueï¼Œç»ˆæ­¢å½“æ¬¡å¾ªç¯ã€‚ä½¿ç”¨æŠ›å¼‚å¸¸çš„æ–¹å¼ï¼Œç»ˆæ­¢forEachæ•´ä¸ªå¾ªç¯
        if (ball !== tryMoveBall && b === ball) return;
        //if (isCollisionBallAndBall(ball, b)) { // ç¢°æ’äº†
        if (is2CirclesCollided(ball, b)) {
            if (isChPos) {
                let angle = getAngleOf2BallCollided(ball, b); // æ­£æ•°
                let collidedPoint = get2BallCollidedXYByAngle(angle, ball.radius + b.radius);
                //console.log(">>>> get2BallCollidedXYByAngle, x=" + collidedPoint.x + ", y=" + collidedPoint.y);
                // é‡æ–°è®¾ç½®å°çƒä½ç½®
                ball.x = b.x - collidedPoint.x;
                ball.y = b.y - collidedPoint.y;
            }
            result = true;
            return true; // åªæ˜¯é€€å‡ºå¾ªç¯
        }
    });
    return result;
}


// åˆ¤æ–­æ˜¯å¦è¾¾åˆ°é€Ÿåº¦ä¸Šé™
function isSpeedMax(ball) {
    let speed0 = getBallSpeed0(ball);
    if (ball.isMainBall && ball.roleId === Role.JIANGJIANG.id) { // åƒµå°¸ä¸»æ‰“æ—¶ï¼Œä¸Šé™ä¸ºåŸå§‹é€Ÿåº¦çš„ 1.6 å€
        if (ball.vx ** 2 + ball.vy ** 2 > (speed0 * 1.4) ** 2) return true; // 1.3 ç›´æ‰“é…·é…·é€Ÿåº¦æœ‰ç‚¹ä¸å¤Ÿï¼Œ1.5 åˆæœ‰ç‚¹å¤šäº†ï¼Œéœ€è¦æ›´å¤šå®æˆ˜è§‚å¯ŸéªŒè¯
    } else { // 1.5
        if (ball.vx ** 2 + ball.vy ** 2 > (speed0 * 1.3) ** 2) return true; // 1.2
    }
    return false;
}


// é…·é…·ä¸ºé˜Ÿå‹åŠ é€Ÿ60%/30%ï¼Œçªç ´åï¼Œè‡ªèº«åŠ é€Ÿ50%
function isKukuCollided(ball0, ball1) {
    let result = false;
    // æ˜¯å¦åŒé˜Ÿ
    if (ball0.teamColor !== ball1.teamColor) return result;
    // æ˜¯å¦æœ‰é…·é…·
    if (ball0.roleId !== Role.KUKU.id && ball1.roleId !== Role.KUKU.id) return result;
    // æ˜¯å¦æœ‰ä¸»çƒ
    if (!ball0.isMainBall && !ball1.isMainBall) return result;
    result = true;
    return result;
}


// åƒµå°¸ç¢°æ’
function isJiangjiangCollided(ball0, ball1) {
    let result = false;
    // æ˜¯å¦æœ‰åƒµåƒµ
    if (ball0.roleId !== Role.JIANGJIANG.id && ball1.roleId !== Role.JIANGJIANG.id) return result;
    // æ˜¯å¦æœ‰ä¸»çƒ
    if (!ball0.isMainBall && !ball1.isMainBall) return result;
    result = true;
    return result;
}


// å°ä¸‘ç¢°æ’
function isJoker2Collided(ball0, ball1) {
    let result = false;
    // æ˜¯å¦æœ‰å°ä¸‘
    if (ball0.roleId !== Role.JOKER.id && ball1.roleId !== Role.JOKER.id) return result;
    // æ˜¯å¦æœ‰å°ä¸‘åˆ†èº«
    if (ball0.no <= 4 && ball1.no <= 4) return result;
    // æ˜¯å¦æœ‰ä¸»çƒ
    if (!ball0.isMainBall && !ball1.isMainBall) return result;
    // æ˜¯å¦ä¸ºåŒé˜Ÿï¼ŒåŒé˜Ÿä¸ç®—ï¼Œä¸å‡é€Ÿ
    //if (ball0.teamColor === ball1.teamColor) return result;
    result = true;
    return result;
}


// ç”µéŸ³ç¢°æ’
function isDianyinCollided(ball0, ball1) {
    if (!balls || balls.length < 1) return false;
    let result = false;
    // æ˜¯å¦åŒé˜Ÿ
    if (ball0.teamColor === ball1.teamColor) return result;
    // æ˜¯å¦æœ‰ç”µéŸ³
    if (ball0.roleId !== Role.DIANYIN.id && ball1.roleId !== Role.DIANYIN.id) return result;
    // æ˜¯å¦æœ‰ä¸»çƒã€éä¸»çƒç¢°åˆ°ä¸€æ ·åŠ é€Ÿã€‘
    //if (!ball0.isMainBall && !ball1.isMainBall) return result;
    // æ˜¯å¦æœ‰å°ä¸‘åˆ†èº«ï¼Œç¢°å°ä¸‘åˆ†èº«ä¸åŠ é€Ÿ
    if ((ball0.roleId === Role.JOKER.id && ball0.no > 4)
        || (ball1.roleId === Role.JOKER.id && ball1.no > 4)) return result;
    // ç”µéŸ³ç¢°æ’å¯¹è±¡æ˜¯å¦å­˜æ´»ï¼Œç›®å‰è¿˜æ²¡æœ‰è¡€é‡ä¼¤å®³åŠŸèƒ½ï¼Œå…ˆä¸ç®¡
    // ç”µéŸ³éœ€è¦æ˜¯ä¸»è§’æˆ–è€…è·Ÿä¸»è§’ä¸€é˜Ÿ
    let isRoleRight = false;
    if ((ball0.roleId === Role.DIANYIN.id && (ball0.isMainBall || ball0.teamColor === balls[0].teamColor))
        || (ball1.roleId === Role.DIANYIN.id && (ball1.isMainBall || ball1.teamColor === balls[0].teamColor))) isRoleRight = true;

    //console.log(">>>> isRoleRight", isRoleRight);
    if (!isRoleRight) return result;

    result = true;
    return result;
}


// å¤ªå¹³ä¹ç¢°æ’
function isLeleCollided(ball0, ball1) {
    let result = false;
    // æ˜¯å¦æœ‰å¤ªå¹³ä¹
    if (ball0.roleId !== Role.LELE.id && ball1.roleId !== Role.LELE.id) return result;
    // æ˜¯å¦æœ‰ä¸»çƒ
    if (!ball0.isMainBall && !ball1.isMainBall) return result;
    // æ˜¯å¦æœ‰å°ä¸‘åˆ†èº«ï¼Œç¢°å°ä¸‘åˆ†èº«ä¸åŠ é€Ÿ
    if ((ball0.roleId === Role.JOKER.id && ball0.no > 4)
        || (ball1.roleId === Role.JOKER.id && ball1.no > 4)) return result;
    // å¤ªå¹³ä¹éœ€è¦æ˜¯ä¸»è§’
    let isRoleRight = false;
    if ((ball0.roleId === Role.LELE.id && ball0.isMainBall)
        || (ball1.roleId === Role.LELE.id && ball1.isMainBall)) isRoleRight = true;
    if (!isRoleRight) return result;
    // ç¢°åˆ°çš„è§’è‰²éœ€è¦æ˜¯å­˜æ´»çš„ã€è¡€é‡ä¼¤å®³ç³»ç»Ÿè¿˜æ²¡å®ç°å…ˆä¸ç®¡ã€‘

    result = true;
    return result;
}


// å¤„ç†é…·é…·åŠ é€Ÿ
function doKukuSpeed(ball0, ball1) {
    if (!isKukuCollided(ball0, ball1)) return;
    // ä¸ºç¢°æ’çš„é˜Ÿå‹åŠ é€Ÿ60%ã€é€Ÿåº¦å¤ªå¿«ï¼Œæ‰‹åŠ¨è°ƒæ•´æ¯”ä¾‹ã€‘
    const kukuTeammateRatio = 1.6;
    // çªç ´åé…·é…·è‡ªèº«åŠ é€Ÿ50%
    const kukuSelfRatio = 1.5;
    if (ball0.roleId === Role.KUKU.id) { // ball0 ä¸ºé…·é…·
        if (ball0.addCount < 10) {
            if (ball0.isMainBall) {
                // é™åˆ¶é€Ÿåº¦ä¸Šé™
                if (!isSpeedMax(ball0)) {
                    ball0.vx *= kukuSelfRatio;
                    ball0.vy *= kukuSelfRatio;
                }
                if (!isSpeedMax(ball1)) {
                    ball1.vx *= kukuTeammateRatio;
                    ball1.vy *= kukuTeammateRatio;
                }
            } else {
                if (!isSpeedMax(ball1)) {
                    ball1.vx *= kukuTeammateRatio;
                    ball1.vy *= kukuTeammateRatio;
                }
            }
            ball0.addCount++; // æ¯å›åˆæœ€å¤šåŠ é€Ÿ10æ¬¡
        }
    } else { // ball1 ä¸ºé…·é…·
        if (ball1.addCount < 10) {
            if (ball1.isMainBall) {
                if (!isSpeedMax(ball1)) {
                    ball1.vx *= kukuSelfRatio;
                    ball1.vy *= kukuSelfRatio;
                }
                if (!isSpeedMax(ball0)) {
                    ball0.vx *= kukuTeammateRatio;
                    ball0.vy *= kukuTeammateRatio;
                }
            } else {
                if (!isSpeedMax(ball0)) {
                    ball0.vx *= kukuTeammateRatio;
                    ball0.vy *= kukuTeammateRatio;
                }
            }
            ball1.addCount++;
        }
    }
}


// å¤„ç†åƒµåƒµåŠ é€Ÿã€å‡é€Ÿ
function doJiangjiangSpeed(ball0, ball1) {
    if (userConfig.currRole !== Role.JIANGJIANG.id) return;
    if (!isJiangjiangCollided(ball0, ball1)) return;
    if (isKukuCollided(ball0, ball1)) return; // å’Œé…·é…·ç¢°æ’ï¼Œèµ°é…·é…·åŠ é€Ÿé€»è¾‘
    // ç¢°è§’è‰²åŠ é€Ÿ 20%
    const body1Ratio = 1 + 0.20; // æ¨ªå‘å•è§’è‰²èƒ½ç©¿ 6 æ¬¡
    // ç¢°å°ä¸‘åˆ†èº«å‡é€Ÿ 10%
    const body2Ratio = 1 - 0.15;
    if (ball0.roleId === Role.JIANGJIANG.id && ball0.isMainBall) {
        if (isJoker2Collided(ball0, ball1)) { // ç¢°åˆ°äº†å°ä¸‘åˆ†èº«
            ball0.vx *= body2Ratio;
            ball0.vy *= body2Ratio;
        } else {
            if (!isSpeedMax(ball0)) {
                ball0.vx *= body1Ratio;
                ball0.vy *= body1Ratio;
            }
        }
    }
}


// å¤„ç†å¹½çµå¸•å¸•åŠ é€Ÿã€å‡é€Ÿ
function doPapaSpeed(ball0, ball1) {
    if (userConfig.currRole !== Role.YLPAPA.id) return;
    if (isKukuCollided(ball0, ball1)) return; // å’Œé…·é…·ç¢°æ’ï¼Œèµ°é…·é…·åŠ é€Ÿé€»è¾‘
    // ç¢°è§’è‰²åŠ é€Ÿ 0
    const body1Ratio = 1 + 0;
    // ç¢°å°ä¸‘åˆ†èº«å‡é€Ÿ 0
    const body2Ratio = 1 + 0;
    if (ball0.roleId === Role.YLPAPA.id && ball0.isMainBall) {
        if (isJoker2Collided(ball0, ball1)) { // ç¢°åˆ°äº†å°ä¸‘åˆ†èº«
            ball0.vx *= body2Ratio;
            ball0.vy *= body2Ratio;
        } else {
            if (!isSpeedMax(ball0)) {
                ball0.vx *= body1Ratio;
                ball0.vy *= body1Ratio;
            }
        }
    }
}


// å¤„ç†ç”µéŸ³åŠ é€Ÿ
function doDianyinSpeed(ball0, ball1) {
    if (!isDianyinCollided(ball0, ball1)) return;
    //console.log(">>>> doDianyinSpeed isDianyinCollided=true");
    // çªç ´åï¼Œç¢°åˆ°å­˜æ´»å¯¹æ‰‹ï¼Œè‡ªèº«åŠ é€Ÿ20%ï¼Œæ‰‹åŠ¨è°ƒæ•´æ¯”ä¾‹ï¼Œè·Ÿå®æˆ˜å¯¹æ¯”
    let dianyinRatio = 0.2, addSpeed, speed0; // æ”¹ä¸ºåŸå§‹é€Ÿåº¦çš„æ¯”ä¾‹
    if (ball0.roleId === Role.DIANYIN.id) { // ball0 ä¸ºç”µéŸ³
        ball0.upgradeEffect = 1; // è®¾ç½®çªç ´æ•ˆæœ
        if (!isSpeedMax(ball0)) {
            speed0 = getBallSpeed0(ball0);
            addSpeed = speed0 * dianyinRatio;
            //console.log(">>>> doDianyinSpeed addSpeed", addSpeed);
            let vRate = 1 + addSpeed / Math.sqrt(ball0.vx * ball0.vx + ball0.vy * ball0.vy);
            //console.log(">>>> doDianyinSpeed ball0 vRate", vRate);
            ball0.vx *= vRate;
            ball0.vy *= vRate;
        }
    } else { // ball1 ä¸ºç”µéŸ³
        ball1.upgradeEffect = 1;
        if (!isSpeedMax(ball1)) {
            speed0 = getBallSpeed0(ball1);
            addSpeed = speed0 * dianyinRatio;
            let vRate = 1 + addSpeed / Math.sqrt(ball1.vx * ball1.vx + ball1.vy * ball1.vy);
            //console.log(">>>> doDianyinSpeed ball1 vRate", vRate);
            ball1.vx *= vRate;
            ball1.vy *= vRate;
        }
    }
}


// å¤„ç†å¤ªå¹³ä¹åŠ é€Ÿ
function doLeleSpeed(ball0, ball1) {
    if (userConfig.currRole !== Role.LELE.id) return;
    if (!isLeleCollided(ball0, ball1)) return;
    // çªç ´åï¼Œç¢°åˆ°å­˜æ´»è§’è‰²ï¼ˆé˜Ÿå‹å’Œå¯¹æ‰‹éƒ½ç®—ï¼‰ï¼Œè‡ªèº«åŠ é€Ÿ30%ï¼Œåé¢åŠ å¼ºåˆ°40%äº†ï¼Œæ‰‹åŠ¨è°ƒæ•´æ¯”ä¾‹ï¼Œè·Ÿå®æˆ˜å¯¹æ¯”
    const leleRatio = 1.50; // 30%->1.5 40%->2.0 å¤ªå¿«
    if (ball0.roleId === Role.LELE.id) { // ball0 ä¸ºå¤ªå¹³ä¹
        if (!isSpeedMax(ball0)) {
            ball0.vx *= leleRatio;
            ball0.vy *= leleRatio;
        }
    }
}


// æ£€æµ‹ç¢°è›‹å¤„ç†
function checkEggs(ball, isCheck) {

    ball.isEggCollided = false; // ç¢°æ’æ ‡è¯†é‡ç½®

    if (isCheckEgg(ball, isCheck) && isInEggArea(ball)) {
        eggs.forEach(e => {
            //if (isCollisionBallAndBall(ball, e)) {
            if (is2CirclesCollided(ball, e)) {
                console.log(">>>> checkEggs egg ball Collided.");
                ball.isEggCollided = true;
                ball.isCollided = true;
                //if (!isCheck) ball.collidedCount += 1; // è›‹ä¸ç®—æ¸¸æˆè§’è‰²
                if (!isCheck) ball.wallCollidedCount += 1;

                ball.collidedP0.x = ball.x;
                ball.collidedP0.y = ball.y;

                /*
                let angle = getAngleOf2BallCollided(ball, e); // æ­£æ•°
                let collidedPoint = get2BallCollidedXYByAngle(angle, ball.radius + e.radius);
                //console.log(">>>> get2BallCollidedXYByAngle, x=" + collidedPoint.x + ", y=" + collidedPoint.y);
                // é‡æ–°è®¾ç½®å°çƒä½ç½®
                ball.x = e.x - collidedPoint.x;
                ball.y = e.y - collidedPoint.y;
                // æ”¹å˜äº†yçš„ä½ç½®ï¼Œè¿˜è¦æ‰¾åˆ°å¯¹åº”çš„xä½ç½®
                //setXOrY(ball, collidedP0, true);
                */

                // ä½ç½®è°ƒæ•´æœ‰åå·®
                //do2BallsCollidedMV2(ball, e, true, false, collideParams);
                // ä½¿ç”¨å›é€€æ–¹å¼è°ƒæ•´ä½ç½®
                //doBackToBorderBallsCollided(ball, e, true);
                // ä½¿ç”¨æ–°çš„è®¡ç®—æ–¹å¼è°ƒæ•´åæ ‡ä½ç½®
                adjustMovingBallPos(ball, e);

                console.log(">>>> checkEggs-" + ball.getBallDesc() + "-æ’å‡»ç‚¹åæ ‡ï¼šx=" + ball.x + ", y=" + ball.y);
                if (isCheck && recordCollidedPoint(ball)) return true;

                // ç¢°åˆ°å°±åœæ­¢
                if (userConfig.isStopAfterCollided) {
                    ball.vx = 0;
                    ball.vy = 0;
                    return true;
                }

                if (concurrentCollided && ball.isMainBall && checkWallCollided(ball)) { // åŒæ—¶ç¢°æ’äº†å¢™é¢ã€è›‹åˆ‡é¢ï¼Œé€Ÿåº¦ç›´æ¥åå‘
                    console.log(">>>> æ’å¢™è§’ï¼ŒåŒæ—¶ç¢°æ’äº†å¢™é¢å’Œè›‹åˆ‡é¢ï¼Œé€Ÿåº¦ç›´æ¥åå‘");
                    ball.vx = -ball.collidedV0.x;
                    ball.vy = -ball.collidedV0.y;
                } else {
                    // è®¡ç®—å°çƒåå¼¹é€Ÿåº¦å’Œåå‘
                    do2BallsCollidedMV2(ball, e, false, true, collideParams);
                    // è›‹ä¸ä¼šåŠ¨
                    e.vx = 0;
                    e.vy = 0;
                    // ç¢°è›‹åå¼¹åŠ é€Ÿ
                    //checkEggBounce(ball);
                }

                // ç»˜ç”»ç¢°æ’è™šçº¿åœ†åœˆ
                ball.drawCollidedPos();
            }
        });
    }

    ball.isCheckFinished = true; // æ£€æµ‹å®Œæˆ
    drawAndUpdate(ball, isCheck); // ç»˜åˆ¶å°çƒå¹¶æ›´æ–°é€Ÿåº¦
}


// å•ç‹¬æ£€æµ‹è›‹åˆ‡é¢æ˜¯å¦ç¢°æ’
function checkEggCollided(ball, isChPos) {
    let result = false;
    if (isCheckEgg(ball, true) && isInEggArea(ball)) {
        eggs.some(e => {
            //if (isCollisionBallAndBall(ball, e)) {
            if (is2CirclesCollided(ball, e)) {
                console.log(">>>> checkEggCollided Collided.");
                if (isChPos) {
                    let angle = getAngleOf2BallCollided(ball, e); // æ­£æ•°
                    let collidedPoint = get2BallCollidedXYByAngle(angle, ball.radius + e.radius);
                    //console.log(">>>> get2BallCollidedXYByAngle, x=" + collidedPoint.x + ", y=" + collidedPoint.y);
                    // é‡æ–°è®¾ç½®å°çƒä½ç½®
                    ball.x = e.x - collidedPoint.x;
                    ball.y = e.y - collidedPoint.y;
                    //do2BallsCollidedMV2(ball, e, true, false, collideParams);
                }
                result = true;
                return true; // åªæ˜¯é€€å‡ºå¾ªç¯
            }
        });
    }
    return result;
}


// æ˜¯å¦ç¢°åˆ°è›‹åŒºåŸŸ
function isInEggArea(ball) {
    let posCheck = ((ball.y - ball.radius <= 1 * sysConfig.girdSize || ball.y + ball.radius >= 21 * sysConfig.girdSize) && ball.x + ball.radius >= 6 * sysConfig.girdSize && ball.x - ball.radius <= 8 * sysConfig.girdSize);
    return posCheck;
}


// æ˜¯å¦éœ€è¦æ£€æµ‹ç¢°è›‹
// éä¸»è§’è¦æ£€æµ‹
// åƒµå°¸ã€å¹½çµï¼Œç„å‡†æ—¶æ£€æµ‹
// å‚€å„¡ç»³å­ï¼Œç„å‡†æˆ–æ‹‰å›æ—¶æ£€æµ‹
// å…¶ä»–ä¸»è§’è¦æ£€æµ‹
function isCheckEgg(ball, isCheck) {
    //return !ball.isMainBall || (ball.roleId !== Role.JIANGJIANG.id && ball.roleId !== Role.YLPAPA.id && (ball.roleId !== Role.KUILEI.id || isKuileiPulling));
    if (!ball.isMainBall) return true;
    if (ball.roleId === Role.JIANGJIANG.id || ball.roleId === Role.YLPAPA.id) {
        if (isCheck && !userConfig.isShowTryFullPath) return true;
        return false;
    }
    if (ball.roleId === Role.KUILEI.id) {
        if (isCheck && !userConfig.isShowTryFullPath || isKuileiPulling) return true;
        return false;
    }

    return true;
}


// æ£€æµ‹æ˜¯å¦ç¢°æ’äº†è‡ªå·±
// å‚€å„¡ç¢°åˆ°è‡ªå·±åï¼Œç»³ç´¢ä¼šç«‹å³åœæ­¢
function checkSelfCollided(ball) {
    if (ball.isMainBall && ball.roleId === Role.KUILEI.id && !isKuileiPulling) {
        if (ball.wallCollidedCount < 1) return; // è‡³å°‘ç¢°å¢™é¢ä¸€æ¬¡æ‰ä¼šåå¼¹ç¢°åˆ°è‡ªå·± 
        tempCheckBall.roleId = ball.roleId;
        tempCheckBall.x = ball.x0;
        tempCheckBall.y = ball.y0;
        tempCheckBall.radius = ball.radiusTmp;
        // æ£€æµ‹ç¢°æ’
        if (is2CirclesCollided(ball, tempCheckBall)) {
            // ç¢°åˆ°è‡ªå·±ï¼Œç»³ç´¢ç«‹å³åœæ­¢
            ball.wallCollidedCount = 3;
        }
    }
}


// å°çƒå¸¦è´¨é‡ç¢°æ’åå¼¹
// friction:sysConfig.friction friction:roundNumber(0.8677 / 842 * canvas.width, 4)
var collideParams = { friction: 0.70, bounce: 0.70, eggId: -1, verCode: 0 };
onMounted(() => {
    //collideParams.friction = sysConfig.friction;
    collideParams.friction = roundNumber(0.8677 / 842 * canvas.width, 4);
    // ç®€å•æ¨¡æ‹Ÿæ‘©æ“¦åŠ› f=0.2*m
    let m0 = balls.length > 0 ? balls[0].m : 70;
    collideParams.bounce = sysConfig.bounce ? sysConfig.bounce : (sysConfig.friction + 0.2 * m0);
    collideParams.eggId = Ball.SPECIALROLEID.eggId;
    collideParams.verCode = sysConfig.version;
    if (!collideParams.bounce) collideParams.bounce = 0.70;
    if (!collideParams.eggId) collideParams.eggId = -1;
    console.log(">>>> do2BallsCollidedMV2 params=" + JSON.stringify(collideParams));
});
//var dotCount = 0;
//function do2BallsCollidedMV2(ball0, ball1, isChPos, isChVel, params) {}


// å°çƒç»˜åˆ¶åŠé€Ÿåº¦çŠ¶æ€æ›´æ–°
function drawAndUpdate(ball, isCheck) {
    // æ‰€æœ‰ç¢°æ’æ£€æµ‹æœªå®Œæˆï¼Œä¸ç»˜åˆ¶ï¼Œä¹Ÿä¸æ›´æ–°é€Ÿåº¦ï¼Œç›´æ¥è¿”å›
    if (!ball.isCheckFinished) return;

    // ç”»è¢«ç„å‡†è§’è‰²æŒ‡ç¤ºåœˆ
    /* TODO æœ‰å¾ˆå¤šç©ºé—²æ—¶é—´å†ç ”ç©¶å‘é‡äº†ï¼Œä¸åœ¨è‡ªå·±çš„ä¸“ä¸šé¢†åŸŸï¼ŒçœŸçš„å¾ˆè€—è´¹æ—¶é—´ç²¾åŠ›ï¼ï¼
    if (isCheck) balls.forEach(b => {
        if (b.isMainBall) return; // continue
        // æ£€æµ‹æ‹–åŠ¨ç‚¹åˆ°ä¸»çƒåœ†å¿ƒçš„çº¿æ®µä¸éä¸»çƒæ˜¯å¦ç›¸äº¤
        let start = {x: mouse.x, y: mouse.y}; // çº¿æ®µèµ·ç‚¹-æ‹–åŠ¨ç‚¹
        let end = {x: ball.x, y: ball.y}; // çº¿æ®µç»ˆç‚¹-ä¸»çƒåœ†å¿ƒ
        let o = {x: b.x, y: b.y}; // éä¸»çƒåœ†å¿ƒ
        // å®šé•¿çº¿æ®µæ£€æµ‹ä¸åœ†ç›¸äº¤ï¼Œä¸èƒ½æ»¡è¶³å®é™…éœ€æ±‚ï¼Œå®é™…éœ€è¦çš„æ˜¯æ£€æµ‹å˜é•¿çº¿æ®µä¸åœ†ç›¸äº¤ã€çœŸçš„æ²¡æ—¶é—´æŠ˜è…¾äº†ï¼Œå…ˆæ”¾ä¸€æ”¾ï¼Œå¹¶ä¸”åŠ äº†æŒ‡ç¤ºåœˆä¹Ÿæ²¡æœ‰å¥½å¤šå°‘ã€‘
        if (doesLineInterceptCircle(start, end, o, b.radius)) b.drawAimCircle();
    });
    */

    // å°çƒä½ç½®æ²¡åŠ¨ä¸ç”»
    if (ball.isMainBall) { // åªæ£€æµ‹ä¸»çƒ
        if (!isBallDrawAndUpdate(ball, 1)) return;
    } else { // æ£€æµ‹éä¸»çƒ
        if (!isBallDrawAndUpdate(ball, 2)) return;
    }

    if (userConfig.isStopAfter2WallCollided && ball.isMainBall && ball.wallCollidedCount >= 2) { // ç¢°ä¸¤æ¬¡ååœæ­¢ï¼Œç”¨äºæµ‹è¯•è§‚å¯Ÿè§’åº¦
        ball.vx = 0;
        ball.vy = 0;
    }

    if (!isCheck) { // æ£€æµ‹ç¢°æ’ç‚¹ï¼Œä¸ç”¨ç”»ï¼Œä¼˜åŒ–æ€§èƒ½
        ball.draw(); // ç»˜åˆ¶å°çƒ
        ball.drawLinePath(ball.prePoint, { x: ball.x, y: ball.y }); // ç»˜åˆ¶å°çƒæ’å‡»è½¨è¿¹-æ­£å¸¸ç›´çº¿
        ball.drawBallPath(ball.prePoint, { x: ball.x, y: ball.y }); // ç»˜åˆ¶å°çƒæ’å‡»è½¨è¿¹-æœ¬ä½“ç›´çº¿
        if (ball.isWallCollided || ball.isLineCollided || ball.isBallCollided || ball.isEggCollided) ball.preCollided = { x: ball.x, y: ball.y }; // å¤‡ä»½ç¢°æ’ç‚¹
        ball.prePoint = { x: ball.x, y: ball.y }; // å¤‡ä»½è¿åŠ¨ç‚¹
        //ball.drawPointPath(); // ç»˜åˆ¶å°çƒåœ†ç‚¹æ’å‡»è½¨è¿¹
    }
    ball.update(); // æ›´æ–°å°çƒè¿åŠ¨çŠ¶æ€
}


// æ‰€æœ‰ç¢°æ’æ£€æµ‹å®Œæˆä¹‹åï¼Œè¦å¤„ç†çš„äº‹æƒ…
function doAfterCollidCheck() {
    // TODO
}


// åˆ¤æ–­å°çƒæ˜¯å¦åœ¨å››ä¸ªåˆ‡è§’ï¼ˆçŸ©å½¢ï¼‰èŒƒå›´å†…ã€‚æ³¨æ„ï¼Œè¿™é‡Œåªæ˜¯ç²—ç•¥åˆ¤æ–­
function isInAngleArea(ball) {
    let idx = -1;
    // å·¦ä¸Šè§’
    if ((ball.x - ball.radius <= sysConfig.girdSize * 3) && (ball.y - ball.radius <= sysConfig.girdSize * 3)) idx = 0;
    // å³ä¸Šè§’
    if ((ball.x + ball.radius >= sysConfig.girdSize * 11) && (ball.y - ball.radius <= sysConfig.girdSize * 3)) idx = 1;
    // å³ä¸‹è§’
    if ((ball.x + ball.radius >= sysConfig.girdSize * 11) && (ball.y + ball.radius >= sysConfig.girdSize * 19)) idx = 2;
    // å·¦ä¸‹è§’
    if ((ball.x - ball.radius <= sysConfig.girdSize * 3) && (ball.y + ball.radius >= sysConfig.girdSize * 19)) idx = 3;
    //console.log(">>>> isInAngleArea idx=" + idx);
    return idx;
}


// åŸç†ï¼šåŒä¸€æ¡çº¿ä¸Šçš„ç‚¹ï¼Œå€¾æ–œè§’åº¦ç›¸åŒ
// æ”¹å˜äº†yçš„ä½ç½®ï¼Œè¿˜è¦æ‰¾åˆ°å¯¹åº”çš„xä½ç½®ï¼Œç›¸åä¹Ÿä¸€æ ·ã€‚flag=true é€šè¿‡yæ”¹å˜xï¼›flag=false é€šè¿‡xæ”¹å˜y
// åˆ‡è§’è¾¹å› ä¸ºæ—‹è½¬äº†åæ ‡ç³»ï¼Œå•ç‹¬å¤„ç†
function setXOrY(ball, collidedP0, flag) {
    let angle = Math.atan2(ball.vy, ball.vx);
    if (flag) { // y->x
        let x = (collidedP0.y - ball.y) / Math.tan(angle);
        //console.log(">>>> x=" + x);
        // TODO é˜²æ­¢è°ƒæ•´å‡ºé”™
        if (isNumber(x) && isNumber(ball.x - x)) ball.x -= x;
    } else { // x->y
        let y = (collidedP0.x - ball.x) * Math.tan(angle);
        //console.log(">>>> y=" + y);
        if (isNumber(y) && isNumber(ball.y - y)) ball.y -= y;
    }
}


// æ‘©æ“¦åŠ›ä½œç”¨ï¼Œæ•´ä¸ªå°é¢
// requestAnimationFrame 60 å¸§ï¼Œæ¯å¸§è°ƒç”¨ä¸€æ¬¡ï¼Œæ‘©æ“¦åŠ›æ˜¯å›ºå®šå€¼ï¼Œä½†å•ä½æ—¶é—´å†…èµ°çš„è·ç¦»è¿œçš„ï¼Œæ‘©æ“¦åŠ›æ€»å’Œå¤§ã€‚åœ¨åŒæ ·çš„ä¸€å¸§æ—¶é—´å†…ï¼Œæ‘©æ“¦åŠ›è·Ÿé€Ÿåº¦æ­£ç›¸å…³
function checkFriction(ball) {
    if (sysConfig.friction <= 0) return;
    if (ball.isMainBall && ball.roleId === Role.KUILEI.id && !isKuileiPulling) return; // å‚€å„¡çš„ç»³å­ä¸å—æ‘©æ“¦åŠ›å½±å“ï¼Œæ‹‰å›æ—¶å½±å“
    // æ±‚åˆé€Ÿåº¦
    let v = Math.sqrt(ball.vx * ball.vx + ball.vy * ball.vy);
    //if (v > 0 ) console.log(">>>> v=" + v);
    //if (v <= 0) return;
    // æ¨¡æ‹Ÿå®æˆ˜æ‰“å®Œåç¼“æ…¢åœæ­¢è¿åŠ¨æ•ˆæœ
    // æ‘©æ“¦åŠ›è·Ÿå®æ—¶é€Ÿåº¦æ­£ç›¸å…³ï¼Œv0 / f0 = v1 / f1 -> f1 = v1 / (v0 / f0)
    let f1 = v / (ball.v / sysConfig.friction);
    if (!f1 || !isNumber(f1) || f1 < (0.5 / 842) * canvas.width) f1 = (0.5 / 842) * canvas.width; // é¿å…æ‘©æ“¦åŠ›å¤ªå°ï¼Œå¯¼è‡´å¾ˆä¹…æ‰åœä¸‹æ¥
    if (v > f1) {
        v -= f1;
    } else {
        v = 0;
    };
    // åˆé€Ÿåº¦åˆ†è§£
    let angle = Math.atan2(ball.vy, ball.vx);
    ball.vx = Math.cos(angle) * v;
    ball.vy = Math.sin(angle) * v;
}


// åå¼¹ç³»æ•°é€Ÿåº¦æŸè€—ï¼Œæ¯å¼¹ä¸€æ¬¡ï¼Œé€Ÿåº¦ä¼šå˜æ…¢ä¸€ç‚¹
function checkBounce(ball, bounceVal) {
    if (!bounceVal && sysConfig.bounce <= 0) return;
    if (ball.isMainBall && ball.roleId === Role.KUILEI.id && !isKuileiPulling) return; // å‚€å„¡çš„ç»³å­ä¸å‡é€Ÿï¼Œæ‹‰å›æ—¶å½±å“
    if (ball.vx === 0 && ball.vy === 0) return;
    let v = Math.sqrt(ball.vx * ball.vx + ball.vy * ball.vy);
    //if (v > 0 ) console.log(">>>> v=" + v);
    let val = bounceVal ? bounceVal : sysConfig.bounce;
    if (v > val) {
        //console.log(">>>> checkBounce v=" + v);
        v -= val;
    } else {
        v = 0;
    };
    let angle = Math.atan2(ball.vy, ball.vx);
    ball.vx = Math.cos(angle) * v;
    ball.vy = Math.sin(angle) * v;
}


// ç¢°è›‹åå¼¹åŠ é€Ÿ
function checkEggBounce(ball, eggBounceVal) {
    if (sysConfig.eggBounce <= 0) return;
    if (ball.isMainBall && (ball.roleId === Role.KUILEI.id && !isKuileiPulling || ball.roleId === Role.JIANGJIANG.id || ball.roleId === Role.YLPAPA.id)) return;
    if (ball.vx === 0 && ball.vy === 0) return;
    let v = Math.sqrt(ball.vx * ball.vx + ball.vy * ball.vy);
    let val = eggBounceVal ? eggBounceVal : sysConfig.eggBounce;
    v = v * (1 + val);
    let angle = Math.atan2(ball.vy, ball.vx);
    ball.vx = Math.cos(angle) * v;
    ball.vy = Math.sin(angle) * v;
}


// ä¸¤çƒç¢°æ’æ£€æµ‹ï¼ˆåœ†ä¸åœ†ç¢°æ’ï¼‰ã€ç›®å‰æ£€æµ‹åˆ¤æ–­è¿˜å­˜åœ¨ä¸ªåˆ«ç¢°æ’ç©¿é€é—®é¢˜ã€‘
function isCollisionBallAndBall(ball0, ball1) {
    // ä¿©çƒéƒ½æ²¡é€Ÿåº¦ï¼Œä¸ç®—ç¢°æ’
    if (ball0.vx === 0 && ball0.vy === 0 && ball1.vx === 0 && ball1.vy === 0) return false;
    let result = false;
    // å‚€å„¡ç¢°æ’åˆ¤æ–­åŠå¾„å–ç»³å­çš„åŠå¾„
    let KLRadius;
    if (ball0.isMainBall && ball0.roleId === Role.KUILEI.id) {
        if (isKuileiPulling) KLRadius = ball0.radiusTmp;
        else KLRadius = ball0.pathRadius; // pathRadius-ç»³å­è·¯å¾„åŠå¾„ï¼Œæ‹‰å›ä¹‹å‰é»˜è®¤çš„æ˜¯ tryRadius-ç„å‡†åœˆåŠå¾„
    }
    // åŒå­æœ¬ä½“ä¸åˆ†èº«ä¸ä¼šç¢°æ’ï¼Œä¼šç©¿é€
    let twinCheck = isTwinSelf(ball0, ball1);
    //console.log(">>>> isCollisionBallAndBall twinCheck=" + twinCheck);
    result = !twinCheck && (ball0.x - ball1.x) ** 2 + (ball0.y - ball1.y) ** 2 <= ((KLRadius ? KLRadius : ball0.radius) + ball1.radius) ** 2 + sysConfig.epsilon;
    //console.log(">>>> isCollisionBallAndBall 2 balls check result=" + result);

    // å¦‚æœæ˜¯ç¢°è›‹æ£€æµ‹ï¼Œç›´æ¥è¿”å›
    if (ball1.roleId === Ball.SPECIALROLEID.eggId) return result;

    // å¤‡ä»½ä¸€ä¸‹ç¢°æ’çŠ¶æ€
    let colliding01 = ball0.collidingNos[ball1.no - 1];

    if (result) {
        if (ball0.collidingNos) ball0.collidingNos[(ball1.no - 1) < 0 ? 0 : (ball1.no - 1)] = true;
        //if (ball1.collidingNos) ball1.collidingNos[(ball0.no - 1) < 0 ? 0 : (ball0.no - 1)] = true;
    } else {
        if (ball0.collidingNos) ball0.collidingNos[(ball1.no - 1) < 0 ? 0 : (ball1.no - 1)] = false;
        //if (ball1.collidingNos) ball1.collidingNos[(ball0.no - 1) < 0 ? 0 : (ball0.no - 1)] = false;
    }

    // è‡ªå·±ä¸ç®—ï¼Œball.collidingNos ä¸­ï¼Œball.no-1 æ˜¯è‡ªå·±
    if (ball0.collidingNos) ball0.collidingNos[(ball0.no - 1) < 0 ? 0 : (ball0.no - 1)] = false;
    if (ball1.collidingNos) ball1.collidingNos[(ball1.no - 1) < 0 ? 0 : (ball1.no - 1)] = false;

    //console.log(">>>> isCollisionBallAndBall ball0:", ball0.collidingNos);
    //console.log(">>>> isCollisionBallAndBall ball1:", ball1.collidingNos);

    // æ­£åœ¨ç¢°æ’ä¸é‡å¤æ£€æµ‹ã€åªå¯¹å¯ç©¿é€çš„è§’è‰²ç”Ÿæ•ˆï¼Œåƒµå°¸ã€å¹½çµã€å‚€å„¡æœªæ‹‰å›æ—¶ã€‘
    if ((userConfig.currRole === Role.JIANGJIANG.id || userConfig.currRole === Role.YLPAPA.id
        || (userConfig.currRole === Role.KUILEI.id && !isKuileiPulling))
        && colliding01 && colliding01 === ball0.collidingNos[ball1.no - 1]) result = false;

    //console.log(">>>> isCollisionBallAndBall final result=" + result);
    return result;
}


// æ˜¯å¦ä¸ºåŒå­æœ¬ä½“ä¸åˆ†èº«ç¢°æ’
function isTwinSelf(ball0, ball1) {
    let twinCheck = ball0.roleId === ball1.roleId && ball0.roleId === Role.SHUANGZI.id && ball0.teamColor === ball1.teamColor && ball0.no !== ball1.no;
    return twinCheck;
}


// è§’è‰²æ˜¯å¦ç¢°åˆ°äº†è›‹ï¼ˆæœ€å¤šä¸¤ä¸ªè›‹ï¼‰
function isBallAndEggCollided(ball) {
    if (!eggs || eggs.length < 1) return false;
    let result = false;
    eggs.some(egg => {
        if (is2CirclesCollided(ball, egg)) {
            result = true;
            return true; // åªæ˜¯é€€å‡ºäº†å¾ªç¯
        }
    });
    return result;
}


// ä¸¤çƒç¢°æ’æ—¶ï¼Œåœ†å¿ƒè¿çº¿ä¸xè½´çš„å¤¹è§’ã€‚æ³¨æ„ä¸¤çƒé¡ºåºï¼Œçœ‹æ‰“å°ç»“æœï¼Œå–æ­£æ•°é¡ºåº
// ball0 ä¸ºè¿åŠ¨å°çƒï¼Œball1 ä¸ºè¢«æ’å°çƒ
function getAngleOf2BallCollided(ball0, ball1) {
    let dx = ball1.x - ball0.x;
    let dy = ball1.y - ball0.y;
    let angle = Math.atan2(dy, dx);
    //console.log(">>>> getAngleOf2BallCollided=" + angle);
    return angle;
}


// ä¸¤çƒæ­£å¥½ç¢°æ’ï¼Œé€šè¿‡å¤¹è§’è·å–å°çƒåœ†å¿ƒä¸è›‹åœ†å¿ƒçš„ç›¸å¯¹è·ç¦»xã€y
// d ä¸ºä¿©çƒåœ†å¿ƒè·ç¦»
function get2BallCollidedXYByAngle(angle, d) {
    let x = Math.cos(angle) * d;
    let y = Math.sin(angle) * d;
    return { x: x, y: y };
}

//////////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////////
// ã€åŠ¨ç”»æ¸²æŸ“æ§åˆ¶ã€‘ å˜é‡ã€æ–¹æ³•åŒºåŸŸ
//////////////////////////////////////////////////////////////////////

// é€‰ä¸­çš„å°çƒ
var selectedBall = null; // var å…¨å±€å˜é‡ï¼Œå®šä¹‰é¡ºåºä¸å½±å“å‰é¢æ–¹æ³•ä½¿ç”¨
// å°è¯•è¿åŠ¨çš„å°çƒ
//window.onload = function () {};
var tryMoveBall;
onMounted(() => {
    if (balls && balls.length > 0) tryMoveBall = new Ball(context, {
        no: balls[0].no,
        roleId: balls[0].roleId,
        isMainBall: true,
        x: 0,
        y: 0,
        vx: 0,
        vy: 0,
        radius: balls[0].radius,
        color: balls[0].color
    });
})
// å°è¯•è¿åŠ¨çš„å°çƒï¼Œç¬¬ä¸€æ¬¡ç¢°æ’åæ ‡
let tryMoveBallFirstCollidedPos = { x: 0, y: 0 };
let tryMoveBallFirstCollidedPosBack = { x: 0, y: 0 };
// å°è¯•è¿åŠ¨çš„å°çƒï¼Œç¢°æ’ç‚¹åæ ‡
let tryMoveBallCollidedPoints = [];
// æ§åˆ¶ç»˜åˆ¶è¿åŠ¨è½¨è¿¹
let isAnimated = false; // æ¸²æŸ“å®Œæˆ
let isMoving = true; // æ˜¯å¦åœ¨è¿åŠ¨
let isPlaying = true; // æ˜¯å¦åœ¨ç©
let isKuileiPulling = false; // å‚€å„¡æ˜¯å¦æ­£åœ¨æ‹‰å›


// é‡ç½®åŠ¨ç”»æ¸²æŸ“ç›¸å…³å˜é‡
function resetAnimate() {
    selectedBall = null;
    if (balls && balls.length > 0) tryMoveBall = new Ball(context, {
        no: balls[0].no,
        roleId: balls[0].roleId,
        isMainBall: true,
        x: 0,
        y: 0,
        vx: 0,
        vy: 0,
        radius: balls[0].radius,
        color: balls[0].color
    });
    tryMoveBallFirstCollidedPos = { x: 0, y: 0 };
    tryMoveBallCollidedPoints = [];
    isAnimated = false;
    //isMoving = true;
    //isPlaying = true;
    isKuileiPulling = false;
}


// åŠ¨ç”»æ¸²æŸ“å…¥å£
onMounted(() => {
    animate();
})


// æ§åˆ¶å¸§ç‡
var fps = 60;
var fpsInterval = 1000 / fps;
var fpsLast = new Date().getTime();

// åŠ¨ç”»æ¸²æŸ“ä¸»å‡½æ•°ã€‚æ³¨æ„ï¼å¤šæ¬¡è°ƒç”¨è¿™ä¸ªæ¸²æŸ“å‡½æ•°ï¼Œä¼šå¯¼è‡´åŠ¨ç”»å˜å¿«ï¼å³å€é€Ÿå¿«æ”¾çš„æ•ˆæœ
// TODO å‡å°‘å›¾å½¢é‡å¤ç»˜åˆ¶æ¸²æŸ“ï¼Œå¯ä»¥å¾ˆå¥½åœ°èŠ‚çœCPUæ€§èƒ½
function animate() {
    if (!balls || balls.length < 1) return;

    // æ£€æµ‹æ˜¯å¦åœ¨ç©
    checkIsPlaying();

    // é—²ç½®æ²¡ç©äº†ï¼Œæˆ–è€…é•¿æ—¶é—´ç„å‡†ä¸åŠ¨æ—¶ï¼Œåœæ­¢æ¸²æŸ“ï¼Œä¼˜åŒ–CPUæ€§èƒ½
    if (!isPlaying) {
        // TODO å±å¹•å¤šç‚¹è§¦ç¢°ï¼Œå¯èƒ½ä¼šå‡ºç°ç¨‹åºå¼‚å¸¸æƒ…å†µï¼ˆç›®å‰é™åˆ¶äº†å¤šç‚¹è§¦ç¢°ï¼‰ï¼šä¸»çƒæœ‰é€Ÿåº¦ä½†æ˜¯ä¸è¿åŠ¨ï¼Œå¯¼è‡´ä¸æ‰§è¡Œ resetBallsSpeedï¼Œå‡ºç°æ­»å¾ªç¯ï¼
        // æœ‰è¿åŠ¨ç¢°æ’æ‰å¤„ç†åœæ­¢äº‹é¡¹ï¼›å› ä¸ºå•ç‹¬ç¢°è›‹ä¸ç®—ç¢°æ’ï¼Œä¼šå¯¼è‡´ resetBallsSpeed ä¸èƒ½æ‰§è¡Œï¼Œå‡ºç°å¡æ­»ï¼ selectedBall ä¸º null æ—¶ï¼Œä¸»çƒå¼€å§‹è¿åŠ¨
        if (!selectedBall || checkAnyBallCollided(0)) {
            //doAfterBallStopped(balls);
            resetBallsSpeed(balls);
        }
        // æ²¡æœ‰ç¢°æ’ï¼Œå°±åªæ˜¯åœæ­¢ animate æ¸²æŸ“
        return;
    }

    // ä¸åœåœ°æ¸²æŸ“ï¼Œç›¸å¯¹æ¥è¯´æ¯”è¾ƒè€—æ€§èƒ½
    // æ‰§è¡Œæ¬¡æ•°é€šå¸¸æ˜¯æ¯ç§’ 60 æ¬¡ï¼Œå½“é¡µé¢å¤„äºæœªæ¿€æ´»çš„çŠ¶æ€ä¸‹ï¼Œè¯¥é¡µé¢çš„å±å¹•ç»˜åˆ¶ä»»åŠ¡ä¹Ÿä¼šè¢«æµè§ˆå™¨æš‚åœ
    requestAnimationFrame(animate);
    //console.log(">>>> requestAnimationFrame åŠ¨ç”»æ¸²æŸ“ >>>>");

    // å¸§ç‡ 90 120ï¼Œéœ€è¦è¿›è¡Œå¸§ç‡æ§åˆ¶
    if (fpsCtrlFlag) {
        let fpsNow = new Date().getTime();
        let elapsed = fpsNow - fpsLast;
        if (elapsed <= fpsInterval) return; // å¸§ç‡æ—¶é—´ä¸å¤Ÿï¼Œä¸å¾€ä¸‹æ‰§è¡Œ
        fpsLast = fpsNow - (elapsed % fpsInterval); // æ ¡æ­£å¸§ç‡æ—¶é—´
    }

    // æ¸…ç©ºè¿åŠ¨å±‚ç”»å¸ƒã€TODO ç›®å‰å­˜åœ¨ä½ç½®æ²¡å˜ä¼šé‡å¤ç”»ä¸€æ¬¡çš„é—®é¢˜ï¼Œå¯ä»¥çœ‹åˆ°å°ä¸‘åˆ†èº«é€æ˜åº¦å˜åŒ–ã€‘
    doClearMoveCanvas();

    balls.forEach(ball => {
        if (selectedBall === ball) {
            //console.log(">>>> ball=" + JSON.stringify(ball));
            //balls.forEach(draw);
            //console.log(">>>> animate mainBall.x=" + ball.x + ", mainBall.y=" + ball.y);
            ball.draw();
        } else {
            try {
                checkSelfCollided(ball); // è‡ªèº«ç¢°æ’æ£€æµ‹
                checkWalls(ball, false); // å¢™é¢ç¢°æ’æ£€æµ‹
                checkLines(ball, false); // åˆ‡é¢ç¢°æ’æ£€æµ‹
                checkOtherBalls(ball, false); // çƒç¢°æ’æ£€æµ‹
                if (isDuoduoExist) checkEggs(ball, false); // è›‹ç¢°æ’æ£€æµ‹
                checkFriction(ball); // æ‘©æ“¦åŠ›ä½œç”¨
                doAfterCollidCheck(); // æ£€æµ‹å®Œæˆåå¤„ç†ä¸šåŠ¡
            } catch (e) {
                doGlobalError(e, (sysConfig && sysConfig.alertErrorCount) ? sysConfig.alertErrorCount : 3);
            }
        }
    });

    // TODO åŠ¨ç”»ï¼ŒåŠ¨ã€ç”»åˆ†å¼€ç‹¬ç«‹æ§åˆ¶ã€‚åœ¨æ£€æŸ¥ç¢°æ’æ–¹æ³•ä¸­å¯ä»¥æ›´ç»†ç²’åº¦æ§åˆ¶

    // ç»˜åˆ¶
    //lines.forEach(draw); // ç”»äº†åˆ‡è§’å¡«å……ï¼Œåˆ‡è§’çº¿å¯ä»¥ä¸ç”»äº†
    //balls.forEach(draw); // æ”¾æ£€æŸ¥ç¢°æ’æ–¹æ³•ä¸­ç»†ç²’åº¦æ§åˆ¶

    // ç§»åŠ¨ä½ç½®å®Œæˆåï¼Œç»˜åˆ¶ç§»åŠ¨è½¨è¿¹æç¤º
    //if (selectedBall) console.log(">>>> isChgPosFinished:" + selectedBall.isChgPosFinished);
    if (selectedBall && selectedBall.isChgPosFinished && selectedBall.isMainBall) {
        showMovePath();
    }

    // æ¸²æŸ“å®Œæˆ
    isAnimated = true;
}


// å°çƒç»˜åˆ¶
function draw(ball) {
    ball.draw();
}


// æ¸…ç©ºè¿åŠ¨å±‚ç”»å¸ƒ
function doClearMoveCanvas() {
    // æ¸…é™¤ä¸»çƒè¿åŠ¨å±‚ç”»å¸ƒ
    if (isBallDrawAndUpdate(null, 1)) { // ä¸»çƒæœ‰è¿åŠ¨
        console.log(">>>> doClearMoveCanvas gameMainBallCanvas");
        clearCanvasAll(gameMainBallCanvas);
    }
    // æ¸…é™¤ä¸»è¿åŠ¨å±‚ç”»å¸ƒ
    if (isBallDrawAndUpdate(null, 2)) { // éä¸»çƒæœ‰è¿åŠ¨
        console.log(">>>> doClearMoveCanvas canvas");
        clearCanvasAll(canvas);
    }
}


// æ¸…ç©ºè·¯å¾„å±‚ç”»å¸ƒ
function doClearPathCanvas() {
    if (isBallDrawAndUpdate(null, 1)) { // ä¸»çƒæœ‰è¿åŠ¨
        // æ¸…é™¤çƒè·¯å¾„
        console.log(">>>> doClearPathCanvas gamePathBallCanvas");
        clearCanvasAll(gamePathBallCanvas);
        // æ¸…é™¤çº¿è·¯å¾„
        console.log(">>>> doClearPathCanvas gamePathCanvas");
        clearCanvasAll(gamePathCanvas);
    }
}


// æ¸…ç©ºç”»å¸ƒæ‰€æœ‰å†…å®¹
function clearCanvasAll(cvs) {
    // æŒ‡å®šåŒºåŸŸæ¸…é™¤ï¼Œå¯¹äºç§»åŠ¨äº†åæ ‡ç³»åŸç‚¹çš„æƒ…å†µä¸é€‚ç”¨
    /*
    let ctx = cvs.getContext('2d');
    ctx.clearRect(0, 0, cvs.width, cvs.height);
    ctx.beginPath(); // å¼€å¯æ–°pathï¼Œé¿å…æ—§çš„pathæ®‹ç•™
    */

    // é‡ç½®ç”»å¸ƒé«˜åº¦ï¼Œå†…å®¹ä¼šè¢«è‡ªåŠ¨ç§»é™¤
    let w = cvs.width;
    let h = cvs.height;
    cvs.width = w;
    cvs.height = h;
}


// åˆ·æ–°ä¸€æ¬¡æ‰€æœ‰è§’è‰²æ¸²æŸ“ï¼Œä¸å½±å“è·¯å¾„å’Œåœºæ™¯
function flushAllRoleOnce() {
    if (!balls || balls.length < 1) return;
    // æ¸…ç©ºè§’è‰²æ‰€åœ¨å›¾å±‚
    clearCanvasAll(canvas); // è§’è‰²è¿åŠ¨å±‚
    clearCanvasAll(gameMainBallCanvas); // ä¸»è§’è¿åŠ¨å±‚
    // é‡ç”»
    balls.some(ball => {
        ball.draw();
    });
}


// æ£€æµ‹æ˜¯å¦åœ¨ç©
function checkIsPlaying() {
    isMoving = checkIsMoving();
    //console.log(">>>> isAnimated=" + isAnimated);
    console.log(">>>> isMoving=" + isMoving);
    //console.log(">>>> isFirstCollidedPointFounded=" + isFirstCollidedPointFounded);
    if (!isAnimated || isMoving) { // æ²¡æœ‰æ¸²æŸ“å®Œæˆï¼Œæˆ–è€…é€Ÿåº¦è¿˜åœ¨å˜åŒ–ï¼Œè¯´æ˜åœ¨ç©
        isPlaying = true;
    } else {
        isPlaying = false;
    }

    // TODO ç„å‡†ä¸åŠ¨æ—¶ï¼Œä¼˜åŒ–CPUæ€§èƒ½
    if (isAnimated && isMoving && isFirstCollidedPointFounded) {
        isPlaying = false; // æ³¨æ„ï¼Œè¿™é‡Œä¼šåœæ­¢æ¸²æŸ“ï¼Œåç»­éœ€è¦å†æ¬¡æ‰‹åŠ¨è°ƒç”¨ animate() è¿›è¡Œæ¸²æŸ“
    }

    console.log(">>>> isPlaying=" + isPlaying);
}


// æ£€æµ‹å¤šä¸ªå°çƒæ˜¯å¦åœ¨è¿åŠ¨
function checkIsMoving() {
    let result = false;
    // æ£€æµ‹tryMoveBall
    //if (tryMoveBall) result = result || (tryMoveBall.vx > 0 || tryMoveBall.vy > 0);
    if (tryMoveBall) result = result || tryMoveBall.isMoving;
    if (result) return result;
    // æ£€æµ‹ball
    if (balls && balls.length > 0) balls.some(ball => {
        result = result || (ball.vx > 0 || ball.vy > 0);
        result = result || ball.isMoving;
        if (result) return true; // åªæ˜¯é€€å‡ºäº†å¾ªç¯
    });
    return result;
}


// animate å•æ¬¡æ‰§è¡Œæ¬¡æ•°è¿‡å¤šï¼Œå¯èƒ½æ˜¯å‡ºç°äº†æ­»å¾ªç¯ï¼Œå°†æ‰€æœ‰å°çƒé€Ÿåº¦ç½®é›¶
function resetBallsSpeed(balls) {
    // é‡ç½®æ‰€æœ‰è§’è‰²é€Ÿåº¦ï¼Œæ›´æ–°è¿åŠ¨çŠ¶æ€
    stopAllBalls(balls);
    // å¤„ç†åœæ­¢äº‹é¡¹ animate() ä¼šè°ƒç”¨
    doAfterBallStopped(balls);
    // å†æ£€æµ‹ä¸€æ¬¡ animate çŠ¶æ€
    checkIsPlaying();
    if (!isMoving && !isPlaying) console.log(">>>> æœ¬å›åˆç»“æŸ >>>>");
}


// å¤„ç†å‡†å¤‡ tryMoveBall
function preTryMoveBall(num) {
    if (!tryMoveBall || !tryMoveBall.isMainBall) return;
    // tryMoveBall é¢œè‰²è·Ÿä¸»çƒåŒæ­¥
    tryMoveBall.teamColor = balls[0].teamColor;
    if (tryMoveBall.roleId !== Role.KUILEI.id) return;
    // è°ƒæ•´åŠå¾„
    switch (num) {
        case 0: // è¿˜åŸ
            tryMoveBall.radius = balls[0].radiusTmp;
            balls[0].radius = balls[0].radiusTmp;
            break;
        case 1: // è°ƒæ•´åŠå¾„
            tryMoveBall.radius = balls[0].tryRadius; // ç„å‡†åœˆåŠå¾„
            balls[0].radius = balls[0].tryRadius;
            break;
        default:

    }
}


// é‡ç½®tryMoveBall
function resetTryMoveBall() {
    if (!balls || balls.length < 1) return;
    if (!tryMoveBall) return;
    tryMoveBall.teamColor = balls[0].teamColor;
    tryMoveBall.v = balls[0].v;
    tryMoveBall.vx = 0;
    tryMoveBall.vy = 0;
    tryMoveBall.isMoving = false;
    tryMoveBall.isChgPosFinished = false;
}


// å°è¯•ç§»åŠ¨ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªç¢°æ’åæ ‡ï¼Œç”¨äºæ§åˆ¶è¿åŠ¨è½¨è¿¹æ˜¾ç¤º
let isFirstCollidedPointFounded = false;
function doTryMoveBallFirstCollidedPos() {
    if (!tryMoveBall || !selectedBall.isChgPosFinished) return;
    //console.log(">>>> doTryMoveBallFirstCollidedPos...");
    // æ¨¡æ‹Ÿå°çƒè¿åŠ¨
    // TODO å¯èƒ½å¾ªç¯å‡ æ¬¡åˆ°å››äº”åæ¬¡ï¼Œæ‰èƒ½æ‰¾åˆ°ï¼Œéå¸¸è€—æ€§èƒ½ï¼å¬åˆ°CPUé£æ‰‡åŠ é€Ÿå£°å“äº†ï¼ï¼ã€éœ€è¦ä¼˜åŒ–ã€‘
    let count = 0; // è›®ç‹ææ…¢ï¼Œå¾ªç¯äº† 36 æ¬¡å·¦å³
    //while (!tryMoveBall.isCollided) {
    while (!isTryMoveBallRecordFinished()) {
        try {
            checkWalls(tryMoveBall, true); // å¢™é¢ç¢°æ’æ£€æµ‹
            checkLines(tryMoveBall, true); // åˆ‡é¢ç¢°æ’æ£€æµ‹
            checkOtherBalls(tryMoveBall, true); // çƒç¢°æ’æ£€æµ‹
            if (isDuoduoExist) checkEggs(tryMoveBall, true); // è›‹ç¢°æ’æ£€æµ‹
            checkFriction(tryMoveBall); // æ‘©æ“¦åŠ›ä½œç”¨
            doAfterCollidCheck(); // æ£€æµ‹å®Œæˆåå¤„ç†ä¸šåŠ¡
        } catch (e) {
            doGlobalError(e, (sysConfig && sysConfig.alertErrorCount) ? sysConfig.alertErrorCount : 3);
        }

        // è¾¾åˆ°æ¬¡æ•°åï¼Œå°±ç®—æ²¡æ‰¾åˆ°ï¼Œä¹Ÿé€€å‡ºï¼Œé¿å…æ­»å¾ªç¯
        count++;
        if (count >= 100) break;
    }
    console.log(">>>> doTryMoveBallFirstCollidedPos count=" + count);
    console.log(">>>> æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ’å‡»ç‚¹åæ ‡ï¼šx=" + tryMoveBallFirstCollidedPos.x + ", y=" + tryMoveBallFirstCollidedPos.y);
    isFirstCollidedPointFounded = true;
    // é‡ç½®æ ‡å¿—
    if (tryMoveBall.isCollided) tryMoveBall.isCollided = false;
    // é‡ç½®é€Ÿåº¦
    doTryMoveBallFinished();
}


// é‡å ç¢°æ’æ—¶ï¼Œè°ƒæ•´æœ‰é€Ÿåº¦å°çƒçš„åæ ‡ä½ç½®ï¼Œåªé€‚ç”¨æœ‰ä¸€ä¸ªå°çƒæœ‰é€Ÿåº¦çš„æƒ…å†µï¼Œä¸¤çƒéƒ½æœ‰é€Ÿåº¦åœ¨æ ¸å¿ƒç¢°æ’æ–¹æ³•è°ƒæ•´
function adjustMovingBallPos(ball0, ball1, isCheck) {
    // è®¡ç®—å®é™…ç¢°æ’ç‚¹åæ ‡
    const pos = getPreOrNextFrameCollidedPos(ball0, ball1, 0);
    if (!pos) return;
    // å°†è¿åŠ¨å°çƒåæ ‡è°ƒæ•´ä¸ºå®é™…ç¢°æ’ç‚¹åæ ‡
    const targetBall = getMovingBall(ball0, ball1);
    if (!targetBall) return;
    targetBall.x = pos.x;
    targetBall.y = pos.y;
}


// è·å–ä¸¤ä¸ªå°çƒä¹‹é—´æœ‰é€Ÿåº¦çš„å°çƒ
// null-ä¸¤çƒéƒ½æ²¡æœ‰é€Ÿåº¦ï¼›0-ä¸¤çƒéƒ½æœ‰é€Ÿåº¦ï¼›targetBall-æœ‰é€Ÿåº¦çš„å°çƒ
function getMovingBall(ball0, ball1) {
    if (!ball0 || !ball1) return null;
    if (ball0.vx + ball0.vy + ball1.vx + ball1.vy === 0) return null; // éƒ½æ²¡æœ‰é€Ÿåº¦ä¸æ£€æµ‹
    if (ball0.vx + ball0.vy !== 0 && ball1.vx + ball1.vy !== 0) return 0; // éƒ½æœ‰é€Ÿåº¦ä¹Ÿä¸æ£€æµ‹
    let targetBall = ball0; // targetBall å¼•ç”¨åœ°å€æŒ‡å‘ ball0
    if (ball1.vx + ball1.vy !== 0) targetBall = ball1; // åªå¤„ç†æœ‰é€Ÿåº¦çš„
    return targetBall;
}


// è·å–å½“å‰å¸§ç¢°æ’ç‚¹åæ ‡
function getCurrFrameCollidedPos(ball0, ball1) {
    const targetBall = getMovingBall(ball0, ball1);
    if (!targetBall) return null;
    return calculateCircleCollision(targetBall, targetBall.no === ball0.no ? ball1 : ball0);
}


// è·å–ä¸Šä¸€å¸§æˆ–ä¸‹ä¸€å¸§ç¢°æ’ç‚¹åæ ‡
function getPreOrNextFrameCollidedPos(ball0, ball1, idx) {
    const targetBall = getMovingBall(ball0, ball1);
    if (!targetBall) return null;
    switch (idx) {
        case 0:
            const preBall = getPreOrNextFramePos(targetBall, 0);
            if (!preBall) return null;
            return calculateCircleCollision(preBall, targetBall.no === ball0.no ? ball1 : ball0);
        case 1:
            const nextBall = getPreOrNextFramePos(targetBall, 1);
            if (!nextBall) return null;
            return calculateCircleCollision(nextBall, targetBall.no === ball0.no ? ball1 : ball0);
        default:
            return null;
    }
}


// è·å–ä¸Šä¸€å¸§æˆ–ä¸‹ä¸€å¸§ä½ç½®åæ ‡ä¿¡æ¯
function getPreOrNextFramePos(targetBall, idx) {
    if (!targetBall) return null;
    switch (idx) {
        case 0:
            return doGetPreFramePos(targetBall);
        case 1:
            return doGetNextFramePos(targetBall);
        default:
            return null;
    }
}


function doGetPreFramePos(ball) {
    if (!ball) return null;
    if (ball.vx * ball.vy === 0) return null;
    let vRatio = 1.2;
    let preBall = {
        x: ball.x - ball.vx * vRatio,
        y: ball.y - ball.vy * vRatio,
        vx: ball.vx * vRatio, // æ³¨æ„ï¼Œè¿™ä¸ªé€Ÿåº¦ä¸æ˜¯å®é™…ä¸Šä¸€å¸§çš„ï¼Œå·²ç»å‡å»äº†æ‘©æ“¦åŠ›ï¼Œä¹˜ä»¥ 1.2 å¤§è‡´è¿˜åŸä¸Šä¸€å¸§çš„é€Ÿåº¦
        vy: ball.vy * vRatio,
        radius: ball.radius
    };
    return preBall;
}


function doGetNextFramePos(ball) {
    if (!ball) return null;
    if (ball.vx * ball.vy === 0) return null;
    let tmpBall = {
        v: ball.v,
        vx: ball.vx,
        vy: ball.vy,
    };
    // å¤„ç†æ‘©æ“¦åŠ›
    checkFriction(tmpBall);
    let nextBall = {
        x: ball.x + tmpBall.vx,
        y: ball.y + tmpBall.vy,
        vx: tmpBall.vx,
        vy: tmpBall.vy,
        radius: ball.radius
    };
    return nextBall;
}


// ä¸¤çƒç¢°æ’åï¼Œä¸»çƒä½ç½®åé€€åˆ°ç¢°æ’è¾¹ç•Œ
function doBackToBorderBallsCollided(ball0, ball1, isCheck) {
    if (!ball0 || !ball1) return;
    if (!ball0.vx && !ball0.vy) return;
    if (!isCheck) return;
    let count = 0; // å¾ªç¯è®¡æ•°ï¼Œé¿å…æ­»å¾ªç¯
    let bvx = 0, bvy = 0, bpx = 1, bvxyp = Math.abs(roundNumber(ball0.vx / ball0.vy)); // åé€€çš„é€Ÿåº¦æ–¹å‘å’Œå¤§å° å¯èƒ½ä¼šæœ‰é™¤0å¼‚å¸¸ï¼Œä½†ä¸º0çš„æƒ…å†µåç»­æ²¡ç”¨åˆ°ï¼Œæ²¡å½±å“
    //if (!isNumber(bvxyp)) alert(bvxyp); // Infinity
    while (is2CirclesCollided(ball0, ball1)) {
        // æŠŠé€Ÿåº¦å¤§çš„è®¾ç½®ä¸º bpx
        if (Math.abs(ball0.vx) >= Math.abs(ball0.vy)) {
            // æ¯æ¬¡åé€€æ¯”ä¾‹
            if (ball0.vx > 0) bvx = bpx;
            if (ball0.vx < 0) bvx = -bpx;
            if (ball0.vy > 0) bvy = roundNumber(bpx / bvxyp, 4);
            if (ball0.vy < 0) bvy = -roundNumber(bpx / bvxyp, 4);
        } else {
            if (ball0.vx > 0) bvx = roundNumber(bpx * bvxyp, 4);
            if (ball0.vx < 0) bvx = -roundNumber(bpx * bvxyp, 4);
            if (ball0.vy > 0) bvy = bpx;
            if (ball0.vy < 0) bvy = -bpx;
        }
        // åå‘ç§»åŠ¨
        ball0.x -= bvx;
        ball0.y -= bvy;

        // å‡å®šè§’è‰²æœ€å¤§ 3 æ ¼ï¼Œæ¯æ ¼æœ€å¤§ 70 åƒç´ ï¼Œcount æœ€å¤§ 200 å·¦å³
        count++;
        if (count >= 200) break;
    }
    console.log(">>>> doBackToBorderBallsCollided count=" + count);

    // å–ä¸Šä¸€æ¬¡ç¢°æ’åæ ‡ï¼Œå› ä¸º while ç»“æŸä¹‹åï¼Œæ˜¯ä¸¤çƒæ²¡æœ‰ç¢°æ’æ—¶çš„åæ ‡ï¼Œéœ€è¦åŠ ä¸€ç‚¹ç‚¹
    if (bvx || bvy) {
        ball0.x += bvx;
        ball0.y += bvy;
    }
}


// å°è¯•è¿åŠ¨å°çƒç¢°æ’çš„è®°å½•æ˜¯å¦å®Œæˆ
function isTryMoveBallRecordFinished() {
    // åƒµå°¸ã€å‚€å„¡ç­‰ç©¿é€è§’è‰²ï¼Œå– userConfig.tryFullPathPointNum é…ç½®å€¼
    if (isRoleCanPierces()) {
        if (userConfig.currRole === Role.KUILEI.id && tryMoveBallCollidedPoints.length >= 3) return true;
        //if (userConfig.currRole === Role.JIANGJIANG.id && tryMoveBallCollidedPoints.length >= userConfig.tryFullPathPointNum + 1) return true;
        if (tryMoveBallCollidedPoints.length >= userConfig.tryFullPathPointNum) return true;
    } else { // å…¶ä»–è§’è‰²åªå–ç¬¬ä¸€ä¸ªç¢°æ’ç‚¹
        if (tryMoveBallFirstCollidedPos.x > 0 && tryMoveBallFirstCollidedPos.y > 0) return true;
    }
    return false;
}


// å°è¯•è¿åŠ¨å°çƒä»»åŠ¡å®Œæˆå¤„ç†äº‹é¡¹
function doTryMoveBallFinished() {
    if (!tryMoveBall) return;
    tryMoveBall.vx = 0;
    tryMoveBall.vy = 0;
}


// è®¡ç®—åœ†ç¢°æ’/è·å–ä¸¤å°çƒç¢°æ’ç‚¹åæ ‡
function calculateCircleCollision(ball0, ball1) {
    const movingCircle = {
        x: roundNumber(ball0.x, 4),
        y: roundNumber(ball0.y, 4),
        radius: roundNumber(ball0.radius, 4) // æ³¨æ„ï¼æœ‰çš„è§’è‰²ç„å‡†åŠå¾„å’Œæœ¬ä½“åŠå¾„ä¸ä¸€æ ·ï¼Œå‚€å„¡ã€æ¸¸ä¾ ã€èŠ±åƒæœºç­‰
    };

    const staticCircle = {
        x: roundNumber(ball1.x, 4),
        y: roundNumber(ball1.y, 4),
        radius: roundNumber(ball1.radius, 4)
    };

    const velocity = {
        x: roundNumber(ball0.vx, 4),
        y: roundNumber(ball0.vy, 4),
    };

    // è®¡ç®—åœ†å¿ƒä¹‹é—´çš„è·ç¦»å‘é‡
    const dx = staticCircle.x - movingCircle.x;
    const dy = staticCircle.y - movingCircle.y;
    const distance = Math.sqrt(dx * dx + dy * dy);

    // å¦‚æœåœ†å¿ƒè·ç¦»å·²ç»å°äºä¸¤åœ†åŠå¾„ä¹‹å’Œï¼Œè¯´æ˜å·²ç»ç¢°æ’
    if (distance <= staticCircle.radius + movingCircle.radius) {
        // å¯ä»¥å°è¯•å›é€€åˆ°åˆšå¥½ç¢°æ’ç‚¹ä½ç½®
        return null;
    }

    // è®¡ç®—é€Ÿåº¦å‘é‡é•¿åº¦
    const speed = Math.sqrt(velocity.x * velocity.x + velocity.y * velocity.y);

    // å¦‚æœé€Ÿåº¦ä¸º0ï¼Œåˆ™ä¸ä¼šå‘ç”Ÿç¢°æ’
    if (speed === 0) {
        return null;
    }

    // è®¡ç®—é€Ÿåº¦å‘é‡çš„å•ä½å‘é‡
    const unitVelocity = {
        x: velocity.x / speed,
        y: velocity.y / speed
    };

    // è®¡ç®—åœ†å¿ƒè¿çº¿åœ¨é€Ÿåº¦æ–¹å‘ä¸Šçš„æŠ•å½±é•¿åº¦
    const projection = dx * unitVelocity.x + dy * unitVelocity.y;

    // å¦‚æœæŠ•å½±ä¸ºè´Ÿï¼Œç§»åŠ¨åœ†æ­£åœ¨è¿œç¦»é™æ­¢åœ†ï¼Œä¸ä¼šå‘ç”Ÿç¢°æ’
    if (projection < 0) {
        return null;
    }

    // è®¡ç®—åœ†å¿ƒè¿çº¿çš„å‚ç›´åˆ†é‡é•¿åº¦
    const perpendicular = Math.sqrt(distance * distance - projection * projection);

    // å¦‚æœå‚ç›´è·ç¦»å¤§äºä¸¤åœ†åŠå¾„ä¹‹å’Œï¼Œåˆ™ä¸ä¼šå‘ç”Ÿç¢°æ’
    if (perpendicular > staticCircle.radius + movingCircle.radius) {
        //collisionResult.textContent = "ç§»åŠ¨åœ†ä¸ä¼šä¸é™æ­¢åœ†ç¢°æ’ï¼Œå®ƒä»¬ä¼šé”™è¿‡å½¼æ­¤ã€‚";
        //collisionPoint.textContent = `å‚ç›´è·ç¦»: ${perpendicular.toFixed(2)}ï¼Œæœ€å°è·ç¦»: ${staticCircle.radius + movingCircle.radius}`;
        return null;
    }

    // è®¡ç®—ç¢°æ’ç‚¹æ²¿é€Ÿåº¦æ–¹å‘çš„è·ç¦»
    const approach = projection - Math.sqrt(Math.pow(staticCircle.radius + movingCircle.radius, 2) - perpendicular * perpendicular);

    // å¦‚æœapproachä¸ºè´Ÿï¼Œè¡¨ç¤ºç§»åŠ¨åœ†å·²ç»è¶Šè¿‡äº†ç¢°æ’ç‚¹
    if (approach < 0) {
        return null;
    }

    // è®¡ç®—ç¢°æ’ç‚¹çš„åæ ‡
    const collisionX = roundNumber(movingCircle.x + unitVelocity.x * approach, 4);
    const collisionY = roundNumber(movingCircle.y + unitVelocity.y * approach, 4);

    // è¿”å›ç¢°æ’ç‚¹åæ ‡
    return { x: collisionX, y: collisionY };

    /*
    // è®¡ç®—ç¢°æ’æ—¶é—´
    const timeToCollision = approach / speed;
    
    // è®¡ç®—ç¢°æ’æ—¶ç§»åŠ¨åœ†çš„ä½ç½®
    const movingCircleAtCollision = {
        x: movingCircle.x + velocity.x * timeToCollision,
        y: movingCircle.y + velocity.y * timeToCollision
    };
    */

    // æ˜¾ç¤ºç»“æœ
    //collisionResult.textContent = `å°†ä¼šå‘ç”Ÿç¢°æ’ï¼ç¢°æ’æ—¶é—´: ${timeToCollision.toFixed(2)} å•ä½æ—¶é—´å`;
    //collisionPoint.textContent = `ç¢°æ’ç‚¹åæ ‡: (${collisionX.toFixed(2)}, ${collisionY.toFixed(2)})ï¼Œç§»åŠ¨åœ†åœ†å¿ƒä½ç½®: (${movingCircleAtCollision.x.toFixed(2)}, ${movingCircleAtCollision.y.toFixed(2)})`;
}


// è®°å½•ç¢°æ’ç‚¹åæ ‡
function recordCollidedPoint(ball) {
    //console.log(">>>> recordCollidedPoint ball: " + JSON.stringify(ball));
    if (!tryMoveBallCollidedPoints) tryMoveBallCollidedPoints = [];
    // ä¸èƒ½ç©¿é€çš„è§’è‰²ï¼Œåªè®°å½•ç¬¬ä¸€ä¸ªæ’å‡»ç‚¹åæ ‡
    if (!isRoleCanPierces() && tryMoveBallCollidedPoints.length > 0) tryMoveBallCollidedPoints = [];
    if (tryMoveBallCollidedPoints.length === 0) {
        tryMoveBallFirstCollidedPos.x = ball.x;
        tryMoveBallFirstCollidedPos.y = ball.y;
        tryMoveBallCollidedPoints[0] = tryMoveBallFirstCollidedPos;
        // å¤‡ä»½ç¬¬ä¸€æ¬¡ç¢°æ’ç‚¹åæ ‡
        tryMoveBallFirstCollidedPosBack.x = tryMoveBallFirstCollidedPos.x;
        tryMoveBallFirstCollidedPosBack.y = tryMoveBallFirstCollidedPos.y;
    } else {
        tryMoveBallCollidedPoints.push({ x: ball.x, y: ball.y });
    }
    console.log(">>>> recordCollidedPoint è®°å½•æ’å‡»ç‚¹[" + tryMoveBallCollidedPoints.length + "]åæ ‡ï¼šx=" + ball.x + ", y=" + ball.y);
    return true;
}


// ä¸»è§’è‰²è¿åŠ¨å®Œæˆåï¼Œè¦å¤„ç†çš„äº‹æƒ…
// function doAfterBallStopped(balls) {}
function doAfterBallStopped(balls) {
    if (!balls || balls.length < 1) return;
    for (let i = 0, len = balls.length; i < len; i++) {
        console.log('>>>> doAfterBallStopped ' + balls[i].getBallDesc());
        // å‚€å„¡æ‰“å®Œå
        if (userConfig.currRole === Role.KUILEI.id && balls[i].roleId === Role.KUILEI.id && balls[i].isMainBall)
            doKuilei(balls[i]);
    }

    // åŒå­æ‰“å®Œå
    if (userConfig.currRole === Role.SHUANGZI.id) afterTwins(selectedBall ? false : true);

    // çŒ´å­æœ¬ä½“æ‰“å®Œå
    if (userConfig.currRole === Role.WUKONG.id) afterMonkeys();

    // é‡ç½®è§’è‰²å­—æ®µå±æ€§å€¼ï¼Œä¸»è¦æ˜¯ç¢°æ’æ¬¡æ•°æ¸…é›¶
    resetRoleField();

    // è¿åŠ¨ç»“æŸï¼Œé®ç½©å±‚è°ƒåˆ°æœ€ä¸‹ï¼Œé¿å…æŒ¡ä½æ‹–åŠ¨ ã€æ”¾æœ€åã€‘
    changeCanvasIndex(gameMaskCanvas, -2);

    // é‡ç½®è¶…æ—¶è®¡æ—¶å™¨
    autoStopTimer && clearTimeout(autoStopTimer);
    //console.log(">>>> autoStopTimer:", autoStopTimer);
    autoStopTimer = null;
}


// è°ƒæ•´æŒ‡å®šå›¾å±‚z-index
function changeCanvasIndex(target, idx) {
    target.style.zIndex = idx;
}


// TODO å¼€æ‰“åï¼Œè¶…æ—¶è‡ªåŠ¨åœæ­¢ï¼Œé˜²æ­¢ç¨‹åºå¼‚å¸¸ï¼Œå¯¼è‡´é«˜è€—ç”µï¼
// åœ¨ doAfterBallStoppedã€resetBallsSpeed ç­‰æ¸¸æˆç»“æŸçš„åœ°æ–¹ï¼Œä¹Ÿè¦æ¸…ç†é‡ç½®å®šæ—¶å™¨
var autoStopTimer;
function autoStopTimeout(sec) {
    let sTime = new Date().getTime();
    autoStopTimer && clearTimeout(autoStopTimer);
    if (!sec) sec = userConfig.animateAutoRestTime;
    if (!sec) sec = 20;
    autoStopTimer = setTimeout(() => {
        resetBallsSpeed(balls);
        let eTime = new Date().getTime();
        let runTime = Math.round((eTime - sTime) / 1000);
        console.log('>>>> autoStopTimeout: ' + runTime);
        alert('ğŸ‘‰ æœ¬å›åˆè¿è¡Œäº† ' + runTime + ' ç§’ï¼Œå·²è¶…æ—¶è‡ªåŠ¨ç»“æŸã€‚');
    }, sec * 1000);
}


// å¤„ç†å‚€å„¡æ‰“å®Œåä¸šåŠ¡é€»è¾‘
function doKuilei(ball) {
    if (!ball || userConfig.currRole !== Role.KUILEI.id || !ball.isMainBall || ball.roleId !== Role.KUILEI.id || ball.wallCollidedCount < 2) return;
    if (isKuileiPulling) { // å‚€å„¡æ‹‰å›ä¹‹å‰å·²ç»è¿˜åŸè¿‡ä¸€æ¬¡äº†ï¼Œæ‹‰å›æ‰“å®Œç›´æ¥é‡ç½®çŠ¶æ€è¿”å›å°±è¡Œ
        // é‡ç½®æ‹‰å›çŠ¶æ€
        isKuileiPulling = false;
        return;
    }
    // è¿˜åŸ tryMoveBall
    preTryMoveBall(0);
    // åæ ‡å›åˆ°èµ·ç‚¹
    setBallPosToBeginPoint(ball);
    //globalParams.composite = "source-over";
    //ball.drawIcon(globalParams);
    //ball.drawRoleBloodLine(globalParams);
    //ball.drawCurrentCircle();
}


// å¤„ç†å‚€å„¡æ‰“å®Œåæ‹‰å›ä¸šåŠ¡é€»è¾‘
function doKuileiPullBack(ball) {
    if (!ball || userConfig.currRole !== Role.KUILEI.id || !ball.isMainBall
        || ball.roleId !== Role.KUILEI.id || ball.wallCollidedCount < 2
        || !userConfig.isKuileiPullBack || isKuileiPulling
        || ball.roleCollidedCount < 1) return;
    // æ¸…ç©ºè·¯å¾„å±‚ç”»å¸ƒ è¿™é‡Œä¼šå¯¼è‡´å‚€å„¡ä¸»çƒç”»é¢é—ªåŠ¨ä¸€ä¸‹ï¼Œå› ä¸ºä¸»çƒåŸå§‹ä½ç½®ç”»åœ¨è·¯å¾„å±‚
    // å…ˆåœ¨ä¸»çƒå±‚ç”»ä¸€æ¬¡å½“å‰ä½ç½®
    ball.draw();
    doClearPathCanvas();
    // å‚€å„¡å…ˆåœæ­¢è¿åŠ¨
    ball.vx = 0;
    ball.vy = 0;
    // å‚€å„¡ç»³å­å¤ä½
    doKuilei(ball);
    // è®¾ç½®è§’è‰²æ‹‰å›é€Ÿåº¦
    getPullBackSpeed();
    // é‡ç½®è§’è‰²å­—æ®µå±æ€§å€¼
    //resetRoleField();
    // é‡ç½®å„ä¸ªå°çƒçš„ç¢°æ’æ ‡å¿—ä½
    //setBallCollidingNos();
    // è®¾ç½®å‚€å„¡æ‹‰å›æ ‡å¿—
    isKuileiPulling = true;
}


// è®¾ç½®å°çƒä½ç½®åˆ°åŸå§‹èµ·ç‚¹
function setBallPosToBeginPoint(ball) {
    ball.x = ball.x0;
    ball.y = ball.y0;
    // TODO æ‰‹åŠ¨äº§ç”Ÿä¸€ä¸ªå¾ˆå°çš„å˜åŠ¨(è¦ç¡®ä¿roundNumberèƒ½æ”¹å˜æ•°å€¼)ï¼Œåæ ‡ä¸€æ ·ä¼šå¯¼è‡´ä¸»çƒè·¯å¾„åœ¨æ‹‰å›æ—¶æ¸…ç†ä¸æ‰
    ball.x0 -= 0.0005;
}


// æ ¹æ®é¼ æ ‡ä¸å°çƒè¿çº¿è§’åº¦ï¼Œè·å–vxã€vy
function getVxVy(p1, p2, v, ball) {
    if (!ball) return { vx: 0, vy: 0 };
    let targetBall = ball;
    //if (!targetBall) targetBall = balls[0];
    // è·å–ä¸¤ç‚¹è¿çº¿ä¸Xè½´çš„å¤¹è§’ 1-è¿‘ç‚¹ï¼›2-è¿œç‚¹
    let angle = getAngleX({
        x: p1 ? p1.x : targetBall.x,
        y: p1 ? p1.y : targetBall.y
    }, {
        x: p2 ? p2.x : mouse.x,
        y: p2 ? p2.y : mouse.y
    });
    //console.log('>>>> angleX=' + angle);
    // ä¸»è§’Aã€æ’å‡»ç‚¹Bã€è§¦æ‘¸ç‚¹Cï¼Œè®¡ç®—ABã€ACçš„å¤¹è§’
    let angleV = getAngleV(targetBall, tryMoveBallFirstCollidedPosBack, mouse);
    // ç‚¹æŒ‰æ“ä½œæ¨¡å¼
    //clickOffset.x = 0; clickOffset.y = 0;
    if (userConfig.currPlayOpt === 1 && (!isDragging || angleV < 135))
        angle = getAngleX({
            x: p1 ? p1.x : (mouse.x - clickOffset.x),
            y: p1 ? p1.y : (mouse.y - clickOffset.y)
        }, {
            x: p2 ? p2.x : targetBall.x,
            y: p2 ? p2.y : targetBall.y
        });
    //console.log('>>>> angle=' + angle);

    // å·²çŸ¥è§’åº¦ã€é€Ÿåº¦vï¼Œæ±‚ vx vy
    let radians = angle * Math.PI / 180;
    let vx = Math.cos(radians) * (v ? v : targetBall.v);
    let vy = Math.sin(radians) * (v ? v : targetBall.v);
    //console.log('>>>> vx=' + vx + '; vy=' + vy);

    // TODO è¿åŠ¨æ–¹å‘å–åï¼Œæ¨¡æ‹Ÿç©å§æ’å‡»ç‹è€…
    if (ball) {
        ball.vx = -vx;
        ball.vy = -vy;
    }

    vx = roundNumber(vx, 4);
    vy = roundNumber(vy, 4);

    return { vx: -vx, vy: -vy };
}


// æ˜¾ç¤ºè½¨è¿¹æç¤º
function showMovePath() {
    if (!selectedBall || !tryMoveBallCollidedPoints || tryMoveBallCollidedPoints.length < 1) return;
    let collidedPoint, p1, p2;
    for (let i = 0, len = tryMoveBallCollidedPoints.length; i < len; i++) {
        collidedPoint = tryMoveBallCollidedPoints[i];
        if (!collidedPoint) continue;
        if (collidedPoint.x <= 0 || collidedPoint.y <= 0) continue;
        // ç¬¬ä¸€ä¸ªç¢°æ’ç‚¹
        if (i === 0) p1 = { x: selectedBall.x, y: selectedBall.y }; // çƒä½ç½®
        else p1 = { x: tryMoveBallCollidedPoints[i - 1].x, y: tryMoveBallCollidedPoints[i - 1].y };
        p2 = { x: tryMoveBallCollidedPoints[i].x, y: tryMoveBallCollidedPoints[i].y }; // ç¢°æ’ç‚¹åæ ‡
        drawLine2Point(p1, p2);
    }
}


// ç»˜åˆ¶ç„å‡†è·¯å¾„ã€ç„å‡†åœˆï¼Œå°çƒä¸­å¿ƒç‚¹ä¸ç¢°æ’ç‚¹è¿çº¿
// è·å–äº†ç¬¬ä¸€ä¸ªç¢°æ’ç‚¹ï¼Œå°±ä¸ç”¨åå‘ï¼Œç›´æ¥è¿æ¥çƒä½ç½®ä¸ç¬¬ä¸€ä¸ªæ’å‡»ç‚¹ä½ç½®å³å¯
function drawLine2Point(p1, p2) {
    if (!selectedBall || !selectedBall.isMainBall) return; // éä¸»çƒä¸ç”»
    let context = selectedBall.context;
    context.save();
    context.beginPath();
    context.globalCompositeOperation = "destination-over";
    context.moveTo(p1.x, p1.y); // èµ·å§‹ä½ç½®
    context.lineTo(p2.x, p2.y); // ç»“æŸä½ç½®
    context.strokeStyle = currTheme.rlColor;
    context.lineWidth = selectedBall.radius * 2;
    if (selectedBall.isMainBall && selectedBall.roleId === Role.KUILEI.id) context.lineWidth = selectedBall.tryRadius * 2;
    context.lineCap = "round"; // åœ†è§’
    //context.closePath(); // é—­åˆè·¯å¾„åæ˜¯çŸ©å½¢
    context.stroke();
    context.restore();
    // ç„å‡†ç¢°æ’ç‚¹ç”»è™šçº¿åœˆ
    context.save();
    context.beginPath();
    context.arc(p2.x, p2.y, selectedBall.tryRadius, Math.PI / 180 * 0, Math.PI / 180 * 360);
    context.lineWidth = currTheme.ccWidth;
    let tcColor = Theme.getColorCodeNormal(currTheme.plColor) + "A0";
    context.strokeStyle = Theme.isColorCode(tcColor) ? tcColor : "#F9FBF5A0";
    context.setLineDash([Math.round(6 * dpr * sysConfig.pxRatio), Math.round(3 * dpr * sysConfig.pxRatio)]);
    if (selectedBall.isMainBall && selectedBall.roleId === Role.KUILEI.id) context.setLineDash([Math.round(2 * dpr * sysConfig.pxRatio), Math.round(2 * dpr * sysConfig.pxRatio)]);
    context.closePath();
    context.stroke(); // ç©ºå¿ƒ
    context.restore();
    // èµ·ç‚¹è¢«ç›´çº¿è¦†ç›–äº†ï¼Œé‡ç”»ä¸€æ¬¡
    //selectedBall.draw();
}


// è·å–ä¸¤ç‚¹è¿çº¿ä¸Xè½´çš„å¤¹è§’ 1-è¿‘ç‚¹ï¼›2-è¿œç‚¹
const getAngleX = ({ x: x1, y: y1 }, { x: x2, y: y2 }) => {
    let angle = Math.atan2(y2 - y1, x2 - x1) * 180 / (Math.PI);
    //angle = angle < 0 ? angle + 360 : angle;
    return angle;
}
// è·å–ä¸¤ç‚¹è¿çº¿ä¸Yè½´çš„å¤¹è§’ 1-è¿‘ç‚¹ï¼›2-è¿œç‚¹
const getAngleY = ({ x: x1, y: y1 }, { x: x2, y: y2 }) => {
    let angle = Math.atan2(x2 - x1, y2 - y1) * 180 / (Math.PI);
    angle = angle < 0 ? angle + 360 : angle;
    return angle;
}

// çº¿æ®µABã€ACç›¸äº¤äºAï¼Œæ±‚ä¸¤çº¿æ®µçš„å¤¹è§’
function getAngleV(A, B, C) {
    // è®¡ç®—å‘é‡ABå’ŒAC
    let AB = { x: B.x - A.x, y: B.y - A.y };
    let AC = { x: C.x - A.x, y: C.y - A.y };

    // è®¡ç®—å‘é‡çš„ç‚¹ç§¯
    let dotProduct = AB.x * AC.x + AB.y * AC.y;

    // è®¡ç®—å‘é‡çš„æ¨¡
    let magnitudeAB = Math.sqrt(AB.x * AB.x + AB.y * AB.y);
    let magnitudeAC = Math.sqrt(AC.x * AC.x + AC.y * AC.y);

    // è®¡ç®—å¤¹è§’çš„ä½™å¼¦å€¼
    let cosTheta = dotProduct / (magnitudeAB * magnitudeAC);

    // è®¡ç®—å¤¹è§’ï¼ˆå¼§åº¦ï¼‰
    let theta = Math.acos(cosTheta);

    // å°†å¼§åº¦è½¬æ¢ä¸ºè§’åº¦
    let angleInDegrees = theta * (180 / Math.PI);

    return angleInDegrees;
}

//////////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////////
// ã€ç‚¹å‡»ã€æ‹–åŠ¨ç›‘å¬äº‹ä»¶ã€‘ å˜é‡ã€æ–¹æ³•åŒºåŸŸ
//////////////////////////////////////////////////////////////////////
// é•¿æŒ‰å®šæ—¶å™¨
var longPressTimer = 0;
// é•¿æŒ‰åæ ‡
var longPressPoint = { x: 0, y: 0 };
// å°çƒæ‹–åŠ¨å‰çš„åæ ‡
var oldBallPos = { x: 0, y: 0 };
// ç‚¹æŒ‰æ¨¡å¼è§¦æ‘¸ç‚¹ä¸ä¸Šä¸€ä¸ªç¢°æ’ç‚¹çš„åç§»é‡
var clickOffset = { x: 0, y: 0 };
// é¼ æ ‡æŒ‰ä¸‹å¹¶æ‹–åŠ¨
var isMouseMoving = false;
// æ˜¯å¦æ­£åœ¨æ‹–åŠ¨
var isDragging = false;
// è®°å½•è§¦æ‘¸å¼€å§‹çš„æ—¶é—´å’Œä½ç½®
var touchStartTime = 0;
var touchStartX = 0;
var touchStartY = 0;
// ç§»åŠ¨ç«¯å¼€å§‹è§¦æ‘¸äº‹ä»¶
var currTouchPointNum = 0;


// äº‹ä»¶é¡ºåºï¼štouchstart-touchmove-touchend-mousedown-mouseup-click
// mousedownäº‹ä»¶è§¦å‘æ—¶ç»‘å®šmousemoveã€mouseupäº‹ä»¶ï¼Œmouseupäº‹ä»¶è§¦å‘æ—¶ï¼Œè§£é™¤mousemoveã€mouseupäº‹ä»¶
onMounted(() => {
    if (os.isPc) canvas.addEventListener('mousedown', (e) => {

        if (userConfig.currPlayOpt !== 1 && isMoving) return; // å¤„äºç§»åŠ¨æˆ–è¿åŠ¨çŠ¶æ€
        touchStartTime = Date.now(); // è®°å½•è§¦æ‘¸å¼€å§‹æ—¶é—´
        touchStartX = mouse.x; // è®°å½•è§¦æ‘¸å¼€å§‹ä½ç½®çš„ X åæ ‡
        touchStartY = mouse.y; // è®°å½•è§¦æ‘¸å¼€å§‹ä½ç½®çš„ Y åæ ‡
        //isDragging = true;
        // è®¡ç®—è§¦æ‘¸ç‚¹ä¸ç«¯ç‚¹ B çš„åç§»é‡
        if (tryMoveBallFirstCollidedPosBack.x <= 0 && tryMoveBallFirstCollidedPosBack.y <= 0) {
            clickOffset.x = 0;
            clickOffset.y = 0;
        } else {
            clickOffset.x = mouse.x - tryMoveBallFirstCollidedPosBack.x;
            clickOffset.y = mouse.y - tryMoveBallFirstCollidedPosBack.y;
        }

        doEventDefault(e); // å¤„ç†äº‹ä»¶é»˜è®¤è¡Œä¸º

        //balls.some(ball => {
        // æ·»åŠ äº‹ä»¶æ¥æ¨¡æ‹Ÿæ‹–æ‹½
        // æ³¨æ„ï¼Œç§»é™¤å’Œæ·»åŠ çš„å‡½æ•°åå¿…é¡»ä¸€æ¨¡ä¸€æ ·ï¼Œä¸èƒ½å¸¦å‚æ•°ï¼Œå¦åˆ™ä¸èƒ½æ­£å¸¸ç§»é™¤
        canvas.removeEventListener('mousemove', onMouseOrTouchMove, false);
        canvas.addEventListener('mousemove', onMouseOrTouchMove, false);
        canvas.removeEventListener('mouseup', onMouseUp, false);
        canvas.addEventListener('mouseup', onMouseUp, false);
        //return true;
        //});

        // é¼ æ ‡å·¦é”®æŒ‰ä¸‹ï¼Œè®¾ç½®é•¿æŒ‰å®šæ—¶å™¨
        longPressTimer && clearTimeout(longPressTimer);
        longPressTimer = setTimeout(() => { doLongPress(e) }, 500);

    }, false);


    if (!os.isPc) canvas.addEventListener('touchstart', (e) => {
        //isDragging = true;
        //const touch = e.touches[0]; // è·å–ç¬¬ä¸€ä¸ªè§¦æ‘¸ç‚¹
        getClickPos(e);
        touchStartTime = Date.now(); // è®°å½•è§¦æ‘¸å¼€å§‹æ—¶é—´
        touchStartX = mouse.x; // è®°å½•è§¦æ‘¸å¼€å§‹ä½ç½®çš„ X åæ ‡
        touchStartY = mouse.y; // è®°å½•è§¦æ‘¸å¼€å§‹ä½ç½®çš„ Y åæ ‡
        // è®¡ç®—è§¦æ‘¸ç‚¹ä¸ç«¯ç‚¹ B çš„åç§»é‡
        if (tryMoveBallFirstCollidedPosBack.x <= 0 && tryMoveBallFirstCollidedPosBack.y <= 0) {
            clickOffset.x = 0;
            clickOffset.y = 0;
        } else {
            clickOffset.x = mouse.x - tryMoveBallFirstCollidedPosBack.x;
            clickOffset.y = mouse.y - tryMoveBallFirstCollidedPosBack.y;
        }
        doEventDefault(e);
        currTouchPointNum = e.touches.length;
        // ç›®å‰åªæ”¯æŒå•ç‚¹è§¦ç¢°
        if (currTouchPointNum !== 1) return;
        // è§¦æ‘¸å¼€å§‹ï¼Œè®¾ç½®é•¿æŒ‰å®šæ—¶å™¨
        longPressPoint.x = mouse.x;
        longPressPoint.y = mouse.y;
        longPressTimer && clearTimeout(longPressTimer);
        longPressTimer = setTimeout(() => { doLongPress(e) }, 500);
    }, false);


    // ç –æ ¼åæ ‡ç”»å¸ƒå¼€å§‹è§¦æ‘¸äº‹ä»¶
    if (!os.isPc) gameSceneCoordinateCanvas.addEventListener('touchstart', (e) => {
        //console.log(e);
        doEventDefault(e);
        currTouchPointNum = e.touches.length;
        // ç›®å‰åªæ”¯æŒå•ç‚¹è§¦ç¢°
        if (currTouchPointNum !== 1) return;
        //getClickPos(e);

    }, false);
})


// æ‹–æ‹½ç§»åŠ¨ä¸šåŠ¡å¤„ç†
function onMouseMove(isPlay2) {

    // å¦‚æœæ˜¯å¯¼å…¥ï¼Œæ ‡è®°ç§»åŠ¨å®Œæˆ
    if (userConfig.shareRoleAndPos) {
        selectMainBall(); // é€‰ä¸­ä¸»çƒ
        selectedBall.isChgPosFinished = true; // æ ‡è®°ç§»åŠ¨å®Œæˆ
        setBallsPosBack(false); // è¿˜åŸåŸå§‹ä½ç½®åæ ‡
        clearShareRoleAndPos(); // æ¸…é™¤å¯¼å…¥æ•°æ®
    }

    if (!selectedBall) return;
    console.log(">>>> onMouseMove " + selectedBall.getBallDesc());

    // æ ‡è®°é¼ æ ‡æ­£åœ¨æ‹–åŠ¨
    isMouseMoving = true;
    // åŒå‡»ä¸ç®—æ‹–åŠ¨
    if (isPlay2) isMouseMoving = false;

    // æ ‡è®°æ¸¸æˆå¼€å§‹
    sysConfig.isGameBeginning = true;

    // æ‹–åŠ¨æ—¶æ¸…ç©ºäº†ç”»å¸ƒï¼Œéœ€è¦é‡æ–°æ¸²æŸ“ç•Œé¢
    isAnimated = false;
    if (!isPlaying) animate(); // åŠ¨ç”»æ¸²æŸ“åï¼ŒisAnimated æ ‡è¯†ä¸º true

    // æ¸…ç©ºè¿åŠ¨å±‚ç”»å¸ƒ
    //doClearMoveCanvas();
    // æ¸…ç©ºè·¯å¾„å±‚ç”»å¸ƒ
    doClearPathCanvas();

    // é‡ç½®ä¹‹å‰æ‰¾åˆ°çš„æ’å‡»ç‚¹åæ ‡ã€å¿…é¡»æ”¾è¿™ã€‘
    tryMoveBallFirstCollidedPos.x = 0;
    tryMoveBallFirstCollidedPos.y = 0;
    tryMoveBallCollidedPoints = [];

    // åŒå‡»é‡æ‰“è¿›æ¥çš„ï¼Œä¸å¤„ç†æ‹–åŠ¨
    //if (isPlay2 || !isMouseMoving) return;

    //console.log(">>>> onMouseMove isChgPosFinished=" + selectedBall.isChgPosFinished);
    if (!selectedBall.isChgPosFinished) { // è¿˜åœ¨æ‹–åŠ¨
        //console.log(">>>> onMouseMove mouse.x=" + mouse.x + ", mouse.y=" + mouse.y);
        if (!isPlay2) {
            selectedBall.x = mouse.x;
            selectedBall.y = mouse.y;
        }
        //selectedBall.x0 = mouse.x;
        //selectedBall.y0 = mouse.y;

        // åŒå­åˆ†èº«ä½ç½®å¤„ç†
        afterTwins(false);

        // å°çƒç¢°æ’æ£€æµ‹ï¼Œæ”¾æœ€å‰é¢ï¼Œé¿å…å°çƒä½ç½®è¶…å‡ºå¢™é¢è¾¹ç•Œ
        checkOtherBallCollided(selectedBall, true);
        // å››é¢å¢™æ£€æµ‹
        checkWallCollided(selectedBall, true);
        // å››ä¸ªåˆ‡é¢æ£€æµ‹
        checkLineCollided(selectedBall, true);
        // è›‹åˆ‡é¢ç¢°æ’æ£€æµ‹
        if (isDuoduoExist) checkEggCollided(selectedBall, true);

        //console.log(">>>> onMouseMove selectedBall.x=" + selectedBall.x + ", selectedBall.y=" + selectedBall.y);

        // åæ ‡æç¤ºè·Ÿéšæ˜¾ç¤º
        setRolePosLineFollowing(selectedBall, true);

        // çŸ­æ—¶é—´è¯¯ç¢°ï¼Œé‡æ–°æ¸²æŸ“
        isAnimated = false;
        if (!isPlaying) animate();
        // æ¸…ç©ºè·¯å¾„å±‚ç”»å¸ƒ
        doClearPathCanvas();

    } else { // æ‹–åŠ¨å®Œæˆï¼ŒåŠ¨æ€æ˜¾ç¤ºå°çƒè¿åŠ¨æ–¹å‘
        // åæ ‡æç¤ºè·Ÿéšå…³é—­
        setRolePosLineFollowing(selectedBall, false);

        // è·å–å°çƒåˆ†é€Ÿåº¦ vxã€vy
        if (isRoleCanPierces()) { // èƒ½ç©¿é€çš„è§’è‰²ï¼Œé€Ÿåº¦è®¾ç½®å¤§ä¸€äº›ï¼ŒåŠ å¿«æ‹¿åˆ°å‰5ä¸ªç¢°æ’ç‚¹ï¼Œå‡å°‘å»¶è¿Ÿ
            tryMoveBall.v = 200; // å†å¾€ä¸Šå¿«å¯èƒ½ä¼šå‡ºç°è·¯å¾„ä¸å‡†
            getVxVy(null, null, tryMoveBall.v, selectedBall);
        } else { // å…¶ä»–è§’è‰²
            getVxVy(null, null, null, selectedBall);
        }
        // æ›´æ–°ç§»åŠ¨çš„çƒ
        tryMoveBall.x = roundNumber(selectedBall.x, 4);
        tryMoveBall.y = roundNumber(selectedBall.y, 4);
        //tryMoveBall.x0 = tryMoveBall.x;
        //tryMoveBall.y0 = tryMoveBall.y;
        tryMoveBall.vx = roundNumber(selectedBall.vx, 4);
        tryMoveBall.vy = roundNumber(selectedBall.vy, 4);
        // å‡†å¤‡ tryMoveBall
        preTryMoveBall(1);
        // å°è¯•æ¨¡æ‹Ÿè¿åŠ¨æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ’å‡»ç‚¹
        doTryMoveBallFirstCollidedPos();
    }
}


// è§’è‰²åæ ‡æç¤ºè·Ÿéšè§’è‰²ç§»åŠ¨
let rolePosXEle, rolePosYEle, rolePosLineTimer;
function setRolePosLineFollowing(ball, isShow) {
    if (!userConfig.isShowRoleMovePos) return;
    //if (!ball) return;

    // æ¸…ç†å®šæ—¶å™¨
    rolePosLineTimer && clearTimeout(rolePosLineTimer);

    let girdCount = 2.5;
    if (userConfig.isShowRoleBloodLine) girdCount = 3.2;
    //rolePosLine.style.left = (screenPos.x - rolePosLine.getBoundingClientRect().width / 2).toFixed(2) + "px";
    //rolePosLine.style.top = (screenPos.y - sysConfig.girdSizeCss * girdCount).toFixed(2) + "px";
    rolePosLine.style.left = (ball.x / dpr + sysConfig.cLeft - rolePosLine.getBoundingClientRect().width / 2).toFixed(2) + "px";
    rolePosLine.style.top = (ball.y / dpr + sysConfig.cTop - sysConfig.girdSizeCss * girdCount).toFixed(2) + "px";

    if (!rolePosXEle) rolePosXEle = document.getElementById("rolePosX");
    if (!rolePosYEle) rolePosYEle = document.getElementById("rolePosY");
    let pos = { x: ball.x, y: ball.y };
    switchPxOrGird(pos, 0);
    //switchPxOrGird(pos, 1);
    rolePosXEle.innerText = pos.x.toFixed(2);
    rolePosYEle.innerText = pos.y.toFixed(2);

    if (isShow) rolePosLine.style.display = "unset";
    else rolePosLine.style.display = "none";
}


// åæ ‡æ¢ç®—
function switchPxOrGird(p, no) {
    switch (no) {
        case 1: // gird to px
            // x
            if (p.x >= 0) {
                p.x += 7;
            } else {
                p.x = 7 + p.x;
            }
            //y
            if (p.y >= 0) {
                p.y = 11 - p.y;
            } else {
                p.y = 11 - p.y;
            }

            p.x = roundNumber(p.x * sysConfig.girdSize, 2);
            p.y = roundNumber(p.y * sysConfig.girdSize, 2);
            break;
        default: // px to gird
            p.x = roundNumber((p.x / sysConfig.girdSize - 7), 2);
            p.y = roundNumber(((p.y / sysConfig.girdSize - 11) * -1), 2);
    }
}


function onMouseUp(e) {
    //console.log(e);
    isDragging = false;
    // PC ç«¯ç§»åŠ¨å®Œæˆåæ¨¡æ‹Ÿä¸€æ¬¡ç‚¹å‡»
    doClick(e);
    // é¼ æ ‡å·¦é”®æŠ¬èµ·ï¼Œé‡ç½®é•¿æŒ‰å®šæ—¶å™¨
    longPressTimer && clearTimeout(longPressTimer);
    longPressTimer = 0;
    // æ¸…é™¤äº‹ä»¶
    canvas.removeEventListener('mousemove', onMouseOrTouchMove, false);
    canvas.removeEventListener('mouseup', onMouseUp, false);
}


function onMouseOrTouchMove(e) {
    //console.log(e);
    isDragging = true;
    doEventDefault(e);
    // è§£å†³éƒ¨åˆ†æœºå‹ï¼Œæ‰‹æŒ‡æ²¡æœ‰moveï¼Œtouchmoveäº‹ä»¶ä»ä¼šè¢«è°ƒç”¨çš„é—®é¢˜
    // å¤ªç²¾ç¡®çš„å…¨ç­‰ä¼šå¯¼è‡´è§¦æ‘¸ç¨å¾®æŠ–åŠ¨ä¸€ä¸‹å°±ä¼šé‡ç½®å®šæ—¶å™¨ï¼Œå¯¼è‡´é•¿æŒ‰ä¸çµæ•
    //if (longPressPoint.x !== mouse.x || longPressPoint.y !== mouse.y) {
    // å…è®¸æ‰‹æŒ‡æœ‰åŠå¾„ä¸º10åƒç´ çš„èŒƒå›´æŠ–åŠ¨
    if (!is2CirclesCollided({ x: longPressPoint.x, y: longPressPoint.y, radius: 10 }, { x: mouse.x, y: mouse.y, radius: 10 })) {
        // æœ‰æ‹–åŠ¨è¡Œä¸ºï¼Œé‡ç½®é•¿æŒ‰å®šæ—¶å™¨
        longPressTimer && clearTimeout(longPressTimer);
        longPressTimer = 0;
    }
    selectBall();
    onMouseMove();
}


function onTouchEnd() {
    isDragging = false;
    // æ¸…é™¤äº‹ä»¶
    canvas.removeEventListener('touchmove', onMouseOrTouchMove, false);
    canvas.removeEventListener('touchend', onTouchEnd, false);
}

// é€‰ä¸­å°çƒ
function selectBall(pos) {
    if (selectedBall) return;
    balls.some(ball => {
        if (isBallSelected(ball, pos)) {
            selectedBall = ball;
            oldBallPos.x = ball.x;
            oldBallPos.y = ball.y;
            return true;
        }
    });
}


// ç§»åŠ¨ç«¯æ‹–åŠ¨äº‹ä»¶
// touchstart --> mousedown æ‰‹æŒ‡åœ¨å…ƒç´ æŒ‰ä¸‹
// touchmove --> mousemove æ‰‹æŒ‡åœ¨å…ƒç´ æŒ‰ä¸‹ä¹‹åï¼Œåœ¨å±å¹•ä¸­ç§»åŠ¨
// touchend --> mouseup æ‰‹æŒ‡åœ¨å…ƒç´ æŒ‰ä¸‹ä¹‹åï¼Œåœ¨å±å¹•ä¸­æŠ¬èµ·
onMounted(() => {
    if (!os.isPc) canvas.addEventListener('touchmove', (e) => {
        if (currTouchPointNum !== 1) return;
        onMouseOrTouchMove(e);
    }, false);
})


onMounted(() => {
    // å•å‡»å¼€å§‹å¾€æŒ‡å®šæ–¹å‘è¿åŠ¨
    // äº‹ä»¶é¡ºåº mousedownã€mouseupã€clickï¼Œå‰ä¸€ä¸ªäº‹ä»¶æ‰§è¡Œå®Œæ¯•æ‰ä¼šæ‰§è¡Œä¸‹ä¸€ä¸ªäº‹ä»¶
    if (os.isPc) canvas.addEventListener('click', (e) => {
        doEventDefault(e);
        getClickPos(e);
        const touchEndX = mouse.x; // è§¦æ‘¸ç»“æŸä½ç½®çš„ X åæ ‡
        const touchEndY = mouse.y; // è§¦æ‘¸ç»“æŸä½ç½®çš„ Y åæ ‡
        const touchEndTime = Date.now(); // è®°å½•è§¦æ‘¸ç»“æŸæ—¶é—´

        // è®¡ç®—è§¦æ‘¸ç§»åŠ¨çš„è·ç¦»
        const deltaX = touchEndX - touchStartX;
        const deltaY = touchEndY - touchStartY;
        const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);

        // è®¡ç®—è§¦æ‘¸æŒç»­æ—¶é—´
        const duration = touchEndTime - touchStartTime;

        // åˆ¤æ–­æ˜¯å¦ä¸ºå•å‡»äº‹ä»¶
        if (duration < 300 && distance < 10) { // 300ms å†…ä¸”ç§»åŠ¨è·ç¦»å°äº 10px
            //alert("PC Click"); // PC ç«¯ç§»åŠ¨ç»“æŸæ—¶ä¼šå‡ºå‘ç‚¹å‡»äº‹ä»¶
            doClick(e, true);
        }

    }, false);

    // åŒå‡»å…è®¸æ‹–åŠ¨å°çƒä½ç½®
    if (os.isPc) canvas.addEventListener('dblclick', (e) => {
        doEventDefault(e);
        doDbClick(e);

    }, false);

    // ç –æ ¼åæ ‡å±‚ç‚¹å‡»äº‹ä»¶ï¼Œç‚¹å‡»åæ ‡ï¼Œåˆ‡æ¢é•¿çŸ­æ˜¾ç¤º
    if (os.isPc) gameSceneCoordinateCanvas.addEventListener('click', (e) => {
        doEventDefault(e);
        // åˆ‡æ¢å®Œå…¨åæ ‡
        //getClickPos(e);
    }, false);

    // ç‚¹æŒ‰å‘å°„æŒ‰é’®ç‚¹å‡»ç›‘å¬
    if (os.isPc) gameClickPlayCanvas.addEventListener('click', (e) => {
        doEventDefault(e);
        // å‘å°„å¤„ç†
        doClickPlay(e);
    }, false);

    // ç –æ ¼åæ ‡åŒå‡»åˆ‡æ¢æ˜¾ç¤º
    if (os.isPc) gameSceneCoordinateCanvas.addEventListener('dblclick', (e) => {
        doEventDefault(e);
        // åˆ‡æ¢å®Œå…¨åæ ‡
        let p = getClickPos(e);
        if (isInGirdNumArea(p)) {
            userConfig.isShowGridCoordinateFull = !userConfig.isShowGridCoordinateFull;
            switchCanvasShow(gameSceneCoordinateCanvas, true);
            localStorage.setItem('collide-try-user-settings', JSON.stringify(userConfig));
        }
    }, false);

    // å•å‡»é®ç½©å±‚å…³é—­æœ€ä¸Šå±‚å¼¹çª—ç›‘å¬äº‹ä»¶
    if (os.isPc) dialogMask.addEventListener('click', (e) => {
        doEventDefault(e);
        doCloseTopDialog(e);
    }, false);
})


// ç§»åŠ¨ç«¯å•ã€åŒå‡»äº‹ä»¶
onMounted(() => {
    let lastTouchEnd = 0;
    if (!os.isPc) canvas.addEventListener('touchend', (e) => {
        //console.log(e);
        //alert(e.touches.length);
        isDragging = false;
        doEventDefault(e);
        //if (e.type !== "touchend" && e.touches.length !== 0) return;
        if (currTouchPointNum !== 1) return;
        // è§¦æ‘¸ç»“æŸï¼Œé‡ç½®é•¿æŒ‰å®šæ—¶å™¨
        longPressTimer && clearTimeout(longPressTimer);
        longPressTimer = 0;

        //const touch = e.changedTouches[0]; // è·å–ç¬¬ä¸€ä¸ªè§¦æ‘¸ç‚¹
        //const touchEndX = touch.clientX; // è§¦æ‘¸ç»“æŸä½ç½®çš„ X åæ ‡
        //const touchEndY = touch.clientY; // è§¦æ‘¸ç»“æŸä½ç½®çš„ Y åæ ‡
        //const touchEndTime = Date.now(); // è®°å½•è§¦æ‘¸ç»“æŸæ—¶é—´
        //getClickPos(e);
        const touchEndX = mouse.x; // è§¦æ‘¸ç»“æŸä½ç½®çš„ X åæ ‡
        const touchEndY = mouse.y; // è§¦æ‘¸ç»“æŸä½ç½®çš„ Y åæ ‡
        const touchEndTime = Date.now(); // è®°å½•è§¦æ‘¸ç»“æŸæ—¶é—´

        // è®¡ç®—è§¦æ‘¸ç§»åŠ¨çš„è·ç¦»
        const deltaX = touchEndX - touchStartX;
        const deltaY = touchEndY - touchStartY;
        const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);

        // è®¡ç®—è§¦æ‘¸æŒç»­æ—¶é—´
        const duration = touchEndTime - touchStartTime;

        // åˆ¤æ–­æ˜¯å¦ä¸ºå•å‡»äº‹ä»¶
        let isClicked = false;
        if (duration < 300 && distance < 10) { // 300ms å†…ä¸”ç§»åŠ¨è·ç¦»å°äº 10px
            //alert(">>>> å•å‡»äº†"); // TODO åŒå‡»ä¼šè§¦å‘ä¸¤æ¬¡å•å‡»
            isClicked = true;
            doClick(e, true);
        }

        if (touchEndTime - lastTouchEnd <= 300) { // 200~300
            //alert(">>>> åŒå‡»äº†");
            doDbClick(e);
        } else {
            //alert(">>>> é¼ æ ‡æŠ¬èµ·è§¦å‘å•å‡»äº†");
            if (!isClicked) doClick(e);
        }
        lastTouchEnd = touchEndTime;
    }, false);


    // ç§»åŠ¨ç«¯ç‚¹æŒ‰å‘å°„æŒ‰é’®ç‚¹å‡»ç›‘å¬
    var lastTouchEndClickBtn = 0;
    if (!os.isPc) gameClickPlayCanvas.addEventListener('touchend', (e) => {
        doEventDefault(e);
        let now = (new Date()).getTime();
        if (now - lastTouchEndClickBtn <= 300) { // 200~300
            //alert(">>>> åŒå‡»äº†");
            //doDbClick(e);
        } else {
            //alert(">>>> å•å‡»äº†");
            // å‘å°„å¤„ç†
            doClickPlay(e);
        }
        lastTouchEndClickBtn = now;
    }, false);


    // ç –æ ¼åæ ‡å±‚ç‚¹å‡»äº‹ä»¶ï¼Œç‚¹å‡»åæ ‡ï¼Œåˆ‡æ¢é•¿çŸ­æ˜¾ç¤º
    if (!os.isPc) gameSceneCoordinateCanvas.addEventListener('touchend', (e) => {
        //console.log(e);
        //alert(e.touches.length);
        doEventDefault(e);
        if (currTouchPointNum !== 1) return;

        let now = (new Date()).getTime();
        if (now - lastTouchEnd <= 300) { // 200~300
            //alert(">>>> åŒå‡»äº†");
            // åˆ‡æ¢å®Œå…¨åæ ‡
            let p = getClickPos(e);
            if (isInGirdNumArea(p)) {
                userConfig.isShowGridCoordinateFull = !userConfig.isShowGridCoordinateFull;
                switchCanvasShow(gameSceneCoordinateCanvas, true);
                localStorage.setItem('collide-try-user-settings', JSON.stringify(userConfig));
            }
        } else {
            //alert(">>>> å•å‡»äº†");
        }
        lastTouchEnd = now; // å…±ç”¨ä¸€ä¸ªäº‹ä»¶æ ‡å¿—ä¼šå¯¼è‡´åˆ¤æ–­é”™ä¹±é—®é¢˜ï¼Œç›®å‰ä¸šåŠ¡ä¸å¤šï¼Œæ²¡æœ‰å†²çªï¼Œå…ˆè¿™æ ·
    }, false);


    // å•å‡»é®ç½©å±‚å…³é—­æœ€ä¸Šå±‚å¼¹çª—ç›‘å¬äº‹ä»¶
    if (!os.isPc) dialogMask.addEventListener('touchend', (e) => {
        doEventDefault(e);
        let now = (new Date()).getTime();
        if (now - lastTouchEnd <= 300) { // 200~300
            //alert(">>>> åŒå‡»äº†");
        } else {
            //alert(">>>> å•å‡»äº†");
            doCloseTopDialog(e);
        }
        lastTouchEnd = now;
    }, false);
})


// ç‚¹æŒ‰å‘å°„æŒ‰é’®ç‚¹å‡»
function doClickPlay(e) {
    if (!selectedBall) return; // æ²¡ç”¨é€‰ä¸­çƒ
    if (selectedBall.vx === 0 && selectedBall.vy === 0) return; // æ²¡æœ‰æ‹–åŠ¨å®Œæˆæ—¶ï¼Œæ²¡æœ‰é€Ÿåº¦
    // ç‚¹å‡»èŒƒå›´åˆ¤æ–­ï¼Œä¸åŒçš„ç”»å¸ƒåæ ‡ç³»ä¸ä¸€è‡´
    //if (!is2CirclesCollided(ball0, ball1)) return;
    clickPlayBtn.isReady = true;
    doClick(e);
}


// å…³é—­æœ€ä¸Šå±‚å¼¹çª—
function doCloseTopDialog(e) {
    doBack(true);
}


// å•å‡»åå¤„ç†é€»è¾‘
function doClick(e, isClick) {

    // ä¸‰è¿å‡»è®¡æ•°
    //preTripleClick(e);
    // é¼ æ ‡æˆ–æ‰‹æŒ‡æŠ¬èµ·ï¼Œæ ‡è®°é¼ æ ‡æ²¡æœ‰åœ¨æ‹–åŠ¨
    isMouseMoving = false;

    if (!selectedBall) return; // æ²¡ç”¨é€‰ä¸­çƒ
    if (userConfig.isJustShowTable) return; // åªæ˜¾ç¤ºå°é¢ï¼Œä¸å¤„ç†ç‚¹å‡»äº‹ä»¶
    // ç‚¹æŒ‰æ¨¡å¼ç‚¹å‡»æ—¶æ¨¡æ‹Ÿæ‹–åŠ¨
    if (isClick && userConfig.currPlayOpt === 1 && !clickPlayBtn.isReady) {
        // ç‚¹å‡»è°ƒæ•´ä½ç½®æ—¶ï¼Œåç§»å½’é›¶
        clickOffset.x = 0; clickOffset.y = 0;
        // æ¨¡æ‹Ÿä¸€æ¬¡ç§»åŠ¨
        onMouseMove();
        // éœ€é‡æ–°æ¸²æŸ“
        isAnimated = false;
        if (!isPlaying) animate();
    }

    //console.log(">>>> isChgPosFinished=" + selectedBall.isChgPosFinished);
    //if (selectedBall) console.log(">>>> isBallReady=" + isBallReady(selectedBall));
    if (selectedBall.isChgPosFinished && isBallReady(selectedBall)) {
        console.log(">>>> doClick is readying >>>>");
        // é‡ç½®æ‹–åŠ¨æ ‡è¯†
        selectedBall.isChgPosFinished = false;
        //if (userConfig.isJustTrying) return; // åªç„å‡†ä¸æ‰“
        // è®¾ç½®èµ·ç‚¹
        //selectedBall.x0 = selectedBall.x;
        //selectedBall.y0 = selectedBall.y;
        selectedBall.preCollided = { x: selectedBall.x, y: selectedBall.y };
        selectedBall.prePoint = { x: selectedBall.x, y: selectedBall.y };
        // æ›´æ–°ä¸»çƒç§»åŠ¨ä½ç½®åæ ‡
        oldBallPos.x = selectedBall.x;
        oldBallPos.y = selectedBall.y;
        // å¤‡ä»½åŸå§‹ä½ç½®åæ ‡
        setBallsPosBack(true);
        // åˆå§‹åŒ–åŒå­åˆ†èº«ï¼Œåªç„å‡†ä¸æ‰“ä¸è®¾ç½®
        if (selectedBall.isMainBall && selectedBall.roleId === Role.SHUANGZI.id && !userConfig.isJustTrying) doTwins(selectedBall);
        // çŒ´å­åˆ†èº«
        if (selectedBall.isMainBall && selectedBall.roleId === Role.WUKONG.id && !userConfig.isJustTrying) preMonkeys();
        // é‡ç½®è§’è‰²å­—æ®µå±æ€§å€¼
        resetRoleField();
        // ç„å‡†æ¾æ‰‹å¼€æ‰“ä¹‹å‰ï¼Œå†æ¬¡æ›´æ–°é€Ÿåº¦ï¼Œé¿å…ç„å‡†çœ‹åˆ°çš„è·Ÿå®é™…æ‰“çš„æ–¹å‘å› ä¸ºæ‰‹æŠ–å¯¼è‡´åå·®
        if (tryMoveBallFirstCollidedPos.x > 0 && tryMoveBallFirstCollidedPos.y > 0)
            getVxVy(tryMoveBallFirstCollidedPos, { x: selectedBall.x, y: selectedBall.y }, null, selectedBall);
        // å‚€å„¡ç»³å­å› ä¸ºæ²¡æœ‰åŠ å—æ‘©æ“¦åŠ›ï¼Œé€Ÿåº¦éœ€è¦é™ä¸€ç‚¹ï¼Œä¸ç„¶çœ‹ç€å¤ªå¿«
        /*
        if (selectedBall.isMainBall && selectedBall.roleId === Role.KUILEI.id && !isKuileiPulling) {
            selectedBall.vx *= Ball.SPEEDRATIO.L;
            selectedBall.vy *= Ball.SPEEDRATIO.L;
        }
        */
        // æ¸…ç©ºselectedBallåå¼€å§‹è¿åŠ¨
        if (!userConfig.isJustTrying) {
            selectedBall.draw();
            selectedBall.update();
        }
        selectedBall = null;
        // é‡ç½®tryMoveBall
        resetTryMoveBall();
        // é‡ç½®æ˜¯å¦æ‰¾åˆ°ç¬¬ä¸€æ¬¡æ’å‡»ç‚¹æ ‡è¯†
        isFirstCollidedPointFounded = false;
        // é‡æ–°æ¸²æŸ“
        if (!isPlaying) animate();
        // å¼€å§‹è¿åŠ¨ï¼Œç½®é¡¶é®ç½©ï¼Œé¿å…è¯¯ç¢°
        changeCanvasIndex(gameMaskCanvas, 2);
        // è¶…æ—¶è‡ªåŠ¨åœæ­¢
        autoStopTimeout();
        // é‡ç½®å„ä¸ªå°çƒçš„ç¢°æ’æ ‡å¿—ä½
        setBallCollidingNos();
        // é‡ç½®å‚€å„¡æ‹‰å›æ ‡å¿—
        isKuileiPulling = false;
        // åªç„å‡†ä¸æ‰“
        if (userConfig.isJustTrying) doJustTrying();
        // ç‚¹æŒ‰å‘å°„æ ‡è¯†é‡ç½®
        clickPlayBtn.isReady = false;
        // éšè—å‘å°„æŒ‰é’®
        if (userConfig.currPlayOpt === 1) gameClickPlayCanvas.style.display = "none";
        // ç¬¬ä¸€ä¸ªç¢°æ’ç‚¹å¤‡ä»½é‡ç½®
        tryMoveBallFirstCollidedPosBack.x = 0; tryMoveBallFirstCollidedPosBack.y = 0;
    }

    // åˆ¤æ–­çƒä½ç½®æ˜¯å¦æ”¹åŠ¨
    if (isBallMoved(selectedBall)) { // æ‹–åŠ¨å®Œæˆ
        if (selectedBall.isMainBall) selectedBall.isChgPosFinished = true; // ä¸»çƒæ‰ä¼šæœ‰æ‹–åŠ¨å®Œæˆï¼Œä¼šå‘å°„ï¼Œå‘å°„åæ‰å¯ä»¥å†æ¬¡æ‹–åŠ¨
        if (!selectedBall.isMainBall) selectedBall = null; // éä¸»çƒæ‹–åŠ¨å®Œæˆåï¼Œä¸å‘å°„ï¼Œå¯ä»¥å¤šæ¬¡æ‹–åŠ¨
        // è‡ªåŠ¨éšè—åæ ‡æ¡
        rolePosLineTimer = setTimeout(() => { rolePosLine.style.display = 'none' }, 3000);
    }

    // é¼ æ ‡æŠ¬èµ·çš„clickäº‹ä»¶ï¼Œç‚¹æŒ‰å‘å°„åç§»åæ ‡é‡ç½®
    clickOffset.x = 0; clickOffset.y = 0;
    // æ˜¾ç¤ºå‘å°„æŒ‰é’®
    if (userConfig.currPlayOpt === 1 && selectedBall && selectedBall.isChgPosFinished) gameClickPlayCanvas.style.display = "unset";
}


// åŒå‡»åå¤„ç†é€»è¾‘ã€ç§»åŠ¨ç«¯åŒå‡»è¿˜æœ‰ç‚¹é—®é¢˜ã€‘
function doDbClick(e) {
    if (userConfig.isJustShowTable) return; // åªæ˜¾ç¤ºå°é¢ï¼Œä¸å¤„ç†ç‚¹å‡»äº‹ä»¶
    // ä¸‰è¿å‡»è®¡æ•°
    //preTripleClick(e, true);
    // åŒå‡»ä¸»çƒï¼Œå…æ‹–åŠ¨ï¼Œç›´æ¥å¼€æ‰“
    directPlayAgain(true);
}


// ä¸‰è¿å‡»ï¼Œä¸ç”¨å¤ªå¿«ç‚¹ã€ä¸ç¨³å®šï¼Œä¼šè§¦å‘å•å‡»ã€åŒå‡»çš„äº‹ä»¶ï¼Œå¯¼è‡´åŠŸèƒ½æ··ä¹±ã€‘
let tripleClick = 0;
let tripleClickTimer = 0;
function doTripleClick(e) {
    if (userConfig.isJustShowTable) return; // åªæ˜¾ç¤ºå°é¢ï¼Œä¸å¤„ç†ç‚¹å‡»äº‹ä»¶
    //alert(">>>> ä¸‰è¿å‡»");
    // æ‰€æœ‰è§’è‰²é‡æ–°è®¾ç½®éšæœºä½ç½®
    putAllBallsRandom();
    // é‡æ–°æ¸²æŸ“
    isAnimated = false;
    if (!isPlaying) animate();
}


// ä¸‰è¿å‡»å‡†å¤‡
function preTripleClick(e, isDbClick) {
    if (isDbClick) tripleClick += 2;
    else tripleClick += 1;
    if (tripleClick >= 4) { // TODO ç›®å‰åŒå‡»äº‹ä»¶ä¼šå¤šå‡ºä¸€æ¬¡å•å‡»
        tripleClickTimer && clearTimeout(tripleClickTimer);
        tripleClick = 0;
        tripleClickTimer = 0;
        doTripleClick(e);
        return;
    }
    tripleClickTimer && clearTimeout(tripleClickTimer);
    tripleClickTimer = setTimeout(() => {
        tripleClickTimer && clearTimeout(tripleClickTimer);
        tripleClick = 0;
        tripleClickTimer = 0;
    }, 500);
}


// é•¿æŒ‰å¤„ç†
function doLongPress(e) {
    //console.log(e);
    if (!userConfig.isLongPressRandom) return;
    // åœ¨ç„å‡†é˜¶æ®µä¸èƒ½é‡ç½®
    if (selectedBall && selectedBall.isChgPosFinished) return;
    // ç§»åŠ¨ç«¯ç›®å‰åªæ”¯æŒå•ç‚¹è§¦ç¢°
    if (!os.isPc && currTouchPointNum !== 1) return;
    // åªæ˜¾ç¤ºå°é¢ï¼Œä¸å¤„ç†ç‚¹å‡»äº‹ä»¶
    if (userConfig.isJustShowTable) return;
    // æŒ‰è§’è‰²ä¸é‡ç½®ï¼Œåªèƒ½æŒ‰ç©ºç™½åŒºåŸŸ
    if (isBallsSelected(balls)) return;
    //alert(">>>> é•¿æŒ‰");
    // æ‰€æœ‰è§’è‰²é‡æ–°è®¾ç½®éšæœºä½ç½®
    putAllBallsRandom();
    // é€‰ä¸­ä¸»çƒ
    selectMainBall();
    // è¿˜åŸtryMoveBallåŠå¾„
    preTryMoveBall(0);
    // é‡ç½®tryMoveBallé€Ÿåº¦çŠ¶æ€
    resetTryMoveBall();
    // ä¸»çƒé€Ÿåº¦é‡ç½®
    selectedBall.vx = 0;
    selectedBall.vy = 0;
    selectedBall.isMoving = false;
    // æ ‡è®°ä¸»çƒæœªç§»åŠ¨å®Œæˆã€è¿™é‡Œå¿…é¡»æ”¾åœ¨onMouseMoveä¹‹å‰ã€‘
    selectedBall.isChgPosFinished = false;
    // æ¨¡æ‹Ÿæ‹–åŠ¨ï¼Œé‡æ–°æ¸²æŸ“æ”¹å˜ä½ç½®åçš„ç”»é¢
    onMouseMove(true);
    // ä¸é€‰ä¸­ä¸»çƒ
    selectedBall = null;
    // é˜»æ–­åç»­äº‹ä»¶
    doEventDefault(e);
    // è§’è‰²åæ ‡å…³é—­
    rolePosLine.style.display = "none";
}


// å¤„ç†äº‹ä»¶å†’æ³¡å’Œé»˜è®¤è¡Œä¸º
function doEventDefault(e) {
    e = e || window.event;
    if (!e) return;

    //console.log(">>>> doEventDefault ", e);
    // æ‰“å°è°ƒç”¨å †æ ˆ
    //if (!isProd()) printStack();

    // é˜»æ­¢äº‹ä»¶å†’æ³¡ï¼Œä½†ä¸ä¼šé˜»æ­¢æµè§ˆå™¨é»˜è®¤è¡Œä¸º
    if (e.stopPropagation) { // éIE
        e.stopPropagation();
    } else { // IE
        e.cacelBubble = true;
    }

    let ele = e.target;
    if (ele && ele.tagName && ele.tagName.toLowerCase() === "a") return; // a é“¾æ¥
    if (ele && ele.tagName && ele.tagName.toLowerCase() === "input") return; // input file é€‰æ‹©

    // é˜»æ­¢æµè§ˆå™¨é»˜è®¤è¡Œä¸º
    if (e.preventDefault) { // éIE
        if (e.cancelable) e.preventDefault();
    } else { // IE
        e.returnValue = false;
    }
}


// åˆ¤æ–­çƒä½ç½®æ˜¯å¦æ”¹åŠ¨
function isBallMoved(ball) {
    if (!ball) return false;
    if (ball.x != oldBallPos.x || ball.y != oldBallPos.y) {
        // æ‹–åŠ¨å®Œæˆ
        return true;
    }
    return false;
}


// å°çƒæ˜¯å¦å‡†å¤‡å°±ç»ªï¼Œvxã€vy ä¸ä¸ºé›¶
function isBallReady(ball) {
    if (!ball) return false;
    if (userConfig.currPlayOpt === 1 && !clickPlayBtn.isReady) return false;
    if (ball.vx !== 0 || ball.vy !== 0) {
        // é€Ÿåº¦å‡†å¤‡å°±ç»ª
        return true;
    }
    return false;
}


// åˆ¤æ–­é¼ æ ‡æ˜¯å¦ç‚¹å‡»äº†å°çƒ
function isBallSelected(ball, pos) {
    // é€šè¿‡é¼ æ ‡ä½ç½®åˆ°åœ†å¿ƒçš„è·ç¦»åˆ¤æ–­
    //console.log(">>>> mouse.x=" + mouse.x + ", mouse.y=" + mouse.y);
    //console.log(">>>> ball.x=" + ball.x + ", ball.y=" + ball.y);
    let d;
    if (pos) d = getDistanceOf2Points({ x: pos.x, y: pos.y }, { x: ball.x, y: ball.y });
    else d = getDistanceOf2Points({ x: mouse.x, y: mouse.y }, { x: ball.x, y: ball.y });
    //console.log(">>>> isBallSelected d=" + d);
    if (d <= ball.radius) return true;
    return false;
}


// åˆ¤æ–­é¼ æ ‡æ˜¯å¦æŒ¨åˆ°äº†ä»»æ„ä¸€ä¸ªå°çƒ
function isBallsSelected(checkBalls, pos) {
    if (!checkBalls || checkBalls.length < 1) return false;
    let ball;
    for (let i = 0, len = checkBalls.length; i < len; i++) {
        ball = checkBalls[i];
        let d;
        if (pos) d = getDistanceOf2Points({ x: pos.x, y: pos.y }, { x: ball.x, y: ball.y });
        else d = getDistanceOf2Points({ x: mouse.x, y: mouse.y }, { x: ball.x, y: ball.y });
        //console.log(">>>> isBallSelected d=" + d);
        if (d <= ball.radius) return true;
    }
    return false;
}


// é€‰ä¸­ä¸»çƒï¼Œåªæ”¯æŒä¸€ä¸ªä¸»çƒ
function selectMainBall() {
    let mainBall = balls[0];
    selectedBall = mainBall;
    //oldBallPos.x = mainBall.x;
    //oldBallPos.y = mainBall.y;
}


// å¤„ç†åªç„å‡†ä¸æ‰“äº‹å®œ
function doJustTrying() {
    if (!userConfig.isJustTrying) return;
    if (!balls || balls.length < 1) return;
    let selectedBall = balls[0];
    selectedBall.vx = 0;
    selectedBall.vy = 0;
    // è¿˜åŸ tryMoveBall
    preTryMoveBall(0);
    doAfterBallStopped(balls);
    // æ‰‹åŠ¨åç§»ä¸€ç‚¹ç‚¹ä½ç½®åæ ‡ï¼Œå¥½è®©è§’è‰²é‡æ–°æ¸²æŸ“
    selectedBall.y -= 0.0000000001;
}


// æ‰“å®Œä¸€æ¬¡åï¼Œå…æ‹–åŠ¨ï¼Œã€åŸä½ç½®ã€‘å†æ¬¡å¼€æ‰“
function directPlayAgain(isChgPosFinished) {
    if (!userConfig.isDbclickBack) return;
    if (selectedBall && selectedBall.isChgPosFinished) return;
    if (checkIsMoving()) return; // è§£å†³å¤šç‚¹è§¦ç¢°ï¼Œå•å‡»å¼€æ‰“ååˆè§¦å‘åŒå‡»é‡ç½®ï¼Œå¯¼è‡´æ— é™å¾ªç¯
    // è·å–ç‚¹å‡»åæ ‡
    let pos = clickPos;
    // æ˜¯å¦ç‚¹å‡»äº†ä¸»çƒã€ç§»åŠ¨ç«¯å¯èƒ½ç‚¹ä¸å‡†ã€‘
    //if (!isBallSelected(balls[0], pos)) return;
    console.log(">>>> directPlayAgain >>>>");
    // é€‰ä¸­ä¸»çƒ
    selectMainBall();
    // è¿˜åŸåŸå§‹ä½ç½®åæ ‡
    setBallsPosBack(false);
    // æ¨¡æ‹Ÿæ‹–åŠ¨
    onMouseMove(true);
    // é‡ç”»ä¸€æ¬¡
    //selectedBall.draw();
    // æ ‡è®°ä¸»çƒç§»åŠ¨å®Œæˆ
    selectedBall.isChgPosFinished = isChgPosFinished;
    // é‡æ–°æ¸²æŸ“
    //isAnimated = false;
    //if (!isPlaying) animate();
    // è§’è‰²åæ ‡å…³é—­
    rolePosLine.style.display = "none";
}


//////////////////////////////////////////////////////////////////////

</script>
