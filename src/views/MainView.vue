<style scoped>
/*********************** ä¸»åº”ç”¨æ ·å¼ start ***********************/
/* canvas å›¾å±‚æ ·å¼ */
#container {
    position: relative;
    height: 100vh;
}

canvas {
    position: absolute;
    left: 0;
    top: 0;
    display: none;
}

#game-scene-graph {
    z-index: -1;
}

#game-scene-emoji {
    z-index: -1;
}

#game-scene {
    background: rgba(255, 255, 255, 0);
    /*å›¾å±‚é€æ˜ï¼Œç»™ç”»çš„å›¾å½¢å¡«å……é¢œè‰²*/
    z-index: -1;
}

#game-scene-lines {
    z-index: 0;
}

#game-scene-coordinate {
    z-index: 0;
}

#game-main {
    z-index: 1;
}

#game-main-ball {
    z-index: 1;
    pointer-events: none;
    /* å¯ä»¥ç‚¹å‡»ç©¿é€ */
}

#game-path {
    z-index: 1;
    pointer-events: none;
    /* å¯ä»¥ç‚¹å‡»ç©¿é€ */
}

#game-path-ball {
    z-index: 1;
    pointer-events: none;
    /* å¯ä»¥ç‚¹å‡»ç©¿é€ */
}

#game-mask {
    z-index: -2;
}

/* é®ç½©å›¾å±‚æ ·å¼ */
#dialog-mask {
    position: absolute;
    left: 0;
    top: 0;
    z-index: 1000;
    background-color: rgba(0, 0, 0, 0.5);
    width: 100vw;
    height: 100vh;
    display: none;
}

/* åº”ç”¨å…¨å±€å…¬ç”¨æ ·å¼ */
.collide-try-btn {
    width: 40px;
    text-align: center;
    vertical-align: middle;
    line-height: 1;
    border-radius: 3px;
}

.in-one-line {
    display: flex;
    flex-wrap: nowrap;
    flex-direction: row;
    align-content: center;
    justify-content: center;
    align-items: stretch;
}

.each-item-border-bottom {
    width: 100%;
    display: inline-block;
    border-bottom: 1px solid #ddd;
    text-align: left;
}

/* å¸¦ä¸€ä¸ªå…³é—­æŒ‰é’®çš„å±…ä¸­åä¸Šå¼¹çª— */
.collide-try-close-btn-dialog {
    position: absolute;
    left: 0;
    top: -20vh;
    right: 0;
    bottom: 0;
    margin: auto;
    z-index: 10010;
    width: 80%;
    height: max-content;
    border-radius: 10px;
    text-align: center;
    display: none;
}

.collide-try-close-btn-dialog-title {
    border-radius: 10px 10px 0 0;
    background: #edeff6;
    display: flex;
    flex-direction: row;
    align-items: baseline;
    flex-wrap: nowrap;
    justify-content: flex-start;
}

.collide-try-close-btn-dialog-title-close {
    position: absolute;
    width: 100%;
    font-size: 18px;
    top: 6px;
    left: -6px;
    text-align: right;
}

.collide-try-close-btn-dialog-title-close span {
    font-size: 16px;
    cursor: pointer;
}

.collide-try-close-btn-dialog-title b {
    font-size: 18px;
    text-align: left;
    line-height: 2.4;
    padding-left: 10px;
    vertical-align: middle;
}

.collide-try-close-btn-dialog-content {
    background-color: #f7f7fc;
    max-height: 80.0vh;
    /* å†…å®¹è¶…å‡ºåŒºåŸŸï¼Œéœ€è¦è®¾ç½®é«˜åº¦ï¼Œæ‰èƒ½æ»šåŠ¨ */
    /* éšè— IEã€Edge å’Œ Firefox çš„æ»šåŠ¨æ¡ */
    -ms-overflow-style: none;
    /* IE and Edge */
    scrollbar-width: none;
    /* Firefox */
    overflow-x: hidden;
    overflow-y: scroll;
    font-size: 14px;
    margin-top: -2px;
    /* è§£å†³æ ‡é¢˜è¾¹æ¡†é€æ˜é—®é¢˜ */
    padding: 10px 10px 25px 10px;
    border-radius: 0 0 10px 10px;
}

.collide-try-close-btn-dialog-content pre {
    width: 100%;
    text-align: left;
    font-size: 16px;
    line-height: 1.6;
    white-space: pre-line;
}

.collide-try-close-btn-dialog-content pre a {
    font-size: 10px;
}

.collide-try-close-btn-dialog-ok {
    text-align: right;
    margin-top: -11px;
    margin-right: 20px;
}

.collide-try-close-btn-dialog-ok span {
    text-align: center;
    vertical-align: middle;
    width: max-content;
    padding: 6px;
    font-size: 14px;
    background: chartreuse;
    border-radius: 5px;
    border: 1px black;
    box-shadow: rgba(0, 0, 0, 0.16) 0px 10px 36px 0px, rgba(0, 0, 0, 0.06) 0px 0px 0px 1px;
    cursor: pointer;
}

/* å°æç¤ºå¼¹çª—æ ·å¼ï¼Œé‡å†™æ ·å¼éœ€è¦æ”¾åœ¨è¿™ä¸ªæ ·å¼åé¢ */
.collide-try-tiny-dialog {
    position: absolute;
    top: 5px;
    right: 40px;
    margin: auto;
    z-index: 0;
    text-align: center;
    font-size: 16px;
    display: none;
}

.collide-try-tiny-dialog-msg {
    text-align: right;
    vertical-align: middle;
    padding: 0 5px 5px 5px;
    font-size: 16px;
    background: #fff;
    border-radius: 5px;
    border: 1px dashed black;
    box-shadow: rgba(0, 0, 0, 0.16) 0px 10px 36px 0px, rgba(0, 0, 0, 0.06) 0px 0px 0px 1px;
}

.collide-try-tiny-dialog-msg span {
    font-size: 20px;
}

.collide-try-tiny-dialog-ok {
    text-align: right;
    vertical-align: middle;
    width: 100%;
    margin: 5px 0;
    font-size: 14px;
}

.collide-try-tiny-dialog-ok span {
    text-align: center;
    vertical-align: middle;
    width: max-content;
    margin-top: 5px;
    padding: 5px;
    font-size: 14px;
    background: chartreuse;
    border-radius: 5px;
    border: 1px black;
    box-shadow: rgba(0, 0, 0, 0.16) 0px 10px 36px 0px, rgba(0, 0, 0, 0.06) 0px 0px 0px 1px;
    cursor: pointer;
}

/* å³ä¸Šè§’è®¾ç½®æç¤ºå¼¹çª—æ ·å¼ */
#game-setting-icon {
    position: absolute;
    right: 10px;
    top: 10px;
    z-index: 0;
}

#game-setting-icon>span {
    padding: 2px;
    font-size: 16px;
    text-align: center;
    vertical-align: middle;
    cursor: pointer;
}

/* è®¾ç½®ä¸»è§’æ—¶æç¤ºå¼¹çª—æ ·å¼ */
/* çˆ¶å…ƒç´ è®¾ç½® position ä¸º relativeï¼Œè‡ªèº«è®¾ç½®ä¸º absoluteï¼Œå³å¯è·Ÿéšå®šä½ */
.user-setting-item-input-area {
    position: relative;
}

#game-setting-main-role-dialog {
    top: 25px;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 1003;
}

#game-setting-main-role-dialog-msg {
    text-align: left;
    padding: 5px;
    font-size: 14px;
}

#game-setting-main-role-dialog-msg span {
    font-size: 16px;
}

#game-setting-main-role-dialog-ok {}

#game-setting-main-role-dialog-ok span {}

/* TODO åç»­å†å°è£…ä¸€ä¸ªå…¨å±€å¼¹çª—ï¼Œå¤šå¤„è°ƒç”¨åŒä¸€ä¸ªï¼Œå‡å°‘é‡å¤ä»£ç  */
/* é€‰æ‹©è§’è‰²å¼¹çª—æ ·å¼ */
#choose-role-dialog {
    position: absolute;
    left: 0;
    top: 0;
    right: 0;
    bottom: 0;
    margin: auto;
    z-index: 1001;
    width: 80%;
    height: max-content;
    border-radius: 10px;
    background-color: #f7f7fc;
    text-align: center;
    display: none;
    overflow: hidden;
}

#role-list-area {
    max-height: 80.0vh;
    -ms-overflow-style: none;
    scrollbar-width: none;
    overflow-x: hidden;
    overflow-y: scroll;
}

#role-list-head {
    border-radius: 10px 10px 0 0;
    background: #edeff6;
    text-align: center;
}

#role-list-head-msg {
    padding: 3px 0 2px 0;
    font-size: 24px;
}

#role-list-head-desc {
    padding: 0 0 5px 0;
    font-size: 10px;
}

#role-list-head-setting-icon {
    width: 100%;
    position: absolute;
    font-size: 22px;
    top: 4px;
    left: -4px;
    text-align: right;
}

#role-list-head-setting-icon span {
    font-size: 22px;
    cursor: pointer;
}

.role-list {
    padding: 10px 0 10px 0;
    font-size: 20px;
    cursor: pointer;
}

.role-list:not(:last-child) {
    border-bottom: 1px solid #ddd;
}

.role-list:last-child {
    border-radius: 0 0 10px 10px;
}

.role-list:hover {
    background-color: #FAFAFA;
}

/* é€‰æ‹©è§’è‰²åˆ—è¡¨iconã€nameè¡¨æ ¼æ ·å¼ */
.role-list-icon-name {
    display: inline-grid;
    grid-template-columns: 46px 170px;
    grid-template-rows: 100%;
    align-content: center;
    justify-content: center;
    align-items: baseline;
    justify-items: stretch;
    padding-left: 10px;
}

.role-list-icon-name span {
    font-size: 20px;
}

.role-list-icon {
    text-align: center;
    vertical-align: middle;
}

.role-list-name {
    text-align: left;
}

/* é€‰æ‹©è§’è‰²åŒå­å›¾æ ‡é‡ç”» */
#role-shuangzi span {
    font-size: 20px;
}

#role-shuangzi-new-draw {
    display: inline-grid;
}

.role-shuangzi-single {
    grid-area: 1 / 2;
}

#role-shuangzi-1 {
    margin-right: 7px;
    z-index: 1002;
}

#role-shuangzi-2 {
    margin-left: 7px;
    margin-top: -2px;
    z-index: 1001;
}

/* ç”¨æˆ·è®¾ç½®å¼¹çª—æ ·å¼ */
#user-setting-dialog {
    overflow: hidden;
    position: absolute;
    left: 0;
    top: 0;
    right: 0;
    bottom: 0;
    margin: auto;
    z-index: 1002;
    width: 80%;
    height: max-content;
    border-radius: 10px;
    background-color: #f7f7fc;
    text-align: center;
    display: none;
}

#user-setting-area {
    max-height: 80.0vh;
    /* å†…å®¹è¶…å‡ºåŒºåŸŸï¼Œéœ€è¦è®¾ç½®é«˜åº¦ï¼Œæ‰èƒ½æ»šåŠ¨ */
    /* éšè— IEã€Edge å’Œ Firefox çš„æ»šåŠ¨æ¡ */
    -ms-overflow-style: none;
    /* IE and Edge */
    scrollbar-width: none;
    /* Firefox */
    overflow-x: hidden;
    overflow-y: scroll;
}

/* éšè— Chromeã€Safari å’Œ Opera çš„æ»šåŠ¨æ¡ */
#user-setting-area::-webkit-scrollbar {
    display: none;
}

#user-setting-head {
    border-radius: 10px 10px 0 0;
    background: #edeff6;
    text-align: center;
}

#user-setting-head-msg {
    padding: 5px 0 5px 0;
    font-size: 24px;
}

#user-setting-head-desc {
    padding: 0 0 3px 0;
    font-size: 10px;
}

#user-setting-close-icon {
    position: absolute;
    width: 100%;
    font-size: 18px;
    top: 6px;
    left: -6px;
    text-align: right;
}

#user-setting-close-icon span {
    font-size: 18px;
    cursor: pointer;
}

.user-setting-item {
    padding: 6px 10px;
    font-size: 18px;
    text-align: left;
}

.user-setting-item-msg-left {
    font-size: 16px;
}

.user-setting-item-switch-right button {
    font-size: 12px;
}

.user-setting-item:not(:last-child) {
    border-bottom: 1px solid #ddd;
}

.user-setting-item:last-child {
    border-radius: 0 0 10px 10px;
}

.user-setting-item:hover {
    background-color: #FAFAFA;
}

.user-setting-item-msg-left {
    position: relative;
    text-align: left;
}

.user-setting-item-switch-right {
    position: relative;
    float: right;
    top: 3px;
    vertical-align: middle;
}

.user-setting-item-input-area {
    margin: 4px 0px;
}

.user-setting-item-input-area input {
    width: 100%;
    vertical-align: middle;
    border: none;
    padding: 2px 2px;
    font-size: 12px;
    color: #2196F3;
    background-color: transparent;
    outline: none;
    -webkit-appearance: none;
}

.div-input-game-roles {
    display: inline-block;
    min-width: 25px;
    max-width: 100px;
    vertical-align: middle;
    border: 1px solid transparent;
    border-color: #2196F3;
    border-radius: 4px;
    padding: 2px 4px;
    margin-right: 3px;
    font-size: 12px;
    color: #2196F3;
    background-color: transparent;
    outline: none;
    -webkit-appearance: none;
}

.div-input-game-roles.red {
    color: red;
    border-color: red;
}

.div-input-game-roles.default {}

.reset-btn {
    /*
        vertical-align: middle;
        margin-left: 4px;
        */
    font-size: 15px;
    cursor: pointer;
}

/* å¯¼å…¥/å¯¼å‡ºè§’è‰²å’Œåæ ‡ */
#shareRoleAndPos {}

.bg-lv1 {
    background-color: #16C60C;
    color: #fff;
}

.bg-lv2 {
    background-color: #2196F3;
    color: #fff;
}

/* å…³äºåº”ç”¨å¼¹çª—æ ·å¼ */
#user-setting-about-app-dialog {
    position: absolute;
    left: 0;
    top: 0;
    right: 0;
    bottom: 0;
    margin: auto;
    z-index: 1003;
    width: 80%;
    height: max-content;
    border-radius: 10px;
    background-color: #f7f7fc;
    text-align: center;
    display: none;
}

#user-setting-about-app-close-icon {
    position: absolute;
    width: 100%;
    border-radius: 10px 10px 0 0;
    font-size: 18px;
    top: 6px;
    left: -6px;
    text-align: right;
}

#user-setting-about-app-close-icon span {
    font-size: 18px;
    cursor: pointer;
}

#user-setting-about-app-content {
    max-height: 80.0vh;
    /* å†…å®¹è¶…å‡ºåŒºåŸŸï¼Œéœ€è¦è®¾ç½®é«˜åº¦ï¼Œæ‰èƒ½æ»šåŠ¨ */
    /* éšè— IEã€Edge å’Œ Firefox çš„æ»šåŠ¨æ¡ */
    -ms-overflow-style: none;
    /* IE and Edge */
    scrollbar-width: none;
    /* Firefox */
    overflow-x: hidden;
    overflow-y: scroll;
    font-size: 14px;
    padding: 10px;
}

#user-setting-about-app-content pre {
    width: 100%;
    text-align: left;
    font-size: 12px;
    line-height: 1.5;
    white-space: pre-line;
}

#user-setting-about-app-content pre b {
    line-height: 2;
}

#user-setting-about-app-content pre a {
    font-size: 10px;
}

#user-setting-about-app-title {}

#about-app-title {
    font-size: 18px;
    text-align: left;
    line-height: 2.4;
    padding-left: 10px;
    vertical-align: middle;
}

#about-app-title svg {
    width: 20px;
    height: 20px;
    vertical-align: sub;
    padding-right: 5px;
}

.collide-try-goodbye {
    display: none;
}

#collide-try-bye {
    margin-top: 886px;
}

#collide-try-bye span {
    line-height: 1.5;
}

#see-you-next-time {
    font-size: 16px;
    font-weight: bold;
    /*color: mediumblue;*/
}

/* è§’è‰²åæ ‡æ‚¬æµ®æ¡æ ·å¼ */
#collide-try-role-pos-line {
    position: absolute;
    left: 0;
    top: 0;
    margin: auto;
    z-index: 1;
    background-color: #fff;
    border-radius: 5px;
    width: max-content;
    height: max-content;
    text-align: center;
    vertical-align: middle;
    padding: 2px 0px 2px 4px;
    box-shadow: rgba(0, 0, 0, 0.16) 0px 10px 36px 0px, rgba(0, 0, 0, 0.06) 0px 0px 0px 1px;
    display: none;
}

.div-input-role-pos {
    display: inline-block;
    text-align: left;
    line-height: 1;
    padding: 2px 4px;
    background-color: transparent;
    outline: none;
    -webkit-appearance: none;
}

/* é¢œè‰²æ ·å¼ */
.red {
    color: red !important;
}

/* SVG å›¾å½¢åŒºåŸŸ */
.svg-image-area .bi {
    display: none;
}

/************************ ä¸»åº”ç”¨æ ·å¼ end ************************/


/********************** ç¬¬ä¸‰æ–¹ç»„ä»¶æ ·å¼ start *********************/
/* CSS å¼€å…³æ ·å¼ */
/* https://c.runoob.com/codedemo/3146/ */
.switch {
    position: relative;
    display: inline-block;
    width: 40px;
    height: 18px;
}

.switch input {
    display: none;
}

.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    -webkit-transition: .2s;
    transition: .2s;
}

.slider:before {
    position: absolute;
    content: "";
    height: 14px;
    width: 14px;
    left: 3px;
    bottom: 2px;
    background-color: white;
    -webkit-transition: .2s;
    transition: .2s;
}

input:checked+.slider {
    background-color: #2196F3;
}

input:focus+.slider {
    box-shadow: 0 0 1px #2196F3;
}

input:checked+.slider:before {
    -webkit-transform: translateX(20px);
    -ms-transform: translateX(20px);
    transform: translateX(20px);
}

/* Rounded sliders */
.slider.round {
    border-radius: 34px;
}

.slider.round:before {
    border-radius: 50%;
}


/* CSS ä¸‹æ‹‰èœå• */
/* https://c.runoob.com/codedemo/161/ */
.dropbtn {
    color: #2196F3;
    border: none;
    cursor: pointer;
    background: unset;
}

.dropdown {
    position: relative;
    display: inline-block;
}

.dropdown-content {
    display: none;
    position: absolute;
    background-color: #f9f9f9;
    width: max-content;
    box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
    z-index: 2;
}

.dropdown-content a {
    color: black;
    padding: 5px 5px 5px 5px;
    text-decoration: none;
    display: block;
}

.dropdown-content a:hover {
    background-color: #f1f1f1
}

.dropdown:hover .dropdown-content {
    display: block;
}

.dropdown:hover .dropbtn {
    background-color: #3e8e41;
}

.show {
    display: block;
}


/* console.log æ—¥å¿—åŒºåŸŸ */
/* https://blog.csdn.net/ChenX_Web/article/details/99721636 */
#info {
    position: fixed;
    left: 0;
    top: 0;
    width: 100vw;
    height: 60vh;
    background: #fff;
    overflow: scroll;
    font-size: 10px;
    z-index: 999999999;
    -webkit-tap-highlight-color: transparent;
    /* éšè— IEã€Edge å’Œ Firefox çš„æ»šåŠ¨æ¡ */
    -ms-overflow-style: none;
    /* IE and Edge */
    scrollbar-width: none;
    /* Firefox */
}

#info h1 {
    color: #000;
    word-wrap: break-word;
    word-break: normal;
    border-bottom: 1px solid #D3E3FD;
    padding: 2px;
    font-size: 8px;
}

#info h1:nth-child(odd) {
    background-color: #fff;
}

/********************** ç¬¬ä¸‰æ–¹ç»„ä»¶æ ·å¼ end ***********************/
</style>

<template>
    <main id="app-main">
        <!-- canvas å›¾å±‚å®¹å™¨ -->
        <div id="container" ref="container">
            <!--
    å¤šå›¾å±‚æœªæŒ‡å®š z-indexï¼Œåå®šä¹‰çš„å›¾å±‚ä¼šè¦†ç›–å‰é¢å®šä¹‰çš„
    å›¾å±‚é¡ºåºï¼Œä¼šåœ¨æ¸¸æˆè¿‡ç¨‹è°ƒæ•´
    -->
            <!-- scene-graph åœºæ™¯å›¾å½¢å±‚ -->
            <canvas id="game-scene-graph" ref="gameSceneGraph" width="420" height="660"
                style="width: 420px; height: 660px; display: unset;"><!-- é™æ€åœºæ™¯æ›²çº¿å›¾å½¢å±‚ï¼Œå…¨å±ç”»å¸ƒï¼Œåªæ¸²æŸ“ä¸€æ¬¡ -->
                å¦‚æœçœ‹åˆ°è¿™ä¸ªæç¤ºï¼Œè¯´æ˜ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒCanvasï¼Œè¯·å‡çº§æµè§ˆå™¨ç‰ˆæœ¬ï¼Œæˆ–è€…æ›´æ¢å…¶ä»–æµè§ˆå™¨
            </canvas>
            <!-- scene-emoji åœºæ™¯emojiå›¾æ ‡å±‚ -->
            <canvas id="game-scene-emoji" ref="gameSceneEmoji" width="420" height="660"
                style="width: 420px; height: 660px; display: unset;"><!-- é™æ€åœºæ™¯æ™¯ç‰©å›¾å½¢å±‚ï¼Œå…¨å±ç”»å¸ƒï¼Œåªæ¸²æŸ“ä¸€æ¬¡ -->
                Canvas not supported
            </canvas>
            <!-- scene æ¸¸æˆåœºæ™¯å±‚ -->
            <canvas id="game-scene" ref="gameScene" width="420" height="660"
                style="width: 420px; height: 660px;"><!-- é™æ€åœºæ™¯èƒŒæ™¯å±‚ï¼Œåªæ¸²æŸ“ä¸€æ¬¡ï¼Œä¼˜åŒ–CPUæ€§èƒ½ -->
                Canvas not supported
            </canvas>
            <!-- scene-lines åœºæ™¯è¾¹æ¡†å±‚ -->
            <canvas id="game-scene-lines" ref="gameSceneLines" width="420" height="660"
                style="width: 420px; height: 660px; display: unset;"><!-- é™æ€åœºæ™¯åœºåœ°è¾¹æ¡†å±‚ï¼Œå…¨å±ç”»å¸ƒï¼Œåªæ¸²æŸ“ä¸€æ¬¡ -->
                Canvas not supported
            </canvas>
            <!-- scene-coordinate åœºæ™¯åæ ‡å±‚ -->
            <canvas id="game-scene-coordinate" ref="gameSceneCoordinate" width="420" height="660"
                style="width: 420px; height: 660px; display: unset;"><!-- é™æ€åœºæ™¯ç –æ ¼åæ ‡å±‚ï¼Œå…¨å±ç”»å¸ƒï¼Œåªæ¸²æŸ“ä¸€æ¬¡ -->
                Canvas not supported
            </canvas>
            <!-- main è§’è‰²è¿åŠ¨å±‚ -->
            <canvas id="game-main" ref="gameMain" width="420" height="660"
                style="width: 420px; height: 660px;"><!-- ä¸»è¿åŠ¨å±‚ï¼Œæ¯æ¬¡æ¸²æŸ“ä¼šæ¸…ç©ºç”»å¸ƒ -->
                Canvas not supported
            </canvas>
            <!-- main-ball ä¸»è§’è¿åŠ¨å±‚ -->
            <canvas id="game-main-ball" ref="gameMainBall" width="420" height="660"
                style="width: 420px; height: 660px;"><!-- ä¸»çƒï¼ˆä¸»è§’ï¼‰è¿åŠ¨å±‚ï¼Œæ¯æ¬¡æ¸²æŸ“ä¼šæ¸…ç©ºç”»å¸ƒ -->
                Canvas not supported
            </canvas>
            <!-- path è§’è‰²è·¯å¾„å±‚ -->
            <canvas id="game-path" ref="gamePath" width="420" height="660"
                style="width: 420px; height: 660px;"><!-- è§’è‰²ä¸­çº¿è·¯å¾„å±‚ï¼Œæ‰‹åŠ¨æ¸…ç©ºç”»å¸ƒ -->
                Canvas not supported
            </canvas>
            <!-- path-ball ä¸»è§’å…¨è·¯å¾„å±‚ -->
            <canvas id="game-path-ball" ref="gamePathBall" width="420" height="660"
                style="width: 420px; height: 660px;"><!-- è§’è‰²å…¨è·¯å¾„å±‚ï¼Œæ‰‹åŠ¨æ¸…ç©ºç”»å¸ƒ -->
                Canvas not supported
            </canvas>
            <!-- mask è¿åŠ¨é®ç½©å±‚ -->
            <canvas id="game-mask" ref="gameMask" width="420" height="660"
                style="width: 420px; height: 660px;"><!-- é®ç½©å±‚ï¼Œé¿å…è¿åŠ¨æ—¶æ“ä½œå°çƒï¼Œæ‰‹åŠ¨è°ƒæ•´å›¾å±‚é¡ºåº -->
                Canvas not supported
            </canvas>
        </div>
        <!-- å¼¹çª—é®ç½© -->
        <div id="dialog-mask" ref="dialogMask" class="collide-try-dialog"></div>
        <!-- å³ä¸Šè§’è®¾ç½®æç¤º -->
        <div id="game-setting-icon"><span @click="switchUserSettingDialog(true);">&nbsp;&nbsp;&nbsp;&nbsp;</span></div>
        <div id="game-setting-entry-dialog" ref="gameSettingEntryDialog"
            class="collide-try-dialog collide-try-tiny-dialog" style="display: none;">
            <div id="game-setting-entry-dialog-msg" class="collide-try-tiny-dialog-msg">
                å³ä¸Šè§’æœ‰ä¸€ä¸ªéšè—çš„è®¾ç½®<span>âš™</span>å…¥å£å“¦~<span>ğŸ‘‰</span></div>
            <div id="game-setting-entry-dialog-ok" class="collide-try-tiny-dialog-ok"
                @click="closeGameSettingEntryDialog();"><span class="collide-try-dialog-ok">çŸ¥é“å•¦</span></div>
        </div>
        <!-- é€‰æ‹©è§’è‰²å¼¹çª— -->
        <div id="choose-role-dialog" ref="chooseRoleDialog" class="collide-try-dialog">
            <div id="role-list-head">
                <div id="role-list-head-msg">ğŸ‘‡è¯·é€‰æ‹©è§’è‰²</div>
                <div id="role-list-head-setting-icon"><span @click="switchUserSettingDialog(true);">âš™ï¸</span></div>
                <div id="role-list-head-desc">ï¼ˆé‡æ–°æ‰“å¼€é¡µé¢/åˆ·æ–°å³å¯å†æ¬¡é€‰è§’è‰²ï¼‰</div>
            </div>
            <ul id="role-list-area">
                <li id="role-heiwa" class="role-list" @click="chooseRole($event.target, Role.HEIWA.id);">
                    <div class="role-list-icon-name"><span class="role-list-icon">ğŸ¼</span><span
                            class="role-list-name">åœ£å©´å¤§ç‹ï¼ˆé»‘å¨ƒï¼‰</span></div>
                </li>
                <li id="role-jiangjiang" class="role-list" @click="chooseRole($event.target, Role.JIANGJIANG.id);">
                    <div class="role-list-icon-name"><span class="role-list-icon">ğŸ§Ÿâ€â™‚</span><span
                            class="role-list-name">æ³¢æ¯”åƒµåƒµï¼ˆåƒµå°¸ï¼‰</span></div>
                </li>
                <li id="role-duoduo" class="role-list" @click="chooseRole($event.target, Role.DUODUO.id);">
                    <div class="role-list-icon-name"><span class="role-list-icon">ğŸ¥š</span><span
                            class="role-list-name">é£é“ƒæœµæœµï¼ˆæœµæœµï¼‰</span></div>
                </li>
                <li id="role-kuilei" class="role-list" @click="chooseRole($event.target, Role.KUILEI.id);">
                    <div class="role-list-icon-name"><span class="role-list-icon">ğŸ¦Š</span><span
                            class="role-list-name">å‚€å„¡å¨ƒå¨ƒï¼ˆç‹ç‹¸ï¼‰</span></div>
                </li>
                <li id="role-shuangzi" class="role-list" @click="chooseRole($event.target, Role.SHUANGZI.id);">
                    <div class="role-list-icon-name">
                        <span class="role-list-icon">
                            <div id="role-shuangzi-new-draw"><span id="role-shuangzi-1"
                                    class="role-shuangzi-single">ğŸ§â€â™‚ï¸</span><span id="role-shuangzi-2"
                                    class="role-shuangzi-single">ğŸ§</span></div>
                        </span>
                        <span class="role-list-name">æ€ªç›—åŒå­ï¼ˆåŒå­ï¼‰</span>
                    </div>
                </li>
                <li id="role-lele" class="role-list" @click="chooseRole($event.target, Role.LELE.id);">
                    <div class="role-list-icon-name"><span class="role-list-icon">ğŸ¥™</span><span
                            class="role-list-name">å¤ªå¹³ä¹ï¼ˆä¹ä¹ï¼‰</span></div>
                </li>
                <li id="role-huaqianji" class="role-list" @click="chooseRole($event.target, Role.HUAQIANJI.id);">
                    <div class="role-list-icon-name"><span class="role-list-icon">ğŸš€</span><span
                            class="role-list-name">èŠ±åƒæœºï¼ˆç‚®å¼¹ï¼‰</span></div>
                </li>
                <li id="role-youxia" class="role-list" @click="chooseRole($event.target, Role.YOUXIA.id);">
                    <div class="role-list-icon-name"><span class="role-list-icon">ğŸ¹</span><span
                            class="role-list-name">æš—å¤œæ¸¸ä¾ ï¼ˆæ¸¸ä¾ ï¼‰</span></div>
                </li>
                <li id="role-flash" class="role-list" @click="chooseRole($event.target, -2);">
                    <div class="role-list-icon-name"><span class="role-list-icon">âš¡</span><span
                            class="role-list-name">æé€Ÿå¼€å§‹ï¼ˆæ¥å§ï¼‰</span></div>
                </li>
                <li id="role-random" class="role-list" @click="chooseRole($event.target, -1);">
                    <div class="role-list-icon-name"><span class="role-list-icon">ğŸ”€</span><span
                            class="role-list-name">éšä¾¿ç©ç©ï¼ˆå¥½çš„ï¼‰</span></div>
                </li>
            </ul>
        </div>
        <!-- å‚æ•°è®¾ç½®å¼¹çª— -->
        <div id="user-setting-dialog" ref="userSettingDialog" class="collide-try-dialog">
            <div id="user-setting-head">
                <div id="user-setting-head-msg">å‚æ•°è®¾ç½®</div>
                <div id="user-setting-close-icon"><span @click="switchUserSettingDialog(false);">â</span></div>
                <div id="user-setting-head-desc"></div>
            </div>
            <ul id="user-setting-area">
                <li class="user-setting-item" id="user-setting-item-1st">
                    <span class="user-setting-item-msg-left">æ¸¸æˆåœºæ™¯ä¸»é¢˜</span>
                    <span class="user-setting-item-switch-right">
                        <button class="dropbtn" @click="toggleDropdown()" id="sceneThemeMode">é»˜è®¤ä¸»é¢˜</button>
                        <div class="dropdown-content" id="themeDropdown">
                            <!-- a æ ‡ç­¾çš„ href ä¼šè§¦å‘ popstate äº‹ä»¶ -->
                            <a @click="setSceneThemeVal($event.target, 0);">é»˜è®¤ä¸»é¢˜</a>
                            <!-- <a @click="setSceneThemeVal($event.target, 2);">æ–°å¹´ä¸»é¢˜</a> -->
                            <a @click="setSceneThemeVal($event.target, 3);">ç”°å›­ä¸»é¢˜</a>
                            <a @click="setSceneThemeVal($event.target, 5);">å¤æ—¥ä¸»é¢˜</a>
                            <a @click="setSceneThemeVal($event.target, 4);">æ˜Ÿé™…ä¸»é¢˜</a>
                            <a @click="setSceneThemeVal($event.target, 1);">å†°é›ªä¸»é¢˜</a>
                        </div>
                    </span>
                </li>
                <li class="user-setting-item">
                    <span class="user-setting-item-msg-left">ä¸»è§’æ‰€åœ¨é˜Ÿé¢œè‰²</span>
                    <span class="user-setting-item-switch-right">
                        <button class="dropbtn red" @click="toggleTeamColor()" id="mainTeamColor">çº¢è‰²</button>
                    </span>
                </li>
                <li class="user-setting-item">
                    <span class="user-setting-item-msg-left">åªç”¨ä¸€ä¸ªè§’è‰²æµ‹è¯•</span>
                    <span class="user-setting-item-switch-right">
                        <label class="switch" @click="switchCheckbox($event, 'isTestOnlyOne');">
                            <input type="checkbox" id="isTestOnlyOne">
                            <div class="slider round"></div>
                        </label>
                    </span>
                </li>
                <li class="user-setting-item">
                    <span class="user-setting-item-msg-left">æ˜¾ç¤ºè§’è‰²è¿åŠ¨è·¯å¾„</span>
                    <span class="user-setting-item-switch-right">
                        <label class="switch" @click="switchCheckbox($event, 'isShowBallMovePath');">
                            <input type="checkbox" id="isShowBallMovePath">
                            <div class="slider round"></div>
                        </label>
                    </span>
                </li>
                <li class="user-setting-item">
                    <span class="user-setting-item-msg-left">æ˜¾ç¤ºè§’è‰²æœ¬ä½“è·¯å¾„</span>
                    <span class="user-setting-item-switch-right">
                        <label class="switch" @click="switchCheckbox($event, 'isShowBallPath');">
                            <input type="checkbox" id="isShowBallPath">
                            <div class="slider round"></div>
                        </label>
                    </span>
                </li>
                <li class="user-setting-item">
                    <span class="user-setting-item-msg-left">åªç„å‡†ä¸æ‰“</span>
                    <span class="user-setting-item-switch-right">
                        <label class="switch" @click="switchCheckbox($event, 'isJustTrying');">
                            <input type="checkbox" id="isJustTrying">
                            <div class="slider round"></div>
                        </label>
                    </span>
                </li>
                <li class="user-setting-item">
                    <span class="user-setting-item-msg-left">ç¢°åˆ°è§’è‰²å³åœæ­¢</span>
                    <span class="user-setting-item-switch-right">
                        <label class="switch" @click="switchCheckbox($event, 'isStopAfterCollided');">
                            <input type="checkbox" id="isStopAfterCollided">
                            <div class="slider round"></div>
                        </label>
                    </span>
                </li>
                <li class="user-setting-item">
                    <span class="user-setting-item-msg-left">ç¢°å¢™ä¸¤æ¬¡å³åœæ­¢</span>
                    <span class="user-setting-item-switch-right">
                        <label class="switch" @click="switchCheckbox($event, 'isStopAfter2WallCollided');">
                            <input type="checkbox" id="isStopAfter2WallCollided">
                            <div class="slider round"></div>
                        </label>
                    </span>
                </li>
                <li class="user-setting-item">
                    <span class="user-setting-item-msg-left">åªæ˜¾ç¤ºæ’å‡»å°é¢</span>
                    <span class="user-setting-item-switch-right">
                        <label class="switch" @click="switchCheckbox($event, 'isJustShowTable');">
                            <input type="checkbox" id="isJustShowTable">
                            <div class="slider round"></div>
                        </label>
                    </span>
                </li>
                <li class="user-setting-item">
                    <span class="user-setting-item-msg-left">æ˜¾ç¤ºåœºæ™¯å›¾å½¢</span>
                    <span class="user-setting-item-switch-right">
                        <label class="switch" @click="switchCheckbox($event, 'isShowSceneGraph');">
                            <input type="checkbox" id="isShowSceneGraph">
                            <div class="slider round"></div>
                        </label>
                    </span>
                </li>
                <li class="user-setting-item">
                    <span class="user-setting-item-msg-left">æ˜¾ç¤ºå°é¢è¾¹æ¡†</span>
                    <span class="user-setting-item-switch-right">
                        <label class="switch"
                            @click="switchCheckbox($event, 'isShowTableBorder', { canvasEle: gameSceneLinesCanvas });">
                            <input type="checkbox" id="isShowTableBorder">
                            <div class="slider round"></div>
                        </label>
                    </span>
                </li>
                <li class="user-setting-item">
                    <span class="user-setting-item-msg-left">æ˜¾ç¤ºç –æ ¼åæ ‡</span>
                    <span class="user-setting-item-switch-right">
                        <label class="switch"
                            @click="switchCheckbox($event, 'isShowGridCoordinate', { canvasEle: gameSceneCoordinateCanvas });">
                            <input type="checkbox" id="isShowGridCoordinate">
                            <div class="slider round"></div>
                        </label>
                    </span>
                </li>
                <li class="user-setting-item">
                    <span class="user-setting-item-msg-left">æ˜¾ç¤ºè§’è‰²è¡€é‡æ¡</span>
                    <span class="user-setting-item-switch-right">
                        <label class="switch" @click="switchCheckbox($event, 'isShowRoleBloodLine');">
                            <input type="checkbox" id="isShowRoleBloodLine">
                            <div class="slider round"></div>
                        </label>
                    </span>
                </li>
                <li class="user-setting-item">
                    <span class="user-setting-item-msg-left">å‚€å„¡æ‹‰å›</span>
                    <span class="user-setting-item-switch-right">
                        <label class="switch" @click="switchCheckbox($event, 'isKuileiPullBack');">
                            <input type="checkbox" id="isKuileiPullBack">
                            <div class="slider round"></div>
                        </label>
                    </span>
                </li>
                <li class="user-setting-item">
                    <span class="user-setting-item-msg-left">ç„å‡†ç©¿é€</span>
                    <span class="user-setting-item-switch-right">
                        <label class="switch" @click="switchCheckbox($event, 'isPiercesTry');">
                            <input type="checkbox" id="isPiercesTry">
                            <div class="slider round"></div>
                        </label>
                    </span>
                </li>
                <li class="user-setting-item">
                    <span class="user-setting-item-msg-left">ç„å‡†æ˜¾ç¤ºè·¯å¾„</span>
                    <span class="user-setting-item-switch-right">
                        <label class="switch" @click="switchCheckbox($event, 'isShowTryFullPath');">
                            <input type="checkbox" id="isShowTryFullPath">
                            <div class="slider round"></div>
                        </label>
                    </span>
                </li>
                <li class="user-setting-item">
                    <span class="user-setting-item-msg-left">åŒå‡»å±å¹•å›é€€</span>
                    <span class="user-setting-item-switch-right">
                        <label class="switch" @click="switchCheckbox($event, 'isDbclickBack');">
                            <input type="checkbox" id="isDbclickBack">
                            <div class="slider round"></div>
                        </label>
                    </span>
                </li>
                <li class="user-setting-item">
                    <span class="user-setting-item-msg-left">é•¿æŒ‰é‡ç½®è§’è‰²ä½ç½®</span>
                    <span class="user-setting-item-switch-right">
                        <label class="switch" @click="switchCheckbox($event, 'isLongPressRandom');">
                            <input type="checkbox" id="isLongPressRandom">
                            <div class="slider round"></div>
                        </label>
                    </span>
                </li>
                <li class="user-setting-item">
                    <span class="user-setting-item-msg-left">æ˜¾ç¤ºè§’è‰²åæ ‡(å•ä½ï¼šæ ¼)</span>
                    <span class="user-setting-item-switch-right">
                        <label class="switch" @click="switchCheckbox($event, 'isShowRoleMovePos');">
                            <input type="checkbox" id="isShowRoleMovePos">
                            <div class="slider round"></div>
                        </label>
                    </span>
                </li>
                <li class="user-setting-item">
                    <span class="user-setting-item-msg-left">åˆ†äº«/å¯¼å…¥è§’è‰²åŠåæ ‡</span><span class="reset-btn"
                        @click="resetShareContent(this);" title="é‡ç½®åˆ†äº«"> ğŸ”„ </span>
                    <div class="user-setting-item-input-area in-one-line">
                        <input type="text" id="shareRoleAndPos" value="" maxlength="1000"
                            placeholder="ç²˜è´´å†…å®¹åç‚¹å‡»å¯¼å…¥ï¼Œåˆ·æ–°é¡µé¢ç”Ÿæ•ˆ">
                        <button class="collide-try-btn bg-lv1" id="rpShareCopy" @click="copyShareContent();">å¤åˆ¶</button>
                        <button class="collide-try-btn bg-lv2" id="rpShareImport" @click="importShareContent();"
                            style="display: none;">å¯¼å…¥</button>
                    </div>
                </li>
                <li class="user-setting-item">
                    <span class="user-setting-item-msg-left">æŒ‡å®šæ¸¸æˆè§’è‰²(è¾“å…¥è§’è‰²å)</span><span class="reset-btn"
                        @click="resetGameRoleIds(this);" title="é‡ç½®è§’è‰²"> ğŸ”„ </span>
                    <div class="user-setting-item-input-area">
                        <div class="div-input-game-roles default red" contenteditable="true" id="gameRoleId1"
                            placeholder="è¾“å…¥ä¸»è§’" value="">è¾“å…¥ä¸»è§’</div>
                        <div class="div-input-game-roles default red" contenteditable="true" id="gameRoleId2"
                            placeholder="è¾“å…¥é˜Ÿå‹" value="">è¾“å…¥é˜Ÿå‹</div>
                        <div class="div-input-game-roles default" contenteditable="true" id="gameRoleId3"
                            placeholder="è¾“å…¥å¯¹æ‰‹1" value="">è¾“å…¥å¯¹æ‰‹1</div>
                        <div class="div-input-game-roles default" contenteditable="true" id="gameRoleId4"
                            placeholder="è¾“å…¥å¯¹æ‰‹2" value="">è¾“å…¥å¯¹æ‰‹2</div>
                        <div id="game-setting-main-role-dialog" class="collide-try-dialog collide-try-tiny-dialog"
                            style="display: none;">
                            <div id="game-setting-main-role-dialog-msg" class="collide-try-tiny-dialog-msg">
                                ğŸ‘†ä¸»è§’è®¾ç½®åªåœ¨<span>ã€æé€Ÿå¼€å§‹ã€‘</span>é€‰é¡¹ç”Ÿæ•ˆå“¦~</div>
                            <div id="game-setting-main-role-dialog-ok" class="collide-try-tiny-dialog-ok"
                                @click="closeGameSettingMainRoleDialog();"><span
                                    class="collide-try-dialog-ok">å¥½çš„å§</span></div>
                        </div>
                    </div>
                </li>
                <li class="user-setting-item">
                    <span class="user-setting-item-msg-left">è§’è‰²åŠ é€Ÿæˆ–å‡é€Ÿ(-20~200)</span>
                    <div class="user-setting-item-input-area">
                        <input type="text" id="roleSpeedAddVal" value="0" maxlength="3">
                    </div>
                </li>
                <li class="user-setting-item" style="display: none;">
                    <span class="user-setting-item-msg-left">å¡é¡¿è‡ªåŠ¨æ¢å¤ç­‰å¾…æ—¶é—´(å•ä½ï¼šç§’)</span>
                    <div class="user-setting-item-input-area">
                        <input type="text" id="animateAutoRestTime" value="20" maxlength="100">
                    </div>
                </li>
                <li class="user-setting-item">
                    <span class="user-setting-item-msg-left">æ–œè¾¹å€¾æ–œåå·®(å•ä½ï¼šæ ¼)</span>
                    <div class="user-setting-item-input-area">
                        <input type="text" id="wan8CocosTableMoveVals" value="0" maxlength="100">
                    </div>
                </li>
                <li class="user-setting-item" id="collide-try-save-html" @click="saveRemoteHtml(this);">
                    <span class="user-setting-item-msg-left">ä¸‹è½½ç¦»çº¿ç‰ˆ</span>
                </li>
                <li class="user-setting-item" @click="resetUserSettings()">
                    <span class="user-setting-item-msg-left">æ¢å¤é»˜è®¤è®¾ç½®</span>
                </li>
                <li class="user-setting-item" @click="switchDialogShow(aboutAppDialog, true, { display: 'unset' });">
                    <span class="user-setting-item-msg-left">å…³äºåº”ç”¨</span>
                </li>
                <li class="user-setting-item">&nbsp;&nbsp;</li>
            </ul>
        </div>

        <!-- æ›´æ–°æç¤ºå¼¹çª— -->
        <div id="collide-try-update-content-dialog" ref="collideTryUpdateContentDialog"
            class="collide-try-dialog collide-try-close-btn-dialog">
            <div id="collide-try-update-content-close-icon" class="collide-try-close-btn-dialog-title-close">
                <span @click="showUpdateContent(false);">â</span>
            </div>
            <div id="collide-try-update-content-title"
                class="each-item-border-bottom collide-try-close-btn-dialog-title">
                <b id="update-content-title">ğŸ†• åº”ç”¨æ›´æ–°</b>
            </div>
            <div id="collide-try-update-content" class="collide-try-close-btn-dialog-content">

            </div>
        </div>

        <!-- æ“ä½œæŒ‡å—å¼¹çª— -->
        <div id="collide-try-how-to-play-dialog" class="collide-try-dialog collide-try-close-btn-dialog">
            <div class="collide-try-close-btn-dialog-title-close" style="display: none;">
                <span @click="showHowToPlay(false);">â</span>
            </div>
            <div id="collide-try-how-to-play-title" class="each-item-border-bottom collide-try-close-btn-dialog-title">
                <b>ğŸ‘‡ æ“ä½œæŒ‡å—</b><span>ï¼ˆå…ˆè¿™æ ·å†é‚£æ ·ğŸ¤ªï¼‰</span>
            </div>
            <div id="collide-try-how-to-play-content" class="collide-try-close-btn-dialog-content">
                <pre>
                â‘  æ‹–åŠ¨è§’è‰²æ‘†å¥½ä½ç½®
                â‘¡ å†æ‹–åŠ¨ä¸»è§’ç„å‡†ï¼Œæ¾æ‰‹å¼€æ‰“
                â‘¢ è®¾ç½®é‡Œé¢å¯ä»¥æŒ‡å®šä»»æ„è§’è‰²å“¦~
                </pre>
            </div>
            <div class="collide-try-close-btn-dialog-ok" @click="showHowToPlay(false);">
                <span class="collide-try-dialog-ok">æœ•çŸ¥é“äº†</span>
            </div>
        </div>

        <!-- è§’è‰²åæ ‡æ‚¬æµ®æ¡ -->
        <div id="collide-try-role-pos-line" ref="collideTryRolePosLine"
            class="collide-try-dialog collide-try-role-pos-line-font">
            <b class="collide-try-role-pos-line-font">X</b> :<div
                class="div-input-role-pos collide-try-role-pos-line-font" contenteditable="false" id="rolePosX"
                placeholder="0.00" value="">
                0.00
            </div>
            <b class="collide-try-role-pos-line-font">Y</b> :<div
                class="div-input-role-pos collide-try-role-pos-line-font" contenteditable="false" id="rolePosY"
                placeholder="0.00" value="">
                0.00
            </div>
        </div>

        <!-- å…³äºåº”ç”¨å¼¹çª— -->
        <div id="user-setting-about-app-dialog" ref="userSettingAboutAppDialog" class="collide-try-dialog">
            <div id="user-setting-about-app-close-icon" style="display: none;"><span
                    @click="switchDialogShow(aboutAppDialog, false);">â</span></div>
            <div id="user-setting-about-app-title" class="each-item-border-bottom">
                <b id="about-app-title">
                    <span @click="switchDialogShow(aboutAppDialog, false);"><svg t="1709376528064" class="icon"
                            viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="8794"
                            width="20" height="20">
                            <path d="M512 959.68L640 896 320 576h640v-128H320L640 128l-128-63.68L64.32 512z"
                                fill="#2c2c2c" p-id="8795"></path>
                        </svg></span>
                    å…³äºåº”ç”¨
                </b>
            </div>
            <div id="user-setting-about-app-content">
                <pre>
<b class="collide-try-app-full-name">ç©å§-æ’å‡»ç‹è€…-è§’è‰²è§’åº¦ç»ƒä¹ å™¨</b>
<b>ğŸ‘¨â€ğŸ’» Author: THeLiGht_ Group</b>
<b>ğŸ“§ Contact: m1yellow@163.com</b>

1ï¸âƒ£ ç›®å‰æ”¯æŒä¸€ä¸ªä¸»æ‰“è§’è‰²ã€ä¸‰ä¸ªè¾…åŠ©è§’è‰²ï¼Œä¸»è¦é€‚ç”¨äºé»‘å¨ƒã€åƒµåƒµã€æœµæœµã€å‚€å„¡ã€åŒå­ã€å¤ªå¹³ä¹ç­‰è§’è‰²ã€è§’åº¦ã€å’Œã€èµ°ä½ã€ç»ƒä¹ 
2ï¸âƒ£ è¡€é‡æ¡ä»…ç”¨æ¥åŒºåˆ†é˜Ÿä¼ï¼Œå› ä¸ºè¡€é‡ä¼¤å®³ä½“ç³»å¾ˆå¤æ‚ï¼Œç›®å‰ä¸è€ƒè™‘å»å®ç°
3ï¸âƒ£ è§’è‰²è¿åŠ¨é€Ÿåº¦å’Œè·ç¦»å¯èƒ½å’Œå®æˆ˜æœ‰ä¸€å®šå·®è·ï¼Œåšåˆ°ä¸€æ¨¡ä¸€æ ·å¾ˆéš¾
4ï¸âƒ£ å¯èƒ½å­˜åœ¨ä¸ªåˆ«è§’åº¦ï¼ˆç¢°å¢™è§’ï¼‰åå¼¹æœ‰ç‚¹é—®é¢˜ï¼Œè¯·ä»¥å®æˆ˜æ•°æ®ä¸ºå‡†
5ï¸âƒ£ å…¼å®¹æ‰‹æœºã€å¹³æ¿ã€ç”µè„‘æµè§ˆå™¨


<b class="each-item-border-bottom">ğŸ†• V4.2.2 æ›´æ–°ï¼š</b>
<pre id="collide-try-about-app-update-newest">
1. æ–°å¢äº†ã€æ“ä½œæŒ‡å—ã€‘è¯´æ˜ï¼Œé¦–æ¬¡è¿›å…¥æ¸¸æˆæ—¶æç¤º
2. è°ƒæ•´äº†åŒå­å›¾æ ‡ï¼ˆæœ‰æ˜¾ç¤ºé—®é¢˜å¯ä»¥åé¦ˆä¸€ä¸‹ï¼‰
3. æ›´æ–°äº†ã€å…³äºåº”ç”¨ã€‘å†…å®¹
</pre>
                <b class="each-item-border-bottom">V4.2.1 æ›´æ–°ï¼š</b>
                1. æ–°å¢äº†ã€ç„å‡†ç©¿é€ã€‘å¼€å…³ï¼Œå¼¥è¡¥å‚€å„¡ã€åƒµå°¸ç­‰å¯ç©¿é€è§’è‰²ç„å‡†æ—¶çš„æµç•…çµæ•åº¦
                2. è¡¥å…¨è§’è‰²å½•å…¥ï¼ˆ62ä¸ªï¼‰

                <b class="each-item-border-bottom">V4.2.0 æ›´æ–°ï¼š</b>
                1. æ–°å¢äº†ã€å¤æ—¥ä¸»é¢˜ã€‘
                2. ä¸»é¢˜æ¨¡å¼éšå­£èŠ‚è‡ªåŠ¨åˆ‡æ¢
                3. è¡¥å…¨è§’è‰²å½•å…¥ï¼ˆ61ä¸ªï¼‰

                <b class="each-item-border-bottom">V4.1.5 æ›´æ–°ï¼š</b>
                1. æ–°å¢äº†ã€æ˜¾ç¤ºè§’è‰²è¿åŠ¨è·¯å¾„ã€‘å¼€å…³åŠŸèƒ½
                2. ä¿®å¤äº†ç§»åŠ¨ç«¯å¤šç‚¹è§¦ç¢°å¯èƒ½å‡ºç°å¡æ­»çš„é—®é¢˜
                3. åŠ å…¥äº†è¶…æ—¶è‡ªåŠ¨ç»“æŸï¼ˆé»˜è®¤20ç§’ï¼‰ï¼Œé¿å…ç¨‹åºä¸€ç›´å¡æ­»æ¶ˆè€—æ€§èƒ½
                4. ã€ä¿å­˜ç¦»çº¿ç‰ˆã€‘ï¼ˆä¸ç”¨è”ç½‘ï¼‰æ”¹ä¸ºã€ä¸‹è½½ç¦»çº¿ç‰ˆã€‘ï¼ˆè¦è”ç½‘ï¼Œæ›´å¯é ï¼‰
                5. å†…ç½®äº†è®¿é—®å¯†é’¥ï¼Œç›®å‰ä¸ç”¨è¾“å…¥å¯†é’¥éƒ½å¯ä»¥ç©äº†
                6. è¿˜åœ¨é€€æ¸¸ä¸­ï¼Œç©å‹ä»¬çé‡å‹¿å¿µå“ˆ

                <b class="each-item-border-bottom">V4.1.4 æ›´æ–°ï¼š</b>
                1. å…¼å®¹é€‚é…å¹³æ¿æµè§ˆå™¨
                2. è§’è‰²å›¾æ ‡ã€åœºæ™¯ä¸»é¢˜å›¾å½¢å¤§å°è°ƒæ•´
                3. åŠ å…¥äº†ã€å‘Šåˆ«ã€ä¿¡æ¯ï¼Œé€€æ¸¸ä¸€æ®µæ—¶é—´

                <b class="each-item-border-bottom">V4.1.3 æ›´æ–°ï¼š</b>
                1. æ–°å¢äº†ã€æ˜¾ç¤ºè§’è‰²åæ ‡ã€‘åŠŸèƒ½
                2. æ–°å¢äº†ã€åˆ†äº«/å¯¼å…¥è§’è‰²åŠåæ ‡ã€‘åŠŸèƒ½

                <b class="each-item-border-bottom">V4.1.2 æ›´æ–°ï¼š</b>
                1. ç¦»çº¿ç‰ˆè°ƒæ•´ä¸ºä¸éœ€è¦è¾“å…¥è®¿é—®å¯†é’¥
                2. æ–°å¢äº†åˆ‡æ¢ã€ä¸»è§’æ‰€åœ¨é˜Ÿé¢œè‰²ã€‘åŠŸèƒ½
                3. ä¼˜åŒ–äº†ã€åªæ˜¾ç¤ºæ’å‡»å°é¢ã€‘ã€ã€æ˜¾ç¤ºåœºæ™¯å›¾å½¢ã€‘å¼€å…³ï¼Œå…åˆ·æ–°é¡µé¢

                <b class="each-item-border-bottom">V4.1.1 æ›´æ–°ï¼š</b>
                1. æ–°å¢äº†ã€æ˜¾ç¤ºç –æ ¼åæ ‡ã€‘åŠŸèƒ½
                2. æ–°å¢äº†ã€é•¿æŒ‰é‡ç½®è§’è‰²ä½ç½®ã€‘åŠŸèƒ½
                3. ä¼˜åŒ–äº†ã€æ˜¾ç¤ºå°é¢è¾¹æ¡†ã€‘ã€ã€æ˜¾ç¤ºç –æ ¼åæ ‡ã€‘å¼€å…³ï¼Œå…åˆ·æ–°é¡µé¢

                <b class="each-item-border-bottom">V4.1.0 æ›´æ–°ï¼š</b>
                1. æ–°å¢äº†ã€ç„å‡†æ˜¾ç¤ºè·¯å¾„ã€‘åŠŸèƒ½
                2. ä¿®å¤äº†ã€åªç„å‡†ä¸æ‰“ã€‘æ—¶çš„æ‹–åŠ¨é—®é¢˜
                3. åŠ å…¥äº†æ›´æ–°æç¤º
                4. ä¼˜åŒ–äº†æ‹–åŠ¨ã€ç„å‡†æ—¶çš„åŠ¨ç”»æ¸²æŸ“ï¼Œå‡å°‘æ€§èƒ½æ¶ˆè€—

                <b class="each-item-border-bottom">V4.0.3 æ›´æ–°ï¼š</b>
                1. å®ç°äº†å‚€å„¡æ‹‰å›åŠŸèƒ½
                2. æ–°å¢äº†å¤ªå¹³ä¹ç»ƒä¹ é€‰é¡¹

                <b class="each-item-border-bottom">V4.0.2 æ›´æ–°ï¼š</b>
                1. ä¿®å¤äº†åƒµå°¸ã€å‚€å„¡ç„å‡†æ—¶ç©¿é€é—®é¢˜
                2. å®ç°äº†ç”µéŸ³çªç ´åŠ é€Ÿæ•ˆæœ
                3. åŠ å…¥äº†è®¿é—®å¯†é’¥ï¼ˆç©å‹ç§èŠè·å–å³å¯å“¦ï¼‰

                <b class="each-item-border-bottom">V4.0.1 æ›´æ–°ï¼š</b>
                1. æ–°å¢ã€ä¿å­˜ç¦»çº¿ç‰ˆã€‘åŠŸèƒ½
                2. è®¾ç½®ä¸»è§’æ—¶ï¼Œæç¤ºä½¿ç”¨ã€æé€Ÿå¼€å§‹ã€‘æ‰ç”Ÿæ•ˆ

                <b class="each-item-border-bottom">V4.0.0 æ›´æ–°ï¼š</b>
                1. å¯ä»¥åœ¨è®¾ç½®é‡Œé¢æŒ‡å®šä»»æ„è§’è‰²
                2. æ–°å¢ã€åŒå‡»å±å¹•å›é€€ã€‘é‡æ‰“åŠŸèƒ½
                3. æ¸¸æˆç•Œé¢å³ä¸Šè§’åŠ å…¥éšå½¢è®¾ç½®æŒ‰é’®ï¼Œå¤šé¡¹è®¾ç½®ä¸ç”¨åˆ·æ–°é¡µé¢
                4. æ–°å¢ã€å…³äºåº”ç”¨ã€‘ä¿¡æ¯
                5. è§’è‰²åŠ¨ç”»åˆ†å±‚ä¼˜åŒ–ï¼Œå‡å°‘æ€§èƒ½æ¶ˆè€—

                <b class="each-item-border-bottom">ğŸ”— å‚è€ƒæ–‡ç« ï¼š</b>
                <a target="_blank"
                    href="https://www.kai666666.com/2020/07/28/Canvas%E7%B3%BB%E5%88%97%EF%BC%8814%EF%BC%89%EF%BC%9A%E5%AE%9E%E6%88%98-%E5%B0%8F%E7%90%83%E7%A2%B0%E6%92%9E/">Canvasç³»åˆ—ï¼ˆ14ï¼‰ï¼šå®æˆ˜-å°çƒç¢°æ’</a><a
                    target="_blank" href="https://cloud.tencent.com/developer/article/1722313"> â‘¡ </a>
                <a target="_blank"
                    href="https://www.kai666666.com/2020/08/04/Canvas%E7%B3%BB%E5%88%97%EF%BC%8816%EF%BC%89%EF%BC%9A%E5%AE%9E%E6%88%98-%E5%B0%8F%E7%90%83%E4%B8%8E%E6%96%9C%E9%9D%A2%E7%A2%B0%E6%92%9E/">Canvasç³»åˆ—ï¼ˆ16ï¼‰ï¼šå®æˆ˜-å°çƒä¸æ–œé¢ç¢°æ’</a><a
                    target="_blank" href="https://cloud.tencent.com/developer/article/1720496"> â‘¡ </a>
                <a target="_blank" href="https://www.w3cschool.cn/xjmuw/xjmuw-ymch25y5.html">canvasåŠ¨ç”»åŒ…æ•™ä¸åŒ…ä¼šï¼šåæ ‡æ—‹è½¬å’Œæ–œé¢åå¼¹</a>
                <a target="_blank" href="https://juejin.cn/post/7016972355956113439">ä½¿ç”¨canvasåˆ¶ä½œä¸€ä¸ªå°çƒç¢°æ’æ¨¡å‹</a>

                </pre>

                <br><br>
                <div id="collide-try-bye-reason" class="collide-try-goodbye">
                    <pre>
<b class="each-item-border-bottom">å‡ ä¸ªæ¸¸æˆå…¬å¹³å»ºè®®ï¼š</b>
â‘  å¼€å±€åœ¨é€‰æ‹©è§’è‰²æ¡†ä¸‹æ–¹åŠ å…¥â€œçŸ³å¤´å‰ªåˆ€å¸ƒâ€é€‰é¡¹ï¼Œè°èµ¢è°å…ˆæ‰‹ï¼ç³»ç»Ÿä¸è¦å¸®é€‰ï¼Œä¸é€‰åˆ™åæ‰‹ï¼Œé€‰å®Œåœ¨æ¸¸æˆç•Œé¢å…¬ç¤ºï¼
â‘¡ 1å·ä½å…ˆæ‰“ï¼Œ2å·ä½åæ‰“ï¼Œäº¤ç»™ç©å®¶è‡ªå·±å†³å®šï¼Œç©å®¶å°±æƒ³1å·ä½å…ˆæ‰“å°±è¿™ä¹ˆéš¾ï¼Ÿ
â‘¢ å¼€å±€è§’è‰²ä½ç½®ã€ğŸŒ¿ã€ğŸ’£ã€ğŸ„ ç­‰é™·é˜±ä½ç½®ï¼Œè¯·å®Œå…¨éšæœºï¼å“ªæœ‰é‚£ä¹ˆå·§å°±åˆšå¥½ç»™ç›´çº¿ï¼Ÿ
â‘£ åŠ å…¥ã€å…è®¸å‘è¨€äº¤æµã€å‹¾é€‰æ¡†ï¼Œåªè¦æœ‰ä¸€ä¸ªç©å®¶ä¸å‹¾é€‰ï¼Œå°±ä¸èƒ½å‘è¨€å’Œå‘è¡¨æƒ…ï¼
â‘¤ åŠ å…¥ã€Šæ’ç‹ç­‰çº§èµ„æ ¼è¯ã€‹æœºåˆ¶ï¼Œæ ¹æ®ä¸Šä¸€ä¸ªèµ›å­£å’Œå½“å‰èµ›å­£æœ€é«˜æ®µä½è‡ªåŠ¨åŒºåˆ†ï¼Œå¤§å¥–èµ›ã€å¤§å¸ˆã€‘ä»¥ä¸‹æ®µä½åŠ å…¥æ’ç‹ç­‰çº§åŒ¹é…è§„åˆ™ï¼Œé¿å… 20ã€30 å¤šçº§çš„ç©å®¶é¢‘ç¹å¯¹é˜µæ»¡çº§å¤§ä½¬è¢«æ°”èµ°ï¼ç•™ä½æ–°ç”¨æˆ·æ‰æœ‰å¾— â­• å•Šï¼[ç‹—å¤´]
â‘¥ ä¸­å¥–æ¦‚ç‡æœ‰åçˆ±å°±ä¸æäº†ï¼å›é¦ˆè¡£é£Ÿçˆ¶æ¯ä¹Ÿæ²¡é”™ ğŸ‘Œ

ä½ åœ¨æ•™æˆ‘åšäº‹ï¼Ÿ
æ¸¸æˆå…¬å¹³ï¼ç©çš„äººæ›´å¤šï¼æ ¼å±€æ‰“å¼€ï¼


<b class="each-item-border-bottom">ä¸å…¬å¹³ï¼BUGå¤ªå¤šï¼å¤ªæµªè´¹æ—¶é—´ç²¾åŠ›ï¼</b>
â€¢ ç‰ºç‰²å…¬å¹³æ¢åˆ©ç›Šï¼Œå®åœ¨æ˜¯ç©ä¸è¿‡ï¼æ¯å¤©éƒ½ä¼šè¢«ä¸å…¬å¹³å’Œå„ç§BUGæ°”ç‚¸ï¼ï¼ˆè¶Šæ˜¯åœ¨ä¹ï¼Œçœ‹å¾—è¶Šæ¸…ï¼Œå°±ä¼šè¶Šæ°”ï¼‰

â€¢ å·¥ä½œã€ç”Ÿæ´»å·²ç»å¤Ÿç´¯äº†ï¼Œè¿˜è¦æ¯”æ¥æ¯”å»ï¼æ¸¸æˆå¨±ä¹æ”¾æ¾äº†ä¸ªå•¥ï¼Ÿæ¸¸æˆç¤¾äº¤çœŸçš„èƒ½äº¤åˆ°å¥½æœ‹å‹æˆ–å¥”ç°å¯¹è±¡ï¼Ÿ

â€¢ 40çº§ä»¥ä¸‹ï¼ŒæŠ€å·§ä¸å¤Ÿã€æ²¡è§’è‰²æˆ–è€…åªæœ‰æ ‡é…ç»„åˆï¼Œå¾ˆéš¾æ‰“èµ¢é«˜é…ç»„åˆï¼Œå¤§æ¦‚ç‡ç™½é€ï¼›40çº§ä»¥ä¸Šï¼Œå‡ ä¹éƒ½æ˜¯é«˜é…ï¼Œå…ˆæ‰‹å’Œå¼€å±€ä½ç½®è‡³å…³é‡è¦ï¼Œä¸¤å±€ç”šè‡³ä¸‰å±€ä¸ç»™å…ˆæ‰‹ï¼Œå¤§æ¦‚ç‡è¿è·ªï¼å…ˆæ‰‹å’Œå¼€å±€å¥½ä½ç½®ç»™è°ï¼Œæ‡‚çš„éƒ½æ‡‚ï¼


<b class="each-item-border-bottom">æ‰€ä»¥å‘¢ï¼Ÿè¿˜ç©å—ï¼Ÿ</b>
â€¢ <b>æ¸…æ¥šè‡ªå·±ä¸ºä»€ä¹ˆç©è¿™ä¸ªæ¸¸æˆï¼</b>ä¸å…¬å¹³çš„äº‹æƒ…å¤šäº†å»äº†ï¼æ€•æµªè´¹æ—¶é—´ç²¾åŠ›å°±å‡å°‘åšä»»åŠ¡/å†²åˆ†çš„å±€æ•°ï¼Œæˆ–è€…è·Ÿå¥½å‹è¿‡ä¸€ä¸‹æ—¥å¸¸ä»»åŠ¡ã€åˆ‡ç£‹å‡ å±€ç»ƒä¹ è§’è‰²æŠ€å·§ï¼Œå†æˆ–è€…æ¯å¤©ç™»å½•ç­¾åˆ°å°±è¡Œäº†ï¼

â€¢ <b>ç›®æ ‡æ®µä½æœŸæœ›å¤ªé«˜ä¼šç©å¾—å¾ˆç´¯ï¼</b>è§’è‰²æ­é…æ²¡å‡‘é½é«˜é…ï¼Œæ’å‡»æŠ€å·§ï¼ˆè§’åº¦ã€è¿å‡»ã€è½ç‚¹ï¼‰ç†Ÿç»ƒåº¦ä¸å¤Ÿï¼ˆè§’è‰² > æŠ€å·§ = è¿æ°”[æ°ªé‡‘]ï¼‰ï¼Œé‡åˆ°æ»¡çº§å¤§ä½¬æˆ–è€…çªç ´&é«˜é…ç»„åˆç¡®å®å¾ˆéš¾èµ¢ï¼ˆæ¯•ç«Ÿä»–ä»¬å·²ç»ç©äº†å‡ å¹´äº†ï¼‰ï¼å¾ˆå¤š 20ã€30 å¤šçº§çš„ç©å®¶å¤§å¥–èµ›é¢‘ç¹å¯¹é˜µæ»¡çº§å¤§ä½¬ï¼Œè¾“åˆ°æ€€ç–‘äººç”Ÿï¼Œæ²¡æŒºè¿‡è¿™æ®µè‰°éš¾çš„ç“¶é¢ˆæœŸå°±æ°”åˆ°ã€æ³¨é”€ã€‘äº†ï¼

â€¢ <b>å¤§å¥–èµ›â€œæ—¥ä¸‰â€ï¼Œåå±€å®Œä¸æˆå°±æ”¾ä¸‹å§ï¼</b>å¹³å‡ä¸€å¤§å±€ï¼ˆ3å°å±€ï¼‰7 åˆ†é’Ÿï¼Œ10 å±€å°±ä¸€ä¸ªå¤šå°æ—¶ï¼Œ20 å±€ä¸¤å°æ—¶ä»¥ä¸Šï¼Œæ¯å¤©å‡ ä¸ªå°æ—¶ç©æ¸¸æˆæ˜¯æŒºå¥¢ä¾ˆçš„äº†ï¼ç”¨ä¸€åŠçš„æ¸¸æˆæ—¶é—´ç»è¥æ‰“ç†ç°å®ç”Ÿæ´»ï¼Œä¼šä¸ä¼šæ›´æœ‰æ„ä¹‰ï¼Ÿ

â€¢ã€è§’è‰²æ‹¼ä¸è¿‡ã€‘+ã€ä¸€ä¸ªåŠ²å„¿ä¸è®¤è¾“ã€‘ï¼Œæ–°æ‰‹è§’è‰²è·Ÿé«˜é…è§’è‰²æ¯”æ‹¼ï¼Œå°±åƒâ€œé¸¡è›‹ç¢°çŸ³å¤´â€å’Œé«˜ç­‰æ•°å­¦ï¼Œæ‰“ä¸è¿‡å°±æ˜¯æ‰“ä¸è¿‡ï¼ä¸ä¼šå°±æ˜¯ä¸ä¼šï¼<b>è¿™ä¸ªã€æ‹¼è§’è‰²ã€‘çš„æ¸¸æˆåˆ«å¤ªè¾ƒåŠ²ç¡¬è‚ï¼40çº§ä¹‹å‰ï¼Œè§’è‰²å…‘æ¢è·¯çº¿å’ŒæŠ€å·§ç»ƒä¹ æ‰æ˜¯å…³é”®ï¼</b>


                    </pre>
                </div>
                <div id="collide-try-bye" class="collide-try-goodbye">
                    <span>å°±åªæƒ³å•çº¯åœ°ç©ä¸€ä¸‹æ¸¸æˆï¼Œ<br>å¯æ›¾æƒ³è¢«æ¸¸æˆç©å¾—ä¸€å¡Œç³Šæ¶‚ï¼</span><br>
                    <span id="see-you-next-time">æœ‰ç¼˜å†è§~</span>
                </div>
            </div>
        </div>

        <!-- SVG å›¾å½¢åŒºåŸŸï¼ŒCSS è®¾ç½®ä¸æ˜¾ç¤ºï¼Œå®½é«˜è¿‡å¤§ä¼šå¯¼è‡´åŸæœ‰æ ·å¼é”™ä½ -->
        <div class="svg-image-area">
            <!-- https://icons.bootcss.com/icons/snow2/ -->
            <!-- https://yqnn.github.io/svg-path-editor/ -->
            <!-- é»˜è®¤ä¸»é¢˜-ä¸­å¿ƒå›¾å½¢ -->
            <svg xmlns="http://www.w3.org/2000/svg" width="800" height="800" fill="#6274C490" id="svg-default-center"
                class="bi bi-default-center" viewBox="0 0 800 800">
                <path
                    d="M39,361l30.165-17.437,30.526,15.268L71.346,378.462Zm662.489-17.437,30.526-15.269L762,345l-29.985,18.194ZM252.321,295.575s-4-11.846,6.541-15.269c0,0,7.614-2.782,17.444,8.725,0,0,4.3,11.666-6.541,15.269C269.765,304.3,259.013,307.626,252.321,295.575Zm82.856-102.519s-1.426-13.026,10.9-10.906c0,0,8.137-.392,10.9,10.906,0,0,2.2,11.184-10.9,10.907C346.08,203.963,338.523,204.884,335.177,193.056Zm2.181,370.813s1.134-10.64,10.9-8.725c0,0,7.362-.237,10.9,8.725,0,0,1.475,12.706-10.9,10.906C348.26,574.775,339.665,575.264,337.358,563.869Zm104.66,2.181s1.121-11.772,13.083-10.906c0,0,9.711,2.567,8.722,10.906,0,0,.728,8.846-10.9,10.906C452.92,576.956,444,578.611,442.018,566.05ZM402.771,361.012s0.222-12.616,13.082-15.268c0,0,9.647-2.729,13.083,15.268,0,0-1.931,11.839-13.083,13.088C415.853,374.1,404.6,372.223,402.771,361.012ZM531,337c4.43,5.388,5.75,43.344,3,40l75.911-24.713Zm-19.208-47.969s-11.152-21.5-30.526-28.356l87.217-74.162Zm-74.135-32.719C428.364,235.6,394.038,50.255,398.41,60l-10.9,161.412S354.487,232.022,333,251.95l-82.856-54.531,58.871,82.887s-17.634,25.994-17.443,56.713L189,358l102.569,16.1s26.934,89.76,111.2,87.25c0,0,98.875,1.955,93.758-100.338,0,0-7.184-64.79-69.774-65.437,0,0-40.215-1.321-54.51,39.263,0,0-7.811,27.219,13.082,47.987,0,0-20.41-45.658,23.673-64.825,0,0,35.347-7.477,48.281,32.106,0,0,16.709,63.783-49.281,77.894,0,0-76.807,4.3-83.725-73.531C324.275,354.469,312.226,252.288,437.657,256.312ZM278.486,428.631L93.15,657.662,274.125,487.525s29.3,23.868,37.068,28.356L283,605l56.538-76.031s20.24,12.3,45.789,13.087L400.59,758s15.5-195.811,17.279-218.224C417.977,538.415,418,540,418,540s33.951-3.5,48-17l71,71-42.651-86.844s17.212-10.4,34.886-32.719L725.474,624.944,518.333,428.631s-42.507,62.707-113.382,67.619C404.951,496.25,343.848,502.446,278.486,428.631Z" />
            </svg>
            <!-- å†°é›ªä¸»é¢˜-ä¸­å¿ƒé›ªèŠ± -->
            <svg xmlns="http://www.w3.org/2000/svg" width="1600" height="1600" fill="#EEF0F220" id="svg-snow"
                class="bi bi-snow2" viewBox="0 0 1600 1600">
                <path
                    d="M 800 1600 a 50 50 90 0 1 -50 -50 v -129.3 l -64.6 64.7 a 50 50 90 0 1 -70.7 -70.8 L 750 1279.3 v -108.6 l -64.6 64.7 a 50 50 90 0 1 -70.7 -70.8 L 750 1029.3 V 886.6 l -123.6 71.3 l -49.5 185 a 50 50 90 1 1 -96.6 -26 l 23.7 -88.2 l -94 54.2 l -49.6 185 a 50 50 90 1 1 -96.6 -26 l 23.7 -88.2 l -112 64.6 a 50 50 90 0 1 -50 -86.6 l 112 -64.6 l -88.4 -23.7 a 50 50 90 1 1 26 -96.6 l 184.8 49.5 l 94 -54.2 l -88.2 -23.7 a 50 50 90 1 1 25.8 -96.6 l 185 49.5 L 700 800 l -123.6 -71.3 l -184.9 49.5 a 50 50 90 1 1 -25.8 -96.6 l 88.3 -23.7 l -94 -54.2 l -185 49.5 a 50 50 90 0 1 -25.8 -96.6 l 88.3 -23.7 l -112 -64.6 a 50 50 90 1 1 50 -86.6 l 112 64.6 l -23.7 -88.3 a 50 50 90 0 1 96.6 -25.8 l 49.5 184.9 l 94 54.2 l -23.6 -88.3 a 50 50 90 0 1 96.6 -25.8 l 49.5 184.9 l 123.6 71.3 V 570.7 L 614.7 435.4 a 50 50 90 1 1 70.7 -70.8 l 64.6 64.7 V 320.7 L 614.7 185.4 a 50 50 90 1 1 70.7 -70.8 l 64.6 64.7 V 50 a 50 50 90 0 1 100 0 v 129.3 l 64.7 -64.7 a 50 50 90 1 1 70.7 70.8 L 850 320.7 v 108.6 l 64.7 -64.7 a 50 50 90 1 1 70.7 70.8 L 850 570.7 v 142.7 l 123.6 -71.3 l 49.5 -185 a 50 50 90 1 1 96.6 26 l -23.6 88.2 l 94 -54.2 l 49.5 -185 a 50 50 90 1 1 96.6 26 l -23.6 88.2 l 112 -64.6 a 50 50 90 0 1 50 86.6 l -112 64.6 l 88.3 23.7 a 50 50 90 1 1 -26 96.6 l -184.8 -49.5 l -94 54.2 l 88.3 23.7 a 50 50 90 1 1 -26 96.6 l -184.8 -49.5 L 900 800 l 123.6 71.3 l 184.9 -49.5 a 50 50 90 0 1 25.9 96.6 l -88.3 23.7 l 94 54.2 l 184.9 -49.5 a 50 50 90 0 1 25.9 96.6 l -88.3 23.7 l 112 64.6 a 50 50 90 0 1 -50 86.6 l -112 -64.6 l 23.6 88.3 a 50 50 90 1 1 -96.6 25.8 l -49.5 -184.9 l -94 -54.2 l 23.6 88.3 a 50 50 90 0 1 -96.6 25.8 L 973.6 958 L 850 886.6 v 142.7 l 135.4 135.3 a 50 50 90 0 1 -70.7 70.8 l -64.7 -64.7 v 108.6 l 135.4 135.3 a 50 50 90 0 1 -70.7 70.8 l -64.7 -64.7 V 1550 a 50 50 90 0 1 -50 50 z" />
            </svg>
            <!-- é»˜è®¤ä¸»é¢˜-éª¨å¤´ -->
            <svg xmlns="http://www.w3.org/2000/svg" width="1156" height="517" fill="#FAF8F9A0" id="svg-bone"
                class="bi bi-bone" viewBox="0 0 1156 517">
                <path
                    d="M792.742,214l57.981,11c3.363-29.552-.866-54.089-7-78-2.4-9.366-.024-22.848-2-32-2.756-12.77-5.116-37.265,5-41,4.986-3.95,15.353-.123,20.994,2,17.974,6.764,38.175,12.06,55.981,20,7.922,3.532,15.683,10.442,23.993,14,11.179,4.787,21.369,6.927,30.989,13,9.948,6.279,18.756,14.747,28.989,21,10.71,6.539,22.34,9.5,32.99,16,29.58,18.072,58.62,36.04,84.97,57,13.08,10.4,24.71,32.444,26,54,0.61,10.3,1.26,27.307-5,31-6.46,4.477-16.89,2.009-25.99,4-23.16,5.063-56.47.19-80.98,0-9.79-.076-18.55-2.665-25.99,0,0.63,1.754.19,0.971,1,2,2.47,7.744,9.69,9.051,15.99,13,10.61,6.641,22.03,13.213,34.99,18,7.46,2.755,22.38,4.63,27.99,9h-1c-11.71,11.493-31.73,15.109-47.98,22-41.91,17.771-86.1,28-143.953,28-18.818,0-34.74,2-54.982,2H823.732c-5.875-1.889-8.167-7.075-12-11-0.354-17.627,7.822-25.443,13-37,10.049-22.45,19.493-45.007,19.993-77l-3-1c-7.616-5.636-41.911-9.444-53.982-12-4.534,52.915-31.062,101.589-51.984,140-6.922,12.709-17.711,39.253-34.988,40a18.324,18.324,0,0,1-1-6c3.474-3.869,3.686-8.7,6-14,5.09-11.667,10.537-23.4,16-36,14.961-34.548,40.4-82.758,41.986-128l-96.968-16c1.058,44.646-16.339,103.107-33.989,130-3.4,5.179-9.339,9.173-13,14-6.087,8.037-14.232,21.163-25.991,23-1.588-2.95-2.075-5.721-2-11,7.807-10.562,8.419-33.928,13-48,10.814-33.244,20.663-67.317,20.993-110h-2c-4.541-2.84-13.811.31-19.994-1-8.691-1.842-46.887-4.9-52.982-3,4.532,13.093,2,33.92,2,50,0,59.086-15.28,98.1-43.986,128l-4-2c-2.163-18.366,1.188-44.319,5-62q0.5-57.995,1-116c-22.312-.853-50.247,3.117-69.978,9-8.128,2.424-17.691.73-23.992,5-0.96,1.418-.976,3.273-1,6,5.5,8.265,1.426,25.461,3,37,4.01,29.431-17.2,68-28.991,87-4.908,7.908-8.173,23.353-19.993,24v-2c-3.549-5.645,0-30.838,0-40,0-34.26,4.652-65.063,5-101h-1c-2.467,1.738-4.363.709-8,2-12.15,4.316-26.066,10.022-37.988,15-7.112,2.97-16.413,2.355-16.994,12,3.65,5.559,3.123,27.578,3,37-0.324,24.556-14.154,38.656-25.992,52-4.013,4.524-6.914,10.639-14,12-1.124.144-1.787-.067-4-1-3.809-30.813,6.634-57.745,7-89h-2c-6.774,5.9-31.421,12.544-40.987,17-2.567,23.606-22.621,48.571-30.99,68-3.571,8.291-3.524,16.462-7,25-8.157,20.047-17.051,45.871-26.991,65-6.367,12.253-20.929,42.732-36.988,43a24.966,24.966,0,0,0-4-5c0.2-20.015,1.553-52.337-3-69-2.362-8.649-8.5-11.167-9-22,3.069-3.5,3.484-8.853,6-13,6.228-10.274,14.561-22.634,17.994-35a23.635,23.635,0,0,1-8-1,16.936,16.936,0,0,1-2-6c2.161-2.688,3.173-7.056,4-11h-1c-3.27,3.075-38.246,15.949-42.986,13-2.222-1.382-1.89-4.365-2-8,8.746-8.589,19.334-20.834,24.992-32h-2c-1.8,1.488-28.293,10.916-30.99,10-3.031-1.029-3.655-3.981-4-8,7.331-4.806,12.683-11.772,20.993-16v-1h-2c-6.953,4.614-44.236,12.022-54.982,10-1.113-2.476-1.687-3.233-2-7,3.921-3.582,16.349-13.578,17.994-18-13.905-1.408-28.469-9.161-39.987-14-4.759-2-12.629-.525-15-5-0.877-1.3-.894-2.467-1-5a18.058,18.058,0,0,0,4-3c78.125,0.41,150.189,14.25,216.929,26,11.007,1.938,35.66-13.768,43.986-18,3.636-1.848,12.182-3.6,14-7V256c-5.011-7.79-4.018-22.785-9-31-12.138-20.028-28.283-36.567-44.985-52-0.093-10.478,3.9-10.265,9-15,48.81,0.306,58.334,66.3,72.976,103,14.669-6.819,28.894-16.5,43.986-23,6.26-2.7,19.386-4.919,21.993-11-2.408-3.732-1.451-9.225-3-14-3.124-9.629-6.752-20.225-11-30-10.143-23.359-27.548-42.49-37.987-65-4.851-10.459-15.093-29.765,5-29,6.659,6.867,17.167,10.312,24.992,16,5.709,4.15,9.708,11.31,13.995,17l11,10c16.367,22.489,22.482,55.04,32.989,83,17.461-6.611,34.972-9.887,53.982-16,13-4.18,28.214-9.018,43.986-10,0.105-8.829-2.206-16.135-4-23-4.822-18.464-5.314-34.9-12-51-3.043-7.334-8.352-14.31-12-21-6.378-11.711-10.614-24.409-19.993-33a50.141,50.141,0,0,1,1-11c26.713-15.492,39.515.656,49.984,20,16.506,30.5,30.855,76.456,35.988,117,27.335-.087,52.049,1.905,77.975,2,0.445-28.115-8.134-49.972-15-71-5.828-17.862-8.185-32.654-15-49-4.326-10.382-22.8-39.378-17-53,2.189-5.133,7.417-7.271,11-11,27.522-1.686,35.066,13.431,45.985,31,16.622,26.746,22.822,59.785,30.99,96,4.425,19.621.079,41.827,4,62h6c7.736,4.675,24.731,2.585,34.989,5l56.981,10v-2c-2.106-3.544.138-10.073-1-15-3.084-13.361-.965-28.537-5-41-9.288-28.7-15.7-57.04-26.991-83-4.342-9.981-12.346-18.946-16.994-28-3.851-7.5-8.294-28.548-1-34,2.841-2.245,8.155-2.879,13-3,6.25,5.347,15.159,8.379,19.993,15C759.2,32.3,761.34,48.786,767.75,68c4.578,13.723,10.611,29.339,15,44q1.5,12,3,24C791.106,158.74,792.56,187,792.742,214Zm172.944-56c-3.7,2.2-10,1.3-14,3-10.252,4.349-21.064,15.4-24.992,26-11.145,30.082,19.654,64.22,51.983,56C1028.9,230.232,1018.28,160.747,965.686,158Zm140.954,63c-0.96,1.766-1.26,1.68-2,4,6,2.193,5.51,6.5,14,7a10.727,10.727,0,0,1,2-3c-0.64-1.754-.2-0.971-1-2-1.19-3.511-2.84-3.73-5-6h-8Z" />
            </svg>
            <!-- é»˜è®¤ä¸»é¢˜-çŸ³å¤´ -->
            <svg xmlns="http://www.w3.org/2000/svg" width="800" height="800" id="svg-stone" class="bi bi-stone"
                viewBox="0 0 1024 1024">
                <path
                    d="M614.737067 655.978667c2.4192 0.605867 43.178667-9.796267 46.199466-12.458667 6.4128-5.802667 84.535467-101.956267 97.719467-116.347733-0.610133-4.352 0.1152-2.901333-4.842667-6.165334l-49.9456-30.4768c3.264-3.869867-0.362667-1.3312 4.232534-2.299733l95.057066-38.8224c4.232533-1.6896 10.5216-3.0208 13.7856-6.894933l-39.424-49.5872c-5.568-7.8592-14.276267-17.416533-19.716266-24.5504-9.915733-12.9408-32.533333-39.061333-38.8224-50.1888-1.813333-3.268267-6.045867-9.796267-8.4608-13.064534-1.937067-2.538667-3.268267-4.1088-4.842667-6.7712l-21.768533-32.776533-23.825067-23.825067c-27.456-0.605867-24.3072-3.0208-37.009067-15.9616-17.2928-17.898667-58.2912-43.054933-76.189866-58.052266l-150.442667 17.9072-98.568533 3.0208-101.469867 185.642666c-8.465067 9.553067-18.261333 20.1984-26.1248 30.357334 3.264 4.714667 0.482133-1.450667 1.088 2.781866 0 0.2432-0.362667 1.450667-0.4864 1.937067 11.733333 2.781867 23.825067 6.7712 35.554133 10.039467l66.274134 24.187733c20.680533 7.739733 19.9552 11.1232 34.709333 28.177067l81.271467 96.0256c6.165333 7.377067 11.1232 14.148267 17.655466 21.2864 5.201067 5.6832 121.301333 41.723733 136.661334 46.314666 12.821333 3.7504 62.523733 21.892267 71.4752 20.322134l0.256 0.2432z"
                    fill="#13227a" p-id="3204"></path>
                <path
                    d="M458.120533 847.6672c10.402133 2.180267 31.5648-0.2432 42.449067-0.3584 40.029867-0.482133 90.461867-3.392 128.9216-3.268267 10.525867 0 10.525867 1.813333 18.0224-4.957866 21.6448-19.349333 29.755733-22.980267 54.664533-37.858134 10.282667-6.0416 31.2064-20.189867 40.64-23.940266l15.232-6.1696c0.366933-0.119467 1.693867-0.605867 2.180267-0.725334l49.344-158.6688a2027.989333 2027.989333 0 0 1 24.5504-79.825066c4.232533-12.817067 8.226133-26.363733 12.091733-38.698667 2.542933-8.226133 4.232533-11.490133 8.708267-16.448 2.658133-3.0208 7.8592-7.377067 9.314133-12.578133l-0.482133 5.9264c4.957867-4.475733-0.362667-12.578133-2.7776-17.053867-5.205333-9.796267-20.1984-44.987733-24.797867-52.608-3.0208-4.8384-47.044267-49.224533-54.545066-56.6016L682.709333 246.839467c-5.568-4.232533-15.36-3.5072-22.493866-5.077334l23.825066 23.825067 21.7728 32.776533c1.570133 2.6624 2.901333 4.232533 4.834134 6.7712 2.4192 3.268267 6.656 9.796267 8.465066 13.064534 6.293333 11.246933 28.906667 37.248 38.826667 50.1888 5.44 7.133867 14.148267 16.6912 19.707733 24.5504l39.428267 49.5872c-3.144533 3.7504-9.553067 5.201067-13.7856 6.894933l-122.3936 39.6672c3.025067 3.144533 90.824533-2.4192 95.185067-2.4192 11.972267 0.119467 22.370133-1.207467 35.191466-1.3312 10.5216-0.119467 24.5504-1.937067 36.040534-1.211733-3.7504 4.475733-24.311467 12.334933-32.290134 16.6912l-44.872533 20.322133c-4.5952 2.414933-6.894933 3.8656-11.485867 6.0416-13.184 14.391467-91.306667 110.5408-97.719466 116.347733-3.0208 2.781867-43.780267 13.184-46.199467 12.458667-4.8384 6.045867-8.221867 30.839467-10.039467 39.185067-26.850133-3.989333-79.0912-7.620267-110.178133-10.402134l-72.443733-5.563733c-25.518933-1.6896-23.7056-4.8384-32.0512 4.352-5.802667 6.293333-14.997333 18.2656-21.649067 22.856533-7.8592 5.3248-17.053867 11.127467-23.825067 17.053867l18.8672 12.9408c5.077333 3.746133 34.833067 40.3968 41.723734 47.650133l53.090133 63.735467-0.119467-0.128z"
                    fill="#13227a" p-id="3205"></path>
                <path
                    d="M186.248533 702.664533c3.144533-1.937067-1.813333-1.211733 5.077334-1.088l14.8736 2.295467c39.547733 7.253333 98.688 11.127467 138.116266 19.4688 6.7712-6.045867 15.965867-11.733333 23.825067-17.0496 6.7712-4.599467 15.965867-16.571733 21.649067-22.856533 8.3456-9.070933 6.532267-5.9264 32.0512-4.356267l72.443733 5.563733c31.202133 2.781867 83.451733 6.532267 110.178133 10.402134 1.8176-8.341333 5.320533-33.1392 10.039467-39.185067-8.951467 1.6896-58.653867-16.448-71.4752-20.317867-15.364267-4.599467-131.464533-40.635733-136.661333-46.318933-6.651733-7.2576-11.6096-14.0288-17.655467-21.2864l-81.271467-96.0256c-14.634667-17.053867-13.909333-20.4416-34.709333-28.177067l-66.286933-24.192c-11.733333-3.268267-23.825067-7.2576-35.554134-10.039466 0.119467-0.362667 0.4864-1.6896 0.4864-1.9328-0.605867-4.356267 2.176 1.9328-1.088-2.781867-17.898667 25.275733-11.733333 46.318933-8.465066 76.194133 2.781867 25.156267 5.077333 48.8576 7.620266 74.1376 1.6896 16.324267 13.179733 142.340267 16.6912 147.5456h0.1152z"
                    fill="#13227a" p-id="3206"></path>
                <path
                    d="M281.186133 817.070933c0.968533-4.475733-2.901333-1.207467 9.6768 1.3312l123.477334 22.737067c7.739733 1.454933 41.122133 9.796267 43.780266 6.528l-53.090133-63.735467c-6.7712-7.2576-36.6464-43.784533-41.723733-47.650133l-18.8672-12.9408c-39.547733-8.341333-98.688-12.334933-138.116267-19.4688l-14.8736-2.295467c-6.894933-0.123733-1.937067-0.849067-5.077333 1.088 16.448 18.8672 31.684267 37.853867 47.168 56.840534 3.869867 4.714667 44.266667 55.2704 47.7696 57.6896l-0.123734-0.123734z"
                    fill="#13227a" p-id="3207"></path>
                <path
                    d="M863.633067 470.216533l0.482133-5.9264c-1.450667 5.201067-6.651733 9.4336-9.314133 12.578134-4.475733 4.957867-6.1696 8.221867-8.708267 16.448-3.869867 12.334933-7.863467 25.8816-12.096 38.702933a2042.112 2042.112 0 0 0-24.5504 79.816533l-49.339733 158.673067c-0.482133 0.119467-1.8176 0.605867-2.176 0.725333l-15.240534 6.165334c-9.4336 3.7504-30.353067 17.783467-40.631466 23.9488-24.917333 14.754133-33.015467 18.385067-54.6688 37.8496-7.5008 6.775467-7.5008 4.957867-18.018134 4.957866-38.464-0.2432-88.891733 2.781867-128.925866 3.268267-11.008 0.123733-32.0512 2.542933-42.449067 0.366933-2.6624 3.264-36.040533-5.0816-43.780267-6.532266l-123.477333-22.7328c-12.578133-2.542933-8.708267-5.806933-9.6768-1.335467 4.957867 5.802667 104.3712 37.4912 111.022933 38.216533l100.501334 0.725334c65.668267 0.849067 132.1856-2.176 196.8896-5.802667 6.1696-0.362667 6.289067-0.2432 10.039466-3.144533a174.0928 174.0928 0 0 0 8.827734-7.253334c5.320533-4.714667 11.729067-9.553067 16.810666-13.909333l67.844267-56.1152c3.0208-4.714667 10.641067-52.002133 12.4544-61.435733 7.5008-39.185067 13.422933-85.504 24.917333-122.632534 4.8384-15.726933 32.896-107.153067 33.258667-115.7376v0.1152z"
                    fill="#13227a" p-id="3208"></path>
                <path
                    d="M743.300267 534.673067c5.316267-2.542933 8.098133-4.1088 13.422933-7.0144l52.612267-23.825067c9.309867-5.077333 33.501867-14.272 37.8496-19.592533-13.422933-0.8448-29.870933 1.3312-42.325334 1.450666-15.121067 0.119467-27.217067 1.6896-41.365333 1.570134-5.073067 0-76.066133 5.444267-79.697067 1.813333-5.444267 1.088-1.088-1.813333-4.962133 2.6624l58.658133 35.8016c5.806933 3.8656 4.957867 2.176 5.6832 7.253333l0.123734-0.119466z"
                    fill="#13227a" p-id="3209"></path>
            </svg>
            <!-- å¤æ—¥ä¸»é¢˜-å°é»„é¸­ -->
            <svg xmlns="http://www.w3.org/2000/svg" width="800" height="800" id="svg-yl-duck" class="bi bi-yl-duck"
                viewBox="0 0 1024 1024">
                <path
                    d="M212.5 465c-13.8 4.1-25.5 13.1-33.1 25.3-36.4 58.5-126.6 237.8 38.5 367.8 199.9 157.4 655 68.1 699.7-197.8C953.7 445.5 890 364.7 802.8 320c0 0-51-23.4-106.3 0l-484 145z"
                    fill="#FFDC48" p-id="4556"></path>
                <path
                    d="M526.2 543.3s191.5-7.9 194.7 78.2c1.6 42.1-122.8 357.8-467.3 260 0 0 281.2 161.6 574.6-59.6 216.9-280.7 21.3-572.1-123.4-508.3S526.2 543.3 526.2 543.3z"
                    fill="#FFBE3C" p-id="4557"></path>
                <path
                    d="M206 482.7c21.9 37.2 57.5 64.4 99 76.2 36 10.2 79.1 16.2 125.4 16.2 49.8 0 95.9-6.9 133.5-18.6 39.9-12.4 73.8-39.5 94.6-75.7 0.1-0.2 0.2-0.4 0.3-0.5 21.8-38 34.3-82 34.4-128.9 0.5-144.5-117.1-262.5-261.6-262.5C287.1 88.9 170 206 170 350.5c0.1 48.2 13.2 93.4 36 132.2z"
                    fill="#FFDC48" p-id="4558"></path>
                <path
                    d="M431.7 88.8c-16.7 0-33 1.6-48.8 4.6 95.3 28.8 165 117.7 164.6 222.2-0.1 41.5-11.2 80.3-30.4 113.9-0.1 0.2-0.2 0.3-0.3 0.5-18.4 32-48.4 56-83.6 66.9-33.2 10.4-74 16.5-118 16.5-34.3 0-66.6-3.7-94.9-10.2 21.7 26.7 51.3 46.2 84.8 55.7 36 10.2 79.1 16.2 125.4 16.2 49.8 0 95.9-6.9 133.5-18.6 39.9-12.4 73.8-39.5 94.6-75.7 0.1-0.2 0.2-0.4 0.3-0.5 21.8-38 34.3-82 34.4-128.9 0.5-144.5-117.1-262.6-261.6-262.6z"
                    fill="#FFBE3C" p-id="4559"></path>
                <path
                    d="M162 409.9l18.1-9.6c36.3-12.7 76.6-4.4 104.8 21.7 31.8 34 52.7 59.2 85.1 78.4 4.5 2.7 7.3 7.5 7.3 12.7v12.2c0 11.9-8.5 22.2-20.2 24.5-55.5 10.7-209.4 30.8-260-61.8-15.4-37.2 64.9-78.1 64.9-78.1z"
                    fill="#FF4160" p-id="4560"></path>
                <path
                    d="M324.6 464.1L304 447.6s-164.2 68.3-193.9 59.2c0.2 0.3 0.5 0.6 0.7 0.8 13.8 8.5 85.8 48.9 178.4 34.6 103.1-16 81-41.8 81-41.8-17.4-10.3-31.4-22.2-45.6-36.3z"
                    fill="#F43459" p-id="4561"></path>
                <path
                    d="M361.8 513.2c-51.5 12.7-179.2 36.7-257.2-13.4 56.8 79.1 199.6 60.3 252.6 50 11.7-2.3 20.2-12.5 20.2-24.5v-12.2c0-2.8-0.8-5.4-2.2-7.7-3.6 3.7-8.2 6.5-13.4 7.8z"
                    fill="#DB214E" p-id="4562"></path>
                <path
                    d="M776.9 784.8s-125.5 61.7-153.1-51c-25.5-146.7 140.4-117 163.8-153.1 25.8-39.9 42.5-112.7 70.2-70.2s32.9 210.5-80.9 274.3z"
                    fill="#FFDC48" p-id="4563"></path>
                <path
                    d="M667 793.5c46.6 22.4 109.9-8.8 109.9-8.8C890.7 721 885.4 553 857.7 510.4s-44.3 30.3-70.2 70.2c26.3 95.2-16.2 172.2-120.5 212.9z"
                    fill="#FFBE3C" p-id="4564"></path>
                <path d="M405.2 357.4m-40.7 0a40.7 40.7 0 1 0 81.4 0 40.7 40.7 0 1 0-81.4 0Z" fill="#FFBE3C"
                    p-id="4565"></path>
                <path d="M397.4 351.7m-40.7 0a40.7 40.7 0 1 0 81.4 0 40.7 40.7 0 1 0-81.4 0Z" fill="#5E4153"
                    p-id="4566"></path>
                <path
                    d="M918.4 421.2c-20.9-49.4-55.8-85.2-109.7-112.9-0.2-0.1-0.3-0.2-0.5-0.2-2.2-1-50.4-22.5-105.8-4.3-10.4-60.4-40.9-115.8-87-157.3-50.6-45.6-115.8-70.7-183.7-70.7-151.4 0-274.6 123.2-274.6 274.6 0 15.2 1.3 30.4 3.7 45.3l-4.8 2.5c-9.7 5-90.3 47.9-70.9 94.7 0.2 0.4 0.4 0.9 0.6 1.3 12.4 22.6 30 39.1 50.7 50.9-33.2 79.6-61.1 217.3 73.4 323.1 57.7 45.4 136.9 72.8 229.2 79.2 13.4 0.9 26.9 1.4 40.5 1.4 74.5 0 150.8-13.8 218.5-40 60.7-23.5 113.5-56.6 152.5-95.8 43.6-43.8 70.5-94.5 79.9-150.6 17.3-102.5 13.3-181.4-12-241.2zM431.7 101.9c126.8 0 233 95 247 221 1 9.3 1.6 18.9 1.5 28.4-0.1 43-11.4 85.3-32.7 122.4-0.1 0.2-0.3 0.5-0.3 0.6-19.3 33.5-50.2 58.3-87.2 69.8-37.8 11.8-82.6 18-129.6 18-20.3 0-40.4-1.2-59.6-3.5 11.8-6.5 19.6-19.1 19.6-33.2v-12.2c0-9.8-5.2-19-13.7-24-26.2-15.5-44.3-35.1-69.4-62.3-4.1-4.4-8.4-9-12.8-13.8-0.2-0.2-0.4-0.5-0.7-0.7-29.3-27.2-70-37.2-108.3-27.4-1.6-11.4-2.4-23-2.4-34.6 0-3.1 0.1-6.1 0.2-9.2C194.5 334 202 321.4 202 307c0-9.7-3.4-18.6-9.1-25.6 30-103.5 125.7-179.5 238.8-179.5zM109 482.5c-6.3-17.8 31.2-46.8 59-61 0.1 0 0.1-0.1 0.2-0.1l17.2-9.1c31.4-10.7 65.9-3.4 90.4 19 4.3 4.6 8.4 9.1 12.4 13.3 25.6 27.7 45.8 49.5 75.3 67 0.5 0.3 0.9 0.9 0.9 1.5v12.2c0 5.7-4 10.6-9.6 11.7-45.8 8.8-198.2 30.8-245.8-54.5z m795.7 175.6c-16.3 97.1-95.1 179.6-216.1 226.4-161.7 62.5-356.3 47-462.6-36.7-115.4-90.8-101.4-206.4-66-291.4 31.6 12.1 67.4 16.2 101.1 16.2 13.2 0 26.1-0.6 38.3-1.6 0.7 0.2 1.3 0.4 2 0.6 38.4 10.9 83 16.7 128.9 16.7 49.6 0 97.1-6.6 137.4-19.2 43.2-13.5 79.5-42.5 102.1-81.8l0.2-0.3c0-0.1 0.1-0.1 0.1-0.2 23.5-41 36-87.8 36.2-135.4 0-7-0.2-14-0.8-21 45.9-17.4 88.4 0.1 91.5 1.4 74.1 38 144.6 106.6 107.7 326.3z"
                    fill="#5E4153" p-id="4567"></path>
                <path
                    d="M841.5 482.8c-19.6 1.3-31.1 25.4-44.5 53.4-6 12.5-12.1 25.4-18.7 35.6-4.4 6.8-25.8 11.8-44.8 16.2-27.9 6.5-62.5 14.6-87.9 35-30.4 24.5-41.5 61.9-32.9 111.3 0.1 0.3 0.1 0.6 0.2 0.9 8.3 33.7 25.5 56.9 51.1 68.9 14.1 6.6 29.2 9 43.8 9 39.1 0 74.6-17.2 76.7-18.2l0.6-0.3c60.1-33.7 85.2-91.6 95.7-134.2 16-64.8 7.3-131.6-10.4-158.7-8.6-13.3-18.3-19.6-28.9-18.9z m7 33c12.5 19.2 21.8 77.8 6.9 138.2-9.2 37.5-31.1 88.3-82.8 117.4-4.4 2.1-59 27-97.7 8.8-18-8.4-30.3-25.6-36.6-50.9-15.2-88.8 46.6-103.2 101.1-115.9 28.3-6.6 50.7-11.8 60.8-27.4 7.5-11.6 14.1-25.3 20.4-38.5 6.2-13 16.4-34.4 22.3-38.3 1 0.7 2.9 2.5 5.6 6.6z"
                    fill="#5E4153" p-id="4568"></path>
                <path d="M384.7 339.1m-12.7 0a12.7 12.7 0 1 0 25.4 0 12.7 12.7 0 1 0-25.4 0Z" fill="#FFFFFF"
                    p-id="4569"></path>
                <path
                    d="M225.5 485.3c-5.1-0.5-9.6-4-11.2-9.1-2.1-6.9 1.7-14.2 8.6-16.3 15.5-4.8 33.8-13 34-13.1 6.6-3 14.3 0 17.3 6.5 3 6.6 0 14.3-6.5 17.3-0.8 0.4-19.9 8.9-37 14.2-1.8 0.5-3.5 0.7-5.2 0.5z"
                    fill="#FFD7DF" p-id="4570"></path>
            </svg>

            <!-- è§’è‰²iconå›¾æ ‡ -->

        </div>

        <!-- æ˜¾ç¤ºconsole.logæ—¥å¿— -->
        <div id="info" ref="info" @click="show();" type="0"></div>
    </main>
</template>

<script setup>
import { onBeforeMount, onMounted, onBeforeUnmount, onUnmounted } from "vue";

const packageVersion = __APP_VERSION__;

// https://github.com/MaksymSemenykhin/javascript-aes
"use strict"; var Aes = {}; if (Aes.cipher = function (e, r) { for (var o = 4, n = r.length / o - 1, t = [[], [], [], []], s = 0; 4 * o > s; s++)t[s % 4][Math.floor(s / 4)] = e[s]; t = Aes.addRoundKey(t, r, 0, o); for (var f = 1; n > f; f++)t = Aes.subBytes(t, o), t = Aes.shiftRows(t, o), t = Aes.mixColumns(t, o), t = Aes.addRoundKey(t, r, f, o); t = Aes.subBytes(t, o), t = Aes.shiftRows(t, o), t = Aes.addRoundKey(t, r, n, o); for (var a = new Array(4 * o), s = 0; 4 * o > s; s++)a[s] = t[s % 4][Math.floor(s / 4)]; return a }, Aes.keyExpansion = function (e) { for (var r = 4, o = e.length / 4, n = o + 6, t = new Array(r * (n + 1)), s = new Array(4), f = 0; o > f; f++) { var a = [e[4 * f], e[4 * f + 1], e[4 * f + 2], e[4 * f + 3]]; t[f] = a } for (var f = o; r * (n + 1) > f; f++) { t[f] = new Array(4); for (var i = 0; 4 > i; i++)s[i] = t[f - 1][i]; if (f % o == 0) { s = Aes.subWord(Aes.rotWord(s)); for (var i = 0; 4 > i; i++)s[i] ^= Aes.rCon[f / o][i] } else o > 6 && f % o == 4 && (s = Aes.subWord(s)); for (var i = 0; 4 > i; i++)t[f][i] = t[f - o][i] ^ s[i] } return t }, Aes.subBytes = function (e, r) { for (var o = 0; 4 > o; o++)for (var n = 0; r > n; n++)e[o][n] = Aes.sBox[e[o][n]]; return e }, Aes.shiftRows = function (e, r) { for (var o = new Array(4), n = 1; 4 > n; n++) { for (var t = 0; 4 > t; t++)o[t] = e[n][(t + n) % r]; for (var t = 0; 4 > t; t++)e[n][t] = o[t] } return e }, Aes.mixColumns = function (e, r) { for (var o = 0; 4 > o; o++) { for (var n = new Array(4), t = new Array(4), s = 0; 4 > s; s++)n[s] = e[s][o], t[s] = 128 & e[s][o] ? e[s][o] << 1 ^ 283 : e[s][o] << 1; e[0][o] = t[0] ^ n[1] ^ t[1] ^ n[2] ^ n[3], e[1][o] = n[0] ^ t[1] ^ n[2] ^ t[2] ^ n[3], e[2][o] = n[0] ^ n[1] ^ t[2] ^ n[3] ^ t[3], e[3][o] = n[0] ^ t[0] ^ n[1] ^ n[2] ^ t[3] } return e }, Aes.addRoundKey = function (e, r, o, n) { for (var t = 0; 4 > t; t++)for (var s = 0; n > s; s++)e[t][s] ^= r[4 * o + s][t]; return e }, Aes.subWord = function (e) { for (var r = 0; 4 > r; r++)e[r] = Aes.sBox[e[r]]; return e }, Aes.rotWord = function (e) { for (var r = e[0], o = 0; 3 > o; o++)e[o] = e[o + 1]; return e[3] = r, e }, Aes.sBox = [99, 124, 119, 123, 242, 107, 111, 197, 48, 1, 103, 43, 254, 215, 171, 118, 202, 130, 201, 125, 250, 89, 71, 240, 173, 212, 162, 175, 156, 164, 114, 192, 183, 253, 147, 38, 54, 63, 247, 204, 52, 165, 229, 241, 113, 216, 49, 21, 4, 199, 35, 195, 24, 150, 5, 154, 7, 18, 128, 226, 235, 39, 178, 117, 9, 131, 44, 26, 27, 110, 90, 160, 82, 59, 214, 179, 41, 227, 47, 132, 83, 209, 0, 237, 32, 252, 177, 91, 106, 203, 190, 57, 74, 76, 88, 207, 208, 239, 170, 251, 67, 77, 51, 133, 69, 249, 2, 127, 80, 60, 159, 168, 81, 163, 64, 143, 146, 157, 56, 245, 188, 182, 218, 33, 16, 255, 243, 210, 205, 12, 19, 236, 95, 151, 68, 23, 196, 167, 126, 61, 100, 93, 25, 115, 96, 129, 79, 220, 34, 42, 144, 136, 70, 238, 184, 20, 222, 94, 11, 219, 224, 50, 58, 10, 73, 6, 36, 92, 194, 211, 172, 98, 145, 149, 228, 121, 231, 200, 55, 109, 141, 213, 78, 169, 108, 86, 244, 234, 101, 122, 174, 8, 186, 120, 37, 46, 28, 166, 180, 198, 232, 221, 116, 31, 75, 189, 139, 138, 112, 62, 181, 102, 72, 3, 246, 14, 97, 53, 87, 185, 134, 193, 29, 158, 225, 248, 152, 17, 105, 217, 142, 148, 155, 30, 135, 233, 206, 85, 40, 223, 140, 161, 137, 13, 191, 230, 66, 104, 65, 153, 45, 15, 176, 84, 187, 22], Aes.rCon = [[0, 0, 0, 0], [1, 0, 0, 0], [2, 0, 0, 0], [4, 0, 0, 0], [8, 0, 0, 0], [16, 0, 0, 0], [32, 0, 0, 0], [64, 0, 0, 0], [128, 0, 0, 0], [27, 0, 0, 0], [54, 0, 0, 0]], "undefined" != typeof module && module.exports && (module.exports = Aes), "undefined" != typeof module && module.exports) var Aes = require("./aes.js"); Aes.Ctr = {}, Aes.Ctr.encrypt = function (e, r, o) { var n = 16; if (128 != o && 192 != o && 256 != o) throw new Error("Key size is not 128 / 192 / 256"); e = String(e).utf8Encode(), r = String(r).utf8Encode(); for (var t = o / 8, s = new Array(t), f = 0; t > f; f++)s[f] = f < r.length ? r.charCodeAt(f) : 0; var a = Aes.cipher(s, Aes.keyExpansion(s)); a = a.concat(a.slice(0, t - 16)); for (var i = new Array(n), d = (new Date).getTime(), u = d % 1e3, c = Math.floor(d / 1e3), p = Math.floor(65535 * Math.random()), f = 0; 2 > f; f++)i[f] = u >>> 8 * f & 255; for (var f = 0; 2 > f; f++)i[f + 2] = p >>> 8 * f & 255; for (var f = 0; 4 > f; f++)i[f + 4] = c >>> 8 * f & 255; for (var A = "", f = 0; 8 > f; f++)A += String.fromCharCode(i[f]); for (var y = Aes.keyExpansion(a), h = Math.ceil(e.length / n), l = "", v = 0; h > v; v++) { for (var g = 0; 4 > g; g++)i[15 - g] = v >>> 8 * g & 255; for (var g = 0; 4 > g; g++)i[15 - g - 4] = v / 4294967296 >>> 8 * g; for (var w = Aes.cipher(i, y), b = h - 1 > v ? n : (e.length - 1) % n + 1, C = new Array(b), f = 0; b > f; f++)C[f] = w[f] ^ e.charCodeAt(v * n + f), C[f] = String.fromCharCode(C[f]); l += C.join(""), "undefined" != typeof WorkerGlobalScope && self instanceof WorkerGlobalScope && v % 1e3 == 0 && self.postMessage({ progress: v / h }) } return l = (A + l).base64Encode() }, Aes.Ctr.decrypt = function (e, r, o) { var n = 16; if (128 != o && 192 != o && 256 != o) throw new Error("Key size is not 128 / 192 / 256"); e = String(e).base64Decode(), r = String(r).utf8Encode(); for (var t = o / 8, s = new Array(t), f = 0; t > f; f++)s[f] = f < r.length ? r.charCodeAt(f) : 0; var a = Aes.cipher(s, Aes.keyExpansion(s)); a = a.concat(a.slice(0, t - 16)); for (var i = new Array(8), d = e.slice(0, 8), f = 0; 8 > f; f++)i[f] = d.charCodeAt(f); for (var u = Aes.keyExpansion(a), c = Math.ceil((e.length - 8) / n), p = new Array(c), A = 0; c > A; A++)p[A] = e.slice(8 + A * n, 8 + A * n + n); e = p; for (var y = "", A = 0; c > A; A++) { for (var h = 0; 4 > h; h++)i[15 - h] = A >>> 8 * h & 255; for (var h = 0; 4 > h; h++)i[15 - h - 4] = (A + 1) / 4294967296 - 1 >>> 8 * h & 255; for (var l = Aes.cipher(i, u), v = new Array(e[A].length), f = 0; f < e[A].length; f++)v[f] = l[f] ^ e[A].charCodeAt(f), v[f] = String.fromCharCode(v[f]); y += v.join(""), "undefined" != typeof WorkerGlobalScope && self instanceof WorkerGlobalScope && A % 1e3 == 0 && self.postMessage({ progress: A / c }) } return y = y.utf8Decode() }, "undefined" == typeof String.prototype.utf8Encode && (String.prototype.utf8Encode = function () { return unescape(encodeURIComponent(this)) }), "undefined" == typeof String.prototype.utf8Decode && (String.prototype.utf8Decode = function () { try { return decodeURIComponent(escape(this)) } catch (e) { return this } }), "undefined" == typeof String.prototype.base64Encode && (String.prototype.base64Encode = function () { if ("undefined" != typeof btoa) return btoa(this); if ("undefined" != typeof Buffer) return new Buffer(this, "binary").toString("base64"); throw new Error("No Base64 Encode") }), "undefined" == typeof String.prototype.base64Decode && (String.prototype.base64Decode = function () { if ("undefined" != typeof atob) return atob(this); if ("undefined" != typeof Buffer) return new Buffer(this, "base64").toString("binary"); throw new Error("No Base64 Decode") }), "undefined" != typeof module && module.exports && (module.exports = Aes.Ctr);


//////////////////////////////////////////////////////////////////////
// ã€æ¡†æ¶å…¨å±€ã€‘ å˜é‡ã€æ–¹æ³•åŒºåŸŸ
//////////////////////////////////////////////////////////////////////

// TODO å½“å‰åº”ç”¨ç¯å¢ƒï¼Œå‘å¸ƒæ—¶è®°å¾—ä¿®æ”¹ã€‚prod-æ­£å¼ç¯å¢ƒï¼Œä¸æ‰“æ—¥å¿—ï¼›dev-å¼€å‘ç¯å¢ƒï¼›debug-è°ƒè¯•ç¯å¢ƒ
const currActive = "dev";
function isProd() {
    if (currActive && currActive.toLowerCase() === "prod" || import.meta.env.PROD) return true;
    return false;
}

// å…¨å±€å¼‚å¸¸æ•è·
// https://juejin.cn/post/7031876097390149645
var isGlobalErrorCatchAllow = true;
if (isGlobalErrorCatchAllow) {
    /*
    // error äº‹ä»¶ç›‘å¬å¯ä»¥æ›¿ä»£è¿™ä¸ªæ–¹æ³•
    window.onerror = function (message, source, lineno, colno, error) {
        console.log("catch error:", {message, source, line, col, error});
        // message: é”™è¯¯çš„ä¿¡æ¯
        // source:  é”™è¯¯å‘ç”Ÿçš„æ–‡ä»¶
        // lineno:  é”™è¯¯å‘ç”Ÿçš„è¡Œæ•°
        // colno:   é”™è¯¯å‘ç”Ÿçš„åˆ—æ•°
        // error:   é”™è¯¯å¯¹è±¡
    };
    */

    window.addEventListener('error', (e) => {
        //console.log(">>>> error: " + JSON.stringify(e));
        // é˜»æ­¢äº‹ä»¶å†’æ³¡å’Œé»˜è®¤è¡Œä¸º
        doEventDefault(e);
        doGlobalError(e, (sysConfig && sysConfig.alertErrorCount) ? sysConfig.alertErrorCount : 3);
        return false; // è¿™æ ·ä¹Ÿå¯ä»¥é˜»æ­¢äº‹ä»¶å†’æ³¡å’Œé»˜è®¤è¡Œä¸º
    }, true);

    window.addEventListener('unhandledrejection', (e) => {
        doEventDefault(e);
        doGlobalError(e, (sysConfig && sysConfig.alertErrorCount) ? sysConfig.alertErrorCount : 3);
        return false;
    }, true);

}


// å¼‚å¸¸ä¿¡æ¯å¤„ç†
function doGlobalErrorMsg(e, isAlert) {
    // æ§åˆ¶å°æ‰“å°
    console.error(e);
    // æ‰“å°è°ƒç”¨å †æ ˆ
    printStack();
    // é”™è¯¯ä¿¡æ¯æ‹¼æ¥
    let eMsg;
    if (e.stack) eMsg = e.stack;
    if (!eMsg && (e instanceof ErrorEvent)) eMsg = e.message + ", " + e.lineno + ", " + e.colno;
    if (!eMsg) eMsg = e.message;
    if (eMsg && eMsg.includes("æ‰‹åŠ¨ç»“æŸç¨‹åº")) isAlert = false;
    // ç§»åŠ¨ç«¯çª—å£æ˜¾ç¤º
    console.log("âš ï¸ ç¨‹åºå‡ºç°é”™è¯¯: \n" + eMsg);
    // å¼¹çª—æç¤º
    if (isAlert) alert("âš ï¸ ç¨‹åºå‡ºç°é”™è¯¯: \n" + eMsg);
}


// å…³é—­æ•´ä¸ªé¡¹ç›®console.logçš„æ–¹æ³•
// https://blog.csdn.net/halo1416/article/details/122595285
// console.log é‡å†™
const isDebug = !isProd(); // æ§åˆ¶æ˜¯å¦å±è”½å…¨å±€ console.log æ—¥å¿—ï¼›isDebug è®¾ä¸º false å³å¯å±è”½
if (isProd()) console.log = (function (oldLogFunc) {
    return function () {
        if (isDebug) {
            oldLogFunc.apply(this, arguments);
        }
    }
})(console.log);


// ç§»åŠ¨ç«¯æ˜¾ç¤ºconsole.logæ—¥å¿—ã€ä¼šå¯¼è‡´ä¸¥é‡å¡é¡¿ï¼Œä»…åœ¨æ’æŸ¥é—®é¢˜æ—¶ä½¿ç”¨ã€‘
// https://blog.csdn.net/ChenX_Web/article/details/99721636
onMounted(() => {
    let isShowInfoConsole = false;
    let infoConsole = document.getElementById('info');
    if (!isShowInfoConsole && infoConsole) infoConsole.style.display = "none";
    if (isShowInfoConsole && infoConsole) {
        if (console) {
            let _console = {
                log: console.log
            }
            console.log = function (attr) {
                _console.log(attr);
                //let str = JSON.stringify(attr, null, 4);
                let str = attr.toString();
                let node = document.createElement("H1");
                let textnode = document.createTextNode(str);

                node.appendChild(textnode);
                infoConsole.appendChild(node);
                // æ»šåŠ¨åˆ°åº•éƒ¨ï¼Œæ˜¾ç¤ºæœ€æ–°æ—¥å¿—
                infoConsole.scrollTop = infoConsole.scrollHeight;
            }
        }

        function show() {
            // æ»šåŠ¨åˆ°åº•éƒ¨ï¼Œæ˜¾ç¤ºæœ€æ–°æ—¥å¿—
            infoConsole.scrollTop = infoConsole.scrollHeight;
            let type = infoConsole.getAttribute("type");
            if (type === "0") { // æ”¶èµ·
                infoConsole.style.cssText = "width:20px;height:20px;";
                infoConsole.setAttribute("type", "1");
                // æ¸…ç©ºæ—¥å¿—
                if (confirm("æ˜¯å¦æ¸…ç©ºæ—¥å¿—è®°å½•ï¼Ÿ")) {
                    console.clear();
                    infoConsole.innerHTML = "";
                } else { }
            } else { // å±•å¼€
                infoConsole.removeAttribute('style');
                infoConsole.setAttribute("type", "0");
            }
        }
    }
})


// æ‰“å°è°ƒç”¨å †æ ˆ
function printStack() {
    let stack = (new Error()).stack;
    console.log(stack);
}


// åˆ¤æ–­å®¢æˆ·ç«¯
// åˆ¤æ–­å®¢æˆ·ç«¯
const os = function () {
    let ua = navigator.userAgent,
        isChrome = /(?:Chrome|CriOS)/.test(ua),
        isFireFox = /(?:Firefox)/.test(ua),
        isWindowsPhone = /(?:Windows Phone)/.test(ua),
        isSymbian = /(?:SymbianOS)/.test(ua) || isWindowsPhone,
        isAndroid = /(?:Android)/.test(ua),
        isIPhone = /(?:iPhone)/.test(ua),
        isTablet = /(?:iPad|PlayBook)/.test(ua) || (isAndroid && !/(?:Mobile)/.test(ua)) || (isFireFox && /(?:Tablet)/.test(ua)),
        isIPadPro = !isIPhone && !isAndroid && !isSymbian && isIpadPro(),
        isPc = !isIPhone && !isAndroid && !isSymbian && !isTablet && !isIPadPro;
    return {
        isTablet: isTablet || isIPadPro,
        isIPhone: isIPhone,
        isAndroid: isAndroid,
        isPc: isPc
    };
}();


// iPad pro UA æœ‰æ”¹åŠ¨ï¼Œéœ€è¦ç‰¹æ®Šåˆ¤æ–­
// https://blog.csdn.net/Min_Fox/article/details/135225990
function isIpadPro() {
    var ua = window.navigator.userAgent;
    var IsIPad = false;
    if (/ipad/i.test(ua)) {
        IsIPad = true;
    }
    // iPad from IOS13
    var macApp = ua.match(/Macintosh/i) != null;
    if (macApp) {
        // need to distinguish between Macbook and iPad
        var canvas = document.createElement('canvas');
        if (canvas != null) {
            var context = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
            if (context) {
                var info = context.getExtension('WEBGL_debug_renderer_info');
                if (info) {
                    var renderer = context.getParameter(info.UNMASKED_RENDERER_WEBGL);
                    //console.log(renderer);
                    // TODO è¿™ä¸ªåˆ¤æ–­éœ€è¦çœŸå®è®¾å¤‡ã€æˆ–Mac xcodeæ¨¡æ‹Ÿè®¾å¤‡éªŒè¯
                    if (renderer.indexOf('Apple') != -1) IsIPad = true;
                }
            }
        }
    }

    // å¤šè§¦ç‚¹åˆ¤æ–­ã€å±å¹•åˆ†è¾¨ç‡å®½é«˜åˆ¤æ–­
    IsIPad = isProd() ? (navigator.maxTouchPoints > 1 && window.screen.height > window.screen.width) : (window.screen.height > window.screen.width);

    return IsIPad;
}


// åˆ¤æ–­æ˜¯å¦ä¸ºVUE
function isVue() {
    return window.__VUE__ === true || window.app;
}


// è·å–è®¾å¤‡å±å¹•åƒç´ æ¯”ï¼Œç”¨äºè§£å†³å›¾å½¢æ¨¡ç³Šã€é”¯é½¿é—®é¢˜
// TODO æ‰€æœ‰å•ç‹¬è®¾ç½®çº¿å®½çš„åœ°æ–¹éƒ½è¦ * dprï¼Œæ³¨æ„ï¼Œä¸åŠå¾„ç›¸å…³å‚æ•°ä¸ç”¨ï¼Œå› ä¸ºåŠå¾„å·²ç»è®¡ç®—è¿‡äº†
let dpr = window.devicePixelRatio;
dpr = roundNumber(dpr, 4);
console.log(">>>> dpr=" + dpr); // 2/2.7/3


// è·å–é¼ æ ‡ç§»åŠ¨ç‚¹åæ ‡
let mouse = null; // æ”¾åœ¨è®¾ç½®ç”»å¸ƒä½ç½®åå†åˆå§‹åŒ–èµ‹å€¼
let screenPos = { x: 0, y: 0 }; // å±å¹•å¯è§åæ ‡ï¼Œä¸ç®—dpr
function captureMouse(element) {
    mouse = { // 
        x: 0,
        y: 0,
        event: null
    };
    let body_scrollLeft = document.body.scrollLeft;
    let element_scrollLeft = document.documentElement.scrollLeft;
    let body_scrollTop = document.body.scrollTop;
    let element_scrollTop = document.documentElement.scrollTop;
    let offsetLeft = element.offsetLeft;
    let offsetTop = element.offsetTop;
    console.log(">>>> captureMouse offsetLeft:" + offsetLeft + ", offsetTop:" + offsetTop);

    if (os.isPc) { // PCç«¯
        //element.addEventListener('mousedown', (e) => {
        element.addEventListener('mousemove', (e) => {
            let x, y;
            if (e.pageX || e.pageY) { // é¡µé¢å·¦ä¸Šè§’ä¸ºåŸç‚¹
                x = e.pageX;
                y = e.pageY;
            } else { // å¯è§†çª—å£çš„å·¦ä¸Šè§’
                x = e.clientX + body_scrollLeft + element_scrollLeft;
                y = e.clientY + body_scrollTop + element_scrollTop;
            }

            screenPos.x = x;
            screenPos.y = y;

            x -= offsetLeft;
            y -= offsetTop;

            mouse.x = x * dpr;
            mouse.y = y * dpr;
            //console.log(">>>> mouse.x=" + mouse.x + ", mouse.y=" + mouse.y);
            mouse.event = e;
        }, false);

    } else { // ç§»åŠ¨ç«¯
        //element.addEventListener('touchstart', (e) => {
        element.addEventListener('touchmove', (e) => {
            let x, y;

            x = e.touches[0].pageX;
            y = e.touches[0].pageY;

            screenPos.x = x;
            screenPos.y = y;

            x -= offsetLeft;
            y -= offsetTop;

            mouse.x = x * dpr;
            mouse.y = y * dpr;
            mouse.event = e;
        }, false);
    }

    return mouse;
};


// è·å–é¼ æ ‡ç‚¹å‡»åæ ‡
let clickPos = null;
function getClickPos(e) {
    if (!e || e.type === "touchend") return;
    //console.log(e);
    //console.log(e.target);
    let element = e.target;
    let offsetLeft = element.offsetLeft;
    let offsetTop = element.offsetTop;
    //console.log(">>>> getClickPos offsetLeft:" + offsetLeft + ", offsetTop:" + offsetTop);
    clickPos = { x: 0, y: 0 };
    let x, y;
    if (e.pageX && typeof e.pageX === "number") {
        x = e.pageX;
        y = e.pageY;
    } else if (e.touches[0]) {
        x = e.touches[0].pageX;
        y = e.touches[0].pageY;
    }
    x -= offsetLeft;
    y -= offsetTop;
    clickPos.x = x * dpr;
    clickPos.y = y * dpr;
    mouse.x = clickPos.x;
    mouse.y = clickPos.y;
    console.log(">>>> getClickPos clickPos.x=" + clickPos.x + ", clickPos.y=" + clickPos.y);
    return clickPos;
}


// æ—‹è½¬åæ ‡ç³»
function rotate(x, y, sin, cos, reverse) {
    return {
        x: (reverse) ? (x * cos + y * sin) : (x * cos - y * sin),
        y: (reverse) ? (y * cos - x * sin) : (y * cos + x * sin)
    };
}


// ç›‘å¬é¡µé¢å¤§å°å˜åŒ–ï¼Œé‡æ–°è°ƒæ•´ç”»å¸ƒåŠå°çƒå¤§å°
function resetCanvasSize() {
    // dpr æ²¡å˜ä¸åˆ·æ–°
    if (roundNumber(window.devicePixelRatio, 4) === dpr) return;
    // ç›´æ¥åˆ·æ–°ä¸€æ¬¡é¡µé¢å°±å¥½
    location.reload();
    /*ä¼šå­˜åœ¨å¾ˆå¤šå†å²å˜é‡å½±å“ï¼Œballsã€linesã€linesMiddlePoints ç­‰æ•°ç»„å˜é‡è¦æ¸…ç©º
    // é‡æ–°åˆå§‹åŒ–
    init();
    // æ¸²æŸ“å®Œæˆæ ‡è¯†false
    isAnimated = false;
    // æ¸…ç©ºä¸€æ¬¡ç”»å¸ƒ
    context.clearRect(0, 0, canvas.width, canvas.height); // æ¸…ç†ä¸å¹²å‡€
    context.beginPath(); // å¼€å¯æ–°pathï¼Œé¿å…æ¸…ç†ä¸å¹²å‡€
    // é‡æ–°æ¸²æŸ“
    if (!isPlaying) animate();
    */
}
window.addEventListener('resize', resetCanvasSize); // å¯¹åŒä¸€ä¸ªå…ƒç´ çš„åŒä¸€ä¸ªäº‹ä»¶é‡å¤æ·»åŠ ç›‘å¬å‡½æ•°ï¼Œåªä¼šç”Ÿæ•ˆä¸€æ¬¡


// æ£€æµ‹æ˜¯å¦å¯ä»¥ä½¿ç”¨ï¼Œæµè§ˆå™¨æ”¯æŒï¼Œä»¥åŠæµè§ˆå™¨éšç§è®¾ç½®å…è®¸
function checkWebStorage() {
    let result = false;

    if (window.localStorage) {
        try {
            localStorage.setItem('collide-try-role-chose-test', 1);
            let testVal = localStorage.getItem('collide-try-role-chose-test');
            localStorage.removeItem('collide-try-role-chose-test');
            if (!testVal) throw new Error(">>>> å½“å‰æµè§ˆå™¨æ”¯æŒ localStorageï¼Œä½†ä½¿ç”¨å¼‚å¸¸ï¼Œè¯·æ£€æŸ¥æ˜¯å¦å¼€å¯äº†ã€æ— ç—•æ¨¡å¼ã€‘");
            result = true;
        } catch (e) {
            alert(e.message);
        }
    } else {
        alert(">>>> å½“å‰æµè§ˆå™¨ä¸æ”¯æŒ localStorageï¼Œè¯·æ£€æŸ¥æ˜¯å¦å¼€å¯äº†ã€æ— ç—•æ¨¡å¼ã€‘ï¼Œæˆ–å‡çº§æµè§ˆå™¨ç‰ˆæœ¬ï¼Œæˆ–æ›´æ¢å…¶ä»–æµè§ˆå™¨");
    }

    if (result) return result;

    /*
    if (window.sessionStorage) {
        try {
            sessionStorage.setItem('collide-try-role-chose-test', 1);
            let testVal = sessionStorage.getItem('collide-try-role-chose-test');
            sessionStorage.removeItem('collide-try-role-chose-test');
            if (!testVal) throw new Error(">>>> å½“å‰æµè§ˆå™¨æ”¯æŒ sessionStorageï¼Œä½†ä½¿ç”¨å¼‚å¸¸ï¼Œè¯·æ£€æŸ¥éšç§è®¾ç½®æ˜¯å¦è¿‡äºä¸¥æ ¼");
            result = true;
        } catch (e) {
            alert(e.message);
        }
    } else {
        alert(">>>> å½“å‰æµè§ˆå™¨ä¸æ”¯æŒ sessionStorageï¼Œè¯·å‡çº§æµè§ˆå™¨ç‰ˆæœ¬ï¼Œæˆ–è€…æ›´æ¢å…¶ä»–æµè§ˆå™¨");
    }
    */

    return result;
}


// JS æ£€æµ‹å½“å‰ç¯å¢ƒæ˜¯å¦å¤„äºæ·±è‰²æ¨¡å¼
// https://juejin.cn/post/7080567228029992996
var isLightMode = true;
var isDarkMode = false;
try {
    isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches;
    isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;
} catch (e) {
    doGlobalErrorMsg(e, false);
}
console.log(">>>> isLightMode=" + isLightMode);
console.log(">>>> isDarkMode=" + isDarkMode);


// ç›‘å¬è¿”å›
// popstate æ–¹æ¡ˆï¼Œå¿…é¡»æ‰‹åŠ¨ç‚¹ä¸€ä¸‹é¡µé¢ä»»ä½•åœ°æ–¹ï¼Œæ‰ä¼šè§¦å‘ï¼
// chrome ä¸ºäº†é˜²æ­¢æµæ°“ç½‘ç«™ç¦æ­¢ç”¨æˆ·æ‰§è¡Œå›é€€æ“ä½œï¼ŒæŠŠç”¨æˆ·å›°åœ¨å½“å‰ç½‘ç«™ï¼Œä¸“é—¨åšçš„è¿™ä¸ªè®¾è®¡ï¼
onMounted(() => {
    pushHistory();
    window.addEventListener("popstate", function (e) { // åé€€ã€å‰è¿›éƒ½ä¼šè§¦å‘
        //console.log(e);
        e.preventDefault();
        //alert("æˆ‘ç›‘å¬åˆ°äº†æµè§ˆå™¨çš„è¿”å›æŒ‰é’®äº‹ä»¶å•¦"); // æ ¹æ®è‡ªå·±çš„éœ€æ±‚å®ç°è‡ªå·±çš„åŠŸèƒ½
        pushHistory();
        // å¤„ç†è¿”å›äº‹é¡¹
        doBack();
    }, false);
});

function pushHistory() {
    //let ts = new Date().getTime().toString();
    /*
    var state = {
        title: "title",
        url: "#"
    };
    window.history.pushState(state, "title", "#");
    */
    //window.history.pushState(null, null, "#");
    history.pushState(null, null, document.URL);
}
var backClickCount = 0;
var backClickTimer = 0;
function doBack() {
    // å¼¹çª—é®ç½©
    let isDialogMaskShowing = isDialogShowing(dialogMask);
    // é€‰æ‹©è§’è‰²å¼¹çª—
    let isChooseRoleDialogShowing = isDialogShowing(chooseRoleDialog);
    // æ¸¸æˆè®¾ç½®å¼¹çª—
    let isUserSettingDialogShowing = isDialogShowing(userSettingDialog);
    // å…³äºåº”ç”¨å¼¹çª—
    let isAboutAppDialogShowing = isDialogShowing(aboutAppDialog);
    // æ›´æ–°æç¤ºå¼¹çª—
    let isUpdateContentDialogShowing = isDialogShowing(updateContentDialog);
    // æ“ä½œæŒ‡å—å¼¹çª—
    let isHowToPlayDialogShowing = isDialogShowing(howToPlayDialog);

    // å…³é—­æ›´æ–°æç¤ºå¼¹çª—
    if (isUpdateContentDialogShowing) {
        showUpdateContent(false);
        return;
    }

    // å…³é—­æ“ä½œæŒ‡å—å¼¹çª—
    if (isHowToPlayDialogShowing) {
        showHowToPlay(false);
        return;
    }

    // å…³é—­å…³äºåº”ç”¨å¼¹çª—
    if (isAboutAppDialogShowing) {
        switchDialogShow(aboutAppDialog, false);
        return;
    }

    // å…³é—­æ¸¸æˆè®¾ç½®å¼¹çª—
    if (isUserSettingDialogShowing) {
        switchUserSettingDialog(false);
        return;
    }

    // æ¸¸æˆæ­£åœ¨è¿›è¡Œ
    if (checkIsMoving()) {
        //alert("ğŸ‘‰ æ¸¸æˆæ­£åœ¨è¿›è¡Œï¼Œä¸å»ºè®®è¿”å›å“¦~");
        return;
    } else {
        if (!backClickTimer) backClickTimer = setTimeout(() => {
            backClickCount = 0;
            backClickTimer && clearTimeout(backClickTimer);
            backClickTimer = 0;
        }, 3000);
        backClickCount += 1;
        if (backClickCount > 2) {
            alert("ğŸ‘‰ åˆ·æ–°é¡µé¢é‡é€‰è§’è‰²ï¼Œå…³æ‰é¡µé¢é€€å‡ºæ¸¸æˆ");
            backClickCount = 0;
        }
    }

    /*
    // é€€å‡ºæ¸¸æˆ
    if (!isChooseRoleDialogShowing) { // æ¸¸æˆç•Œé¢
        window.history.go(0); // å›åˆ°èµ·å§‹ç•Œé¢
        return;
    } else { // é€‰æ‹©è§’è‰²ç•Œé¢
        //window.history.go(0); // å›åˆ°èµ·å§‹ç•Œé¢
        window.history.forward(1); // ç‚¹åé€€åˆå‰è¿›ï¼Œç›¸å½“äºæ²¡åŠ¨ï¼Œè¾¾åˆ°å±è”½åé€€æŒ‰é’®çš„æ•ˆæœ
        return;
        if (confirm("ğŸ’¡ ç¡®å®šè¦ç¦»å¼€æ¸¸æˆäº†å—ï¼Ÿ")) { // ç¡®è®¤
            window.opener = null;
            window.open('', '_self');
            // Scripts may close only the windows that were opened by them.
            // window.close()æ–¹æ³•åªèƒ½å…³é—­ç”±window.open()æˆ–è€…æµè§ˆå™¨ç›´æ¥è¾“å…¥urlæ‰“å¼€çš„é¡µé¢ï¼Œå…¶ä½™æƒ…å†µå®‰å…¨è€ƒè™‘æ˜¯è¢«é™åˆ¶çš„
            window.close(); // jså…³ä¸äº†ï¼Œéœ€è¦æŒ‰é’®ç‚¹å‡»è°ƒç”¨
        } else { // å–æ¶ˆ
            // ignore
        }
        return;
    }
    */
}


// window å…¨å±€ç‚¹å‡»ç©ºç™½äº‹é¡¹å¤„ç†
window.onclick = function (e) {
    doEventDefault(e); // å¤„ç†äº‹ä»¶é»˜è®¤è¡Œä¸ºï¼Œé˜²æ­¢å‡ºç°ç‚¹ä¸€æ¬¡ï¼Œæ‰§è¡Œä¸¤æ¬¡
    // ç‚¹å‡»äº†ä¸»é¢˜è®¾ç½®ä¸‹æ‹‰æ¡†ä»¥å¤–çš„åŒºåŸŸ
    if (!e.target.matches('.dropbtn')) {
        let themeDropdown = document.getElementById("themeDropdown");
        if (themeDropdown.classList.contains('show')) {
            themeDropdown.classList.remove('show');
        }
    }
}


// æµè§ˆå™¨çª—å£å…³é—­æˆ–è€…åˆ·æ–°æ—¶ã€ä¸€å®šè¦åœ¨å…³é—­é¡µé¢å‰ç§»é™¤æ‰€æœ‰ç›‘å¬äº‹ä»¶ï¼Ÿé¡µé¢å…³é—­è‡ªåŠ¨å¤„ç†äº†å•Šã€‘
// ä¼šå¯¼è‡´é‡æ–°åŠ è½½ä¸€ç›´æç¤º â€œç³»ç»Ÿå¯èƒ½ä¸ä¼šä¿å­˜æ‚¨æ‰€åšçš„æ›´æ”¹â€
/*
window.addEventListener("beforeunload", (event) => {
    // Cancel the event as stated by the standard.
    event.preventDefault();
    // Chrome requires returnValue to be set.
    event.returnValue = "";
});
*/


/*
// ç›‘å¬æµè§ˆå™¨åˆ‡æ¢é¡µé¢ã€‚åˆ¤æ–­ç”¨æˆ·æµè§ˆçš„æ˜¯å¦ä¸ºå½“å‰é¡µï¼Œæ ¹æ®å½“å‰é¡µé¢æ¿€æ´»çŠ¶æ€ï¼Œè¿›è¡Œä¸šåŠ¡å¤„ç†
// Documentï¼šhidden å±æ€§
var hiddenProperty = 'hidden' in document ? 'hidden' :
'webkitHidden' in document ? 'webkitHidden' :
'mozHidden' in document ? 'mozHidden' :
null;
var visibilityChangeEvent = hiddenProperty.replace(/hidden/i, 'visibilitychange');
var onVisibilityChange = function() {
    if (document[hiddenProperty]) { // hidden===true éæ¿€æ´»
        console.log('é¡µé¢éæ¿€æ´»');
    } else {
        console.log('é¡µé¢æ¿€æ´»')
    }
}
document.addEventListener(visibilityChangeEvent, onVisibilityChange);
*/


// è·å–æ­£å¸¸å±•ç¤º Emoji æ—¶çš„å®½åº¦
// https://cloud.tencent.com/developer/article/2211194
const getTextWidth = (text) => {
    const element = document.createElement('span');
    element.setAttribute('aria-hidden', 'true');
    element.setAttribute('style', 'font-size:16px!important;position:absolute;top:0;opacity:0;font-family:Consolas,"Liberation Mono","Courier New",monospace');
    element.textContent = text;
    document.body.appendChild(element);
    const width = element.clientWidth;
    document.body.removeChild(element);
    return width;
}

// icon å…¼å®¹æ—§æœºå‹
//const iconWidth = getTextWidth(Role.getRoleIconById(Role.SHUANGZI.id));
const iconWidth = getTextWidth("ğŸ§â€â™‚ï¸");
//const iconWidth = getTextWidth("ğŸƒâ€â™‚ï¸â€â¡ï¸");
console.log(">>>> iconWidth=" + iconWidth);

// æ£€éªŒ Emoji èƒ½å¦è¢«æ­£å¸¸å±•ç¤º
const isEmojiValid = (emoji) => {
    return getTextWidth(emoji) === iconWidth && iconWidth >= 14;
}

// åŒå­åˆ†èº«å›¾æ ‡æ˜¯å¦èƒ½æ­£å¸¸æ˜¾ç¤º
//const isTwinSingleIconShow = isEmojiValid("ğŸ§") && isEmojiValid("ğŸ§â€â™‚ï¸"); // TODO let const å®šä¹‰çš„å˜é‡ï¼Œåœ¨å®šä¹‰ä¹‹å‰ä¸èƒ½è®¿é—®
var isTwinSingleIconShow = isEmojiValid("ğŸ§") && isEmojiValid("ğŸ§â€â™‚ï¸"); // var å¯ä»¥å…¨å±€è®¿é—®åˆ°ä¸ºåˆå§‹åŒ–çš„å˜é‡ï¼ˆåªæœ‰é»˜è®¤å€¼ï¼‰ï¼Œä¸å—å®šä¹‰ä½ç½®é™åˆ¶
var isTwinLeftIconShow = isEmojiValid("ğŸƒ");
var isTwinRightIconShow = isEmojiValid("ğŸƒâ€â™‚ï¸â€â¡ï¸");
console.log(">>>> isTwinSingleIconShow=" + isTwinSingleIconShow);
//console.log(">>>> twinSingleIconWidth=" + getTextWidth("ğŸ§"));
//console.log(">>>> twinSingleIconWidth=" + getTextWidth("ğŸ§â€â™‚ï¸"));
//console.log(">>>> twinSingleIconWidth=" + getTextWidth("ğŸƒâ€â™‚ï¸â€â¡ï¸"));

// ç”°å›­ä¸»é¢˜-æœ¨å¤´å›¾æ ‡æ˜¯å¦èƒ½æ­£å¸¸æ˜¾ç¤º
var isWoodIconShow = getTextWidth("ğŸªµ") >= 14;
console.log(">>>> isWoodIconShow=" + isWoodIconShow);

// é»˜è®¤ä¸»é¢˜-çŸ³å¤´å›¾æ ‡æ˜¯å¦èƒ½æ­£å¸¸æ˜¾ç¤º
var isRockIconShow = getTextWidth("ğŸª¨") >= 14;
console.log(">>>> isRockIconShow=" + isRockIconShow);

// æ˜Ÿé™…ä¸»é¢˜-åœŸæ˜Ÿå›¾æ ‡æ˜¯å¦èƒ½æ­£å¸¸æ˜¾ç¤º
var isRingedIconShow = getTextWidth("ğŸª") >= 14;
console.log(">>>> isRingedIconShow=" + isRingedIconShow);


//////////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////////
// ã€åŠ å¯†è§£å¯†ã€‘ å˜é‡ã€æ–¹æ³•åŒºåŸŸ
//////////////////////////////////////////////////////////////////////

// æ ¸å¿ƒæ–¹æ³•è§£å¯†ï¼ŒåŠ¨æ€æ·»åŠ 
function addCoreScript(eles, eleId, eleClass, content, targetId) {
    if (eles && eles instanceof HTMLCollection) {
        for (let i = 0, len = eles.length; i < len; i++) {
            //document.head.appendChild(eles[i]);
            document.body.appendChild(eles[i]);
        }
        if (!content) return true;
    }
    if (!content) return false;
    let enScript = document.getElementById(eleId);
    if (!enScript) enScript = document.createElement('script');
    enScript.type = 'text/javascript';
    if (eleId) enScript.setAttribute('id', eleId);
    if (eleClass) enScript.setAttribute('class', eleClass);
    enScript.textContent = content;
    let targetEle = document.getElementById(targetId);
    if (targetEle) targetEle.appendChild(enScript);
    //document.head.appendChild(enScript);
    else document.body.appendChild(enScript);
    return true;
}

onMounted(() => {
    //addCoreScript(null, "test-balls", null, "alert(balls.length)", "app-main");
})

// ç§»é™¤æ ¸å¿ƒæ–¹æ³•[ç‹—å¤´]
// ç§»é™¤ script æ ‡ç­¾ï¼Œä¸ä¼šå½±å“å·²ç»åŠ è½½è¿›å†…å­˜çš„ script
function removeCoreScript(eles, eleIdOrClass) {
    if (eles && eles instanceof HTMLCollection) {
        for (let i = 0, len = eles.length; i < len; i++) {
            eles[i].remove(); // éƒ½ä¼šæŠŠå…ƒç´ ä» eles ä¸­ç§»é™¤
            //document.body.removeChild(eles[i]);
        }
        if (!eleIdOrClass) return true;
    }
    if (!eleIdOrClass) return false;
    let ele = document.getElementById(eleIdOrClass);
    if (!ele) ele = document.getElementsByClassName(eleIdOrClass);
    if (!ele) return false;
    //console.log(ele);
    if (ele instanceof HTMLCollection) {
        for (let i = 0, len = ele.length; i < len; i++) {
            ele[i].remove();
            //document.body.removeChild(ele[i]);
        }
        return true;
    } else {
        ele.remove();
        return true;
    }
    return false;
}


let accessKey = null;
let accessMsg = "ğŸ”‘ è¯·è¾“å…¥è®¿é—®å¯†é’¥";
let codeStr = null;
let encodeStr = "fAE9aAJXpmYCxrWJL/hIKhFvLVbtb19viIlXp6sR7qDxD6UBQWc+vruy9Epl0tPXaPsyI2wW6CNUo5obVRzs0wJCo5WgBw69wQaZPFfZtfESR82dt9xbGPckk+nFxF3ijxZ/H7U7sR57exzLtj7+RZcjydXakdUOSy4E7yrImi8mE8pA9xk+6CN2BM/aEXwwwf6LADE1st2NRoLrlOQ7QZ4uGrDzCHBvs8ZpiheUqhlKtMXY2NaiiKqXiZkDv68AOxK9+wTqc0sWueM6z0vwX7uIixVPCdPTgs/U3C+d2Jv4w9Umnn4HYxHsKEPAQhOctiOzXtcvp4Tdu4cWQknrxQaaWELqjlHuOKT3fJjhHrDCO2ZrqhwGjGnJeCc3AhosXu+7ADa8RSPSV9UHyr0mwgZ5T0z/pvaR5xlivfPMtGF0/U1FIh1onqpSRpeqipqwoTU2OuKXTxfyqZRKxFjk5qhZJO569JdABFrYjOrRaBUTxB/+mfmrT254WJT0uoG0WqOhH27Br6vsJCAy4pmcTVW3xq4eWuZZfjOZTZDt+O7AKDM5Ex9HkRwj3O3xrU0XYlp4ZE1VLforNVzFsYIRIEnKSgcDd3uQuiJRm8vnxASXcFC8Tel6Bo08EVylUle4Uj4/tPab8Xtx8FKvfDicCmvtMQb1FliU0pWjzOH3B6y53Uhl0k446HJgLH7k0E8FER8Rsj4NXpYbfx7F4cLdT66Ci3oTSUqfCPb7yMXgRSMYAOA3ONKxYtmFBhIL2w0YhvcHBcAwla3CpTMt6mhtSn62kHURYBkRaTqyOoBJRP24A2xSDi6/9TSZBkyyJFDwP7i0p9nZj+FPo+ua7yI7QNhR1vRv9jv6zpUV2hI/ahHd/dlVYTY9qS0IGlAy7w2IgUpz7qA1jjltcUg1OGBxF/0S6iJvc1BVEpYijh2H/D7QnA1HIf8a5wjZYC1uv4Z+sd12DWzFGNqZY82kUcDYLhsQNmAc8pSlOc4=";
let superKeyEnStr = "zQN6114c/2W74lv7PvypKZh8zsei8CbICQZNtqrBJyxW0xwV350Wig==";
//superKeyEnStr = Aes.Ctr.encrypt("", "", 256);
//console.log('>>>> superKeyEnStr', superKeyEnStr);
//encodeStr = Aes.Ctr.encrypt(codeStr, "", 256);
//console.log('>>>> encodeStr', encodeStr);

// æ£€æµ‹æ ¸å¿ƒä»£ç å’Œå¯†é’¥
function checkCoreCode(method, isDialog) {

    // æœ¬åœ°ç‰ˆæœ¬ä¸æ£€æµ‹
    if (isLocalVersion()) return true;

    if (!method || typeof method !== 'string' || method.length > 50) return false;
    for (let i = 0, len = 100; i < len; i++) {
        // å…ˆä» localStorage è·å– accessKey
        accessKey = localStorage.getItem('collide-try-access-key', accessKey);
        // TODO ç›®å‰å¼€æ”¾ä½¿ç”¨
        accessKey = "gSLtYnCZNLWAgUxQh0byWDt55xhGj6HU";

        if (isDialog) {
            // æ²¡æ‰¾åˆ°ï¼Œå†å¼¹çª—æç¤ºè¾“å…¥ã€è®¿é—®å¯†é’¥ã€‘
            // å•å‡»å–æ¶ˆæŒ‰é’®ï¼Œprompt() æ–¹æ³•å°†è¿”å› nullï¼Œå•å‡»ç¡®è®¤æŒ‰é’®ï¼Œprompt() å°†è¿”å›è¾“å…¥çš„æ–‡æœ¬ï¼Œå¼¹çª—æ—¶ä¼šæš‚åœ JavaScript æ‰§è¡Œ
            if (!accessKey) accessKey = prompt(accessMsg);
            //console.log(">>>> accessKey=" + accessKey);
            if (accessKey === null) { // ç‚¹äº†å–æ¶ˆ
                accessMsg = "ğŸ”‘ è¯·è¾“å…¥è®¿é—®å¯†é’¥";
                alert("ğŸ’¡ æ¸©é¦¨æç¤ºï¼š\næ²¡æœ‰è®¿é—®å¯†é’¥ï¼Œæ ¸å¿ƒåŠŸèƒ½ä¼šå—åˆ°å½±å“ï¼è¯·è”ç³»å¼€å‘è€…è·å–è®¿é—®å¯†é’¥");
                return false;
            }
            if (!accessKey || accessKey.replaceAll(" ", "") === "") {
                accessMsg = "âŒ è®¿é—®å¯†é’¥ä¸èƒ½ä¸ºç©º";
                continue;
            }
            if (accessKey.length < 8 || accessKey.length > 128) {
                accessMsg = "âŒ è®¿é—®å¯†é’¥é•¿åº¦é”™è¯¯";
                continue;
            }
        }

        if (!accessKey) {
            console.log(">>>> checkCoreCode accessKey empty");
            return false;
        }

        try {
            //encodeStr = Aes.Ctr.encrypt(codeStr, accessKey, 256);
            //console.log(encodeStr);
            if (accessKey.toLowerCase().includes("thelight")) accessKey = Aes.Ctr.decrypt(superKeyEnStr, accessKey, 256);
            //console.log(">>>> accessKey=" + accessKey);
            codeStr = Aes.Ctr.decrypt(encodeStr, accessKey, 256);
            //console.log(codeStr); // å¯†é’¥ä¸å¯¹ï¼Œè¿”å›æ˜¯ä¹±ç  QÂƒÂªÃ‘g=[JLÃ¤Ã³jÂ´qÃ€Â76

            // åŠ¨æ€æ·»åŠ  do2BallsCollidedMV2 æ–¹æ³•
            if (codeStr && codeStr.includes(method)) addCoreScript(null, method, 'collide-try-core-code', codeStr);
            else throw new Error(">>>> Decrypt failed. Please check your accessKey!");
            // å°è¯•è°ƒç”¨éªŒè¯
            //do2BallsCollidedMV2();
            Function('return ' + method + '()')(); // TODO Function å‡½æ•°ä½œç”¨åŸŸè®¿é—®ä¸åˆ° vue å†…éƒ¨æ¨¡æ¿ï¼Œä½†æ˜¯èƒ½è®¿é—®åˆ°å…¨å±€ script
            // è°ƒç”¨ä¸æŠ¥é”™ï¼ŒæŠŠ accessKey å­˜å…¥ localStorage
            localStorage.setItem('collide-try-access-key', accessKey);
            codeStr = null; // é‡Šæ”¾å­—ç¬¦ä¸²å†…å­˜
            encodeStr = null;
            superKeyEnStr = null;
            //break;
            return true;
        } catch (e) {
            //doGlobalError(e, (sysConfig && sysConfig.alertErrorCount)?sysConfig.alertErrorCount:3);
            doGlobalErrorMsg(e, false);
            accessMsg = "âŒ è®¿é—®å¯†é’¥é”™è¯¯";
            localStorage.removeItem('collide-try-access-key');
            if (!isDialog) {
                accessMsg = "ğŸ”‘ è¯·è¾“å…¥è®¿é—®å¯†é’¥";
                break;
            }
        }
    }
    return false;
}

// é¡µé¢å…ƒç´ ã€è„šæœ¬ã€æ–‡ä»¶åŠ è½½å®Œæˆä¹‹åå†æ‰§è¡Œï¼Œé¿å…è·å–ä¸åˆ°å…ƒç´ 
window.onload = function () {
    checkCoreCode("do2BallsCollidedMV2", false);
}


// æ£€æµ‹è¾“å…¥çš„è®¿é—®å¯†é’¥æ˜¯å¦æ­£ç¡®
function checkAccessKey() {

    // æœ¬åœ°ç‰ˆæœ¬ä¸æ£€æµ‹
    if (isLocalVersion()) return true;

    let result = false;
    // æ ¡éªŒæ˜¯å¦è¾“å…¥äº†å¯†é’¥
    accessKey = localStorage.getItem('collide-try-access-key', accessKey);
    if (!accessKey || accessKey.replaceAll(' ', '') === '') return false;

    // æ ¡éªŒå¯†é’¥æ˜¯å¦æ­£ç¡®ï¼Œè§£å¯†æ–¹æ³•æ˜¯å¦èƒ½æ­£å¸¸è®¿é—®
    // checkCoreCode å·²ç»è§£å¯†äº†ä¸€æ¬¡ï¼Œè¿™é‡Œä¸å†é‡å¤è§£å¯†
    try {
        // å°è¯•è°ƒç”¨éªŒè¯
        do2BallsCollidedMV2();
        result = true;
    } catch (e) {
        //doGlobalErrorMsg(e, false);
    }

    return result;

    // è¿™ä¸ªæ£€æµ‹æ–¹æ³•ç›´æ¥æ”¹ä¸ºè¿”å›trueï¼Œå°±ç ´è§£ç»•è¿‡äº†
    //return true;
}


// æ˜¯å¦ä¸ºç¦»çº¿ç‰ˆæœ¬
function isLocalVersion() {
    let result = false;
    // è·å–æ ¸å¿ƒè„šæœ¬å…ƒç´ 
    let coreJsEles = document.getElementsByClassName("collide-try-core-code");
    if (!coreJsEles || coreJsEles.length < 1) return false;
    //console.log(coreJsEles);
    // å°è¯•è®¿é—®æ ¸å¿ƒæ–¹æ³•
    try {
        do2BallsCollidedMV2();
        result = true;
    } catch (e) {
        //doGlobalErrorMsg(e, false);
    }

    return result;
}


//////////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////////
// ã€ä¸»ç¨‹åºã€‘ å˜é‡ã€æ–¹æ³•åŒºåŸŸ
//////////////////////////////////////////////////////////////////////

// è·å–ç”»å¸ƒ
let gameSceneGraphCanvas = document.getElementById('game-scene-graph'); // é™æ€åœºæ™¯å¤§é¢ç§¯åŒºåŸŸæ™¯ç‰©å›¾å½¢å±‚ç”»å¸ƒ
let gameSceneEmojiCanvas = document.getElementById('game-scene-emoji'); // é™æ€åœºæ™¯æ™¯ç‰©å›¾å½¢å±‚ç”»å¸ƒ
let gameSceneCanvas = document.getElementById('game-scene'); // é™æ€åœºæ™¯å±‚ç”»å¸ƒ
let gameSceneLinesCanvas = document.getElementById('game-scene-lines'); // é™æ€åœºæ™¯è¾¹æ¡†å±‚ç”»å¸ƒ
let gameSceneCoordinateCanvas = document.getElementById('game-scene-coordinate'); // é™æ€åœºæ™¯ç –æ ¼åæ ‡å¸ƒ
let canvas = document.getElementById('game-main'); // ä¸»è¿åŠ¨å±‚ç”»å¸ƒ
let gameMainBallCanvas = document.getElementById('game-main-ball'); // ä¸»çƒè¿åŠ¨å±‚ç”»å¸ƒï¼Œä¸»çƒå’Œå…¶ä»–çƒåˆ†å¼€
let gamePathCanvas = document.getElementById('game-path'); // è§’è‰²ä¸­çº¿è·¯å¾„å±‚ç”»å¸ƒï¼ˆä¸€æ¡ç»†çº¿ï¼‰
let gamePathBallCanvas = document.getElementById('game-path-ball'); // è§’è‰²å…¨è·¯å¾„å±‚ç”»å¸ƒï¼ˆè·¯å¾„çº¿å®½ä¸ºè§’è‰²ç›´å¾„ï¼‰
let gameMaskCanvas = document.getElementById('game-mask'); // é®ç½©å±‚ç”»å¸ƒ
// è·å–ä¸Šä¸‹æ–‡
let gameSceneGraphContext = gameSceneGraphCanvas ? gameSceneGraphCanvas.getContext('2d') : null;
let gameSceneEmojiContext = gameSceneEmojiCanvas ? gameSceneEmojiCanvas.getContext('2d') : null;
let gameSceneContext = gameSceneCanvas ? gameSceneCanvas.getContext('2d') : null;
let gameSceneLinesContext = gameSceneLinesCanvas ? gameSceneLinesCanvas.getContext('2d') : null;
let gameSceneCoordinateContext = gameSceneCoordinateCanvas ? gameSceneCoordinateCanvas.getContext('2d') : null;
let context = canvas ? canvas.getContext('2d') : null;
let gameMainBallContext = gameMainBallCanvas ? gameMainBallCanvas.getContext('2d') : null;
let gamePathContext = gamePathCanvas ? gamePathCanvas.getContext('2d') : null;
let gamePathBallContext = gamePathBallCanvas ? gamePathBallCanvas.getContext('2d') : null;
let gameMaskContext = gameMaskCanvas ? gameMaskCanvas.getContext('2d') : null;
// å¼¹çª—å…ƒç´ 
let dialogMask = document.getElementById('dialog-mask'); // é€‰æ‹©è§’è‰²å¼¹çª—é®ç½©
let chooseRoleDialog = document.getElementById('choose-role-dialog'); // é€‰æ‹©è§’è‰²å¼¹çª—
let userSettingDialog = document.getElementById('user-setting-dialog'); // å‚æ•°è®¾ç½®å¼¹çª—
let gameSettingEntryDialog = document.getElementById('game-setting-entry-dialog'); // æ¸¸æˆè®¾ç½®æç¤º
let gameSettingMainRoleDialog = document.getElementById('game-setting-main-role-dialog'); // æ¸¸æˆè®¾ç½®-ä¸»è§’è®¾ç½®æç¤º
let aboutAppDialog = document.getElementById('user-setting-about-app-dialog'); // å‚æ•°è®¾ç½®-å…³äºåº”ç”¨
let updateContentDialog = document.getElementById('collide-try-update-content-dialog'); // æ›´æ–°å†…å®¹æç¤º
let howToPlayDialog = document.getElementById('collide-try-how-to-play-dialog'); // æ“ä½œæŒ‡å—æç¤º
let rolePosLine = document.getElementById('collide-try-role-pos-line'); // è§’è‰²åæ ‡æ‚¬æµ®æ¡

onMounted(() => {
    gameSceneGraphCanvas = document.getElementById('game-scene-graph'); // é™æ€åœºæ™¯å¤§é¢ç§¯åŒºåŸŸæ™¯ç‰©å›¾å½¢å±‚ç”»å¸ƒ
    gameSceneEmojiCanvas = document.getElementById('game-scene-emoji'); // é™æ€åœºæ™¯æ™¯ç‰©å›¾å½¢å±‚ç”»å¸ƒ
    gameSceneCanvas = document.getElementById('game-scene'); // é™æ€åœºæ™¯å±‚ç”»å¸ƒ
    gameSceneLinesCanvas = document.getElementById('game-scene-lines'); // é™æ€åœºæ™¯è¾¹æ¡†å±‚ç”»å¸ƒ
    gameSceneCoordinateCanvas = document.getElementById('game-scene-coordinate'); // é™æ€åœºæ™¯ç –æ ¼åæ ‡å¸ƒ
    canvas = document.getElementById('game-main'); // ä¸»è¿åŠ¨å±‚ç”»å¸ƒ
    gameMainBallCanvas = document.getElementById('game-main-ball'); // ä¸»çƒè¿åŠ¨å±‚ç”»å¸ƒï¼Œä¸»çƒå’Œå…¶ä»–çƒåˆ†å¼€
    gamePathCanvas = document.getElementById('game-path'); // è§’è‰²ä¸­çº¿è·¯å¾„å±‚ç”»å¸ƒï¼ˆä¸€æ¡ç»†çº¿ï¼‰
    gamePathBallCanvas = document.getElementById('game-path-ball'); // è§’è‰²å…¨è·¯å¾„å±‚ç”»å¸ƒï¼ˆè·¯å¾„çº¿å®½ä¸ºè§’è‰²ç›´å¾„ï¼‰
    gameMaskCanvas = document.getElementById('game-mask'); // é®ç½©å±‚ç”»å¸ƒ

    gameSceneGraphContext = gameSceneGraphCanvas.getContext('2d');
    gameSceneEmojiContext = gameSceneEmojiCanvas.getContext('2d');
    gameSceneContext = gameSceneCanvas.getContext('2d');
    gameSceneLinesContext = gameSceneLinesCanvas.getContext('2d');
    gameSceneCoordinateContext = gameSceneCoordinateCanvas.getContext('2d');
    context = canvas.getContext('2d');
    gameMainBallContext = gameMainBallCanvas.getContext('2d');
    gamePathContext = gamePathCanvas.getContext('2d');
    gamePathBallContext = gamePathBallCanvas.getContext('2d');
    gameMaskContext = gameMaskCanvas.getContext('2d');

    dialogMask = document.getElementById('dialog-mask'); // é€‰æ‹©è§’è‰²å¼¹çª—é®ç½©
    chooseRoleDialog = document.getElementById('choose-role-dialog'); // é€‰æ‹©è§’è‰²å¼¹çª—
    userSettingDialog = document.getElementById('user-setting-dialog'); // å‚æ•°è®¾ç½®å¼¹çª—
    gameSettingEntryDialog = document.getElementById('game-setting-entry-dialog'); // æ¸¸æˆè®¾ç½®æç¤º
    gameSettingMainRoleDialog = document.getElementById('game-setting-main-role-dialog'); // æ¸¸æˆè®¾ç½®-ä¸»è§’è®¾ç½®æç¤º
    aboutAppDialog = document.getElementById('user-setting-about-app-dialog'); // å‚æ•°è®¾ç½®-å…³äºåº”ç”¨
    updateContentDialog = document.getElementById('collide-try-update-content-dialog'); // æ›´æ–°å†…å®¹æç¤º
    howToPlayDialog = document.getElementById('collide-try-how-to-play-dialog'); // æ“ä½œæŒ‡å—æç¤º
    rolePosLine = document.getElementById('collide-try-role-pos-line'); // è§’è‰²åæ ‡æ‚¬æµ®æ¡
})

////////////////////////////////////////////////
// ç³»ç»Ÿå‚æ•°é…ç½®
////////////////////////////////////////////////
var sysConfig = {
    // åº”ç”¨åç§°
    appName: "ç©å§-æ’å‡»ç‹è€…-è§’è‰²è§’åº¦ç»ƒä¹ å™¨",
    // ç¨‹åºç‰ˆæœ¬å·
    version: Number(packageVersion.replaceAll(".", "") + "240801"),
    versionName: "V" + packageVersion + "-Beta",
    // è®¾å¤‡å±å¹•åƒç´ æ¯”ï¼Œinitæ–¹æ³•åˆå§‹åŒ–æ—¶æ›´æ–°
    dpr: 3,
    // åƒç´ ç¼©æ”¾æ¯”ä¾‹ï¼Œç”¨äºå¹³æ¿åƒç´ æ”¾å¤§
    pxRatio: 1,
    // æ¸¸æˆæ˜¯å¦å¼€å§‹ï¼Œä»ç¬¬ä¸€æ¬¡æ‹–åŠ¨åï¼Œå°±è®¾ç½®ä¸ºtrue
    isGameBeginning: false,
    // æ¸¸æˆè§’è‰²æ˜¯å¦é€‰æ‹©å®Œæˆï¼Œç”¨äºæ§åˆ¶æ€§èƒ½ä¼˜åŒ–
    isRoleChooseFinished: false,
    // ä¿®æ”¹å‚æ•°è®¾ç½®åï¼Œæ˜¯å¦éœ€è¦åˆ·æ–°é¡µé¢
    isNeedReload: false,
    // ç¨‹åºå‡ºé”™å‡ æ¬¡å¼¹çª—æç¤º
    alertErrorCount: 3,
    // è®¾ç½®æ¸¸æˆå°é¢å å±å¹•å®½åº¦çš„æ¯”ä¾‹
    sceneWidthRatio: 0.78,
    // è®¾ç½®æ¸¸æˆå°é¢è¾¹ç•Œå®½åº¦ï¼Œå– 0.3 * girdSizeCss
    sceneLineWidth: 6,
    // è®¾ç½®ç”»å¸ƒæ˜¾ç¤ºå¤§å°ï¼ˆcssæ ·å¼ä¸­çš„å¤§å°ï¼‰ã€å¤§å›¾ç¼©å°ä¸ä¼šæ¨¡ç³Šã€‘ï¼Œåˆå§‹åŒ–çš„æ—¶å€™ä¼šè®¡ç®—ä¿®æ”¹
    cssWidth: 0,
    cssHeight: 0,
    // è®¾ç½®Canvasç”»å¸ƒåç§»ä½ç½®
    cLeft: 0,
    cTop: 0,
    // ç½‘æ ¼å¤§å°
    girdSize: 0, // canvas å®é™…çš„ girdSize
    girdSizeCss: 0, // css ç¼©å°åçš„ girdSize
    // æ˜¯å¦ä¸ºç©å§æ’å‡»å°é¢ï¼Œåˆ‡è§’ä¸æ˜¯æ ‡å‡†çš„ 180-45=135 è€Œæ˜¯ 180-44=136
    isWan8CocosTable: true,
    // æ–œè¾¹è§’åº¦å€¾æ–œåå·®ï¼ˆå•ä½ï¼šåƒç´ ï¼‰ï¼Œåˆå§‹åŒ–çš„æ—¶å€™ä¼šæ ¹æ® girdSize é‡æ–°è®¡ç®—ï¼Œç¨‹åºå–è¿™é‡Œçš„æ•°å€¼ã€‚ç¬¬ä¸€ä¸ªå€¼å¯¹åº”ç‚¹(0, 3)ï¼Œå…¶ä»–ç‚¹å¾€é¡ºæ—¶é’ˆæ–¹å‘é€’å¢
    wan8CocosTableMoveVals: [0, 0, 0, 0, 0, 0, 0, 0],
    // ç¢°æ’æŸè€—ï¼Œç©å§è§’è‰²ç¢°å¢™æˆ–è€…ç¢°å…¶ä»–è§’è‰²ï¼Œçœ‹ç€ä¼¼ä¹æ²¡æœ‰æŸè€—ã€‚checkBounceæ–¹æ³•ï¼Œä½œç”¨åœ¨åˆé€Ÿåº¦ä¸Š
    bounce: 0,
    // è›‹æœ‰å¼¹æ€§ï¼Œç¢°æ’å¯å¢åŠ ä¸€å®šç™¾åˆ†æ¯”çš„é€Ÿåº¦
    eggBounce: 0.2, // v * eggBounce 50 * 0.2 = 10
    // æ‘©æ“¦åŠ› 0.05 0.24 ä¸€ä¸ªæ¥è¿‘0.9çš„ç³»æ•°èƒ½å¾ˆå¥½çš„æ¨¡æ‹Ÿå‡ºæ‘©æ“¦åŠ›çš„æ•ˆæœ
    friction: 0.575,
    // è§’è‰²é‡é‡æé‡ï¼Œå¯¹åº”æ•°å€¼ï¼Œé»˜è®¤ 100ï¼Œå…¶ä»–è§’è‰²ç›¸å¯¹è¿™ä¸ªå€¼çš„æ¯”ç‡å–å€¼
    maxWeightVal: 100,
    // æ˜¯å¦è¯´å†è§ï¼Œç”¨äºæ§åˆ¶æ˜¾ç¤ºå‘Šåˆ«ä¿¡æ¯
    isSayGoodbye: true,

}
console.log(">>>> sysConfig=" + JSON.stringify(sysConfig));

////////////////////////////////////////////////
// ç”¨æˆ·å‚æ•°é…ç½®
////////////////////////////////////////////////
var userConfig = {
    // ä¸»è§’è‰²é…ç½®
    currRole: -1, // é»˜è®¤æ²¡é€‰ä»»ä½•è§’è‰²ï¼Œå…·ä½“è®¾ç½®å“ªä¸ªè§’è‰²ä¼šå¼¹çª—æç¤ºç”¨æˆ·é€‰æ‹©ã€‚è§’è‰²å¯¹åº”åºå·åœ¨ Role æšä¸¾ç±»
    // åœºæ™¯ä¸»é¢˜ï¼Œ0-é»˜è®¤ä¸»é¢˜ï¼›1-å†¬å­£å†°é›ªä¸»é¢˜ï¼›2-æ–°å¹´ä¸»é¢˜ï¼›3-ç”°å›­ä¸»é¢˜ï¼›4-æ˜Ÿé™…ä¸»é¢˜
    sceneThemeMode: -1, // -1 æ²¡é€‰æ‹©ä»»ä½•ä¸»é¢˜ï¼Œæ ¹æ®æ—¶é—´å­£èŠ‚è‡ªåŠ¨è®¾ç½®
    // ä¸»è§’æ‰€åœ¨é˜Ÿé¢œè‰²
    mainTeamColor: 'r',
    // æ˜¯å¦éšæœºè§’è‰²ï¼Œå®Œå…¨éšæœº
    isRandomRole: false,
    // æ˜¯å¦æé€Ÿå¼€å§‹ï¼ŒæŒ‘é€‰å¸¸ç”¨ç»„åˆ
    isFlashRole: false,
    // æ˜¯å¦åªç”¨ä¸€ä¸ªè§’è‰²æµ‹è¯•
    isTestOnlyOne: false,
    // æ˜¯å¦æ˜¾ç¤ºå°çƒè¿åŠ¨è·¯å¾„
    isShowBallMovePath: true,
    // æ˜¯å¦æ˜¾ç¤ºå°çƒæœ¬ä½“è·¯å¾„
    isShowBallPath: false,
    // ç¢°åˆ°å¦ä¸€ä¸ªå°çƒæ˜¯å¦åœæ­¢è¿åŠ¨
    isStopAfterCollided: false,
    // åªç„å‡†ä¸æ‰“ï¼Œç”¨äºæˆªå›¾åˆ†äº«
    isJustTrying: false,
    // ç¢°ä¸¤æ¬¡ååœæ­¢ï¼Œç”¨äºæµ‹è¯•è§‚å¯Ÿè§’åº¦
    isStopAfter2WallCollided: false,
    // åªæ˜¾ç¤ºå°é¢
    isJustShowTable: false,
    // æ˜¯å¦æ˜¾ç¤ºå°é¢è¾¹æ¡†
    isShowTableBorder: true,
    // æ˜¯å¦æ˜¾ç¤ºç –æ ¼åæ ‡
    isShowGridCoordinate: true,
    // æ˜¯å¦æ˜¾ç¤ºåœºæ™¯å›¾å½¢
    isShowSceneGraph: true,
    // æ˜¯å¦æ˜¾ç¤ºè§’è‰²è¡€é‡æ¡
    isShowRoleBloodLine: true,
    // æ˜¯å¦åŒå‡»å±å¹•å›é€€
    isDbclickBack: true,
    // å‚€å„¡æ‹‰å›
    isKuileiPullBack: false,
    // ç„å‡†ç©¿é€(æå‡æµç•…)ï¼Œåªå¯¹åƒµå°¸ã€å‚€å„¡ç­‰å¯ç©¿é€è§’è‰²æœ‰æ•ˆ
    isPiercesTry: false,
    // ç„å‡†æ˜¾ç¤ºè·¯å¾„ï¼Œåªå¯¹åƒµå°¸ã€å‚€å„¡ç­‰å¯ç©¿é€è§’è‰²æœ‰æ•ˆ
    isShowTryFullPath: false,
    // ç„å‡†æ˜¾ç¤ºè·¯å¾„ï¼ŒæŒ‡å®šç¢°æ’å‡ æ¬¡çš„è·¯å¾„
    tryFullPathPointNum: 6,
    // é•¿æŒ‰é‡ç½®è§’è‰²ä½ç½®
    isLongPressRandom: true,
    // ç§»åŠ¨è§’è‰²æ˜¾ç¤ºåæ ‡ï¼ˆå•ä½ï¼šæ ¼ï¼‰
    isShowRoleMovePos: true,
    // åˆ†äº«/å¯¼å…¥è§’è‰²åŠåæ ‡
    shareRoleAndPos: "",
    // æŒ‡å®šæ¸¸æˆè§’è‰²ï¼Œæ•°é‡ä¸å¤Ÿä¼šéšæœºè¡¥æ»¡ã€‚è¾“å…¥ä¸€ä¸ªå­—å³å¯è‡ªåŠ¨è¯†åˆ«è¡¥å……è§’è‰²å…¨å
    gameRoleIds: [-1, -1, -1, -1],
    // è§’è‰²åŠ é€Ÿæˆ–å‡é€Ÿï¼ˆè´Ÿæ•°ä¸ºå‡é€Ÿï¼‰
    roleSpeedAddVal: 0,
    // å¡é¡¿è‡ªåŠ¨æ¢å¤ç­‰å¾…æ—¶é—´ï¼ˆå•ä½ï¼šç§’ï¼‰
    animateAutoRestTime: 20,
    // æ–œè¾¹è§’åº¦å€¾æ–œåå·®ï¼ˆå•ä½ï¼šæ ¼ï¼‰ï¼Œç”¨æˆ·è®¾ç½®çœ‹åˆ°çš„æ˜¯è¿™é‡Œçš„æ•°å€¼ã€‚ç¬¬ä¸€ä¸ªå€¼å¯¹åº”ç‚¹(0, 3)ï¼Œå…¶ä»–ç‚¹å¾€é¡ºæ—¶é’ˆæ–¹å‘é€’å¢
    //wan8CocosTableMoveVals: [0,0.05,-0.025,-0.025,0.05,-0.025,0.025,0.025], // æ³¨æ„ undefined æ‰¾ä¸åˆ°å€¼ï¼Œæˆ–è€…æ•°å€¼ä¸å¯¹ï¼Œéœ€è¦æ¸…é™¤ localStorage ç¼“å­˜
    wan8CocosTableMoveVals: [0, 0.05, -0.05, -0.05, 0.12, -0.025, 0.025, 0.08],

}
// ç”¨æˆ·åŸå§‹é…ç½®å¤‡ä»½
var userConfigBack = JSON.parse(JSON.stringify(userConfig));

// å…¨å±€å‚æ•°è®¾ç½®
class GlobalParams {
    constructor(options = {}) {
        /*
        å›¾å½¢å åŠ æ¨¡å¼ https://blog.csdn.net/qq_33933205/article/details/107337882
        copyï¼šåªæ˜¾ç¤ºæ–°çš„å›¾å±‚
        xorï¼šæ˜¾ç¤ºæ–°çš„å›¾å±‚å’Œæ—§çš„å›¾å±‚ï¼Œä¸æ˜¾ç¤ºé‡å çš„å›¾å±‚
        source-overï¼šé»˜è®¤å€¼ï¼Œæ–°çš„å›¾å±‚è¦†ç›–è€çš„å›¾å±‚
        destination-overï¼šæ–°çš„å›¾å±‚åœ¨è€çš„å›¾å±‚ä¸‹é¢
        */
        this.composite = options.composite || "";
        // æ‰€æœ‰ç»˜åˆ¶ä¸å—é™åˆ¶
        this.isAll = options.isAll || false;
        // åªç”»å°çƒ
        this.isBallOnly = options.isBallOnly || false;
        // ç»˜åˆ¶å›¾å½¢ï¼Œæ–‡å­—ã€iconã€imgã€svg ç­‰
        this.graph = options.graph || null;
        // é˜´å½±é¢œè‰²
        this.shadowColor = options.shadowColor || "#999";
        // è™šåŒ–èŒƒå›´
        this.shadowBlur = options.shadowBlur || "5";
    }

    static getInstance(options) {
        if (!this.instance) {
            this.instance = new GlobalParams(options);
            //console.log(">>>> GlobalParams new GlobalParams(options)");
        }
        return this.instance;
    }

    reset() {
        this.composite = "";
        this.isAll = false;
        this.isBallOnly = false;
        this.graph = null;
        this.shadowColor = "#999";
        this.shadowBlur = "5";
    }

    static getCleanParams() {
        this.getInstance();
        this.instance.reset();
        return this.instance;
    }
}
const globalParams = GlobalParams.getCleanParams();

//globalParams.graph = "test";
//console.log(globalParams);
//globalParams.reset();
//console.log(globalParams);


// åˆ¤æ–­canvasç”»å¸ƒæ˜¯å¦æœ‰ç»˜åˆ¶å†…å®¹
// https://segmentfault.com/q/1010000005820251
function isCanvasBlank(canvas) {
    let blank = document.createElement('canvas'); // åˆ›å»ºä¸€ä¸ªç©ºcanvaså¯¹è±¡
    blank.width = canvas.width;
    blank.height = canvas.height;
    return canvas.toDataURL() == blank.toDataURL(); // æ¯”è¾ƒå€¼ç›¸ç­‰åˆ™ä¸ºç©º
}

//////////////////////////////////////////////////////////////////////  


//////////////////////////////////////////////////////////////////////
// ã€Ballçƒç›¸å…³ã€‘ å˜é‡ã€æ–¹æ³•åŒºåŸŸ
//////////////////////////////////////////////////////////////////////

// çƒ/æ’å‡»è§’è‰²å¯¹è±¡
class Ball {
    constructor(context, options = {}) {
        this.context = context;
        this.x = options.x || 0; // ä½ç½®
        this.y = options.y || 0;
        this.radius = options.radius || 27; // åŠå¾„
        this.color = options.color || ''; // é¢œè‰²
        this.vx = options.vx || 0; // é€Ÿåº¦
        this.vy = options.vy || 0;
        this.ax = options.ax || 0; // åŠ é€Ÿåº¦
        this.ay = options.ay || 0;
        ////////////////////////////////////////////////
        // ã€æ–°å¢ã€‘å°çƒç¢°æ’æ£€æµ‹ç›¸å…³å˜é‡
        ////////////////////////////////////////////////
        this.no = options.no || 0; // è§’è‰²idç¼–å·ï¼Œä»1å¼€å§‹
        this.teamColor = options.teamColor || 'r'; // r-red;b-blue
        this.roleId = options.roleId || Role.HEIWA.id; // å°çƒå¯¹åº”è§’è‰²idï¼Œä»æšä¸¾ Role ä¸­å–idã€‚æ³¨æ„ï¼šoptions.roleId ä¸º 0 æ—¶ï¼Œæ˜¯ falseï¼Œå¯¼è‡´å–å€¼ä¸º -1
        this.isMainBall = options.isMainBall || false; // æ˜¯å¦ä¸ºä¸»çƒï¼Œç›®å‰åªæœ‰ä¸»çƒå¯ä»¥å‘å°„
        this.sizeRatio = options.sizeRatio || 2.0; // å°çƒç›¸å¯¹ç½‘æ ¼å¤§å°çš„æ¯”ä¾‹ï¼Œé»˜è®¤ 2 ä¸ªç½‘æ ¼å¤§å°
        this.pathRadius = options.pathRadius || roundNumber(5.20 / 2 * dpr, 4); // è·¯å¾„åŠå¾„
        this.tryRadius = options.tryRadius || this.radius; // ç„å‡†åœˆåŠå¾„
        this.radiusTmp = options.radiusTmp || this.radius; // åŠå¾„å¤‡ä»½ï¼Œç”¨äºæ§åˆ¶åŠå¾„å˜åŒ–
        this.pathColor = options.pathColor || "#cfe0d380"; // è·¯å¾„é¢œè‰²
        this.tryColor = options.tryColor || "#cfe0d330"; // ç„å‡†è¿çº¿é¢œè‰²
        this.collidedCount = options.collidedCount || 0; // ï¼ˆæ€»ï¼‰ç¢°æ’æ¬¡æ•°
        this.wallCollidedCount = options.wallCollidedCount || 0; // å¢™å£ç¢°æ’æ¬¡æ•°
        this.roleCollidedCount = options.roleCollidedCount || 0; // è§’è‰²ç¢°æ’æ¬¡æ•°
        this.vRatio = options.vRatio || 1; // åˆå§‹é€Ÿåº¦æ¯”ç‡ï¼šæå¿«-å¿«-ä¸­ç­‰-æ…¢-ææ…¢ é€çº§é€’å‡ 0.1 é»‘å¨ƒï¼šæå¿«-1
        this.v = options.v || 0; // åˆå§‹é€Ÿåº¦
        this.mRatio = options.mRatio || 1; // åˆå§‹é‡é‡æ¯”ç‡ï¼šæé‡-é‡-ä¸­ç­‰-è½»-æè½» é€çº§é€’å‡ 0.1 é»‘å¨ƒï¼šæè½»-0.6
        this.m = options.m || 0; // åˆå§‹é‡é‡
        this.x0 = options.x0 || 0; // èµ·ç‚¹ä½ç½®
        this.y0 = options.y0 || 0;
        this.addCount = options.addCount || 0; // å åŠ æŠ€èƒ½è®¡æ•°
        // æ£€æµ‹é¡ºåºï¼Œä»å¤§åˆ°å°ï¼Œå››é¢å¢™-å››ä¸ªåˆ‡è§’-è›‹
        this.isWallCollided = false; // å¢™é¢æ˜¯å¦ç¢°æ’
        this.isLineCollided = false; // åˆ‡è§’çº¿æ˜¯å¦ç¢°æ’
        this.isBallCollided = false; // çƒæ˜¯å¦ç¢°æ’
        this.isEggCollided = false; // è›‹æ˜¯å¦ç¢°æ’
        this.isCollided = false; // æ€»ç¢°æ’æ ‡è¯†ï¼Œå¢™é¢ã€åˆ‡é¢ã€çƒã€è›‹ï¼Œåªè¦æœ‰ä¸€ä¸ªå°±ç¢°æ’äº†å°±ç®—
        this.isCheckFinished = false; // ç¢°æ’æ£€æµ‹æ˜¯å¦å®Œæˆ
        this.collidingNos = []; // æ­£åœ¨ä¸å“ªå‡ ä¸ªè§’è‰²ç¢°æ’ï¼Œè®¾ç½®è§’è‰²æ—¶åˆå§‹åŒ–
        // å¤‡ä»½ä¸Šä¸€ä¸ªæ’å‡»ç‚¹
        this.preCollided = null;
        // å¤‡ä»½ä¸Šä¸€ä¸ªè¿åŠ¨ç‚¹
        this.prePoint = null;
        // åŸå§‹æ’å‡»ç‚¹
        this.collidedP0 = { x: 0, y: 0 };
        // åŸå§‹æ’å‡»ç‚¹é€Ÿåº¦
        this.collidedV0 = { x: 0, y: 0 };
        // æ¸²æŸ“æ§åˆ¶ç›¸å…³
        this.isMoving = false; // åœ¨ç§»åŠ¨
        this.isChgPosFinished = false; // æ‹–åŠ¨ä½ç½®å®ŒæˆçŠ¶æ€
        // çªç ´å’Œæ•ˆæœ
        this.upgradeEffect = 0;
        // å›¾æ ‡å¤§å°
        this.iconSize = 0;
        ////////////////////////////////////////////////
    }

    // ä½“å‹å¸¸é‡ï¼Œæå°-1.80ï¼›åå°-1.90ï¼›å°-2.00ï¼›ä¸­ç­‰-2.10ï¼›ä¸­å¤§-2.20ï¼›å¤§-2.30ï¼›æå¤§-2.40
    static SIZERATIO = { XS: 1.80, SS: 1.90, S: 2.00, M: 2.10, ML: 2.20, L: 2.30, XL: 2.40 }
    // é€Ÿåº¦å¸¸é‡ï¼Œææ…¢-0.70ï¼›æ…¢-0.75ï¼›ä¸­ç­‰-0.80ï¼›å¿«-0.90ï¼›æå¿«-1.00
    static SPEEDRATIO = { XS: 0.70, S: 0.75, M: 0.80, L: 0.90, XL: 1.00 }
    // è´¨é‡å¸¸é‡ï¼Œæè½»-0.20ï¼›è½»-0.40ï¼›ä¸­ç­‰-0.60ï¼›é‡-0.80ï¼›æé‡-1.00
    static WEIGHTRATIO = { XS: 0.20, S: 0.40, M: 0.60, L: 0.80, XL: 1.00 }
    // åˆ†èº«åˆå§‹ä½ç½®
    static BODY2POS = { x: -1000, y: -1000 }
    // ç‰¹æ®Šè§’è‰²id
    static SPECIALROLEID = { eggId: -1 }


    // ç¢°æ’åç«‹é©¬æ›´æ–°ï¼Œé¿å…å¤šæ¬¡ç¢°æ’åæ‰æ›´æ–°
    update() {
        this.vx += this.ax;
        this.vy += this.ay;
        this.x += this.vx;
        this.y += this.vy;
        console.log(">>>> Ball update " + this.getBallDesc() + " x=" + this.x + ", y=" + this.y);
        console.log(">>>> Ball update " + this.getBallDesc() + " x0=" + this.x0 + ", y0=" + this.y0);
        console.log(">>>> Ball update " + this.getBallDesc() + " vx=" + this.vx + ", vy=" + this.vy);
        console.log(">>>> Ball update " + this.getBallDesc() + " collidedCount=" + this.collidedCount);
        console.log(">>>> Ball update " + this.getBallDesc() + " wallCollidedCount=" + this.wallCollidedCount);
        console.log(">>>> Ball update " + this.getBallDesc() + " roleCollidedCount=" + this.roleCollidedCount);
        if (this.roleId === Role.KUKU.id) console.log(">>>> Ball update " + this.getBallDesc() + " addCount=" + this.addCount);

        if (this.isMainBall && this.roleId === Role.KUILEI.id && this.wallCollidedCount >= 3) { // å‚€å„¡ç¢°ä¸‰æ¬¡åï¼Œç»³å­é€Ÿåº¦åœæ­¢
            if (userConfig.isKuileiPullBack && this.roleCollidedCount > 0 && !isKuileiPulling) { // å‚€å„¡ç»³å­æœ‰æŠ“åˆ°äººï¼Œä¸”å¼€å¯äº†æ‹‰å›å¼€å…³
                doKuileiPullBack(this); // å¤„ç†å‚€å„¡æ‹‰å›
            } else if (!isKuileiPulling) {
                this.vx = 0;
                this.vy = 0;
            }
        }
        if (this.vx === 0 && this.vy === 0) { // è¿åŠ¨åœæ­¢äº†
            this.isMoving = false;
        } else {
            this.isMoving = true;
        }
    }

    // è·å–æ˜¾ç¤ºå­—ç¬¦ä¸²
    getBallDesc() {
        return this.no + "-" + Role.getShortNameById(this.roleId) + "-" + this.roleId + "-" + this.teamColor;
    }

    // æ˜¯å¦æ”¹å˜äº†ä½ç½®
    isPosChanged() {
        return this.x !== this.x0 || this.y !== this.y0;
    }

    // TODO globalParams ç›®å‰åªæ˜¯å•ä¾‹ï¼Œé¿å…drawæ–¹æ³•ä¸åœåœ°åˆ›å»ºå¯¹è±¡ã€‚js å•çº¿ç¨‹æ‰§è¡Œæ²¡é—®é¢˜ï¼Œå¤šçº¿ç¨‹ä¸è¡Œ
    draw(params) {
        //if (this.x === this.prePoint.x && this.y === this.prePoint.y) return; // ä½ç½®æ²¡åŠ¨ä¸ç”»ã€‚ä¸è¡Œï¼Œç”»å¸ƒè¢«æ¸…ç©ºäº†ï¼Œè¿˜æ˜¯å¾—ç”»
        if (!params) params = GlobalParams.getCleanParams();
        //if (selectedBall && selectedBall.isMainBall && this === selectedBall) console.log(selectedBall.context);
        // å•ç‹¬ç»˜åˆ¶èµ·ç‚¹ä½ç½®
        if (sysConfig.isGameBeginning && this.x === this.x0 && this.y === this.y0) { // è¿™ä¸ªåæ ‡åˆ¤æ–­ä¼šå‡ºç°é‡å¤ç»˜åˆ¶çš„é—®é¢˜ï¼Œå°çƒç§»åŠ¨åï¼Œç»è¿‡åŸå§‹ä½ç½®ï¼Œåˆä¼šå†ç”»
            this.drawBeginPoint();
        }
        //if (this.isMainBall && this.roleId === Role.KUILEI.id && this.isMoving) return; // ä¸ç”»ç»³å­ä¸Šçš„å¨ƒå¨ƒï¼Œå¯ä»¥ç›´æ¥è¿”å›

        // çªç ´ç¢°æ’æ•ˆæœ
        if (this.upgradeEffect > 0) this.drawUpgradeCircle();

        // ç”»è§’è‰²å›¾æ ‡
        if (!params.isBallOnly) this.drawIcon();

        // TODO canvasä¸­ä½¿ç”¨çš„save()æ•°é‡å’Œrestore()çš„æ•°é‡éœ€è¦ä¿æŒä¸€è‡´ï¼Œsaveå¤šä¼šå¯¼è‡´å†…å­˜æ³„æ¼ï¼ŒåŠè¿è¡Œä¸€æ®µæ—¶é—´åå˜å¡é¡¿
        // å°½é‡å°‘æ”¹å˜ Canvas çŠ¶æ€å˜é‡ï¼Œå…¬å…±è®¾ç½®æ”¾åˆ°å¾ªç¯å¤–å±‚ï¼Œå¯ä»¥èŠ‚çœä¸€ç‚¹æ€§èƒ½
        this.context.save();
        this.context.beginPath();
        this.context.globalCompositeOperation = "destination-over"; // æ–°çš„å›¾å±‚åœ¨è€çš„å›¾å±‚ä¸‹é¢ï¼Œä¸ºäº†å®ç°è·¯å¾„æ˜¾ç¤ºåœ¨è§’è‰²ä¸Šæ–¹
        if (params.composite) this.context.globalCompositeOperation = params.composite;
        if (this.isMainBall && this.roleId === Role.KUILEI.id && this.isMoving && !isKuileiPulling) { // ç”»ç»‘åœ¨ç»³å­ä¸Šçš„å¨ƒå¨ƒã€çœŸæ˜¯ä¸ªç»†èŠ‚ç‹‚é­”å•Šã€‘
            this.context.arc(this.x, this.y, this.tryRadius, Math.PI / 180 * 0, Math.PI / 180 * 360);
            this.context.fillStyle = "#415D9C";
        } else {
            this.context.arc(this.x, this.y, this.radiusTmp, Math.PI / 180 * 0, Math.PI / 180 * 360);
            this.context.fillStyle = this.color;
        }
        this.context.fill(); // fill å®å¿ƒï¼›stroke ç©ºå¿ƒ
        // æœ‰éœ²éœ²ï¼Œä¸ºåƒµåƒµåŠ ä¸Šç»ç’ƒçƒ
        if (isLuluExist && this.roleId === Role.JIANGJIANG.id && this.id < 0) { // this.id < 0 å…ˆä¸ç”»ç»ç’ƒçƒäº†
            //this.context.globalCompositeOperation = "source-over";
            this.context.arc(this.x, this.y - this.radius / 4, this.radius + 8 * dpr, Math.PI / 180 * 0, Math.PI / 180 * 360);
            this.context.fillStyle = "#C0E0F450";
            //this.context.shadowBlur = 10 * dpr; // é¢‘ç¹ç»˜åˆ¶é˜´å½±ä¼šå½±å“æ€§èƒ½
            this.context.fill();
        }
        //this.context.closePath(); // é—­åˆè·¯å¾„
        //this.context.fill();
        this.context.restore();

        // ç”»ä¸»è§’æŒ‡ç¤ºåœˆ
        if (!checkIsMoving() && !params.isBallOnly) this.drawCurrentCircle();
        // ç”»è§’è‰²è¡€é‡æ¡
        if (!params.isBallOnly) this.drawRoleBloodLine();

    }

    // ç»˜åˆ¶è§’è‰²å›¾æ ‡
    drawIcon(params) {
        if (!params) params = GlobalParams.getCleanParams();
        this.context.save();
        this.context.beginPath();
        this.context.globalCompositeOperation = "source-over";
        if (params.composite) this.context.globalCompositeOperation = params.composite;
        this.context.fillStyle = "#EEF0F2";
        // æ°´å¹³å¯¹é½æ–¹å¼ (center left right start end)
        this.context.textAlign = "center";
        // å‚ç›´å¯¹é½çš„æ–¹å¼ (top bottom middle)
        this.context.textBaseline = 'middle';

        let content = Role.getRoleIconById(this.roleId);
        let iconType = 0; // 0-å…¼å®¹å›¾æ ‡ï¼›1-æ–°å›¾æ ‡
        // åŒå­è¿åŠ¨æ—¶ï¼Œä¸¤ä¸ªäººåˆ†å¼€
        if (isTwinSingleIconShow && userConfig.currRole === Role.SHUANGZI.id && this.roleId === Role.SHUANGZI.id && this.isMainBall && !selectedBall && (checkIsMoving() || isTwinBallShowStill())) {
            // æœ¬ä½“
            if (os.isPc || !isTwinLeftIconShow || !isTwinRightIconShow || !iconType) {
                content = 'ğŸ§â€â™‚ï¸';
            } else {
                content = 'ğŸƒ';
            }
        }
        if (params.graph) content = params.graph;
        if (isTwinSingleIconShow && userConfig.currRole === Role.SHUANGZI.id && this.roleId === Role.SHUANGZI.id && !this.isMainBall && this.teamColor === balls[0].teamColor) {
            // åˆ†èº«
            if (os.isPc || !isTwinLeftIconShow || !isTwinRightIconShow || !iconType) {
                content = 'ğŸ§';
            } else {
                content = 'ğŸƒâ€â™‚ï¸â€â¡ï¸';
            }
        }
        if (this.iconSize < 10) {
            let metrics, width, ratio;
            ratio = 1.4;
            if (this.roleId === Role.HEIWA.id || this.roleId === Role.BAKE.id
                || this.roleId === Role.X.id || this.roleId === Role.DUODUO.id
                || this.roleId === Role.HUAQIANJI.id) ratio = 1.2;
            let fontSize = roundNumber(sysConfig.girdSize * ratio, 4);
            console.log(">>>> drawIcon" + this.getBallDesc() + " fontSize origin=" + fontSize);

            this.context.font = fontSize + "px Arial";
            metrics = this.context.measureText(content);
            width = roundNumber(metrics.width, 4);

            while (width > this.radiusTmp * ratio) {
                fontSize -= 1;
                this.context.font = fontSize + "px Arial";
                metrics = this.context.measureText(content);
                width = roundNumber(metrics.width, 4);
                if (fontSize < 12) break; // é¿å… width è®¡ç®—å¼‚å¸¸ï¼Œå¯¼è‡´æ­»å¾ªç¯
            }
            while (width < sysConfig.girdSize * 1.2) {
                fontSize += 1;
                this.context.font = fontSize + "px Arial";
                metrics = this.context.measureText(content);
                width = roundNumber(metrics.width, 4);
                if (fontSize > 100) break; // é¿å… width è®¡ç®—å¼‚å¸¸ï¼Œå¯¼è‡´æ­»å¾ªç¯
            }
            fontSize = roundNumber(fontSize, 4);
            console.log(">>>> drawIcon" + this.getBallDesc() + " fontSize final=" + fontSize);
            this.iconSize = fontSize;
        } else {
            this.context.font = this.iconSize + "px Arial";
        }

        // çªç ´æ•ˆæœ
        //if (this.upgradeEffect > 0) this.context.font = (fontSize + 10) + "px Arial";

        if (this.isMainBall && this.roleId === Role.KUILEI.id && this.isMoving) {
            this.context.fillText(content, this.x, this.y);
            //this.context.fillText(content, this.x0 === 0 ? this.x : this.x0, this.y0 === 0 ? this.y : this.y0);
        } else if (this.roleId === Role.SHUANGZI.id && content === 'ğŸ‘¬') { // åŒå­å›¾æ ‡é‡ç”»
            if (os.isPc || !isTwinLeftIconShow || !isTwinRightIconShow || !iconType) {
                this.context.fillText('ğŸ§', this.x + (0.20 * sysConfig.girdSize), this.y - (0.1 * sysConfig.girdSize));
                this.context.fillText('ğŸ§â€â™‚ï¸', this.x - (0.20 * sysConfig.girdSize), this.y + (0.1 * sysConfig.girdSize));
            } else {
                this.context.fillText('ğŸƒâ€â™‚ï¸â€â¡ï¸', this.x + (0.20 * sysConfig.girdSize), this.y - (0.1 * sysConfig.girdSize));
                this.context.fillText('ğŸƒ', this.x - (0.20 * sysConfig.girdSize), this.y + (0.1 * sysConfig.girdSize));
            }
        }
        else this.context.fillText(content, this.x, this.y);
        this.context.restore();
    }

    // ç»˜åˆ¶çªç ´ç¢°æ’å…‰åœˆæ•ˆæœ
    drawUpgradeCircle(params) {
        //return; // å…ˆä¸ç”»
        //if (!this.isMainBall) return; // éä¸»è§’ä¸ç”»
        if (this.upgradeEffect < 1) return;
        if (!params) params = GlobalParams.getCleanParams();
        this.context.save();
        this.context.beginPath();
        if (params.composite) this.context.globalCompositeOperation = params.composite;
        let grd = this.context.createRadialGradient(this.x, this.y, 0.1 * this.radiusTmp, this.x, this.y, this.radiusTmp * 3);
        grd.addColorStop(0.1, "#EEF0F2F0");
        grd.addColorStop(0.3, "#FFFE6150");
        grd.addColorStop(0.6, "#EEF0F280");
        grd.addColorStop(1, "#EEF0F200");
        //this.context.arc(this.x, this.y, this.pathRadius, Math.PI / 180 * 0, Math.PI / 180 * 360);
        this.context.arc(this.x, this.y, this.radiusTmp * 2.5, 0, Math.PI * 2, true);
        //this.context.fillStyle = "#EEF0F2"; // è®¾ç½®é¢œè‰²
        this.context.fillStyle = grd; // ä½¿ç”¨æ¸å˜
        this.context.fill();
        this.context.restore();
        // TODO ç”»å®Œåé‡ç½®ï¼Œéœ€è¦ç­‰ç”»å®Œå†é‡ç½®ï¼Œç¡®ä¿è·ç¦»å¾ˆè¿‘ç¢°æ’æ—¶ï¼Œçœ‹ä¸åˆ°ç¢°æ’æ•ˆæœ
        //console.log(">>>> doDianyinSpeed upgradeEffect", this.upgradeEffect);
        //setTimeout(()=>{this.upgradeEffect = 0;}, 20);
        if (this.upgradeEffect > 2) this.upgradeEffect = 0; // è¿™æ ·å¯ä»¥å»¶è¿Ÿé‡ç½®
        if (this.upgradeEffect > 0) this.upgradeEffect += 1;
    }

    // ç»˜åˆ¶å½“å‰ä¸»æ”»è§’è‰²æŒ‡ç¤ºåœˆ
    drawCurrentCircle(params) {
        if (!this.isMainBall) return; // éä¸»è§’ä¸ç”»
        if (userConfig.isTestOnlyOne) return; // å•ä¸ªè§’è‰²æµ‹è¯•æ—¶ä¸ç”»
        if (!params) params = GlobalParams.getCleanParams();
        this.context.save();
        this.context.beginPath();
        if (params.composite) this.context.globalCompositeOperation = params.composite;
        this.context.arc(this.x, this.y, roundNumber(this.radiusTmp + 2 * dpr * sysConfig.pxRatio, 4), Math.PI / 180 * 0, Math.PI / 180 * 360);
        this.context.strokeStyle = "#D75956";
        if (this.teamColor === 'b') this.context.strokeStyle = "#0A7AFD";
        this.context.closePath();
        this.context.lineWidth = 2 * dpr * sysConfig.pxRatio;
        this.context.stroke();
        this.context.restore();
    }

    // ç»˜åˆ¶ç„å‡†æ—¶è¢«ç¢°æ’è§’è‰²æŒ‡ç¤ºåœˆ
    drawTryCollidedCircle(params, ball) {
        if (ball.isMainBall) return; // ç„å‡†æ—¶è¢«ç¢°æ’è§’è‰²ä¸ºéä¸»è§’
        if (userConfig.isTestOnlyOne) return; // å•ä¸ªè§’è‰²æµ‹è¯•æ—¶ä¸ç”»
        if (!params) params = GlobalParams.getCleanParams();
        let context = selectedBall.context;
        context.save();
        context.beginPath();
        if (params.composite) context.globalCompositeOperation = params.composite;
        context.arc(ball.x, ball.y, roundNumber(ball.radiusTmp - 1 * dpr * sysConfig.pxRatio, 4), Math.PI / 180 * 0, Math.PI / 180 * 360);
        context.strokeStyle = "#D75956";
        if (ball.teamColor === 'b') context.strokeStyle = "#0A7AFD";
        context.closePath();
        context.lineWidth = 2 * dpr * sysConfig.pxRatio;
        context.stroke();
        context.restore();
    }

    // ç»˜åˆ¶è§’è‰²è¡€é‡æ¡
    drawRoleBloodLine(params) {
        if (!userConfig.isShowRoleBloodLine) return;
        //if (userConfig.isTestOnlyOne) return; // å•ä¸ªè§’è‰²æµ‹è¯•æ—¶ä¸ç”»
        if (!this.x || !this.y || this.x < 0 || this.y < 0 || !isFinite(this.x) || !isFinite(this.y)) return;
        if (!params) params = GlobalParams.getCleanParams();
        this.context.save();
        this.context.beginPath();
        this.context.fillStyle = "#D84646";
        if (this.teamColor === 'b') this.context.fillStyle = "#2A7CE9";
        // TODO é¢‘ç¹ç»˜åˆ¶é˜´å½±ï¼Œä¼šå½±å“æ€§èƒ½ï¼Œå¯ä»¥æ”¹ç”¨æè¾¹å½¢å¼
        //this.context.shadowColor = '#60221D60'; // è®¾ç½®é˜´å½±
        //this.context.shadowBlur = 1 * dpr;
        //this.context.globalCompositeOperation = "destination-over";
        if (params.composite) this.context.globalCompositeOperation = params.composite;
        // TODO roundRect å…¼å®¹æ€§æœ‰é—®é¢˜ï¼Œè€æœºå‹/è€æµè§ˆå™¨ä¸æ”¯æŒ
        try {
            //this.context.save00();
            if (this.isMainBall && this.roleId === Role.KUILEI.id && this.isMoving && !isKuileiPulling) this.context.roundRect((this.x0 === 0 ? this.x : this.x0) - roundNumber(2.3 * sysConfig.girdSize / 2, 4), (this.y0 === 0 ? this.y : this.y0) - this.radiusTmp - roundNumber(0.7 * sysConfig.girdSize, 4), roundNumber(2.3 * sysConfig.girdSize, 4), roundNumber(0.39 * sysConfig.girdSize, 4), 2);
            else this.context.roundRect(this.x - roundNumber(2.3 * sysConfig.girdSize / 2, 4), this.y - this.radiusTmp - roundNumber(0.7 * sysConfig.girdSize, 4), roundNumber(2.3 * sysConfig.girdSize, 4), roundNumber(0.39 * sysConfig.girdSize, 4), 2);
        } catch (e) {
            doGlobalErrorMsg(e, false);
            //doGlobalError(e, (sysConfig && sysConfig.alertErrorCount)?sysConfig.alertErrorCount:3);
            // ä½¿ç”¨åŸå§‹æ–¹æ³•ç»˜åˆ¶åœ†è§’çŸ©å½¢
            if (this.isMainBall && this.roleId === Role.KUILEI.id && this.isMoving && !isKuileiPulling) fillRoundRect(this.context, (this.x0 === 0 ? this.x : this.x0) - roundNumber(2.3 * sysConfig.girdSize / 2, 4), (this.y0 === 0 ? this.y : this.y0) - this.radiusTmp - roundNumber(0.7 * sysConfig.girdSize, 4), roundNumber(2.3 * sysConfig.girdSize, 4), roundNumber(0.39 * sysConfig.girdSize, 4), 2, this.context.fillStyle);
            else fillRoundRect(this.context, this.x - roundNumber(2.3 * sysConfig.girdSize / 2, 4), this.y - this.radiusTmp - roundNumber(0.7 * sysConfig.girdSize, 4), roundNumber(2.3 * sysConfig.girdSize, 4), roundNumber(0.39 * sysConfig.girdSize, 4), 2, this.context.fillStyle);
        }
        this.context.fill();
        this.context.restore();
    }

    // canvas å›¾å½¢åŠ¨ç”»çš„è‡´å‘½é—®é¢˜å°±æ˜¯æ¯æ¬¡éƒ½è¦å…¨éƒ¨æ¸…é™¤é‡ç”»ï¼å°±å¥½åƒç”¨ç”µé¥­ç…²ç‚’èœï¼Œèƒ½ç‚’ä½†æ˜¯å¾ˆæ— åŠ›ï¼
    // ç»˜åˆ¶è§’è‰²+è¡€é‡æ¡åŒºåŸŸçŸ©å½¢ï¼Œç”¨äºåç»­ã€è„çŸ©å½¢ã€‘ä¼˜åŒ–
    drawBallRect(params) {
        if (!params) params = GlobalParams.getCleanParams();
        this.context.save();
        this.context.beginPath();
        if (params.composite) this.context.globalCompositeOperation = params.composite;
        if (userConfig.isShowRoleBloodLine)
            this.context.strokeRect(this.x - this.radius, this.y - this.radius, this.radius * 2, this.radius * 2);
        else this.context.strokeRect(this.x - this.radius, this.y - this.radius, this.radius * 2, this.radius * 2);
        this.context.strokeStyle = "#000";
        this.context.lineWidth = 1 * dpr;
        this.context.setLineDash([3 * dpr, 3 * dpr]); // è™šçº¿
        this.context.stroke();
        this.context.restore();
    }

    // ç»˜åˆ¶èµ·ç‚¹ä½ç½®
    drawBeginPoint(params) {
        if (!this.isMainBall) return; // éä¸»çƒä¸ç”»
        if (!params) params = GlobalParams.getCleanParams();
        console.log(">>>> drawBeginPoint " + this.getBallDesc());
        // ç”»åœ†å¿ƒç‚¹
        gamePathContext.save();
        gamePathContext.beginPath();
        //gamePathContext.globalCompositeOperation = "xor";
        if (params.composite) gamePathContext.globalCompositeOperation = params.composite;
        gamePathContext.arc(this.x0, this.y0, this.pathRadius, Math.PI / 180 * 0, Math.PI / 180 * 360);
        gamePathContext.fillStyle = this.color;
        gamePathContext.closePath();
        gamePathContext.fill();
        gamePathContext.restore();
        // ç”»å¤–éƒ¨å®çº¿åœ†åœˆ
        gamePathContext.save();
        gamePathContext.beginPath();
        //gamePathContext.globalCompositeOperation = "xor";
        gamePathContext.arc(this.x0, this.y0, this.radiusTmp, Math.PI / 180 * 0, Math.PI / 180 * 360);
        gamePathContext.lineWidth = 1 * dpr * sysConfig.pxRatio;
        gamePathContext.strokeStyle = this.color;
        gamePathContext.fillStyle = this.color;
        gamePathContext.closePath();
        if (this.isMainBall && this.roleId === Role.KUILEI.id) gamePathContext.fill(); // å‚€å„¡æœ¬ä½“ä¸ä¼šåŠ¨
        else gamePathContext.stroke();
        gamePathContext.restore();
        // é‡ç”»è¢«è¦†ç›–çš„è§’è‰²å›¾æ ‡
        this.drawIcon();
    }

    // ç”»è¿çº¿æ’å‡»è½¨è¿¹ã€ç”»åœ¨è·¯å¾„å±‚ã€‘
    drawLinePath(p1, p2) {
        if (!this.isMoving) return; // æ²¡åœ¨è¿åŠ¨ä¸ç”»
        if (!this.isMainBall && this.roleId !== Role.SHUANGZI.id) return; // éä¸»çƒä¸ç”»ï¼ŒåŒå­åˆ†èº«é™¤å¤–
        if (!this.isMainBall && this.roleId === Role.SHUANGZI.id && !userConfig.isTestOnlyOne && this.no > 1 && this.no < 5) return;
        if (!p1 || !p2) return;
        if (isKuileiPulling) return; // å‚€å„¡æ‹‰å›æ—¶ä¸ç”»
        gamePathContext.save();
        gamePathContext.beginPath();
        gamePathContext.globalCompositeOperation = "source-over";
        gamePathContext.moveTo(p1.x, p1.y);
        gamePathContext.lineTo(p2.x, p2.y);
        gamePathContext.strokeStyle = "#cfe0d380";
        if (userConfig.sceneThemeMode === 5) // å¤æ—¥ä¸»é¢˜
            gamePathContext.strokeStyle = "#F9FBF580";
        if (userConfig.currRole === Role.SHUANGZI.id && !this.isMainBall && this.roleId === Role.SHUANGZI.id) gamePathContext.strokeStyle = "#EADF5580"; // åŒå­åˆ†èº«è·¯å¾„é¢œè‰²
        if (this.roleId === Role.KUILEI.id) gamePathContext.strokeStyle = "#D61C24"; // å‚€å„¡è·¯å¾„é¢œè‰²
        gamePathContext.lineWidth = this.pathRadius * sysConfig.pxRatio;
        gamePathContext.stroke();
        gamePathContext.restore();
    }

    // ç»˜åˆ¶å°çƒæœ¬ä½“è¿åŠ¨è·¯å¾„
    drawBallPath(p1, p2) {
        //if (!userConfig.isShowBallPath) return;
        if (!this.isMoving) return;
        if (!this.isMainBall && this.roleId !== Role.SHUANGZI.id) return; // éä¸»çƒä¸ç”»ï¼ŒåŒå­åˆ†èº«é™¤å¤–
        if (!this.isMainBall && this.roleId === Role.SHUANGZI.id && !userConfig.isTestOnlyOne && this.no > 1 && this.no < 5) return;
        if (!p1 || !p2) return;
        if (isKuileiPulling) return; // å‚€å„¡æ‹‰å›æ—¶ä¸ç”»
        gamePathBallContext.save();
        gamePathBallContext.beginPath(); // å¼€å§‹ä¸€æ¡è·¯å¾„ï¼Œæˆ–é‡ç½®å½“å‰çš„è·¯å¾„ã€‚
        gamePathBallContext.globalCompositeOperation = "xor";
        //gamePathBallContext.globalCompositeOperation = "destination-over"; // æ–°çš„å›¾å±‚åœ¨è€çš„å›¾å±‚ä¸‹é¢
        gamePathBallContext.moveTo(p1.x, p1.y);
        gamePathBallContext.lineTo(p2.x, p2.y);
        gamePathBallContext.strokeStyle = "#cfe0d325";
        if (userConfig.sceneThemeMode === 5) // å¤æ—¥ä¸»é¢˜
            gamePathBallContext.strokeStyle = "#F9FBF540";
        //if (!this.isMainBall && this.roleId === Role.SHUANGZI.id) gamePathBallContext.strokeStyle = "#EADF5525"; // åŒå­åˆ†èº«è·¯å¾„é¢œè‰²
        gamePathBallContext.lineWidth = this.radius * 2;
        //gamePathBallContext.lineCap = "round"; // åœ†è§’
        gamePathBallContext.stroke();
        gamePathBallContext.restore();
        return;
        // èµ·ç‚¹å¡«å……
        if (p1.x === this.x0 && p1.y === this.y0) { // åæ ‡åˆ¤æ–­ä¼šå¯¼è‡´é‡å¤ç»˜åˆ¶
            gamePathBallContext.save();
            gamePathBallContext.beginPath();
            //gamePathBallContext.globalCompositeOperation = "destination-over";
            gamePathBallContext.globalCompositeOperation = "xor";
            gamePathBallContext.arc(p1.x, p1.y, this.radius, Math.PI / 180 * 0, Math.PI / 180 * 360);
            gamePathBallContext.fillStyle = "#cfe0d380";
            gamePathBallContext.fill();
            gamePathBallContext.restore();
            // èµ·ç‚¹é‡æ–°ç»˜åˆ¶
            this.drawBeginPoint();
        }
    }

    // ç”»å°åœ†ç‚¹æ’å‡»è½¨è¿¹
    drawPointPath() {
        if (!this.isMainBall) return;
        if (isKuileiPulling) return; // å‚€å„¡æ‹‰å›æ—¶ä¸ç”»
        gamePathContext.save();
        gamePathContext.beginPath();
        gamePathContext.arc(this.x, this.y, this.pathRadius, Math.PI / 180 * 0, Math.PI / 180 * 360);
        gamePathContext.fillStyle = "#cfe0d350";
        gamePathContext.closePath();
        gamePathContext.fill();
        gamePathContext.restore();
    }

    // å•ç‹¬ç»˜åˆ¶ç¢°æ’ä½ç½®ï¼Œåœ¨æ£€æŸ¥ç¢°æ’çš„æ—¶å€™è°ƒç”¨ã€ç”»åœ¨è·¯å¾„å±‚ã€‘
    drawCollidedPos() {
        if (!this.isMainBall && this.roleId !== Role.SHUANGZI.id) return; // éä¸»çƒä¸ç”»ï¼ŒåŒå­åˆ†èº«é™¤å¤–
        if (!this.isMainBall && this.roleId === Role.SHUANGZI.id && !userConfig.isTestOnlyOne && this.no > 1 && this.no < 5) return;
        if (this.isMainBall && this.roleId === Role.KUILEI.id) return; // å‚€å„¡ä¸ç”»ç¢°æ’ç‚¹
        // ç»˜åˆ¶å¤–è™šçº¿
        gamePathContext.save();
        gamePathContext.beginPath();
        gamePathContext.arc(this.x, this.y, this.radius, Math.PI / 180 * 0, Math.PI / 180 * 360);
        gamePathContext.lineWidth = 1 * dpr * sysConfig.pxRatio;
        gamePathContext.strokeStyle = "#000";
        if (userConfig.currRole === Role.SHUANGZI.id && !this.isMainBall && this.roleId === Role.SHUANGZI.id) gamePathContext.strokeStyle = "#fffa"; // åŒå­åˆ†èº«ç¢°æ’åœˆé¢œè‰²
        gamePathContext.setLineDash([3 * dpr * sysConfig.pxRatio, 3 * dpr * sysConfig.pxRatio]); // è™šçº¿
        gamePathContext.closePath();
        gamePathContext.stroke(); // ç©ºå¿ƒ
        gamePathContext.restore();
        // ç»˜åˆ¶åœ†å¿ƒ
        gamePathContext.save();
        gamePathContext.beginPath();
        gamePathContext.arc(this.x, this.y, roundNumber(this.pathRadius / 2, 4), Math.PI / 180 * 0, Math.PI / 180 * 360);
        //gamePathContext.fillStyle = this.color;
        gamePathContext.fillStyle = "#cfe0d380";
        if (this.isMainBall && this.roleId === Role.KUILEI.id) gamePathContext.fillStyle = "#D61C24";
        gamePathContext.closePath();
        gamePathContext.fill();
        gamePathContext.restore();

        //if (userConfig.isShowBallPath) {
        // ç»˜åˆ¶å°çƒå®ä½“å¡«å……
        gamePathBallContext.save();
        gamePathBallContext.beginPath();
        gamePathBallContext.globalCompositeOperation = "destination-over";
        gamePathBallContext.arc(this.x, this.y, this.radius, Math.PI / 180 * 0, Math.PI / 180 * 360);
        //gamePathBallContext.fillStyle = this.color;
        gamePathBallContext.fillStyle = "#cfe0d385";
        gamePathBallContext.closePath();
        gamePathBallContext.fill();
        gamePathBallContext.restore();
        //}
    }
}


// å°çƒæ˜¯å¦éœ€è¦é‡ç»˜å’Œæ›´æ–°
function isBallDrawAndUpdate(ball, caseNo) {
    // æ¸¸æˆæ²¡å¼€å§‹ï¼Œè‚¯å®šè¦ç”»çš„
    if (!sysConfig.isGameBeginning) return true;

    // ä¸»è§’åœ¨æ‹–åŠ¨å’Œç„å‡†æ—¶ï¼Œæ‰€æœ‰éä¸»è§’ä¸ç”»
    if (caseNo === 2 && isMouseMoving && selectedBall.isMainBall) return false;
    // éä¸»è§’åœ¨æ‹–åŠ¨å’Œç„å‡†æ—¶ï¼Œä¸»è§’ä¹Ÿä¸ç”»
    //if (caseNo === 1 && isMouseMoving && !selectedBall.isMainBall) return false;

    // åƒµå°¸ä¸èƒ½æ”¹å˜å…¶ä»–è§’è‰²ä½ç½®ï¼›å‚€å„¡ä¸æ‹‰å›æ—¶ï¼Œä¹Ÿä¸èƒ½æ”¹å˜å…¶ä»–è§’è‰²ä½ç½®
    if (caseNo === 2 && (userConfig.currRole === Role.JIANGJIANG.id || (userConfig.currRole === Role.KUILEI.id && !isKuileiPulling))) {
        return checkAnyBallPosChanged(caseNo);
    }

    // åŒå­ä¸ºä¸»è§’æ—¶ï¼Œæœ¬ä½“å’Œåˆ†èº«æ§åˆ¶
    if (userConfig.currRole === Role.SHUANGZI.id && ball && ball.roleId === Role.SHUANGZI.id && ball.teamColor === balls[0].teamColor) { // åŒå­åˆ†èº«è¦åŒæ—¶è¿åŠ¨
        // åŒå­æœ¬ä½“
        if (ball.isMainBall) {

        } else { // åŒå­åˆ†èº«
            return (checkAnyBallPosChanged(caseNo) || checkAnyBallCollided(caseNo)) && !selectedBall;
        }
    }

    return checkAnyBallPosChanged(caseNo) || checkAnyBallCollided(caseNo);
}


// æ£€æµ‹ä»»æ„ä¸€ä¸ªå°çƒæ˜¯å¦æ”¹å˜äº†ä½ç½®
function checkAnyBallPosChanged(caseNo) {
    let result = false;
    if (!caseNo) caseNo = 0;

    // TODO æ³¨æ„ï¼ï¼balls å˜é‡åœ¨å®šä¹‰å‰ä½¿ç”¨ï¼Œéœ€è¦ä½¿ç”¨ var å®šä¹‰æ‰è¡Œï¼Œlet å®šä¹‰ä¹‹å‰ä¼šæŠ¥ undefined
    if (!balls || balls.length < 1) return result;

    let isCheckMain;
    switch (caseNo) {
        case 1: // åªæ£€æµ‹ä¸»çƒ
            return balls[0].isPosChanged();
        case 2: // åªæ£€æµ‹éä¸»çƒ
            isCheckMain = false;
            break;
        default: // æ£€æµ‹æ‰€æœ‰
            isCheckMain = true;
    }

    for (let i = 0, len = balls.length; i < len; i++) {
        if (!isCheckMain && balls[i].isMainBall) continue;
        result = result || balls[i].isPosChanged();
        if (result) break;
    }

    return result;
}


// æ£€æµ‹ä»»æ„ä¸€ä¸ªå°çƒæ˜¯å¦æœ‰ç¢°æ’
function checkAnyBallCollided(caseNo) {
    let result = false;
    if (!caseNo) caseNo = 0;

    if (!balls || balls.length < 1) return result;

    let isCheckMain;
    switch (caseNo) {
        case 1: // åªæ£€æµ‹ä¸»çƒ
            return balls[0].collidedCount > 0;
        case 2: // åªæ£€æµ‹éä¸»çƒ
            isCheckMain = false;
            break;
        default: // æ£€æµ‹æ‰€æœ‰
            isCheckMain = true;
    }

    for (let i = 0, len = balls.length; i < len; i++) {
        if (!isCheckMain && balls[i].isMainBall) continue;
        result = result || balls[i].collidedCount > 0;
        if (result) break;
    }

    return result;
}


// æ£€æµ‹æ˜¯å¦ä¸ºåˆ†èº«åˆå§‹ä½ç½®
function isRoleHideBody(ball) {
    if (!ball || ball.isMainBall) return false;
    //return !(isNumber(ball.x) && isNumber(ball.y) && ball.x0 !== Ball.BODY2POS.x && ball.y0 !== Ball.BODY2POS.y);
    return ball.x0 === Ball.BODY2POS.x && ball.y0 === Ball.BODY2POS.y;
}


// é‡ç½®è§’è‰²å­—æ®µå±æ€§å€¼
function resetRoleField() {
    if (!balls || balls.length < 1) return;
    for (let i = 0, len = balls.length; i < len; i++) {
        if (!balls[i]) continue;
        // é‡ç½®é…·é…·åŠ é€Ÿæ¬¡æ•°
        if (balls[i].roleId === Role.KUKU.id && balls[i].addCount) balls[i].addCount = 0;
        // é‡ç½®æ‰€æœ‰è§’è‰²ç¢°æ’æ¬¡æ•°
        if (balls[i].collidedCount) balls[i].collidedCount = 0;
        if (balls[i].wallCollidedCount) balls[i].wallCollidedCount = 0;
        if (balls[i].roleCollidedCount) balls[i].roleCollidedCount = 0;
    }
}


// å¤‡ä»½æˆ–è¿˜åŸåŸå§‹åæ ‡
function setBallsPosBack(isBack) {
    if (!balls || balls.length < 1) return;
    for (let i = 0, len = balls.length; i < len; i++) {
        //if (balls[i].isMainBall) continue;
        if (isBack) {
            balls[i].x0 = balls[i].x;
            balls[i].y0 = balls[i].y;
        } else {
            if (balls[i].x0 > 0 && balls[i].y0 > 0) {
                balls[i].x = balls[i].x0;
                balls[i].y = balls[i].y0;
            }
            balls[i].x0 = 0;
            balls[i].y0 = 0;
        }
    }
}


// åˆå§‹åŒ–å„ä¸ªå°çƒçš„ç¢°æ’æ ‡å¿—ä½
function setBallCollidingNos() {
    if (!balls || balls.length < 1) return;
    let len = balls.length;
    balls.forEach(b => {
        for (let i = 0; i < len; i++) {
            //if (!b.collidingNos) b.collidingNos = [];
            b.collidingNos[i] = false;
        }
    });
}


// åŒå­åŠŸèƒ½
function doTwins(ball) {
    preTwins(ball);
}


// åˆå§‹åŒ–åŒå­åˆ†èº«
function preTwins(ball) {
    //let twinBall = balls[balls.length - 1];
    // ä½ç½®ä¸æœ¬ä½“ä¸€æ ·
    twinBall.x = ball.x;
    twinBall.y = ball.y;
    twinBall.x0 = 0;
    twinBall.y0 = 0;
    // é€Ÿåº¦ä¸æœ¬ä½“ç›¸åï¼Œåˆ†èº«å°±ç¨å¾®åè·‘äº†ä¸€ç‚¹ï¼Œè·ç¦»æ¯”æœ¬ä½“å°‘ï¼Œæ‰‹åŠ¨åŠ ä¸€ç‚¹é€Ÿåº¦
    twinBall.vx = -ball.vx * 1.0275;
    twinBall.vy = -ball.vy * 1.0275;
    //console.log(">>>> twinBall:", twinBall);
}


// åŒå­æ‰“å®Œåï¼Œåˆ†èº«æ¶ˆå¤±
function afterTwins(isShow) {
    if (userConfig.currRole !== Role.SHUANGZI.id) return;
    //console.log(">>>> afterTwins isShow=" + isShow);
    //let twinBall = balls[balls.length - 1];
    /*
    // ç§»é™¤åˆ†èº«
    let b = balls.pop();
    if (b.roleId === Role.SHUANGZI.id && b.no !== ball.no) {
        // ç¬¦åˆæ¡ä»¶ï¼Œç§»é™¤
    } else {
        balls.push(b); // ä¸ç¬¦åˆæ¡ä»¶ï¼Œæ”¾å›å»
    }
    */
    // ç§»å‡ºç”»å¸ƒä¹‹å¤–å³å¯
    if (!isShow) {
        twinBall.x = Ball.BODY2POS.x;
        twinBall.y = Ball.BODY2POS.y;
        twinBall.x0 = Ball.BODY2POS.x;
        twinBall.y0 = Ball.BODY2POS.y;
    }
    twinBall.vx = 0;
    twinBall.vy = 0;
}


// åŒå­åˆ†èº«æ˜¯å¦è¿˜åœ¨æ˜¾ç¤º
function isTwinBallShowStill() {
    if (!balls || balls.length < 1) return false;
    for (let i = 0, len = balls.length; i < len; i++) {
        if (!balls[i]) continue;
        if (balls[i].isMainBall) continue;
        if (!balls[i].roleId) continue;
        if (balls[i].roleId !== Role.SHUANGZI.id) continue;
        if (balls[i].teamColor !== balls[0].teamColor) continue;
        if (isNumber(balls[i].x) && isNumber(balls[i].y) && balls[i].x > 0 && balls[i].y > 0) return true;
    }
    return false;
}


// æ ¡æ­£è¢«æ‰“å‡ºåœºåœ°ä¹‹å¤–çš„è§’è‰²åæ ‡
// æ³¨æ„ï¼è§’è‰²åˆ†èº«ç­‰ç‰¹æ®Šè§’è‰²ï¼Œå¯èƒ½å°±æ˜¯éœ€è¦è®¾ç½®åœºåœ°å¤–åæ ‡ï¼Œä»¥è¾¾åˆ°å¼€å±€éšè—çš„ç›®çš„
// ã€æ‰“å®Œä¹‹åè°ƒç”¨ã€‘ï¼Œé¿å…åœ¨ onMouseMove è¿™ç§ç›‘å¬ç±»å¤§é‡æ‰§è¡Œçš„æ–¹æ³•ä¸­è°ƒç”¨ï¼Œå‡å°‘æ€§èƒ½å¼€é”€
function adjustBallsPos() {
    if (!balls || balls.length < 1) return;
    let ball;
    for (let i = 0, len = balls.length; i < len; i++) {
        ball = balls[i];
        // åŒå­åˆ†èº«æ’é™¤
        if (!ball.isMainBall && ball.roleId === Role.SHUANGZI.id) continue;
        // å°äº0ï¼›å¤§äºåœºåœ°å®½é«˜ï¼›åœ¨åˆ‡è§’åŒºåŸŸå†…
        if ((ball.x < 0 || ball.y < 0 || !isNumber(ball.x) || !isNumber(ball.y))
            || (ball.x > canvas.width || ball.y > canvas.height)
            //|| isInAngleArea(ball) > -1) {
        ) {
            // é‡æ–°éšæœºä½ç½®
            putBallRandom(ball);
        }
    }
}


// æ¨å¼€é åœ¨ä¸€èµ·çš„è§’è‰²ï¼Œé¿å…ä¸¤è§’è‰²è´´ç€ç¢°æ’ç©¿é€é—®é¢˜
// æ‹–åŠ¨æ”¹å˜ä½ç½®åè°ƒç”¨
function pushCollidedBalls() {
    if (!balls || balls.length < 1) return;
    let ball;
    for (let i = 0, len = balls.length; i < len; i++) {
        ball = balls[i];
        // åŒå­åˆ†èº«æ’é™¤
        if (!ball.isMainBall && ball.roleId === Role.SHUANGZI.id) continue;
        // å°äº0ï¼›å¤§äºåœºåœ°å®½é«˜ï¼›åœ¨åˆ‡è§’åŒºåŸŸå†…
        if ((ball.x < 0 || ball.y < 0 || !isNumber(ball.x) || !isNumber(ball.y))
            || (ball.x > canvas.width || ball.y > canvas.height)
            //|| isInAngleArea(ball) > -1) {
        ) {
            // é‡æ–°éšæœºä½ç½®
            putBallRandom(ball);
        }
    }
}


// è·å–ä¸€ä¸ªçƒå‘å¦ä¸€ä¸ªçƒçš„é€Ÿåº¦
function getPullBackSpeed() {
    if (!balls || balls.length < 1) return;
    let mainBall = balls[0];
    let ball, vxy;
    for (let i = 0, len = balls.length; i < len; i++) {
        if (i === 0) continue;
        ball = balls[i];
        if (ball.roleCollidedCount < 1) continue;
        vxy = getVxVy({ x: mainBall.x, y: mainBall.y }, { x: ball.x, y: ball.y }, null, mainBall);
        if (!vxy) continue;
        ball.vx = vxy.vx;
        ball.vy = vxy.vy;
        //console.log(">>>> getPullBackSpeed " + ball.getBallDesc() + "-vx=" + ball.vx + ", vy=" + ball.vy);
    }
    // å‚€å„¡æ‹‰å›æ—¶ï¼Œè‡ªèº«æ²¡æœ‰é€Ÿåº¦
    if (mainBall.isMainBall && mainBall.roleId === Role.KUILEI.id) {
        mainBall.vx = 0;
        mainBall.vy = 0;
    }
}


// æ˜¯å¦ä¸ºå¯ç©¿é€è§’è‰²ï¼Œåƒµå°¸ã€å‚€å„¡ã€æ¸¸ä¾ ã€å‰‘å£«ç­‰
// ç”¨äºåˆ¤æ–­æ˜¯å¦æ˜¾ç¤ºç„å‡†è·¯å¾„
function isRoleCanPierces() {
    return userConfig.isShowTryFullPath
        && (userConfig.currRole === Role.JIANGJIANG.id || userConfig.currRole === Role.KUILEI.id
            || userConfig.currRole === Role.HEIWA.id || userConfig.currRole === Role.DUODUO.id);
}


// ç”¨äºåˆ¤æ–­æ˜¯å¦åœ¨ç„å‡†çš„æ—¶å€™ç©¿é€ä¸€æ¬¡
function isTryCanPierces() {
    return userConfig.isPiercesTry
        && (userConfig.currRole === Role.JIANGJIANG.id || userConfig.currRole === Role.KUILEI.id);
}


//////////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////////
// ã€Lineåˆ‡è§’çº¿ç›¸å…³ã€‘ å˜é‡ã€æ–¹æ³•åŒºåŸŸ
//////////////////////////////////////////////////////////////////////

// å››æ ¹åˆ‡è§’çº¿å¯¹è±¡
class Line {
    constructor(context, options = {}) {
        this.context = context;
        this.x1 = options.x1 || 0;
        this.y1 = options.y1 || 0;
        this.x2 = options.x2 || 0;
        this.y2 = options.y2 || 0;
        this.lineWidth = options.lineWidth || 1.0;
        this.color = options.color || '#453678';
        // æ—‹è½¬è§’åº¦ï¼ŒMath.atan2() è¿”å›ä»åŸç‚¹ (0,0) åˆ° (x,y) ç‚¹çš„çº¿æ®µä¸ x è½´æ­£æ–¹å‘ä¹‹é—´çš„å¹³é¢è§’åº¦ (å¼§åº¦å€¼)ï¼Œä¹Ÿå°±æ˜¯ Math.atan2(y,x)
        this.rotation = Math.atan2(this.y2 - this.y1, this.x2 - this.x1);
    }

    draw() {
        this.context.save();
        this.context.lineWidth = this.lineWidth;
        this.context.strokeStyle = this.color;
        this.context.beginPath();
        this.context.moveTo(this.x1, this.y1);
        this.context.lineTo(this.x2, this.y2);
        this.context.closePath();
        this.context.stroke();
        this.context.restore();
    }

    getBounds() {
        let minX = Math.min(this.x1, this.x2);
        let minY = Math.min(this.y1, this.y2);
        let maxX = Math.max(this.x1, this.x2);
        let maxY = Math.max(this.y1, this.y2);
        return {
            x: minX,
            y: minY,
            width: maxX - minX,
            height: maxY - minY
        }
    };
}

//////////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////////
// ã€Roleè§’è‰²ç›¸å…³ã€‘ å˜é‡ã€æ–¹æ³•åŒºåŸŸ
//////////////////////////////////////////////////////////////////////

// è§’è‰²ç±»
class Role {

    constructor(id, icon, fullName, shortName, oneName, cps) {
        this.id = id;
        this.icon = icon;
        this.fullName = fullName;
        this.shortName = shortName;
        this.oneName = oneName;
        this.cps = cps; // å¸¸ç”¨æ­é…
    }

    /*
    æ·»åŠ è§’è‰²è¦ä¿®æ”¹çš„åœ°æ–¹
    1.Role ç±»è§’è‰²å®šä¹‰
    2.initRoleCps è®¾ç½®å¸¸ç”¨æ­é…
    3.initBallByRole é…ç½®è§’è‰²å±æ€§
    */

    //static HEIWA = {id:0, icon:"ğŸ¼", fullName:"åœ£å©´å¤§ç‹", shortName:"é»‘å¨ƒ", oneName:"å¨ƒ", cps:null};
    static HEIWA = new Role(0, "ğŸ¼", "åœ£å©´å¤§ç‹", "é»‘å¨ƒ", "å¨ƒ", null);
    static JIANGJIANG = new Role(1, "ğŸ§Ÿâ€â™‚", "æ³¢æ¯”åƒµåƒµ", "åƒµå°¸", "åƒµ", null);
    static DUODUO = new Role(2, "ğŸ¥š", "é£é“ƒæœµæœµ", "æœµæœµ", "æœµ", null);
    static KUILEI = new Role(3, "ğŸ¦Š", "å‚€å„¡å¨ƒå¨ƒ", "å‚€å„¡", "å‚€", null);
    static BAKE = new Role(4, "8g", "ç«ç„°å·´å…‹", "å·´å…‹", "å·´", null);
    static LULU = new Role(5, "ğŸ°", "ç”œå¿ƒéœ²éœ²", "éœ²éœ²", "éœ²", null);
    static KUKU = new Role(6, "ğŸ˜", "ç–¾é€Ÿé…·é…·", "é…·é…·", "é…·", null);
    static YINGYING = new Role(7, "â„", "å†°é›ªè¹è¹", "è¹è¹", "è¹", null);
    static JIUWEIHU = new Role(8, "ğŸ¦Š", "ç‹å°¾çº±", "ç‹å°¾", "çº±", null);
    static SHUANGZI = new Role(9, "ğŸ‘¬", "æ€ªç›—åŒå­", "åŒå­", "åŒ", null);
    static X = new Role(10, "x", "è‡ªå®šè§’è‰²", "è‡ªå®š", "x", null); // è‡ªå®šä¹‰è§’è‰²
    static YOUXIA = new Role(11, "ğŸ¹", "æš—å¤œæ¸¸ä¾ ", "æ¸¸ä¾ ", "ç®­", null);
    static CHUZI = new Role(12, "ğŸ—", "å°é£Ÿç¥", "å¨å­", "å¨", null);
    static HUAQIANJI = new Role(13, "ğŸš€", "èŠ±åƒæœº", "ç‚®å¼¹", "æœº", null);
    static WUGEGE = new Role(14, "ğŸŒ¿", "å·«æ ¼æ ¼", "æ ¼æ ¼", "æ ¼", null);
    static JOKER = new Role(15, "ğŸ¤¡", "å‘½è¿å°ä¸‘", "å°ä¸‘", "ä¸‘", null);
    static RABBIT = new Role(16, "ğŸ‡", "æ³¢æ–¯å…¬ä¸»", "å…”å­", "å…”", null);
    static NURSE = new Role(17, "ğŸ’‰", "å§¬å¤©ä½¿", "å¥¶å¦ˆ", "å¥¶", null);
    static CAPTAIN = new Role(18, "ğŸš¢", "èµ¤ç¿èˆ¹é•¿", "èˆ¹é•¿", "èˆ¹", null);
    static LELE = new Role(19, "ğŸ¥™", "å¤ªå¹³ä¹", "ä¹ä¹", "ä¹", null);
    static MANWANG = new Role(20, "ğŸ’", "è›®ç‹", "è›®ç‹", "è›®", null);
    static LINGLING = new Role(21, "ğŸ””", "æ³¢æ¯”çµçµ", "çµçµ", "çµ", null);
    static HUOWANG = new Role(22, "ğŸ”¥", "çƒˆç„°ç‹å­", "ç«ç‹", "ç«", null);
    static LEIMENG = new Role(23, "ğŸ–", "é›·å¾·è’™çš„", "é›·è’™", "çŒª", null);
    static DIANYIN = new Role(24, "ğŸµ", "ç”µéŸ³å°‘å¥³", "ç”µéŸ³", "éŸ³", null);
    static XIXUEGUI = new Role(25, "ğŸ¦‡", "å¾·å¤å¨œ", "å¸è¡€", "å¨œ", null);
    static GUISHUSHI = new Role(26, "ğŸŒ¸", "è¯¡æœ¯å¸ˆ", "è¯¡æœ¯", "è¯¡", null);
    static MAGICLION = new Role(27, "ğŸ¦", "é­”æ³•ç‹®", "ç‹®å­", "ç‹®", null);
    static LANGZAI = new Role(28, "ğŸº", "ç‹¼å´½", "ç‹¼å´½", "ç‹¼", null);
    static BZGIRL = new Role(29, "ğŸ‘§", "æš´èµ°å¥³å­©", "å¥³å­©", "æš´", null);
    static PUMPKIN = new Role(30, "ğŸƒ", "å—ç“œä¼¯çˆµ", "å—ç“œ", "å—", null);
    static QUANBA = new Role(31, "ğŸ¥Š", "æ‹³éœ¸", "æ‹³éœ¸", "æ‹³", null);
    static HONGZHAJI = new Role(32, "ğŸ”", "è½°ç‚¸é¸¡", "ç‚¸é¸¡", "é¸¡", null);
    static SANTAIZI = new Role(33, "ğŸ‰", "ä¸‰å¤ªå­", "é¾™ä¸‰", "é¾™", null);
    static ZHADANKE = new Role(34, "ğŸ’£", "ç‚¸å¼¹å®¢", "ç‚¸å¼¹", "å®¢", null);
    static HONGSANSAN = new Role(35, "ğŸ„", "çº¢ä¼ä¼", "è˜‘è‡", "è˜‘", null);
    static WUKONG = new Role(36, "ğŸµ", "æ‚Ÿç©º", "çŒ´å­", "çŒ´", null);
    static ZHANAN = new Role(37, "ğŸ”ª", "å…‰å½±æˆ˜å£«", "æ‰ç”·", "æ‰", null);
    static XIUNV = new Role(38, "ğŸ‘±â€â™€ï¸", "æˆ˜æ–—ä¿®å¥³", "ä¿®å¥³", "ä¿®", null);
    static TONY = new Role(39, "ğŸ’‡â€â™‚ï¸", "æ‰˜å°¼è€å¸ˆ", "æ‰˜å°¼", "æ‰˜", null);
    static RENZHE = new Role(40, "ğŸ¯", "æå°å¿", "å¿è€…", "å¿", null);
    static NUANYANG = new Role(41, "ğŸ", "æš–ç¾Šå·å·", "è‚¥ç¾Š", "ç¾Š", null);
    static QIANGWEI = new Role(42, "ğŸ‘©â€ğŸ¦½", "è”·è–‡å°‘å¥³", "èè", "è”·", null);
    static LANLAN = new Role(43, "ğŸ¤º", "å‰‘å§¬å²šå²š", "å²šå²š", "å²š", null);
    static KAIER = new Role(44, "ğŸ”¨", "åœ£é”¤å‡¯å°”", "å‡¯å°”", "é”¤", null);
    static SHITOUREN = new Role(45, "â›°ï¸", "å²­å—å·¨äºº", "çŸ³å¤´", "çŸ³", null);
    static TIEMIAN = new Role(46, "ğŸ¦", "é“é¢éª‘å£«", "é¾™è™¾", "è™¾", null);
    static MIAOJIANG = new Role(47, "ğŸˆ", "å–µæ³•å¸ˆ", "å–µé…±", "å–µ", null);
    static MUSHI = new Role(48, "â›ª", "åœ£å…‰ç‰§å¸ˆ", "ç‰§å¸ˆ", "ç‰§", null);
    static WUNV = new Role(49, "ğŸ•¯", "åœ£çµå·«å¥³", "å·«å¥³", "å·«", null);
    static LIANGLIANG = new Role(50, "ğŸ§œâ€â™€ï¸", "é“é“é±¼", "é±¼å¥³", "é“", null);
    static LAILAI = new Role(51, "ğŸ§œâ€â™‚ï¸", "ç™ç™é±¼", "é±¼ç”·", "ç™", null);
    static ZHANGYUGE = new Role(52, "ğŸ™", "ç« é±¼å…ˆç”Ÿ", "ç« é±¼", "ç« ", null);
    static HUABANTU = new Role(53, "ğŸ›¹", "æ½®ç©æ˜æ˜Ÿ", "æ»‘æ¿", "å…”", null);
    static NIUXIAOMANG = new Role(54, "ğŸ®", "ç‰›å°è½", "å°ç‰›", "ç‰›", null);
    static LANPANG = new Role(55, "ğŸŒ", "è“èƒ–", "è“èƒ–", "è“", null);
    static JIANSHI = new Role(56, "ğŸ—¡", "æµæµªå‰‘å£«", "å‰‘å£«", "å‰‘", null);
    static JUNDUN = new Role(57, "ğŸ›¡", "å†›å›¢ä¹‹ç›¾", "å†›ç›¾", "ç›¾", null);
    static YOUFANG = new Role(58, "ğŸŒ©ï¸", "æ¸¸æ–¹æœ¯å£«", "é›·ç”µ", "ç”µ", null);
    static MOUSE = new Role(59, "ğŸ­", "çº½æ‰£éª‘å£«", "è€é¼ ", "é¼ ", null);
    static YEREN = new Role(60, "ğŸ§”", "çµåŸŸè¨æ»¡", "é‡äºº", "é‡", null);
    static BAIGUJING = new Role(61, "ğŸ§â€â™€ï¸", "ç™½éª¨å¤«äºº", "ç™½éª¨", "éª¨", null);
    static TUYA = new Role(62, "ğŸ‘¨â€ğŸ¨", "æ¶‚é¸¦æˆ˜å£«", "æ¶‚é¸¦", "æ¶‚", null);


    static maxRoleId = -1;

    static getRoleById(id) {
        for (let item in Role) {
            if (Role[item].id === id) return Role[item];
        }
        return null;
    }

    static getFullNameById(id) {
        for (let item in Role) {
            //console.log(item + ".id = " + Role[item].id);
            //console.log(item + ".fullName = " + Role[item].fullName);
            if (Role[item].id === id) return Role[item].fullName;
        }
        return "";
    }

    static getIdByFullName(fName) {
        for (let item in Role) {
            if (Role[item].fullName === fName) return Role[item].id;
        }
        return -1;
    }

    static getFullNameByKeyWord(kw) {
        if (!kw) return "";
        for (let item in Role) {
            if (!Role[item].fullName || !Role[item].shortName) continue;
            if (Role[item].fullName.includes(kw) || Role[item].shortName.includes(kw)) return Role[item].fullName;
        }
        return "";
    }

    static getIdsByFullNames(fNames) {
        let ids = [];
        for (let i in fNames) {
            //console.log(">>>> Role.getIdsByFullNames fName=" + fNames[i]);
            //console.log(">>>> Role.getIdsByFullNames fName is string=" + (typeof fNames[i] === "string"));
            for (let item in Role) {
                if (Role[item].fullName === fNames[i]) ids.push(Role[item].id);
            }
        }
        return ids;
    }

    static getFullNamesByIds(ids) {
        let fNames = [];
        for (let i in ids) {
            //console.log(">>>> Role.getFullNamesByIds id=" + ids[i]);
            //console.log(">>>> Role.getFullNamesByIds id is number=" + (typeof ids[i] === "number"));
            for (let item in Role) {
                if (Role[item].id === Number(ids[i])) fNames.push(Role[item].fullName);
            }
        }
        //console.log(">>>> Role.getFullNamesByIds fNames=" + fNames);
        return fNames;
    }

    static getShortNameById(id) {
        for (let item in Role) {
            if (Role[item].id === id) return Role[item].shortName;
        }
        return "";
    }

    static getRoleIconById(id) {
        for (let item in Role) {
            if (Role[item].id === id) return Role[item].icon;
        }
        return "";
    }

    static getRoleArray() {
        let roleArr = [];
        for (let item in Role) {
            if (Role[item].id > -1 && Role[item].id != 10) roleArr.push(item);
        }
        return roleArr;
    }

    static getRandomRoleId() {
        if (this.maxRoleId >= 0) return fullCloseInt(0, this.maxRoleId);
        for (let item in Role) {
            //console.log(">>>> maxRoleId=" + this.maxRoleId);
            if (Role[item].id > this.maxRoleId) this.maxRoleId = Role[item].id;
        }
        return fullCloseInt(0, this.maxRoleId);
    }

    static initRoleCps() {
        this.HEIWA.cps = [Role.KUKU.id, Role.LELE.id, Role.LULU.id, Role.JIUWEIHU.id, Role.NURSE.id, Role.CHUZI.id, Role.TONY.id, Role.SHUANGZI.id, Role.WUGEGE.id, Role.WUKONG.id, Role.HUABANTU.id, Role.LANPANG.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id];
        this.JIANGJIANG.cps = [Role.KUKU.id, Role.LULU.id, Role.JIUWEIHU.id, Role.NURSE.id, Role.CHUZI.id, Role.MANWANG.id, Role.HUAQIANJI.id, Role.BAKE.id, Role.YINGYING.id, Role.WUGEGE.id, Role.ZHADANKE.id, Role.HONGSANSAN.id, Role.XIXUEGUI.id, Role.SANTAIZI.id];
        this.DUODUO.cps = [Role.HUAQIANJI.id, Role.BAKE.id, Role.CHUZI.id, Role.JOKER.id, Role.NURSE.id, Role.JIUWEIHU.id, Role.HONGZHAJI.id, Role.MIAOJIANG.id, Role.MUSHI.id];
        this.KUILEI.cps = [Role.YINGYING.id, Role.JOKER.id, Role.LINGLING.id, Role.RABBIT.id, Role.DIANYIN.id, Role.YOUXIA.id, Role.ZHANAN.id, Role.XIXUEGUI.id, Role.ZHADANKE.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.BAKE.cps = [Role.DUODUO.id, Role.LINGLING.id, Role.RABBIT.id, Role.WUGEGE.id, Role.DIANYIN.id, Role.XIUNV.id, Role.JIANGJIANG.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id];
        this.LULU.cps = [Role.JIANGJIANG.id, Role.HEIWA.id, Role.TIEMIAN.id, Role.CAPTAIN.id, Role.SANTAIZI.id];
        this.KUKU.cps = [Role.HEIWA.id, Role.JIANGJIANG.id, Role.RABBIT.id, Role.DIANYIN.id, Role.HUOWANG.id, Role.TIEMIAN.id, Role.ZHANAN.id];
        this.YINGYING.cps = [Role.LELE.id, Role.CAPTAIN.id, Role.KUILEI.id, Role.SHUANGZI.id, Role.WUGEGE.id, Role.LEIMENG.id, Role.JIANGJIANG.id, Role.BZGIRL.id, Role.SANTAIZI.id];
        this.JIUWEIHU.cps = [Role.JIANGJIANG.id, Role.HEIWA.id, Role.ZHANAN.id, Role.DUODUO.id, Role.NURSE.id, Role.CHUZI.id, Role.HONGZHAJI.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id];
        this.SHUANGZI.cps = [Role.JOKER.id, Role.RABBIT.id, Role.YOUXIA.id, Role.HEIWA.id, Role.YINGYING.id, Role.HUOWANG.id, Role.DIANYIN.id, Role.LINGLING.id, Role.LANGZAI.id, Role.ZHANAN.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.ZHADANKE.id, Role.SANTAIZI.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.X.cps = [Role.JOKER.id, Role.WUGEGE.id, Role.RABBIT.id, Role.SHUANGZI.id, Role.KUILEI.id, Role.LELE.id, Role.LEIMENG.id, Role.YINGYING.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id, Role.BAIGUJING.id]; // è‡ªå®šä¹‰è§’è‰²
        this.YOUXIA.cps = [Role.SHUANGZI.id, Role.ZHANAN.id, Role.LELE.id, Role.KUILEI.id, Role.WUGEGE.id, Role.WUKONG.id, Role.HUABANTU.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id];
        this.CHUZI.cps = [Role.HEIWA.id, Role.DIANYIN.id, Role.DUODUO.id, Role.NURSE.id, Role.JIUWEIHU.id, Role.MAGICLION.id, Role.YINGYING.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id];
        this.HUAQIANJI.cps = [Role.DUODUO.id, Role.JIANGJIANG.id, Role.NURSE.id, Role.JIUWEIHU.id, Role.RABBIT.id, Role.DIANYIN.id, Role.PUMPKIN.id, Role.HUOWANG.id, Role.QUANBA.id, Role.MUSHI.id];
        this.WUGEGE.cps = [Role.JOKER.id, Role.HEIWA.id, Role.LINGLING.id, Role.YOUXIA.id, Role.YINGYING.id, Role.JIANGJIANG.id, Role.ZHANAN.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.JOKER.cps = [Role.WUGEGE.id, Role.RABBIT.id, Role.SHUANGZI.id, Role.KUILEI.id, Role.LELE.id, Role.DIANYIN.id, Role.YINGYING.id, Role.LINGLING.id, Role.DUODUO.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.ZHADANKE.id, Role.XIUNV.id, Role.SANTAIZI.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.RABBIT.cps = [Role.LELE.id, Role.JOKER.id, Role.BAKE.id, Role.KUILEI.id, Role.WUKONG.id, Role.SHUANGZI.id, Role.KUKU.id, Role.MAGICLION.id, Role.HUABANTU.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id];
        this.NURSE.cps = [Role.HEIWA.id, Role.JIANGJIANG.id, Role.HUAQIANJI.id, Role.KAIER.id, Role.TIEMIAN.id, Role.DUODUO.id, Role.CHUZI.id, Role.JIUWEIHU.id, Role.LEIMENG.id, Role.BZGIRL.id];
        this.CAPTAIN.cps = [Role.YINGYING.id, Role.CHUZI.id, Role.SHUANGZI.id, Role.LELE.id, Role.KUILEI.id, Role.LULU.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id];
        this.LELE.cps = [Role.HEIWA.id, Role.RABBIT.id, Role.JOKER.id, Role.DIANYIN.id, Role.ZHANAN.id, Role.YINGYING.id, Role.CAPTAIN.id, Role.HUOWANG.id, Role.YOUXIA.id, Role.LANGZAI.id, Role.LINGLING.id, Role.TIEMIAN.id, Role.ZHADANKE.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.MANWANG.cps = [Role.RABBIT.id, Role.HEIWA.id, Role.JIANGJIANG.id, Role.LELE.id, Role.DIANYIN.id];
        this.LINGLING.cps = [Role.BAKE.id, Role.JOKER.id, Role.YINGYING.id, Role.KUILEI.id, Role.CHUZI.id, Role.WUGEGE.id, Role.LEIMENG.id, Role.LANLAN.id, Role.JIUWEIHU.id, Role.GUISHUSHI.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.HUOWANG.cps = [Role.LELE.id, Role.SHUANGZI.id, Role.JOKER.id, Role.GUISHUSHI.id, Role.YINGYING.id, Role.KUKU.id, Role.MAGICLION.id, Role.PUMPKIN.id, Role.HUABANTU.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.LEIMENG.cps = [Role.HEIWA.id, Role.JOKER.id, Role.DIANYIN.id, Role.YINGYING.id, Role.JIUWEIHU.id, Role.RABBIT.id, Role.HUOWANG.id, Role.GUISHUSHI.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.DIANYIN.cps = [Role.LELE.id, Role.SHUANGZI.id, Role.KUILEI.id, Role.JOKER.id, Role.CHUZI.id, Role.QUANBA.id, Role.MAGICLION.id, Role.KUKU.id, Role.LEIMENG.id, Role.HUABANTU.id, Role.BZGIRL.id, Role.SANTAIZI.id];
        this.XIXUEGUI.cps = [Role.CHUZI.id, Role.JOKER.id, Role.BAKE.id, Role.LELE.id, Role.KUILEI.id, Role.SHUANGZI.id, Role.YINGYING.id, Role.HUABANTU.id, Role.JIANGJIANG.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id];
        this.GUISHUSHI.cps = [Role.LELE.id, Role.SHUANGZI.id, Role.JOKER.id, Role.HUOWANG.id, Role.YINGYING.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.MAGICLION.cps = [Role.CHUZI.id, Role.SHITOUREN.id, Role.PUMPKIN.id, Role.DIANYIN.id, Role.JOKER.id, Role.BAKE.id, Role.RABBIT.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id];
        this.LANGZAI.cps = [Role.CHUZI.id, Role.JOKER.id, Role.BAKE.id, Role.YINGYING.id, Role.KUILEI.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.BZGIRL.cps = [Role.ZHANAN.id, Role.CHUZI.id, Role.JOKER.id, Role.BAKE.id, Role.YINGYING.id, Role.KUILEI.id, Role.SHUANGZI.id, Role.LELE.id, Role.DIANYIN.id, Role.RABBIT.id, Role.LANGZAI.id, Role.WUGEGE.id, Role.PUMPKIN.id, Role.LEIMENG.id, Role.SANTAIZI.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.PUMPKIN.cps = [Role.HUAQIANJI.id, Role.MAGICLION.id, Role.QUANBA.id, Role.GUISHUSHI.id, Role.HUOWANG.id, Role.LELE.id, Role.SHUANGZI.id, Role.RABBIT.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.QUANBA.cps = [Role.HUAQIANJI.id, Role.CHUZI.id, Role.PUMPKIN.id, Role.WUGEGE.id, Role.LELE.id, Role.SHUANGZI.id, Role.HUOWANG.id, Role.DIANYIN.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.HONGZHAJI.cps = [Role.JIUWEIHU.id, Role.HUAQIANJI.id, Role.DUODUO.id, Role.WUGEGE.id, Role.RABBIT.id, Role.YOUXIA.id, Role.CHUZI.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.SANTAIZI.cps = [Role.JOKER.id, Role.DIANYIN.id, Role.ZHANAN.id, Role.LELE.id, Role.WUGEGE.id, Role.RABBIT.id, Role.YOUXIA.id, Role.CHUZI.id, Role.HUOWANG.id, Role.GUISHUSHI.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.ZHADANKE.cps = [Role.HONGSANSAN.id, Role.YINGYING.id, Role.JIANGJIANG.id, Role.LELE.id, Role.WUGEGE.id, Role.SHUANGZI.id, Role.HUOWANG.id, Role.GUISHUSHI.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id];
        this.HONGSANSAN.cps = [Role.ZHADANKE.id, Role.PUMPKIN.id, Role.JIANGJIANG.id, Role.HUOWANG.id, Role.GUISHUSHI.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id];
        this.WUKONG.cps = [Role.DIANYIN.id, Role.RABBIT.id, Role.HEIWA.id, Role.XIUNV.id, Role.PUMPKIN.id, Role.ZHANAN.id, Role.HUOWANG.id, Role.GUISHUSHI.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.ZHANAN.cps = [Role.YOUXIA.id, Role.WUGEGE.id, Role.SHUANGZI.id, Role.WUKONG.id, Role.JIUWEIHU.id, Role.ZHANGYUGE.id, Role.HUABANTU.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.XIUNV.cps = [Role.BAKE.id, Role.WUKONG.id, Role.PUMPKIN.id, Role.WUGEGE.id, Role.HUOWANG.id, Role.GUISHUSHI.id, Role.ZHANGYUGE.id, Role.HUABANTU.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.TONY.cps = [Role.HEIWA.id, Role.WUKONG.id, Role.LELE.id, Role.SHUANGZI.id, Role.WUGEGE.id, Role.HUOWANG.id, Role.GUISHUSHI.id, Role.KUKU.id, Role.JIANGJIANG.id, Role.HUABANTU.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id];
        this.RENZHE.cps = [Role.JOKER.id, Role.WUKONG.id, Role.LELE.id, Role.SHUANGZI.id, Role.HUABANTU.id, Role.PUMPKIN.id, Role.WUGEGE.id, Role.YOUXIA.id, Role.KUKU.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id];
        this.NUANYANG.cps = [Role.JOKER.id, Role.YINGYING.id, Role.QIANGWEI.id, Role.CHUZI.id, Role.WUKONG.id, Role.PUMPKIN.id, Role.WUGEGE.id, Role.YOUXIA.id, Role.HUABANTU.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id];
        this.QIANGWEI.cps = [Role.JOKER.id, Role.YINGYING.id, Role.NUANYANG.id, Role.CHUZI.id, Role.WUKONG.id, Role.PUMPKIN.id, Role.WUGEGE.id, Role.YOUXIA.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id];
        this.LANLAN.cps = [Role.JOKER.id, Role.YINGYING.id, Role.LINGLING.id, Role.NUANYANG.id, Role.QIANGWEI.id, Role.CHUZI.id, Role.WUKONG.id, Role.PUMPKIN.id, Role.WUGEGE.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.KAIER.cps = [Role.NURSE.id, Role.JIUWEIHU.id, Role.JOKER.id, Role.QUANBA.id, Role.NUANYANG.id, Role.QIANGWEI.id, Role.CHUZI.id, Role.WUKONG.id, Role.PUMPKIN.id, Role.WUGEGE.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.SHITOUREN.cps = [Role.MAGICLION.id, Role.XIUNV.id, Role.MIAOJIANG.id, Role.NUANYANG.id, Role.QIANGWEI.id, Role.CHUZI.id, Role.PUMPKIN.id, Role.WUGEGE.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.TIEMIAN.cps = [Role.LULU.id, Role.NURSE.id, Role.JIUWEIHU.id, Role.LELE.id, Role.SHUANGZI.id, Role.CHUZI.id, Role.WUKONG.id, Role.PUMPKIN.id, Role.WUGEGE.id, Role.KUKU.id, Role.HUABANTU.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id];
        this.MIAOJIANG.cps = [Role.MAGICLION.id, Role.SHITOUREN.id, Role.NURSE.id, Role.JIUWEIHU.id, Role.DUODUO.id, Role.SHUANGZI.id, Role.CHUZI.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id];
        this.MUSHI.cps = [Role.KAIER.id, Role.QUANBA.id, Role.HUAQIANJI.id, Role.LELE.id, Role.SHUANGZI.id, Role.CHUZI.id, Role.PUMPKIN.id, Role.DIANYIN.id, Role.RABBIT.id, Role.HONGZHAJI.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.WUNV.cps = [Role.YINGYING.id, Role.CAPTAIN.id, Role.LELE.id, Role.SHUANGZI.id, Role.CHUZI.id, Role.WUKONG.id, Role.PUMPKIN.id, Role.JIANGJIANG.id, Role.HUOWANG.id, Role.GUISHUSHI.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.LIANGLIANG.cps = [Role.LAILAI.id, Role.MAGICLION.id, Role.BAKE.id, Role.NUANYANG.id, Role.QIANGWEI.id, Role.CAPTAIN.id, Role.CHUZI.id, Role.LEIMENG.id, Role.BZGIRL.id];
        this.LAILAI.cps = [Role.LIANGLIANG.id, Role.MAGICLION.id, Role.BAKE.id, Role.NUANYANG.id, Role.QIANGWEI.id, Role.CAPTAIN.id, Role.CHUZI.id, Role.LEIMENG.id, Role.BZGIRL.id];
        this.ZHANGYUGE.cps = [Role.HUOWANG.id, Role.GUISHUSHI.id, Role.DIANYIN.id, Role.RABBIT.id, Role.NUANYANG.id, Role.QIANGWEI.id, Role.CAPTAIN.id, Role.YINGYING.id, Role.PUMPKIN.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.HUABANTU.cps = [Role.HUOWANG.id, Role.GUISHUSHI.id, Role.HEIWA.id, Role.DIANYIN.id, Role.RABBIT.id, Role.NUANYANG.id, Role.QIANGWEI.id, Role.CAPTAIN.id, Role.YINGYING.id, Role.LINGLING.id, Role.PUMPKIN.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.NIUXIAOMANG.cps = [Role.HUOWANG.id, Role.GUISHUSHI.id, Role.JOKER.id, Role.DIANYIN.id, Role.RABBIT.id, Role.NUANYANG.id, Role.QIANGWEI.id, Role.CAPTAIN.id, Role.YINGYING.id, Role.LINGLING.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.LANPANG.cps = [Role.HUOWANG.id, Role.GUISHUSHI.id, Role.PUMPKIN.id, Role.HEIWA.id, Role.DIANYIN.id, Role.RABBIT.id, Role.XIXUEGUI.id, Role.NUANYANG.id, Role.QIANGWEI.id, Role.CAPTAIN.id, Role.YINGYING.id, Role.LINGLING.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id, Role.BAIGUJING.id];
        this.JIANSHI.cps = [Role.HUOWANG.id, Role.GUISHUSHI.id, Role.NUANYANG.id, Role.QIANGWEI.id, Role.CAPTAIN.id, Role.JIUWEIHU.id, Role.NURSE.id, Role.CHUZI.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id];
        this.JUNDUN.cps = [Role.DIANYIN.id, Role.RABBIT.id, Role.HEIWA.id, Role.ZHANAN.id, Role.JIANGJIANG.id, Role.NUANYANG.id, Role.QIANGWEI.id, Role.CAPTAIN.id, Role.LANLAN.id, Role.LINGLING.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id];
        this.YOUFANG.cps = [Role.JOKER.id, Role.HUOWANG.id, Role.NUANYANG.id, Role.QIANGWEI.id, Role.CAPTAIN.id, Role.CHUZI.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id];
        this.MOUSE.cps = [Role.DIANYIN.id, Role.RABBIT.id, Role.WUGEGE.id, Role.HUOWANG.id, Role.GUISHUSHI.id, Role.JIANGJIANG.id, Role.NUANYANG.id, Role.CAPTAIN.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id];
        this.YEREN.cps = [Role.DIANYIN.id, Role.RABBIT.id, Role.WUGEGE.id, Role.WUKONG.id, Role.LANPANG.id, Role.HUOWANG.id, Role.GUISHUSHI.id, Role.PUMPKIN.id, Role.LELE.id, Role.SHUANGZI.id, Role.HUABANTU.id, Role.LANPANG.id, Role.MAGICLION.id, Role.JIANGJIANG.id, Role.NUANYANG.id, Role.CAPTAIN.id, Role.XIUNV.id, Role.ZHADANKE.id, Role.HONGSANSAN.id, Role.LEIMENG.id, Role.BZGIRL.id, Role.SANTAIZI.id];
        this.BAIGUJING.cps = [Role.WUGEGE.id, Role.WUKONG.id, Role.LANPANG.id, Role.HUOWANG.id, Role.GUISHUSHI.id, Role.PUMPKIN.id, Role.LELE.id, Role.SHUANGZI.id, Role.KUILEI.id, Role.HUABANTU.id, Role.NIUXIAOMANG.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id];
        this.TUYA.cps = [Role.JIUWEIHU.id, Role.NURSE.id, Role.ZHANAN.id, Role.WUGEGE.id, Role.WUKONG.id, Role.LANPANG.id, Role.HUOWANG.id, Role.GUISHUSHI.id, Role.PUMPKIN.id, Role.LELE.id, Role.SHUANGZI.id, Role.KUILEI.id, Role.HUABANTU.id, Role.NIUXIAOMANG.id, Role.BZGIRL.id, Role.SANTAIZI.id, Role.YEREN.id];
        // TODO åç»­éœ€è¦æŠ½å–åˆ†ç±»ï¼Œä¸ç„¶å¾ˆéš¾ç»´æŠ¤
    }

}
// è®¾ç½®ä¸»è§’å¸¸ç”¨æ­é…
Role.initRoleCps();


// å¸¸ç”¨æ­é…ç±»
class RegularlyCollocation {

    constructor(id, group) {
        this.id = id;
        this.group = group;
    }

    // ğŸ¥šã€ğŸ§Ÿã€â„ï¸ã€ğŸ¤¡ã€8g æ¯ä¸ªåˆ†é…ä¸€ç™¾ä¸‡ä¸ªid
    static group1000001 = new RegularlyCollocation(1000001, [Role.DUODUO.id, Role.BAKE.id]);
    static group1000002 = new RegularlyCollocation(1000002, [Role.DUODUO.id, Role.HUAQIANJI.id]);
    static group1000003 = new RegularlyCollocation(1000003, [Role.DUODUO.id, Role.CHUZI.id]);
    static group1000004 = new RegularlyCollocation(1000004, [Role.DUODUO.id, Role.JOKER.id]);
    static group1000005 = new RegularlyCollocation(1000005, [Role.DUODUO.id, Role.HONGZHAJI.id]);
    static group1000006 = new RegularlyCollocation(1000006, [Role.DUODUO.id, Role.MIAOJIANG.id]);
    static group1000007 = new RegularlyCollocation(1000007, [Role.DUODUO.id, Role.NURSE.id]);
    static group1000008 = new RegularlyCollocation(1000008, [Role.DUODUO.id, Role.JIUWEIHU.id]);

    static group2000001 = new RegularlyCollocation(2000001, [Role.JIANGJIANG.id, Role.LULU.id]);
    static group2000002 = new RegularlyCollocation(2000002, [Role.JIANGJIANG.id, Role.KUKU.id]);
    static group2000003 = new RegularlyCollocation(2000003, [Role.JIANGJIANG.id, Role.JIUWEIHU.id]);
    static group2000004 = new RegularlyCollocation(2000004, [Role.JIANGJIANG.id, Role.NURSE.id]);
    static group2000005 = new RegularlyCollocation(2000005, [Role.JIANGJIANG.id, Role.BAKE.id]);
    static group2000006 = new RegularlyCollocation(2000006, [Role.JIANGJIANG.id, Role.YINGYING.id]);
    static group2000007 = new RegularlyCollocation(2000007, [Role.JIANGJIANG.id, Role.WUGEGE.id]);
    static group2000008 = new RegularlyCollocation(2000008, [Role.JIANGJIANG.id, Role.HUAQIANJI.id]);
    static group2000009 = new RegularlyCollocation(2000009, [Role.JIANGJIANG.id, Role.MANWANG.id]);
    static group2000010 = new RegularlyCollocation(2000010, [Role.JIANGJIANG.id, Role.ZHADANKE.id]);
    static group2000011 = new RegularlyCollocation(2000011, [Role.JIANGJIANG.id, Role.HONGSANSAN.id]);
    static group2000012 = new RegularlyCollocation(2000012, [Role.JIANGJIANG.id, Role.SANTAIZI.id]);

    static group3000001 = new RegularlyCollocation(3000001, [Role.YINGYING.id, Role.LELE.id]);
    static group3000002 = new RegularlyCollocation(3000002, [Role.YINGYING.id, Role.CAPTAIN.id]);
    static group3000003 = new RegularlyCollocation(3000003, [Role.YINGYING.id, Role.KUILEI.id]);
    static group3000004 = new RegularlyCollocation(3000004, [Role.YINGYING.id, Role.WUGEGE.id]);
    static group3000005 = new RegularlyCollocation(3000005, [Role.YINGYING.id, Role.LINGLING.id]);
    static group3000006 = new RegularlyCollocation(3000006, [Role.YINGYING.id, Role.HUOWANG.id]);
    static group3000007 = new RegularlyCollocation(3000007, [Role.YINGYING.id, Role.LEIMENG.id]);
    static group3000008 = new RegularlyCollocation(3000008, [Role.YINGYING.id, Role.BZGIRL.id]);
    static group3000009 = new RegularlyCollocation(3000009, [Role.YINGYING.id, Role.XIXUEGUI.id]);
    static group3000010 = new RegularlyCollocation(3000010, [Role.YINGYING.id, Role.SHUANGZI.id]);
    static group3000011 = new RegularlyCollocation(3000011, [Role.YINGYING.id, Role.JIANGJIANG.id]);
    static group3000012 = new RegularlyCollocation(3000012, [Role.YINGYING.id, Role.ZHADANKE.id]);
    static group3000013 = new RegularlyCollocation(3000013, [Role.YINGYING.id, Role.HONGSANSAN.id]);
    static group3000014 = new RegularlyCollocation(3000014, [Role.YINGYING.id, Role.SANTAIZI.id]);

    static group4000001 = new RegularlyCollocation(4000001, [Role.JOKER.id, Role.WUGEGE.id]);
    static group4000002 = new RegularlyCollocation(4000002, [Role.JOKER.id, Role.RABBIT.id]);
    static group4000003 = new RegularlyCollocation(4000003, [Role.JOKER.id, Role.LELE.id]);
    static group4000004 = new RegularlyCollocation(4000004, [Role.JOKER.id, Role.SHUANGZI.id]);
    static group4000005 = new RegularlyCollocation(4000005, [Role.JOKER.id, Role.KUILEI.id]);
    static group4000006 = new RegularlyCollocation(4000006, [Role.JOKER.id, Role.LEIMENG.id]);
    static group4000007 = new RegularlyCollocation(4000007, [Role.JOKER.id, Role.GUISHUSHI.id]);
    static group4000008 = new RegularlyCollocation(4000008, [Role.JOKER.id, Role.DIANYIN.id]);
    static group4000009 = new RegularlyCollocation(4000009, [Role.JOKER.id, Role.XIXUEGUI.id]);
    static group4000010 = new RegularlyCollocation(4000010, [Role.JOKER.id, Role.LANGZAI.id]);
    static group4000011 = new RegularlyCollocation(4000011, [Role.JOKER.id, Role.BZGIRL.id]);
    static group4000012 = new RegularlyCollocation(4000012, [Role.JOKER.id, Role.HUOWANG.id]);
    static group4000013 = new RegularlyCollocation(4000013, [Role.JOKER.id, Role.XIUNV.id]);
    static group4000014 = new RegularlyCollocation(4000014, [Role.JOKER.id, Role.ZHADANKE.id]);
    static group4000015 = new RegularlyCollocation(4000015, [Role.JOKER.id, Role.HONGSANSAN.id]);
    static group4000016 = new RegularlyCollocation(4000016, [Role.JOKER.id, Role.MAGICLION.id]);
    static group4000017 = new RegularlyCollocation(4000017, [Role.JOKER.id, Role.SANTAIZI.id]);
    static group4000018 = new RegularlyCollocation(4000018, [Role.JOKER.id, Role.YINGYING.id]);
    static group4000019 = new RegularlyCollocation(4000019, [Role.JOKER.id, Role.LINGLING.id]);
    static group4000020 = new RegularlyCollocation(4000020, [Role.JOKER.id, Role.LANLAN.id]);

    static group5000000 = new RegularlyCollocation(5000000, [Role.BAKE.id, Role.DUODUO.id]);
    static group5000001 = new RegularlyCollocation(5000001, [Role.BAKE.id, Role.WUGEGE.id]);
    static group5000002 = new RegularlyCollocation(5000002, [Role.BAKE.id, Role.RABBIT.id]);
    static group5000003 = new RegularlyCollocation(5000003, [Role.BAKE.id, Role.LINGLING.id]);
    static group5000004 = new RegularlyCollocation(5000004, [Role.BAKE.id, Role.DIANYIN.id]);
    static group5000005 = new RegularlyCollocation(5000005, [Role.BAKE.id, Role.XIXUEGUI.id]);
    static group5000006 = new RegularlyCollocation(5000006, [Role.BAKE.id, Role.LEIMENG.id]);
    static group5000007 = new RegularlyCollocation(5000007, [Role.BAKE.id, Role.BZGIRL.id]);
    static group5000008 = new RegularlyCollocation(5000008, [Role.BAKE.id, Role.LANGZAI.id]);
    static group5000009 = new RegularlyCollocation(5000009, [Role.BAKE.id, Role.BZGIRL.id]);
    static group5000010 = new RegularlyCollocation(5000010, [Role.BAKE.id, Role.XIUNV.id]);
    static group5000011 = new RegularlyCollocation(5000011, [Role.BAKE.id, Role.LANLAN.id]);
    static group5000012 = new RegularlyCollocation(5000012, [Role.BAKE.id, Role.SANTAIZI.id]);


    // å…¶ä»–å¼ºåŠ¿æ­é…
    static group100000001 = new RegularlyCollocation(100000001, [Role.JIUWEIHU.id, Role.LEIMENG.id]);
    static group100000002 = new RegularlyCollocation(100000002, [Role.JIUWEIHU.id, Role.NURSE.id]);
    static group100000003 = new RegularlyCollocation(100000003, [Role.JIUWEIHU.id, Role.HONGZHAJI.id]);
    static group100000004 = new RegularlyCollocation(100000004, [Role.CHUZI.id, Role.MAGICLION.id]);
    static group100000005 = new RegularlyCollocation(100000005, [Role.BZGIRL.id, Role.DIANYIN.id]);
    static group100000006 = new RegularlyCollocation(100000006, [Role.ZHADANKE.id, Role.HONGSANSAN.id]);
    static group100000007 = new RegularlyCollocation(100000007, [Role.LELE.id, Role.RABBIT.id]);
    static group100000008 = new RegularlyCollocation(100000008, [Role.LELE.id, Role.DIANYIN.id]);
    static group100000009 = new RegularlyCollocation(100000009, [Role.LULU.id, Role.CAPTAIN.id]);
    static group100000010 = new RegularlyCollocation(100000010, [Role.KUKU.id, Role.TIEMIAN.id]);
    static group100000011 = new RegularlyCollocation(100000011, [Role.RABBIT.id, Role.MAGICLION.id]);
    static group100000012 = new RegularlyCollocation(100000012, [Role.RABBIT.id, Role.PUMPKIN.id]);
    static group100000013 = new RegularlyCollocation(100000013, [Role.QUANBA.id, Role.HUAQIANJI.id]);
    static group100000014 = new RegularlyCollocation(100000014, [Role.QUANBA.id, Role.CHUZI.id]);
    static group100000015 = new RegularlyCollocation(100000015, [Role.SANTAIZI.id, Role.DIANYIN.id]);
    static group100000016 = new RegularlyCollocation(100000016, [Role.SANTAIZI.id, Role.RABBIT.id]);
    static group100000017 = new RegularlyCollocation(100000017, [Role.KUKU.id, Role.RABBIT.id]);
    static group100000018 = new RegularlyCollocation(100000018, [Role.KUKU.id, Role.DIANYIN.id]);
    static group100000019 = new RegularlyCollocation(100000019, [Role.NURSE.id, Role.CHUZI.id]);
    static group100000020 = new RegularlyCollocation(100000020, [Role.JIUWEIHU.id, Role.CHUZI.id]);


    static maxGroupId = 0;
    static groupSum = 0;


    static getMaxGroupId() {
        if (this.maxGroupId > 0) return this.maxGroupId;
        for (let item in RegularlyCollocation) {
            if (!RegularlyCollocation[item].id) continue;
            if (RegularlyCollocation[item].id > this.maxGroupId) this.maxGroupId = RegularlyCollocation[item].id;
        }
        return this.maxGroupId;
    }

    static getGroupSum() {
        if (this.groupSum > 0) return this.groupSum;
        for (let item in RegularlyCollocation) {
            if (!RegularlyCollocation[item].id) continue;
            if (RegularlyCollocation[item].id > 0) this.groupSum += 1;
        }
        //console.log(">>>> RegularlyCollocation groupSum=" + this.groupSum); // 41
        return this.groupSum;
    }

    static getNextGroupItem(id) {
        let currItem = null;
        let targetItem = null;
        for (let item in RegularlyCollocation) {
            if (!RegularlyCollocation[item].id) continue;
            if (currItem) {
                targetItem = RegularlyCollocation[item];
                return targetItem;
            }
            if (RegularlyCollocation[item].id === id) currItem = RegularlyCollocation[item];
        }
        return group1000001;
    }

    static getRandomGroup() {
        let idx = fullCloseInt(1, this.getGroupSum());
        //console.log(">>>> RegularlyCollocation getRandomGroup idx=" + idx);
        let i = 1;
        for (let item in RegularlyCollocation) {
            if (!RegularlyCollocation[item].id) continue;
            if (i === idx) return RegularlyCollocation[item].group;
            i++;
        }
        return group1000001.group;
    }

}

//////////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////////
// ã€åº”ç”¨åˆå§‹åŒ–ã€‘ å˜é‡ã€æ–¹æ³•åŒºåŸŸ
//////////////////////////////////////////////////////////////////////

// å››æ¡åˆ‡è§’çº¿
var lines = [];
// å››æ¡åˆ‡è§’çº¿ä¸­ç‚¹åæ ‡
var linesMiddlePoints = [];
// å°çƒ/è§’è‰²
var balls = [];
// è›‹
var eggs = [];
// ä¸´æ—¶å°çƒå¯¹è±¡ï¼Œç”¨äºçŸ¥é“åæ ‡ã€åŠå¾„åˆ›å»ºçƒå¯¹è±¡ï¼Œä½¿ç”¨å¸¸é‡é¿å…é¢‘ç¹åˆ›å»ºå¯¹è±¡
var tempCheckBall;
// åˆ†èº«å¯¹è±¡ï¼Œè®¾ç½®è·Ÿä¸»çƒä¸€æ ·çš„contextï¼Œä¾¿äºæ‹–åŠ¨æ—¶æ¸…ç†ç”»å¸ƒ
var twinBall;
// è§’è‰²æ˜¯å¦å­˜åœ¨åˆ¤æ–­æ ‡è¯†
var isDuoduoExist = false;
var isLuluExist = false;
var isShuangziExist = false;
// åˆ†äº«çš„è§’è‰²å’Œåæ ‡æ•°æ®
var shareData = null;
// htmlæ ¹å…ƒç´ å­—ä½“å¤§å°
var htmlEle, htmlFontSize, htmlFontSizeNum;

onMounted(() => {
    tempCheckBall = new Ball(context);
    twinBall = new Ball(gameMainBallContext);
    htmlEle = document.getElementsByTagName('html')[0];
    htmlFontSize = window.getComputedStyle(htmlEle).fontSize || "12px";
    htmlFontSizeNum = Number(htmlFontSize.replace("px", ""));
})


// åº”ç”¨åˆå§‹åŒ–
function init() {
    // è®¾ç½®åº”ç”¨å…¨åï¼ˆåç§°+ç‰ˆæœ¬åï¼‰
    setAppFullName();
    // è®¾ç½®åº”ç”¨æ›´æ–°å†…å®¹
    setAppUpdateContent();
    // éšè—å…³é—­æ‰€æœ‰dialogå¼¹çª—ï¼Œä¿è¯ç¦»çº¿ç‰ˆåˆšæ‰“å¼€ä¸ä¼šä¸€ç›´æœ‰å¼¹çª—
    hideAllDialog();
    // æ£€æµ‹ WebStorage æ˜¯å¦æ­£å¸¸å¯ç”¨
    if (!checkWebStorage()) return;
    // ä¿å­˜ä¸€ä»½dpr
    sysConfig.dpr = dpr;
    // ç‰ˆæœ¬å·æ ¡éªŒ
    doVersionThings();
    // ç”¨æˆ·é…ç½®
    setUserConfig();
    // è®¾ç½®åˆå§‹ä¸»é¢˜
    setThemeBySeason();
    // åƒç´ æ¯”ä¾‹
    if (os.isTablet) sysConfig.pxRatio = 1.618;
    console.log(">>>> sysConfig.pxRatio=" + sysConfig.pxRatio);
    // è®¾ç½®å­—ä½“å¤§å°
    setFontSize();
    console.log(">>>> html font size=" + htmlFontSize);
    // æ¸¸æˆå°é¢å å±å¹•å®½åº¦çš„æ¯”ä¾‹
    if (os.isTablet) sysConfig.sceneWidthRatio = 0.618;
    console.log(">>>> sysConfig.sceneWidthRatio=" + sysConfig.sceneWidthRatio);
    // åˆå§‹åŒ–ç”»å¸ƒå¤§å°ã€ç½‘æ ¼å¤§å°
    setPageSize();
    console.log(">>>> sysConfig.girdSize=" + sysConfig.girdSize);
    console.log(">>>> sysConfig.girdSizeCss=" + sysConfig.girdSizeCss);
    // è°ƒæ•´è¾¹æ¡†å®½åº¦ä¸º 0.3 * girdSizeCss
    sysConfig.sceneLineWidth = roundNumber(0.27 * sysConfig.girdSizeCss, 4);
    console.log(">>>> sysConfig.sceneLineWidth=" + sysConfig.sceneLineWidth);
    // è®¾ç½®å¼¹çª—æ»šåŠ¨åŒºåŸŸé«˜åº¦
    setDialogScrollMaxHeight(1.70);
    // ç”»å¸ƒå±…ä¸­
    canvasAutoCenter();
    // åˆå§‹åŒ–é¼ æ ‡ä½ç½®
    captureMouse(canvas);
    // æ ¹æ®ç”¨æˆ·é€‰æ‹©è®¾ç½®å½“å‰è§’è‰²
    //userConfig.currRole = Role.HEIWA.id;
    //userConfig.currRole = Role.JIANGJIANG.id;
    // å¯¼å…¥äº†è§’è‰²å’Œåæ ‡æ•°æ®ï¼Œä¸ç”¨é€‰è§’è‰²
    if (userConfig.shareRoleAndPos) {
        try {
            shareData = JSON.parse(userConfig.shareRoleAndPos);
            console.log(shareData);
        } catch (e) { }
    }
    if (!shareData) setCurrRole();
    if (userConfig.currRole < 0) userConfig.currRole = 0;
    // è®¾ç½®å°é¢åˆ‡è§’åå·®è·ç¦»ã€‚æ³¨æ„æ”¾åœ¨åˆå§‹åŒ–åˆ‡å‰²æ–œè¾¹ä¹‹å‰
    if (sysConfig.isWan8CocosTable) {
        // ä½¿ç”¨å¤šç‚¹ç²¾ç¡®æ§åˆ¶æ–¹å¼
        setSysWan8CocosTableMoveVals();
    }
    console.log(">>>> sysConfig.wan8CocosTableMoveVals=" + sysConfig.wan8CocosTableMoveVals.toString());
    // åˆå§‹åŒ–åˆ‡å‰²æ–œè¾¹
    set4AngleLine();
    // åˆå§‹åŒ–è®¾ç½®å››æ¡åˆ‡è§’çº¿ä¸­ç‚¹åæ ‡
    set4AngleLineMiddlePoint(lines);
    // åªæ˜¾ç¤ºå°é¢ï¼Œä¸è®¾ç½®è§’è‰²ã€æ§åˆ¶å°æŠ¥é”™å¯ä»¥ä¸ç”¨ç®¡ã€‘
    if (!userConfig.isJustShowTable && userConfig.currRole > -1) {
        try {
            if (!shareData) throw new Error(">>>> åˆ†äº«è§’è‰²å’Œåæ ‡æ•°æ®å¼‚å¸¸");
            // è®¾ç½®åˆ†äº«è§’è‰²å’Œä½ç½®
            setShareRoleAndPos(shareData);
            // è®¾ç½®å½“å‰ä¸»è§’
            if (balls && balls.length > 0) userConfig.currRole = balls[0].roleId;
            // æ ‡è®°è§’è‰²å·²ç»é€‰æ‹©å®Œæˆ
            sysConfig.isRoleChooseFinished = true;
        } catch (e) {
            console.log(">>>> setShareRoleAndPos error: " + e.message);
            // è®¾ç½®ä¸»çƒ
            setBallMain();
            // è®¾ç½®å…¶ä»–å°çƒ
            if (!userConfig.isTestOnlyOne) setBallOthersByRole(userConfig.currRole);
            // è®¾ç½®å°ä¸‘åˆ†èº«ã€æ”¾åœ¨è§’è‰²è®¾ç½®å®Œæˆåã€‘
            setRoleJoker();
        } finally {
            // åŠ è½½ä¹‹åï¼Œæ¸…é™¤å¯¼å…¥æ•°æ®ã€æ”¾åˆ°onMouseMoveæ–¹æ³•å†å¤„ç†ã€‘
            //clearShareRoleAndPos();
        }
        // è®¾ç½®åŒå­åˆ†èº«
        if (userConfig.currRole === Role.SHUANGZI.id) setTwins();
        // è®¾ç½®å®Œæ‰€æœ‰è§’è‰²ä¹‹åï¼Œè®¾ç½®ä¸»è§’æ‰€å±é˜Ÿé¢œè‰²
        resetMainTeamColorRandom(userConfig.mainTeamColor);
        // åˆå§‹åŒ–è§’è‰²ç¢°æ’æ ‡å¿—ä½
        setBallCollidingNos();
        // è®¾ç½®å®Œè§’è‰²åï¼Œæ£€æµ‹è§’è‰²æ˜¯å¦å­˜åœ¨
        checkRoleExist();
        // åƒµå°¸éœ²éœ²ç»„åˆï¼ŒåŠ å¿«é€Ÿåº¦
        if (userConfig.currRole === Role.JIANGJIANG.id && isLuluExist) balls[0].vRatio = 1.03;
        // è®¾ç½®è›‹
        if (isDuoduoExist) setEggs();
        // è®¾ç½®é€Ÿåº¦
        setSpeed();
        // è®¾ç½®æ‘©æ“¦åŠ›
        setFriction();
    }
    // è§’è‰²è¿åŠ¨è·¯å¾„åˆ¤æ–­æ˜¾ç¤º
    if (userConfig.isShowBallMovePath) gamePathCanvas.style.display = "inherit";
    // è§’è‰²å…¨è·¯å¾„åˆ¤æ–­æ˜¾ç¤º
    if (userConfig.isShowBallPath) gamePathBallCanvas.style.display = "inherit";
    // æ¸¸æˆæ¡Œé¢åœºæ™¯åˆå§‹åŒ–ï¼Œéœ€è¦æ”¾åœ¨è§’è‰²è®¾ç½®ä¹‹åï¼Œå› ä¸ºåœºæ™¯ä¼šæ ¹æ®è§’è‰²å˜åŒ–
    if (sysConfig.isRoleChooseFinished) gameSceneInit(); // é€‰æ‹©è§’è‰²åæ‰æ¸²æŸ“åœºæ™¯ï¼Œä¼˜åŒ–æ€§èƒ½
    // æ˜¾ç¤ºæ“ä½œæŒ‡å—å¼¹çª—
    if (sysConfig.isRoleChooseFinished) showHowToPlay(true);
}


onMounted(() => {
    try {
        init();
    } catch (e) {
        // å¤„ç†é”™è¯¯äº‹é¡¹
        if (e instanceof Error) {
            if (e.message.includes("æ‰‹åŠ¨ç»“æŸç¨‹åº")) { throw e; }
        }
        doGlobalError(e, (sysConfig && sysConfig.alertErrorCount) ? sysConfig.alertErrorCount : 3);
    }
})


// è®¾ç½®åº”ç”¨åç§°
function setAppFullName() {
    let fullNameEles = document.getElementsByClassName('collide-try-app-full-name');
    if (!fullNameEles) return;
    let fullName = sysConfig.appName + "_" + sysConfig.versionName;
    for (let i = 0, len = fullNameEles.length; i < len; i++) {
        fullNameEles[i].innerText = fullName;
    }
}


// è®¾ç½®åº”ç”¨æ›´æ–°å†…å®¹
function setAppUpdateContent() {
    let updateTitleEle = document.getElementById("update-content-title");
    if (!updateTitleEle) return;
    updateTitleEle.innerText = "ğŸ†• " + sysConfig.versionName + " æ›´æ–°";
    let updateTargetEle = document.getElementById("collide-try-update-content");
    if (!updateTargetEle) return;
    let updateContentEle = document.getElementById("collide-try-about-app-update-newest");
    if (!updateContentEle) return;
    let updateContentEleClone = updateContentEle.cloneNode(true);
    if (!updateContentEleClone) return;
    // å…ˆæ¸…ç©ºå­å…ƒç´ ï¼Œé¿å…é‡å¤æ·»åŠ 
    let targetChildren = updateTargetEle.childNodes;
    if (targetChildren && targetChildren.length > 0) {
        for (let i = 0, len = targetChildren.length; i < len; i++) {
            updateTargetEle.removeChild(targetChildren[i]);
        }
    }
    updateTargetEle.appendChild(updateContentEleClone);
}


// æ ¡éªŒç‰ˆæœ¬å·ï¼Œå¤„ç†æ–°å¢åŠŸèƒ½é€»è¾‘ï¼Œæ›´æ–°ç‰ˆæœ¬è¦æ›´æ–°ä¹‹å‰çš„ç¼“å­˜
function doVersionThings() {
    let collideTryVersionStr = localStorage.getItem('collide-try-version');
    let collideTryVersion = collideTryVersionStr ? Number(collideTryVersionStr) : 0;
    console.log(">>>> collide-try-version-old=" + collideTryVersion + ", collide-try-version-new=" + sysConfig.version);
    if (sysConfig.version > collideTryVersion) {
        // æ›´æ–° userConfig ç¼“å­˜
        let localUserConfigStr = localStorage.getItem('collide-try-user-settings');
        let userConfigCache = null;
        if (localUserConfigStr) {
            userConfigCache = JSON.parse(localUserConfigStr);
        }
        if (userConfigCache) {
            for (let f in userConfig) {
                //console.log(f + " = " + userConfig[f]);
                // ä¸ªåˆ«ç‰¹æ®Šå­—æ®µä¸å—ç¼“å­˜å½±å“ï¼Œä»¥é…ç½®ä¸ºå‡†
                if (f === 'tryFullPathPointNum') continue;
                if (f === 'animateAutoRestTime') continue;
                if (userConfigCache[f] || typeof userConfigCache[f] === "boolean") userConfig[f] = userConfigCache[f];
            }
            // æ›´æ–° localStorage ä¸­çš„ userConfig
            localStorage.setItem('collide-try-user-settings', JSON.stringify(userConfig));
            console.log(">>>> doVersionThings userConfig in localStorage updated.");
        }

        // æ˜¾ç¤ºæ›´æ–°å†…å®¹
        showUpdateContent(true);

        localStorage.setItem('collide-try-version', sysConfig.version); // ç‰ˆæœ¬å·å­˜å…¥ç¼“å­˜
        localStorage.removeItem("collide-try-init-error-count"); // æ›´æ–°ç‰ˆæœ¬åé‡ç½®é”™è¯¯è®¡æ•°
    }
}


// åˆå§‹åŒ–æ–¹æ³•æŠ¥é”™å¤šæ¬¡åï¼Œè¦å¤„ç†çš„äº‹æƒ…
function doGlobalError(e, count) {
    let collideTryInitErrorCountStr = localStorage.getItem('collide-try-init-error-count');
    let collideTryInitErrorCount = collideTryInitErrorCountStr ? Number(collideTryInitErrorCountStr) : 0;
    console.log(">>>> collideTryInitErrorCount=" + collideTryInitErrorCount);
    if (!count || count < 0) count = 3;
    if (collideTryInitErrorCount >= count || !isProd()) { // é”™è¯¯è¾¾åˆ°æŒ‡å®šæ¬¡æ•°
        /*
        // æ¸…ç†æ‰€æœ‰ç¼“å­˜ã€ä¹‹å‰å‚æ•°é…ç½®ä¼šä¸¢å¤±ã€‘
        //localStorage.clear();
        sessionStorage.clear();
        for (let i = 0, len = localStorage.length; i < len; i++) {
            if (!localStorage.key(i)) continue;
            if (localStorage.key(i).includes("access-key")) continue;
            localStorage.removeItem(localStorage.key(i));
        }
        */
        // è¶…è¿‡æ¬¡æ•°å¼¹çª—æç¤º
        if (collideTryInitErrorCount % count === 0 || !isProd()) doGlobalErrorMsg(e, true);
        // è¾¾åˆ°äº”æ¬¡å¼¹çª—æç¤ºå°è¯•æ¢å¤é»˜è®¤è®¾ç½®
        if (collideTryInitErrorCount % 5 === 0)
            alert("ğŸ’¡ æ¸©é¦¨æç¤ºï¼š\nä¸€ç›´æŠ¥é”™ï¼Œå¯ä»¥å°è¯•åœ¨è®¾ç½®é‡Œé¢æ¢å¤é»˜è®¤è®¾ç½®ï¼");

    }

    collideTryInitErrorCount += 1;
    // é‡ç½®åˆå§‹åŒ–é”™è¯¯è®¡æ•°
    if (collideTryInitErrorCount > 10) collideTryInitErrorCount = 0;

    localStorage.setItem('collide-try-init-error-count', collideTryInitErrorCount);
}


// è¯»å–ã€è®¾ç½®ç”¨æˆ·é…ç½®
function setUserConfig() {
    let localUserConfigStr = localStorage.getItem('collide-try-user-settings');
    if (localUserConfigStr) {
        userConfig = JSON.parse(localUserConfigStr);
        // TODO ç‰¹æ®Šå­—æ®µä¸å—ç¼“å­˜å½±å“ï¼Œä»¥ä»£ç é…ç½®ä¸ºå‡†
        userConfig.tryFullPathPointNum = userConfigBack.tryFullPathPointNum;
        console.log(">>>> localStorage userConfig: " + JSON.stringify(userConfig));
    }
}


// è®¾ç½®å½“å‰è§’è‰²
function setCurrRole() {
    // ä» sessionStorage è¯»å–ï¼Œæ³¨æ„å…³é—­é¡µé¢ï¼Œé‡æ–°æ‰“å¼€æ‰ä¼šå¤±æ•ˆï¼Œæµè§ˆå™¨æ ‡é¢˜æ å³é”®â€œé‡æ–°æ‰“å¼€å…³é—­é¡µé¢â€è¿˜æ˜¯èƒ½è·å–åˆ°
    try {
        let roleValStr = sessionStorage.getItem('collide-try-role-chose');
        // å¦‚æœä¸æ˜¯æ•°å­—ç±»å‹
        if (!(!isNaN(parseFloat(roleValStr)) && isFinite(roleValStr))) throw new Error(">>>> è§’è‰²é€‰æ‹©å‡ºç°é”™è¯¯ï¼è¯·é‡æ–°é€‰æ‹©æˆ–è”ç³»å¼€å‘è€…");
        userConfig.currRole = Number(roleValStr);
    } catch (e) {
        //console.log(">>>> sessionStorage getItem error: " + e.message);
        userConfig.currRole = -1;
    }

    //if (!userConfig.currRole) { // æ²¡è·å–åˆ°ï¼Œåˆ™å¼¹å‡ºé€‰æ‹©è§’è‰²æ¡†ã€‚æ³¨æ„ 0 ä¸º false
    if (userConfig.currRole < 0) {
        // sessionStorage æ²¡æ‰¾åˆ°ï¼Œå†ä» localStorage ä¸­å–å€¼
        try {
            let roleValStr = localStorage.getItem('collide-try-role-chose');
            // å¦‚æœä¸æ˜¯æ•°å­—ç±»å‹
            if (!(!isNaN(parseFloat(roleValStr)) && isFinite(roleValStr))) throw new Error(">>>> è§’è‰²é€‰æ‹©å‡ºç°é”™è¯¯ï¼è¯·é‡æ–°é€‰æ‹©æˆ–è”ç³»å¼€å‘è€…");
            userConfig.currRole = Number(roleValStr);
        } catch (e) {
            //console.log(">>>> localStorage getItem error: " + e.message);
            userConfig.currRole = -1;
        }
        // è¿˜æ˜¯æ²¡æ‰¾åˆ°ï¼Œå†å¼¹å‡ºè§’è‰²é€‰æ‹©çª—
        if (userConfig.currRole < 0) {
            dialogMask.style.display = "unset"; // æ˜¾ç¤ºé€‰æ‹©è§’è‰²é®ç½©å±‚
            chooseRoleDialog.style.display = "unset"; // æ˜¾ç¤ºé€‰æ‹©è§’è‰²å¼¹çª—
            //return;
            //alert(">>>> è§’è‰²é€‰æ‹©å‡ºç°é”™è¯¯ï¼è¯·è”ç³»å¼€å‘è€…");
            //throw new Error("è§’è‰²é€‰æ‹©å‡ºç°é”™è¯¯ï¼è¯·è”ç³»å¼€å‘è€…");
        } else {
            // localStorage æ‰¾åˆ°äº†
            localStorage.removeItem("collide-try-role-chose");
            //sessionStorage.setItem('collide-try-role-chose', userConfig.currRole);
        }
    }

    // æ ‡è®°è§’è‰²é€‰æ‹©å®Œæˆ
    if (userConfig.currRole > -1) sysConfig.isRoleChooseFinished = true;

    if (userConfig.isRandomRole || userConfig.isFlashRole) {
        if (userConfig.isRandomRole) userConfig.currRole = Role.getRandomRoleId();
        if (userConfig.isFlashRole) setRolesFlash(userConfig.gameRoleIds, true);
        // å­˜åˆ° sessionStorageã€PCæµè§ˆå™¨åˆ·æ–°ä¸ä¼šå¤±æ•ˆï¼Œå…³é—­é¡µé¢ä¼šå¤±æ•ˆã€‘
        //if (userConfig.currRole > -1) sessionStorage.setItem('collide-try-role-chose', userConfig.currRole);
        // TODO å­˜åˆ° localStorageï¼Œå…¼å®¹ä¸€äº›æµè§ˆå™¨ï¼ˆViaï¼‰åˆ·æ–°å sessionStorage å¤±æ•ˆï¼Œå¯¼è‡´ä¸€ç›´å¼¹å‡ºé€‰æ‹©è§’è‰²é—®é¢˜
        //if (userConfig.currRole > -1) localStorage.setItem('collide-try-role-chose', userConfig.currRole);
        // localStorage å­˜å‚¨æ›´æ–° userConfig å¯¹è±¡
        if (userConfig.currRole > -1) localStorage.setItem('collide-try-user-settings', JSON.stringify(userConfig));
    }

    console.log(">>>> userConfig.currRole=" + userConfig.currRole);
}


// userConfig.wan8CocosTableMoveVals ç»“åˆ girdSize è®¡ç®—ï¼Œèµ‹å€¼ç»™ sysConfig.wan8CocosTableMoveVals
function setSysWan8CocosTableMoveVals() {
    if (userConfig.wan8CocosTableMoveVals.length === 1 && Number(userConfig.wan8CocosTableMoveVals[0]) === 0) {
        sysConfig.wan8CocosTableMoveVals = [0, 0, 0, 0, 0, 0, 0, 0];
    } else {
        for (let i = 0; i < userConfig.wan8CocosTableMoveVals.length; i++) {
            sysConfig.wan8CocosTableMoveVals[i] = roundNumber(userConfig.wan8CocosTableMoveVals[i] * sysConfig.girdSize, 4);
        }
    }
}


/*
é¦–æ¬¡è¿›å…¥æ¸¸æˆï¼Œæœªé€‰æ‹©ä»»ä½•ä¸»é¢˜ï¼Œæ ¹æ®æ—¶é—´å­£èŠ‚è®¾ç½®ä¸»é¢˜
å­£èŠ‚å˜åŒ–ï¼Œæ›´æ¢å¯¹åº”ä¸»é¢˜ï¼Œåªæ”¹ä¸€æ¬¡ï¼Œåœ¨è¿™ä¸ªå­£èŠ‚å†…å¯æ‰‹åŠ¨æ›´æ¢å…¶ä»–ä¸»é¢˜

æŒ‰ç…§é˜³å†åˆ’åˆ†ï¼Œæ˜¥å­£é€šå¸¸æ˜¯3ã€4ã€5æœˆï¼Œå¤å­£æ˜¯6ã€7ã€8æœˆï¼Œç§‹å­£æ˜¯9ã€10ã€11æœˆï¼Œå†¬å­£æ˜¯12ã€1ã€2æœˆã€‚
æŒ‰ç…§å†œå†åˆ’åˆ†ï¼Œæ˜¥å­£æ˜¯å†œå†çš„æ­£æœˆè‡³ä¸‰æœˆï¼Œå¤å­£æ˜¯å››æœˆè‡³å…­æœˆï¼Œç§‹å­£æ˜¯ä¸ƒæœˆè‡³ä¹æœˆï¼Œå†¬å­£æ˜¯åæœˆè‡³åäºŒæœˆã€‚
*/
function setThemeBySeason(date) {
    // ä¸Šä¸€æ¬¡è®¾ç½®ä¸»é¢˜æ—¶é—´æœˆä»½
    let collideTryThemeTimeStr = localStorage.getItem('collide-try-theme-time');
    let collideTryThemeTime = collideTryThemeTimeStr ? Number(collideTryThemeTimeStr) : 0;
    console.log(">>>> collide-try-theme-time=" + collideTryThemeTime);
    if (!date) date = new Date();
    let m = date.getMonth() + 1;
    if (isMonthInSameSeason(collideTryThemeTime, m) && userConfig.sceneThemeMode >= 0) return; // ç©å®¶æ‰‹åŠ¨è®¾ç½®äº†ä¸»é¢˜
    let currThemeMode = 0;
    if ([12, 1, 2].indexOf(m) > -1) { // å†¬å­£ï¼Œå†°é›ªä¸»é¢˜
        currThemeMode = 1;
    } else if ([3, 4, 5].indexOf(m) > -1) { // æ˜¥å­£ï¼Œç”°å›­ä¸»é¢˜
        currThemeMode = 3;
    } else if ([6, 7, 8].indexOf(m) > -1) { // å¤å­£ï¼Œå¤æ—¥ä¸»é¢˜
        currThemeMode = 5;
    } else if ([9, 10, 11].indexOf(m) > -1) { // ç§‹å­£ï¼Œæ˜Ÿé™…ä¸»é¢˜ï¼ˆã€Šæ˜Ÿé™…ç©¿è¶Šã€‹ä¸Šæ˜ æ—¶é—´ 2014-11-07 æ­£å¥½æ˜¯ç§‹å­£ï¼‰
        currThemeMode = 4;
    } else { // é»˜è®¤ä¸»é¢˜
        currThemeMode = 0;
    }
    // è®¾ç½®ä¸»é¢˜æ¨¡å¼
    userConfig.sceneThemeMode = currThemeMode;
    // ä¿å­˜è®¾ç½®ä¸»é¢˜çš„æœˆä»½
    localStorage.setItem('collide-try-theme-time', m);
}


// åˆ¤æ–­ä¸¤ä¸ªæœˆä»½æ˜¯å¦åœ¨åŒä¸€ä¸ªå­£èŠ‚ï¼ˆé˜³å†ï¼‰
function isMonthInSameSeason(m1, m2) {
    let idx1 = Math.floor(m1 / 3);
    if (idx1 < 0 || idx1 >= 4) idx1 = 0;
    let idx2 = Math.floor(m2 / 3);
    if (idx2 < 0 || idx2 >= 4) idx2 = 0;
    return idx1 === idx2;
}


// åˆå§‹åŒ–è§’è‰²ã€é¢œè‰²ã€å¤§å°ã€åŠå¾„ã€é€Ÿåº¦ç­‰å‚æ•°
function initBallByRole(ball) {
    if (!ball.roleId) ball.roleId = Role.HEIWA.id;
    console.log(">>>> initBallByRole " + ball.getBallDesc());
    switch (ball.roleId) {
        //case Role.HEIWA.id: // èµ°é»˜è®¤å¤„ç†
        case Role.JIANGJIANG.id:
            ball.color = "#362CBC";
            ball.sizeRatio = Ball.SIZERATIO.S; // å°
            ball.radius = roundNumber((sysConfig.girdSize * ball.sizeRatio / 2), 4);
            ball.mRatio = Ball.WEIGHTRATIO.M;
            if (ball.isMainBall) ball.vRatio = userConfig.isTestOnlyOne ? 1.05 : Ball.SPEEDRATIO.L; // é€Ÿåº¦æ¯”ç‡ï¼Œæ¯”é»‘å¨ƒæ…¢ä¸€çº§ï¼Œä¸ºäº†æ¨¡æ‹ŸåŠ é€Ÿæ•ˆæœï¼Œé€Ÿåº¦å¯ä»¥è®¾ç½®å¤§ä¸€ç‚¹
            //if (ball.isMainBall) ball.v = 63.00; // åˆå§‹åŒ–çš„æ—¶å€™æ ¹æ® vRatio è®¡ç®—
            break;
        case Role.DUODUO.id:
            ball.color = "#8C5E9D";
            ball.sizeRatio = Ball.SIZERATIO.L; // å¤§
            ball.radius = roundNumber((sysConfig.girdSize * ball.sizeRatio / 2), 4);
            ball.mRatio = Ball.WEIGHTRATIO.S; // è½»
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.KUILEI.id:
            ball.color = "#E72E38";
            ball.sizeRatio = Ball.SIZERATIO.L; //  å¤§
            ball.pathRadius = roundNumber(7.0 / 2 * dpr, 4); // å‚€å„¡ç»³å­è¿åŠ¨è·¯å¾„åŠå¾„
            ball.tryRadius = roundNumber(0.7 * sysConfig.girdSize / 2, 4); // å‚€å„¡ç„å‡†çº¿åŠå¾„
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.XL; // å¿«/æå¿«ï¼Œç®—ç»³å­çš„é€Ÿåº¦
            //if (ball.isMainBall) userConfig.isShowBallPath = false; // ä¸æ˜¾ç¤ºå…¨è·¯å¾„
            //if (ball.isMainBall) userConfig.isStopAfterCollided = false;
            break;
        case Role.BAKE.id:
            ball.color = "#FD5B2B";
            ball.sizeRatio = Ball.SIZERATIO.L; //  å¤§
            ball.mRatio = Ball.WEIGHTRATIO.L; // é‡ å®æˆ˜å‘ç°ï¼Œå…¶å®å·´å…‹å’Œé…·é…·ä¸€æ ·é‡
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.S; // æ…¢
            break;
        case Role.LULU.id:
            ball.color = "#C8728B"; // PaleVioletRed è„¸çº¢çš„æ·¡ç´«çº¢
            ball.sizeRatio = Ball.SIZERATIO.M; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.KUKU.id:
            ball.color = "#CB8140"; // å–çš„é»˜è®¤çš®è‚¤æ£’çƒæ£æ·±é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.L; // å¤§
            ball.mRatio = Ball.WEIGHTRATIO.L; // é‡
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.S; // æ…¢
            break;
        case Role.YINGYING.id:
            ball.color = "#2962D9"; // å–çš„é»˜è®¤çš®è‚¤è£™å­æ·±é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.L; // å¤§
            ball.mRatio = Ball.WEIGHTRATIO.S; // è½»
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.JIUWEIHU.id:
            ball.color = "#D76A75"; // å–çš„é»˜è®¤çš®è‚¤å°¾å·´æ·±é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.L; // å¤§
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.S; // æ…¢
            break;
        case Role.SHUANGZI.id:
            if (!ball.color) ball.color = "#3F375A"; // å–çš„é»˜è®¤çš®è‚¤å³è¾¹è§’è‰²çš„è¡£æœé¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.L; // å¤§
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.XL; // å¿«ï¼Œå®æˆ˜è²Œä¼¼æ˜¯æå¿«
            break;
        case Role.X.id: // è‡ªå®šä¹‰è§’è‰²
            ball.color = "#305F6F";
            ball.sizeRatio = Ball.SIZERATIO.M; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.YOUXIA.id:
            ball.color = "#5A5B81"; // å–çš„é»˜è®¤çš®è‚¤è¡£æœé¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.S; // å°
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.L; // å¿«
            break;
        case Role.CHUZI.id:
            ball.color = "#93462A"; // å–çš„é»˜è®¤çš®è‚¤ç«è…¿æ·±é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.M; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.S; // æ…¢
            break;
        case Role.HUAQIANJI.id:
            ball.color = "#4B466C"; // å–çš„é»˜è®¤çš®è‚¤é“ ç”²ä¸­é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.XL; // æå¤§
            ball.mRatio = Ball.WEIGHTRATIO.XL; // æé‡
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // 0.05; // æ— 
            break;
        case Role.WUGEGE.id:
            ball.color = "#784820"; // å–çš„é»˜è®¤çš®è‚¤æƒæ–æ·±é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.S; // å°
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.L; // å¿«
            break;
        case Role.JOKER.id:
            if (!ball.color) ball.color = "#CD1420"; // å–çš„é»˜è®¤çš®è‚¤å¸½å­é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.M; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.RABBIT.id:
            if (!ball.color) ball.color = "#EF5B87"; // å–çš„é»˜è®¤çš®è‚¤è€³æœµä¸­åº¦é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.XS; // æå°
            ball.mRatio = Ball.WEIGHTRATIO.XS; // æè½»
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.XL; // æå¿«
            break;
        case Role.NURSE.id: // å¥¶å¦ˆ
            if (!ball.color) ball.color = "#BFD67B"; // å–çš„é»˜è®¤çš®è‚¤å¤´å‘é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.S; // å°
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.L; // å¿«
            break;
        case Role.CAPTAIN.id:
            if (!ball.color) ball.color = "#4B49BD"; // å–çš„é»˜è®¤çš®è‚¤è¡£æœé¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.L; // å¤§
            ball.mRatio = Ball.WEIGHTRATIO.L; // é‡
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.L; // å¿«
            break;
        case Role.LELE.id:
            if (!ball.color) ball.color = "#CF3B23"; // å–çš„é»˜è®¤çš®è‚¤è¡£æœé¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.M; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.L; // æå¿«ï¼ŒæŒ‡ç¢°åˆ°è§’è‰²åï¼›ä¸åŠ é€Ÿæ—¶æœ€å¤šç®—å¿«
            break;
        case Role.MANWANG.id:
            if (!ball.color) ball.color = "#BE9A8E"; // å–çš„é»˜è®¤çš®è‚¤æŠ¤ç”²æ·±é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.XL; // æå¤§
            ball.mRatio = Ball.WEIGHTRATIO.XL; // æé‡
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.XS; // ææ…¢
            break;
        case Role.LINGLING.id:
            if (!ball.color) ball.color = "#DCD4E5"; // å–çš„é»˜è®¤çš®è‚¤å¤´å‘ä¸­åº¦é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.L; // å¤§
            ball.mRatio = Ball.WEIGHTRATIO.XS; // æè½»
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.HUOWANG.id:
            if (!ball.color) ball.color = "#FCA12E"; // å–çš„é»˜è®¤çš®è‚¤ç«ç„°æ·±é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.M; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.LEIMENG.id:
            if (!ball.color) ball.color = "#342F41"; // å–çš„é»˜è®¤çš®è‚¤å¤´å‘é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.M; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.L; // å¿«
            break;
        case Role.DIANYIN.id:
            if (!ball.color) ball.color = "#98516B"; // å–çš„é»˜è®¤çš®è‚¤å¤´å‘é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.M; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.XS; // æè½»
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.XIXUEGUI.id:
            if (!ball.color) ball.color = "#1C2331"; // å–çš„é»˜è®¤çš®è‚¤è¡£æœé¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.M; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.XS; // æè½»
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.GUISHUSHI.id:
            if (!ball.color) ball.color = "#C47244"; // å–çš„é»˜è®¤çš®è‚¤å¤´å‘é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.M; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.L; // å¿«
            break;
        case Role.MAGICLION.id:
            if (!ball.color) ball.color = "#F3C264"; // å–çš„é»˜è®¤çš®è‚¤è„¸éƒ¨ä¸­åº¦é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.S; // å°
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.XS; // ææ…¢
            break;
        case Role.LANGZAI.id:
            if (!ball.color) ball.color = "#1B1D21"; // å–çš„é»˜è®¤çš®è‚¤æ¯›å‘ä¸­åº¦é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.M; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.L; // å¿«
            break;
        case Role.BZGIRL.id:
            if (!ball.color) ball.color = "#5D524C"; // å–çš„é»˜è®¤çš®è‚¤å¤´å‘é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.S; // å°
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.L; // å¿«
            break;
        case Role.PUMPKIN.id:
            if (!ball.color) ball.color = "#D46E0D"; // ç­¾åˆ°é€çš„çš®è‚¤è„¸éƒ¨é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.M; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.QUANBA.id:
            if (!ball.color) ball.color = "#0282E6"; // å–çš„é»˜è®¤çš®è‚¤æŠ¤å…·é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.S; // å°
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.L; // å¿«
            break;
        case Role.HONGZHAJI.id:
            if (!ball.color) ball.color = "#C0865B"; // å–çš„é»˜è®¤çš®è‚¤TNTç®±å­é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.XL; // æå¤§
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.XS; // ææ…¢
            break;
        case Role.SANTAIZI.id:
            if (!ball.color) ball.color = "#B9C6CE"; // å–çš„é»˜è®¤çš®è‚¤è¡£æœé¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.S; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.ZHADANKE.id:
            if (!ball.color) ball.color = "#9B3620"; // å–çš„é»˜è®¤çš®è‚¤å¤´å‘é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.S; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.HONGSANSAN.id:
            if (!ball.color) ball.color = "#B73B36"; // å–çš„é»˜è®¤çš®è‚¤å¸½å­é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.S; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.WUKONG.id:
            if (!ball.color) ball.color = "#CC5F22"; // å–çš„é»˜è®¤çš®è‚¤å¤´å‘æ·±é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.S; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.L; // å¿«
            break;
        case Role.ZHANAN.id:
            if (!ball.color) ball.color = "#4A406D"; // å–çš„é»˜è®¤çš®è‚¤é£è¡Œå™¨ç¿…è†€é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.L; // å¤§
            ball.mRatio = Ball.WEIGHTRATIO.XL; // æé‡
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.S; // æ…¢
            break;
        case Role.XIUNV.id:
            if (!ball.color) ball.color = "#453E3C"; // å–çš„é»˜è®¤çš®è‚¤å¤´å·¾é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.M; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.L; // é‡
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.TONY.id:
            if (!ball.color) ball.color = "#5C4BAD"; // å–çš„é»˜è®¤çš®è‚¤å¤´å‘é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.ML; // å¤§
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.RENZHE.id:
            if (!ball.color) ball.color = "#B0683C"; // å–çš„é»˜è®¤çš®è‚¤æ¯›å‘é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.S; // å°
            ball.mRatio = Ball.WEIGHTRATIO.XS; // æè½»
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.XL; // æå¿«
            break;
        case Role.NUANYANG.id:
            if (!ball.color) ball.color = "#D0C5D5"; // å–çš„é»˜è®¤çš®è‚¤æ¯›å‘é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.L; // å¤§
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.S; // æ…¢
            break;
        case Role.QIANGWEI.id:
            if (!ball.color) ball.color = "#89735E"; // å–çš„é»˜è®¤çš®è‚¤å¤´å‘é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.M; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.XL; // æé‡
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.LANLAN.id:
            if (!ball.color) ball.color = "#B67B73"; // å–çš„é»˜è®¤çš®è‚¤å¤´å‘é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.ML; // åå¤§
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.XL; // æå¿«
            break;
        case Role.KAIER.id:
            if (!ball.color) ball.color = "#855E43"; // å–çš„é»˜è®¤çš®è‚¤å¸½å­é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.ML; // åå¤§
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.SHITOUREN.id:
            if (!ball.color) ball.color = "#75837F"; // å–çš„é»˜è®¤çš®è‚¤çŸ³å¤´é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.XL; // æå¤§
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.XS; // ææ…¢
            break;
        case Role.TIEMIAN.id:
            if (!ball.color) ball.color = "#D69C36"; // å–çš„é»˜è®¤çš®è‚¤é“çš®é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.XL; // æå¤§
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.MIAOJIANG.id:
            if (!ball.color) ball.color = "#FFA9A9"; // å–çš„é»˜è®¤çš®è‚¤è€³æœµé¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.S; // å°
            ball.mRatio = Ball.WEIGHTRATIO.S; // è½»
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.L; // å¿«
            break;
        case Role.MUSHI.id:
            if (!ball.color) ball.color = "#A7B278"; // å–çš„é»˜è®¤çš®è‚¤ä¹¦æœ¬é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.M; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.WUNV.id:
            if (!ball.color) ball.color = "#98747E"; // å–çš„é»˜è®¤çš®è‚¤é¢çº±é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.M; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.LIANGLIANG.id:
            if (!ball.color) ball.color = "#ED736F"; // å–çš„é»˜è®¤çš®è‚¤å¤´å‘é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.S; // å°
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.LAILAI.id:
            if (!ball.color) ball.color = "#AEB34F"; // å–çš„é»˜è®¤çš®è‚¤è„¸éƒ¨é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.S; // å°
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.ZHANGYUGE.id:
            if (!ball.color) ball.color = "#87A8DE"; // å–çš„é»˜è®¤çš®è‚¤è§¦æ‰‹é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.S; // å°
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.XL; // æå¿«
            break;
        case Role.HUABANTU.id:
            if (!ball.color) ball.color = "#403B4A"; // å–çš„é»˜è®¤çš®è‚¤è¡£æœé¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.M; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.L; // å¿«ï¼Œæ”¶å›æ»‘æ¿åæ˜¯æå¿«
            break;
        case Role.NIUXIAOMANG.id:
            if (!ball.color) ball.color = "#E8AC85"; // å–çš„é»˜è®¤çš®è‚¤è„¸éƒ¨é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.ML; // åå¤§
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.XL; // æå¿«
            break;
        case Role.LANPANG.id:
            if (!ball.color) ball.color = "#4B8BE4"; // å–çš„é»˜è®¤çš®è‚¤Tæ¤é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.L; // å¤§
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.XL; // æå¿«
            break;
        case Role.JIANSHI.id:
            if (!ball.color) ball.color = "#48728A"; // å–çš„é»˜è®¤çš®è‚¤å‰‘èº«é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.M; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.S; // è½»
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.L; // å¿«
            break;
        case Role.JUNDUN.id:
            if (!ball.color) ball.color = "#607192"; // å–çš„é»˜è®¤çš®è‚¤å¤´ç›”é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.L; // å¤§
            ball.mRatio = Ball.WEIGHTRATIO.L; // é‡
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.S; // æ…¢
            break;
        case Role.YOUFANG.id:
            if (!ball.color) ball.color = "#6D2665"; // å–çš„é»˜è®¤çš®è‚¤å¤´å‘é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.S; // å°
            ball.mRatio = Ball.WEIGHTRATIO.S; // è½»
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.L; // å¿«
            break;
        case Role.MOUSE.id:
            if (!ball.color) ball.color = "#95D850"; // å–çš„é»˜è®¤çš®è‚¤é¢†å·¾é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.XS; // æå°
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.YEREN.id:
            if (!ball.color) ball.color = "#FFA803"; // å–çš„é»˜è®¤çš®è‚¤ç‰›è§’é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.L; // å¤§
            ball.mRatio = Ball.WEIGHTRATIO.L; // é‡
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.BAIGUJING.id:
            if (!ball.color) ball.color = "#5A4A71"; // å–çš„é»˜è®¤çš®è‚¤å¤´å‘é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.M; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.M; // ä¸­ç­‰
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.M; // ä¸­ç­‰
            break;
        case Role.TUYA.id:
            if (!ball.color) ball.color = "#3F3B41"; // å–çš„é»˜è®¤çš®è‚¤å¤´å‘é¢œè‰²
            ball.sizeRatio = Ball.SIZERATIO.M; // ä¸­ç­‰
            ball.mRatio = Ball.WEIGHTRATIO.XS; // æè½»
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.XL; // æå¿«
            break;
        default: // é»˜è®¤æ˜¯é»‘å¨ƒ
            ball.color = "#74593A"; // é»˜è®¤çš®è‚¤é¢œè‰²(RosyBrownç«ç‘°æ£•)-CA9480ï¼›è„¸é¢Šè¾¹ç¼˜è„¸çº¢çš„é¢œè‰²(IndianRedå°åº¦çº¢)-A36E5Dï¼›é»‘(Black)-151A14ï¼›æ£•è‰²å¤´å‘(DarkOliveGreenæš—æ©„æ¦„ç»¿)-74593A
            ball.sizeRatio = Ball.SIZERATIO.XS; // æå° é»‘å¨ƒç›´å¾„ 1.8 æ ¼
            ball.mRatio = Ball.WEIGHTRATIO.XS; // æè½»
            if (ball.isMainBall) ball.vRatio = Ball.SPEEDRATIO.XL; // æå¿«
        //if (ball.isMainBall) ball.v = 60.00;
        //if (ball.isMainBall) userConfig.isShowBallPath = true; // æ˜¯å¦æ˜¾ç¤ºå…¨è·¯å¾„
        //if (ball.isMainBall) userConfig.isStopAfterCollided = true;
    }

    // å…¬å…±å±æ€§è®¾ç½®
    ball.radius = roundNumber((sysConfig.girdSize * ball.sizeRatio / 2), 4);
    if (ball.roleId != Role.KUILEI.id) ball.tryRadius = ball.radius;
    ball.radiusTmp = ball.radius;
    ball.m = ball.mRatio * sysConfig.maxWeightVal;

    console.log(">>>> initBallByRole ball: " + JSON.stringify(ball));

    // localStorage å­˜å‚¨æ›´æ–° userConfig å¯¹è±¡
    //localStorage.setItem('collide-try-user-settings', JSON.stringify(userConfig));
}


// è®¾ç½®å­—ä½“å¤§å°
function setFontSize() {
    if (os.isTablet) {
        // è§’è‰²åæ ‡æ‚¬æµ®æ¡å­—ä½“å¤§å°
        let eles = document.getElementsByClassName("collide-try-role-pos-line-font") || [];
        for (let i = 0, len = eles.length; i < len; i++) {
            eles[i].style.fontSize = Math.round(htmlFontSizeNum * sysConfig.pxRatio) + "px";
        }
    }
}


// æ ¹æ®å®¢æˆ·ç«¯ç±»å‹ï¼Œè‡ªåŠ¨è®¾ç½®é¡µé¢å¤§å°ï¼Œä¿æŒ 14:22 çš„æ¯”ä¾‹
function setPageSize() {
    // æ ¹æ®å®¢æˆ·ç«¯ç±»å‹é€‚é…
    //console.log(">>>> os isPc: " + os.isPc);
    if (os.isPc) {
        canvas.height = document.body.clientHeight * sysConfig.sceneWidthRatio; // ç½‘é¡µå¯è§åŒºåŸŸé«˜ï¼Œé«˜å¤šäº†å¤šä¸€ç‚¹ï¼Œå¯¼è‡´æœ‰å‚ç›´æ»šåŠ¨æ¡ã€‚ç¦ç”¨æ»šåŠ¨å³å¯
        // TODO ç”»å¸ƒæ˜¾ç¤ºå¤§å°ï¼Œé€šè¿‡cssæ ·å¼ç¼©å°ç”»å¸ƒï¼Œè§£å†³å›¾å½¢æ¨¡ç³Šå’Œé”¯é½¿é—®é¢˜
        //sysConfig.girdSizeCss = Math.round(canvas.height / 22);
        //sysConfig.cssWidth = Math.round(sysConfig.girdSizeCss * 14);
        //sysConfig.cssHeight = Math.round(sysConfig.girdSizeCss * 22);
        sysConfig.girdSizeCss = roundNumber(canvas.height / 22, 4);
        sysConfig.cssWidth = roundNumber(sysConfig.girdSizeCss * 14, 4);
        sysConfig.cssHeight = roundNumber(sysConfig.girdSizeCss * 22, 4);
        // ç”»å¸ƒå¤§å°é€‚é… dpr
        //sysConfig.girdSize = Math.round(canvas.height / 22 * dpr);
        //sysConfig.girdSize = Math.round(sysConfig.girdSizeCss * dpr);
        sysConfig.girdSize = roundNumber(sysConfig.girdSizeCss * dpr, 4);
    } else { // å…¶ä»–ï¼Œæ‰‹æœºã€å¹³æ¿
        // TODO æ‰‹æœºæµè§ˆå™¨éå…¨å±æ¨¡å¼ï¼Œé«˜åº¦çœ‹ç€æ²¡å±…ä¸­ï¼Œä½†è¿›å…¥å…¨å±æ¨¡å¼åï¼Œæ°´å¹³ã€å‚ç›´éƒ½æ˜¯å±…ä¸­çš„
        // 400-712-2.7
        //alert(">>>> å±å¹•åˆ†è¾¨ç‡-width: " + window.screen.width + ", å±å¹•åˆ†è¾¨ç‡-height: " + window.screen.height);
        //alert(">>>> ç½‘é¡µå¯è§åŒºåŸŸ-width: " + document.body.clientWidth + ", ç½‘é¡µå¯è§åŒºåŸŸ-height: " + document.body.clientHeight);
        //alert(">>>> å±å¹•å¯ç”¨å·¥ä½œåŒºåŸŸ-width: " + window.screen.availWidth + ", å±å¹•å¯ç”¨å·¥ä½œåŒºåŸŸ-height: " + window.screen.availHeight);
        canvas.width = window.screen.width * sysConfig.sceneWidthRatio;
        //canvas.width = document.body.clientWidth * 0.8; // ç½‘é¡µå¯è§åŒºåŸŸå®½
        //canvas.width = window.screen.availWidth * 0.8; // å±å¹•å¯ç”¨å·¥ä½œåŒºåŸŸå®½åº¦
        sysConfig.girdSizeCss = roundNumber(canvas.width / 14, 4);
        sysConfig.cssWidth = roundNumber(sysConfig.girdSizeCss * 14, 4);
        sysConfig.cssHeight = roundNumber(sysConfig.girdSizeCss * 22, 4);
        sysConfig.girdSize = roundNumber(sysConfig.girdSizeCss * dpr, 4);

        /*
        // TODO ä¸åŒæ‰‹æœºæµè§ˆå™¨å·¥å…·æ é«˜åº¦ä¸åŒï¼Œå¾ˆå¯èƒ½å¯¼è‡´å¯è§é«˜åº¦æ˜¾ç¤ºä¸ä¸‹ç”»å¸ƒï¼é€‚é…çš„é«˜åº¦ä¸èƒ½è¶…è¿‡ç½‘é¡µå¯è§é«˜åº¦ï¼Œ
        // è¶…è¿‡åˆ™æŒ‰ç½‘é¡µå¯è§é«˜åº¦é‡æ–°é€‚é…ã€æ­£å¸¸æƒ…å†µé«˜åº¦ä¸ä¼šæ˜¾ç¤ºä¸ä¸‹ã€‘
        let ph = document.body.clientHeight;
        if (canvas.height > ph) {
            console.log(">>>> canvas é«˜åº¦è¶…å‡ºç½‘é¡µå¯è§é«˜åº¦ï¼ŒæŒ‰ç½‘é¡µå¯è§é«˜åº¦é‡æ–°é€‚é…...");
            canvas.height = ph * 0.8;
            sysConfig.girdSizeCss = roundNumber(canvas.height / 22, 4);
            sysConfig.cssWidth = roundNumber(sysConfig.girdSizeCss * 14, 4);
            sysConfig.cssHeight = roundNumber(sysConfig.girdSizeCss * 22, 4);
            sysConfig.girdSize = roundNumber(sysConfig.girdSizeCss * dpr, 4);
        }
        */

        //alert(">>>> canvas width: " + canvas.width + ", canvas height: " + canvas.height);
    }


    canvas.width = roundNumber(sysConfig.girdSize * 14, 4);
    canvas.height = roundNumber(sysConfig.girdSize * 22, 4);
    canvas.style.width = sysConfig.cssWidth + 'px';
    canvas.style.height = sysConfig.cssHeight + 'px';
    // ç›´æ¥ç”¨ scale æ”¾å¤§æ•´ä¸ªåæ ‡ç³»ï¼Œç›¸å¯¹æ¥è¯´å°±æ˜¯æ”¾å¤§äº†æ¯ä¸ªç»˜åˆ¶æ“ä½œ
    //context.scale(dpr, dpr);
    console.log(">>>> canvas width: " + canvas.width + ", canvas height: " + canvas.height);
    console.log(">>>> canvas cssWidth: " + sysConfig.cssWidth + ", canvas cssHeight: " + sysConfig.cssHeight);


    // é™æ€åœºæ™¯å¤§é¢ç§¯åŒºåŸŸæ™¯ç‰©å›¾å½¢å±‚ç”»å¸ƒè®¾ç½®å…¨å±å®½é«˜
    gameSceneGraphCanvas.width = document.body.clientWidth * dpr;
    gameSceneGraphCanvas.height = document.body.clientHeight * dpr;
    gameSceneGraphCanvas.style.width = document.body.clientWidth + 'px';
    gameSceneGraphCanvas.style.height = document.body.clientHeight + 'px';

    // é™æ€åœºæ™¯æ™¯ç‰©å›¾å½¢å±‚ç”»å¸ƒè®¾ç½®å…¨å±å®½é«˜
    gameSceneEmojiCanvas.width = document.body.clientWidth * dpr;
    gameSceneEmojiCanvas.height = document.body.clientHeight * dpr;
    gameSceneEmojiCanvas.style.width = document.body.clientWidth + 'px';
    gameSceneEmojiCanvas.style.height = document.body.clientHeight + 'px';

    // é™æ€åœºæ™¯å±‚ç”»å¸ƒå¤åˆ¶ã€ä¸»è¿åŠ¨å±‚ç”»å¸ƒã€‘å®½é«˜
    gameSceneCanvas.width = canvas.width;
    gameSceneCanvas.height = canvas.height;
    gameSceneCanvas.style.width = sysConfig.cssWidth + 'px';
    gameSceneCanvas.style.height = sysConfig.cssHeight + 'px';

    // é™æ€åœºæ™¯è¾¹ç•Œçº¿ç”»å¸ƒè®¾ç½®å…¨å±å®½é«˜
    gameSceneLinesCanvas.width = document.body.clientWidth * dpr;
    gameSceneLinesCanvas.height = document.body.clientHeight * dpr;
    gameSceneLinesCanvas.style.width = document.body.clientWidth + 'px';
    gameSceneLinesCanvas.style.height = document.body.clientHeight + 'px';

    // é™æ€åœºæ™¯ç –æ ¼è¾¹æ¡†å±‚è®¾ç½®å…¨å±å®½é«˜
    gameSceneCoordinateCanvas.width = document.body.clientWidth * dpr;
    gameSceneCoordinateCanvas.height = document.body.clientHeight * dpr;
    gameSceneCoordinateCanvas.style.width = document.body.clientWidth + 'px';
    gameSceneCoordinateCanvas.style.height = document.body.clientHeight + 'px';

    // ä¸»çƒè¿åŠ¨å±‚ç”»å¸ƒå¤åˆ¶ã€ä¸»è¿åŠ¨å±‚ç”»å¸ƒã€‘å®½é«˜
    gameMainBallCanvas.width = canvas.width;
    gameMainBallCanvas.height = canvas.height;
    gameMainBallCanvas.style.width = sysConfig.cssWidth + 'px';
    gameMainBallCanvas.style.height = sysConfig.cssHeight + 'px';

    // è·¯å¾„å±‚ç”»å¸ƒå¤åˆ¶ã€ä¸»è¿åŠ¨å±‚ç”»å¸ƒã€‘å®½é«˜
    gamePathCanvas.width = canvas.width;
    gamePathCanvas.height = canvas.height;
    gamePathCanvas.style.width = sysConfig.cssWidth + 'px';
    gamePathCanvas.style.height = sysConfig.cssHeight + 'px';

    // å…¨è·¯å¾„å±‚ç”»å¸ƒå¤åˆ¶ã€ä¸»è¿åŠ¨å±‚ç”»å¸ƒã€‘å®½é«˜
    gamePathBallCanvas.width = canvas.width;
    gamePathBallCanvas.height = canvas.height;
    gamePathBallCanvas.style.width = sysConfig.cssWidth + 'px';
    gamePathBallCanvas.style.height = sysConfig.cssHeight + 'px';

    // é®ç½©å±‚ç”»å¸ƒå¤åˆ¶ã€ä¸»è¿åŠ¨å±‚ç”»å¸ƒã€‘å®½é«˜
    gameMaskCanvas.width = canvas.width;
    gameMaskCanvas.height = canvas.height;
    gameMaskCanvas.style.width = sysConfig.cssWidth + 'px';
    gameMaskCanvas.style.height = sysConfig.cssHeight + 'px';


    // é€‰æ‹©è§’è‰²å¼¹çª—å¤åˆ¶å®½åº¦
    chooseRoleDialog.width = canvas.width;
    chooseRoleDialog.style.width = sysConfig.cssWidth + 'px';
    // ç”¨æˆ·è®¾ç½®å¼¹çª—å¤åˆ¶å®½åº¦
    userSettingDialog.width = canvas.width;
    userSettingDialog.style.width = sysConfig.cssWidth + 'px';
    // ä¸»è§’è®¾ç½®æç¤ºå¼¹çª—å¤åˆ¶å®½åº¦
    //gameSettingMainRoleDialog.width = canvas.width;
    //gameSettingMainRoleDialog.style.width = sysConfig.cssWidth + 'px';
    // ç”¨æˆ·è®¾ç½®-å…³äºåº”ç”¨å¼¹çª—å¤åˆ¶å®½åº¦
    aboutAppDialog.width = canvas.width;
    aboutAppDialog.style.width = sysConfig.cssWidth + 'px';
    // æ›´æ–°å†…å®¹æç¤ºå¼¹çª—å¤åˆ¶å®½åº¦
    updateContentDialog.width = canvas.width;
    updateContentDialog.style.width = sysConfig.cssWidth + 'px';
    // æ“ä½œæŒ‡å—æç¤ºå¼¹çª—å¤åˆ¶å®½åº¦
    howToPlayDialog.width = canvas.width;
    howToPlayDialog.style.width = sysConfig.cssWidth + 'px';


    // ç”»å¸ƒæœ€å¼€å§‹æ˜¯éšè—çš„ï¼Œè°ƒæ•´å¤§å°åï¼Œè®¾ç½®ä¸ºé»˜è®¤æ˜¾ç¤º
    gameSceneCanvas.style.display = "unset"; // é™æ€åœºæ™¯å±‚ç”»å¸ƒæ¢å¤æ˜¾ç¤º
    canvas.style.display = "unset"; // ä¸»è¿åŠ¨å±‚æ¢å¤æ˜¾ç¤º
    gameMainBallCanvas.style.display = "unset"; // ä¸»çƒè¿åŠ¨å±‚ç”»å¸ƒæ¢å¤æ˜¾ç¤º
    //gamePathCanvas.style.display = "unset"; // è·¯å¾„å±‚ç”»å¸ƒæ¢å¤æ˜¾ç¤º
    //gamePathBallCanvas.style.display = "unset"; // å…¨è·¯å¾„å±‚ç”»å¸ƒæ¢å¤æ˜¾ç¤º
    gameMaskCanvas.style.display = "unset"; // é®ç½©å±‚æ™¯ç”»å¸ƒæ¢å¤æ˜¾ç¤º
    document.body.style.overflow = 'hidden'; //ç¦æ­¢é¡µé¢æ»šåŠ¨ï¼Œå…è®¸æ˜¯ visible
}


// è®¾ç½®å¼¹çª—å¯æ»šåŠ¨åŒºåŸŸé«˜åº¦ã€ä¾èµ– canvas å®½é«˜ã€‘
// height = Math.round(width * 1.63)
function setDialogScrollMaxHeight(hRadio) {
    let targetHeight = Math.round(canvas.width * hRadio);
    let targetCssHeight = Math.round(sysConfig.cssWidth * hRadio);
    // é€‰æ‹©è§’è‰²åˆ—è¡¨
    let targetElm = document.getElementById('role-list-area');
    if (targetElm) {
        targetElm.style.maxHeight = targetCssHeight + 'px';
    }
    // å‚æ•°è®¾ç½®åˆ—è¡¨
    targetElm = document.getElementById('user-setting-area');
    if (targetElm) {
        targetElm.style.maxHeight = targetCssHeight + 'px';
    }
    // å…³äºåº”ç”¨å†…å®¹åˆ—è¡¨
    targetElm = document.getElementById('user-setting-about-app-content');
    if (targetElm) {
        targetElm.style.maxHeight = targetCssHeight + 'px';
    }
}


// canvas ç”»å¸ƒå±…ä¸­æ˜¾ç¤ºï¼Œéœ€è¦ç§»åŠ¨ canvas ç”»å¸ƒåæ ‡
function canvasAutoCenter() {
    if (os.isPc) { // PC ç«¯
        // canvas ç”»å¸ƒæ°´å¹³ã€å‚ç›´ç§»åŠ¨åˆ°ä¸­é—´
        let w = document.body.clientWidth;
        let h = document.body.clientHeight;
        console.log(">>>> clientWidth:" + w + ", clientHeight:" + h);
        sysConfig.cLeft = roundNumber((w - sysConfig.cssWidth) / 2, 4);
        sysConfig.cTop = roundNumber((h - sysConfig.cssHeight) / 2, 4);
        if (sysConfig.cLeft < 0) sysConfig.cLeft = 0;
        if (sysConfig.cTop < 0) sysConfig.cTop = 0;
        canvas.style.left = sysConfig.cLeft + "px";
        canvas.style.top = sysConfig.cTop + "px";
        console.log(">>>> sysConfig.cLeft:" + sysConfig.cLeft + ", sysConfig.cTop:" + sysConfig.cTop);
        //canvas.style.transform = "translate(" + (w - canvas.width) / 2 + "px, " + (h - canvas.height) / 2 + "px)";
        // ç§»åŠ¨ canvas åæ ‡ç³»ï¼Œæš‚æ—¶ä¸å¤ªä¼šæ“ä½œ
        //context.translate(Math.round((w - canvas.width) / 2), Math.round((h - canvas.height) / 2));
    } else { // ç§»åŠ¨ç«¯
        // canvas ç”»å¸ƒæ°´å¹³ã€å‚ç›´ç§»åŠ¨åˆ°ä¸­é—´
        // å±å¹•åˆ†è¾¨ç‡å®½é«˜
        //let w = window.screen.width;
        //let h = window.screen.height;
        // ç½‘é¡µå¯è§åŒºåŸŸå®½é«˜
        let w = document.body.clientWidth;
        let h = document.body.clientHeight;
        console.log(">>>> clientWidth:" + w + ", clientHeight:" + h);
        sysConfig.cLeft = roundNumber((w - sysConfig.cssWidth) / 2, 4);
        sysConfig.cTop = roundNumber((h - sysConfig.cssHeight) / 2, 4);
        if (sysConfig.cLeft < 0) sysConfig.cLeft = 0;
        if (sysConfig.cTop < 0) sysConfig.cTop = 0;
        canvas.style.left = sysConfig.cLeft + "px";
        canvas.style.top = sysConfig.cTop + "px";
        console.log(">>>> sysConfig.cLeft:" + sysConfig.cLeft + ", sysConfig.cTop:" + sysConfig.cTop);
    }

    // é™æ€åœºæ™¯å±‚ç”»å¸ƒå±…ä¸­
    gameSceneCanvas.style.left = sysConfig.cLeft + "px";
    gameSceneCanvas.style.top = sysConfig.cTop + "px";
    // ä¸»çƒè¿åŠ¨å±‚ç”»å¸ƒå±…ä¸­
    gameMainBallCanvas.style.left = sysConfig.cLeft + "px";
    gameMainBallCanvas.style.top = sysConfig.cTop + "px";
    // è·¯å¾„å±‚ç”»å¸ƒå±…ä¸­
    gamePathCanvas.style.left = sysConfig.cLeft + "px";
    gamePathCanvas.style.top = sysConfig.cTop + "px";
    // å…¨è·¯å¾„å±‚ç”»å¸ƒå±…ä¸­
    gamePathBallCanvas.style.left = sysConfig.cLeft + "px";
    gamePathBallCanvas.style.top = sysConfig.cTop + "px";
    // é®ç½©å±‚ç”»å¸ƒå±…ä¸­
    gameMaskCanvas.style.left = sysConfig.cLeft + "px";
    gameMaskCanvas.style.top = sysConfig.cTop + "px";
}


// è®¾ç½®å››æ ¹åˆ‡è§’çº¿
function set4AngleLine() {
    // TODO ä¸Šé¢ä¸¤ä¸ªåˆ‡è§’ï¼Œèµ·ç‚¹é€‰xåæ ‡å°çš„ï¼Œç¡®ä¿æ—‹è½¬åå°çƒç¢°æ’å‰çš„ç›¸å¯¹åæ ‡yä¸ºæ­£
    lines.push(new Line(context, { // å·¦ä¸Š
        x1: 0,
        y1: Math.round(sysConfig.girdSize * 3 + sysConfig.wan8CocosTableMoveVals[0]),
        x2: Math.round(sysConfig.girdSize * 3 + sysConfig.wan8CocosTableMoveVals[1]),
        y2: 0
    }));
    lines.push(new Line(context, { // å³ä¸Š
        x1: Math.round(sysConfig.girdSize * 11 + sysConfig.wan8CocosTableMoveVals[2]),
        y1: 0,
        x2: canvas.width,
        y2: Math.round(sysConfig.girdSize * 3 + sysConfig.wan8CocosTableMoveVals[3])
    }));
    // ä¸‹é¢ä¸¤ä¸ªåˆ‡è§’ï¼Œèµ·ç‚¹é€‰xåæ ‡å¤§çš„
    lines.push(new Line(context, { // å³ä¸‹
        x2: Math.round(sysConfig.girdSize * 11 + sysConfig.wan8CocosTableMoveVals[5]),
        y2: canvas.height,
        x1: canvas.width,
        y1: Math.round(sysConfig.girdSize * 19 + sysConfig.wan8CocosTableMoveVals[4])
    }));
    lines.push(new Line(context, { // å·¦ä¸‹
        x2: 0,
        y2: Math.round(sysConfig.girdSize * 19 + sysConfig.wan8CocosTableMoveVals[7]),
        x1: Math.round(sysConfig.girdSize * 3 + sysConfig.wan8CocosTableMoveVals[6]),
        y1: canvas.height
    }));
}


// è®¾ç½®å››æ¡åˆ‡è§’çº¿ä¸­ç‚¹åæ ‡
function set4AngleLineMiddlePoint(lines) {
    lines.some(line => {
        let p = getLineMiddlePoint({ x: line.x1, y: line.y1 }, { x: line.x2, y: line.y2 });
        //console.log(">>>> p=" + JSON.stringify(p));
        linesMiddlePoints.push(p);
    });
}


// æ±‚çº¿æ®µä¸­ç‚¹åæ ‡
function getLineMiddlePoint(p1, p2) {
    let p = { x: 0, y: 0 };
    //p.x = Math.round(Math.min(p1.x, p2.x) + (Math.abs(p1.x - p2.x) / 2)); // ä¼šå¯¼è‡´ä¸€ç‚¹ç‚¹è¯¯å·®
    p.x = Math.min(p1.x, p2.x) + (Math.abs(p1.x - p2.x) / 2);
    //p.y = Math.round(Math.min(p1.y, p2.y) + (Math.abs(p1.y - p2.y) / 2));
    p.y = Math.min(p1.y, p2.y) + (Math.abs(p1.y - p2.y) / 2);
    return p;
}


// æ±‚ä¸¤ç‚¹ä¹‹é—´çš„è·ç¦»
function getDistanceOf2Points(p1, p2) {
    let a = roundNumber(Math.abs(p2.x - p1.x), 4);
    let b = roundNumber(Math.abs(p2.y - p1.y), 4);
    let c = roundNumber(Math.sqrt(a * a + b * b), 4);
    return c;
}


// è·å–ç¦»å°çƒæœ€è¿‘çš„ä¸€æ¡åˆ‡è§’çº¿ä¸‹æ ‡
function getOneAngleLineIndex(ball) {
    let idx = 0;
    let distance = canvas.height;
    for (let i = 0; i < linesMiddlePoints.length; i++) {
        let d = getDistanceOf2Points({ x: ball.x, y: ball.y }, { x: linesMiddlePoints[i].x, y: linesMiddlePoints[i].y });
        //console.log(">>>> distance=" + d);
        if (d < distance) {
            distance = d;
            idx = i;
        }
    }
    //console.log(">>>> line index=" + idx);
    return idx;
}


// æ¸…é™¤è®¾ç½®åˆ†äº«æ•°æ®
function clearShareRoleAndPos() {
    // åŠ è½½ä¹‹åï¼Œæ¸…é™¤å¯¼å…¥æ•°æ®
    userConfig.shareRoleAndPos = "";
    localStorage.setItem('collide-try-user-settings', JSON.stringify(userConfig));
    console.log(">>>> clearShareRoleAndPos userConfig in localStorage updated.");
}


// åŠ è½½è®¾ç½®åˆ†äº«æ•°æ®
function setShareRoleAndPos(shareData) {
    balls = [];
    let sBall;
    for (let i = 0, len = shareData.length; i < len; i++) {
        sBall = shareData[i];
        // ç –æ ¼è½¬åƒç´ 
        //let pos = {x:sBall.x, y:sBall.y};
        switchPxOrGird(sBall, 1);
        let ctx = context;
        if (sBall.m) ctx = gameMainBallContext;
        let shareBall = new Ball(ctx, {
            no: sBall.no,
            color: sBall.rc,
            teamColor: sBall.tc,
            roleId: sBall.rid,
            isMainBall: sBall.m ? true : false,
            x: sBall.x,
            y: sBall.y,
        });
        // åˆå§‹åŒ–å…¶ä»–å‚æ•°
        initBallByRole(shareBall);

        shareBall.x0 = shareBall.x;
        shareBall.y0 = shareBall.y;
        balls.push(shareBall);
    }

    // æ˜¯å¦ä½ä¸€ä¸ªè§’è‰²æµ‹è¯•
    if (balls.length < 4) userConfig.isTestOnlyOne = true;
    else userConfig.isTestOnlyOne = false;

    // å•ç‹¬è®¾ç½®å°ä¸‘åˆ†èº«é¢œè‰²
    setJoker2Color();
}


// è®¾ç½®ä¸»çƒã€æ”¹ä½ç½®ã€‘
function setBallMain() {
    let mainBall = new Ball(gameMainBallContext, {
        no: 1,
        teamColor: 'r',
        roleId: userConfig.currRole, // ä¸»çƒå¯¹åº”è§’è‰²
        isMainBall: true, // ä¸»çƒ
        x: sysConfig.girdSize * 7, // æ°´å¹³å±…ä¸­
        //x: sysConfig.girdSize * 1,
        //x: sysConfig.girdSize * 4,
        //x: sysConfig.girdSize * 5,
        y: sysConfig.girdSize * 11, // å‚ç›´å±…ä¸­
        //y: sysConfig.girdSize * 9,
        //y: sysConfig.girdSize * 4,
        vx: 0,
        vy: 0
    });
    // åˆå§‹åŒ–å…¶ä»–å‚æ•°
    initBallByRole(mainBall);
    // è®¾ç½®éšæœºä½ç½®åæ ‡
    putBallRandom(mainBall);

    mainBall.x0 = mainBall.x;
    mainBall.y0 = mainBall.y;
    balls.push(mainBall);
}


// éšæœºæ”¾ç½®è§’è‰²å°çƒ
function putBallRandom(ball) {
    // è®¾ç½®éšæœºä½ç½®åæ ‡
    let randomPoint = getRandomPoint(ball.radius);
    ball.x = randomPoint.x;
    ball.y = randomPoint.y;

    // ä½ç½®é‡å æ£€æµ‹
    while (checkBallsCollided(ball)) {
        console.log(">>>> putBallRandom checkBallsCollided " + ball.getBallDesc() + " collided.");
        randomPoint = getRandomPoint(ball.radius);
        ball.x = randomPoint.x;
        ball.y = randomPoint.y;
    }
}


// éšæœºæ”¾ç½®æ‰€æœ‰è§’è‰²å°çƒ
function putAllBallsRandom() {
    if (!balls || balls.length < 1) return;
    balls.some(ball => {
        // åŒå­åˆ†èº«é™¤å¤–
        if (!ball.isMainBall && ball.roleId === Role.SHUANGZI.id) return;
        putBallRandom(ball);
    });
}


// æ ¹æ®æ‰€é€‰ä¸»è§’ï¼Œåˆå§‹åŒ–ä¸»è§’ä¹‹å¤–çš„ä¸‰ä¸ªè§’è‰²
function setBallOthersByRole(roleId) {
    if (!roleId) roleId = Role.HEIWA.id;
    let otherRoles = [];

    if (userConfig.isFlashRole) { // æé€Ÿå¼€å§‹ï¼Œå¸¸ç”¨ç»„åˆ
        let flashGroup = setRolesFlash(userConfig.gameRoleIds, false);
        otherRoles = flashGroup.slice(1);
    } else if (userConfig.isRandomRole) { // å…¨éšæœºè§’è‰²
        setRolesRandom(otherRoles);
    } else { // ä¸»è§’+å¸¸ç”¨ç»„åˆ
        switch (roleId) {
            //case Role.HEIWA.id: // èµ°é»˜è®¤
            case Role.JIANGJIANG.id:
                //otherRoles = [Role.JIUWEIHU.id, Role.JIUWEIHU.id, Role.HEIWA.id];
                //otherRoles = [Role.LULU.id, Role.JIANGJIANG.id, Role.LULU.id];
                //otherRoles = [Role.LULU.id, Role.KUILEI.id, Role.YINGYING.id];
                //otherRoles = [Role.LULU.id, Role.DUODUO.id, Role.CHUZI.id];
                //otherRoles = [Role.LULU.id, Role.SHUANGZI.id, Role.YOUXIA.id];
                //otherRoles = [Role.KUKU.id, Role.DUODUO.id, Role.HUAQIANJI.id];
                //otherRoles = [Role.LULU.id, Role.KUILEI.id, Role.JOKER.id];
                //otherRoles = [Role.KUKU.id, Role.JOKER.id, Role.WUGEGE.id];
                //otherRoles = [Role.LULU.id, Role.BAKE.id, Role.DUODUO.id];
                //otherRoles = [Role.KUKU.id, Role.BAKE.id, Role.DUODUO.id];
                //otherRoles = [Role.KUKU.id, Role.JOKER.id, Role.RABBIT.id];
                otherRoles = [];
                let mainCp = Role.JIANGJIANG.cps[fullCloseInt(0, Role.JIANGJIANG.cps.length - 1)]; // ä¸»è§’æ­é…
                //console.log(">>>> mainCp=", mainCp);
                otherRoles.push(mainCp);
                let otherCps = RegularlyCollocation.getRandomGroup(); // å¯¹æ‰‹æ­é…
                //console.log(">>>> otherCps=" + otherCps.toString());
                otherRoles = otherRoles.concat(otherCps);
                if (sysConfig.isSayGoodbye && !isProd()) otherRoles = [Role.KUKU.id, Role.BAKE.id, Role.RABBIT.id];
                //console.log(">>>> otherRoles=" + otherRoles.toString());
                break;
            case Role.DUODUO.id:
                //otherRoles = [Role.BAKE.id, Role.KUILEI.id, Role.YINGYING.id];
                //otherRoles = [Role.BAKE.id, Role.DUODUO.id, Role.BAKE.id];
                otherRoles = [Role.DUODUO.cps[fullCloseInt(0, Role.DUODUO.cps.length - 1)]].concat(RegularlyCollocation.getRandomGroup());
                if (sysConfig.isSayGoodbye && !isProd()) otherRoles = [Role.BAKE.id, Role.JOKER.id, Role.DIANYIN.id];
                break;
            case Role.KUILEI.id:
                //otherRoles = [Role.YINGYING.id, Role.BAKE.id, Role.DUODUO.id];
                //otherRoles = [Role.JOKER.id, Role.BAKE.id, Role.DUODUO.id];
                otherRoles = [Role.KUILEI.cps[fullCloseInt(0, Role.KUILEI.cps.length - 1)]].concat(RegularlyCollocation.getRandomGroup());
                if (sysConfig.isSayGoodbye && !isProd()) otherRoles = [Role.JOKER.id, Role.JIANGJIANG.id, Role.MANWANG.id];
                break;
            case Role.SHUANGZI.id:
                //otherRoles = [Role.JOKER.id, Role.JOKER.id, Role.RABBIT.id];
                //otherRoles = [Role.JOKER.id, Role.SHUANGZI.id, Role.RABBIT.id];
                //otherRoles = [Role.JOKER.id, Role.LEIMENG.id, Role.JIUWEIHU.id];
                otherRoles = [Role.SHUANGZI.cps[fullCloseInt(0, Role.SHUANGZI.cps.length - 1)]].concat(RegularlyCollocation.getRandomGroup());
                if (sysConfig.isSayGoodbye && !isProd()) otherRoles = [Role.DIANYIN.id, Role.BAKE.id, Role.RABBIT.id];
                break;
            case Role.KUKU.id:
                //otherRoles = [Role.HEIWA.id, Role.BAKE.id, Role.DUODUO.id];
                otherRoles = [Role.HEIWA.id].concat(RegularlyCollocation.getRandomGroup());
                if (sysConfig.isSayGoodbye && !isProd()) otherRoles = [Role.HEIWA.id, Role.BAKE.id, Role.DUODUO.id];
                break;
            case Role.LELE.id:
                otherRoles = [Role.LELE.cps[fullCloseInt(0, Role.LELE.cps.length - 1)]].concat(RegularlyCollocation.getRandomGroup());
                if (sysConfig.isSayGoodbye && !isProd()) otherRoles = [Role.HEIWA.id, Role.CAPTAIN.id, Role.YINGYING.id];
                break;
            default:
                //otherRoles = [Role.WUGEGE.id, Role.LULU.id, Role.WUGEGE.id];
                //otherRoles = [Role.KUKU.id, Role.LULU.id, Role.JIANGJIANG.id];
                //otherRoles = [Role.JIUWEIHU.id, Role.JIUWEIHU.id, Role.JIANGJIANG.id];
                //otherRoles = [Role.KUKU.id, Role.BAKE.id, Role.DUODUO.id];
                //otherRoles = [Role.RABBIT.id, Role.RABBIT.id, Role.BAKE.id];
                otherRoles = [Role.HEIWA.cps[fullCloseInt(0, Role.HEIWA.cps.length - 1)]].concat(RegularlyCollocation.getRandomGroup());
                if (sysConfig.isSayGoodbye && !isProd()) otherRoles = [Role.LULU.id, Role.SANTAIZI.id, Role.LEIMENG.id];
        }
    }

    // ééšæœºæ¨¡å¼ï¼Œæœ‰æŒ‡å®šè§’è‰²ï¼Œåˆ™æ›¿æ¢è§’è‰²id
    if (!userConfig.isRandomRole && isUseGameRoleIds()) {
        for (let i = 0, len = userConfig.gameRoleIds.length; i < len; i++) {
            if (i === 0) continue; // ç¬¬ä¸€ä¸ªä¸ºä¸»è§’ï¼Œè¿™é‡Œæ˜¯è®¾ç½®ä¸»è§’ä¹‹å¤–çš„è§’è‰²ï¼Œæ‰€ä»¥æ’é™¤ä¸»è§’
            //if (userConfig.gameRoleIds[i] < 0) continue;
            otherRoles[i - 1] = userConfig.gameRoleIds[i];
        }
    }

    // æ£€æµ‹è§’è‰²id
    doCkeckOtherRoles(otherRoles);
    console.log(">>>> setBallOthersByRole otherRoles=" + otherRoles);

    // å…¬å…±è®¾ç½®
    setRoleOthers(otherRoles);
}


// ä¸»è§’å·²ç»è®¾ç½®äº†ï¼Œè¿™é‡Œåªç”¨è®¾ç½®å…¶ä»–ä¸‰ä¸ªè¾…åŠ©è§’è‰²åŠåˆ†èº«
function setRolesRandom(otherRoles) {
    let rid;
    for (let i = 2; i <= 4; i++) { // è®¾ç½® 2ã€3ã€4 å·è§’è‰²
        // åŒé˜Ÿè§’è‰²ä¸èƒ½ä¸€æ ·ã€‚å³ç¼–å·1ã€2è§’è‰²ä¸èƒ½ä¸€æ ·ï¼›3ã€4ä¹Ÿä¸èƒ½ä¸€æ ·
        rid = Role.getRandomRoleId();
        while (i === 2 && rid === userConfig.currRole) { // ä¸èƒ½å’Œä¸»è§’ä¸€æ ·
            rid = Role.getRandomRoleId();
        }
        while (i === 4 && rid === otherRoles[1]) { // ä¸èƒ½å’Œé˜Ÿå‹ä¸€æ ·
            rid = Role.getRandomRoleId();
        }
        otherRoles.push(rid);
    }
}


// è®¾ç½®æé€Ÿå¼€å§‹ï¼Œè¡¥å…¨å¸¸ç”¨ç»„åˆ
function setRolesFlash(roleIds, isSetCurrRole) {
    if (!roleIds) roleIds = userConfig.gameRoleIds;
    let flashRoles = [];
    // æœ‰æŒ‡å®šè§’è‰²ï¼Œè¡¥å…¨å¸¸ç”¨ç»„åˆ
    if (isUseGameRoleIds()) {
        // çº¢é˜Ÿè§’è‰²è¡¥å…¨
        if (isUseGameRoleIdsFull(1)) { // è®¾ç½®äº†ä¿©
            flashRoles.push(roleIds[0]);
            flashRoles.push(roleIds[1]);
        } else if (roleIds[0] < 0 && roleIds[1] < 0) { // ä¿©éƒ½æ²¡è®¾ç½®
            if (isSetCurrRole) { // é‡æ–°é€‰æ‹©ä¸»è§’
                flashRoles = flashRoles.concat(RegularlyCollocation.getRandomGroup()); // concat() æ–¹æ³•ä¸ä¼šæ›´æ”¹ç°æœ‰æ•°ç»„ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªæ–°æ•°ç»„ï¼Œå…¶ä¸­åŒ…å«å·²è¿æ¥æ•°ç»„çš„å€¼ã€‚
            } else {
                flashRoles.push(userConfig.currRole);
                let role = Role.getRoleById(userConfig.currRole);
                flashRoles.push(role.cps[fullCloseInt(0, role.cps.length - 1)]);
            }
        } else if (roleIds[0] > -1) { // è®¾ç½®äº†ç¬¬ä¸€ä¸ª
            // æ‰¾åˆ°è®¾ç½®è§’è‰²çš„å¸¸ç”¨æ­é…
            let role = Role.getRoleById(roleIds[0]);
            flashRoles.push(roleIds[0]);
            flashRoles.push(role.cps[fullCloseInt(0, role.cps.length - 1)]);
        } else if (roleIds[1] > -1) { // è®¾ç½®äº†ç¬¬äºŒä¸ª
            let role = Role.getRoleById(roleIds[1]);
            flashRoles.push(role.cps[fullCloseInt(0, role.cps.length - 1)]);
            flashRoles.push(roleIds[1]);
        }
        // è“é˜Ÿè§’è‰²è¡¥å…¨
        if (isUseGameRoleIdsFull(2)) {
            flashRoles.push(roleIds[2]);
            flashRoles.push(roleIds[3]);
        } else if (roleIds[2] < 0 && roleIds[3] < 0) {
            flashRoles = flashRoles.concat(RegularlyCollocation.getRandomGroup());
        } else if (roleIds[2] > -1) {
            let role = Role.getRoleById(roleIds[2]);
            flashRoles.push(roleIds[2]);
            flashRoles.push(role.cps[fullCloseInt(0, role.cps.length - 1)]);
        } else if (roleIds[3] > -1) {
            let role = Role.getRoleById(roleIds[3]);
            flashRoles.push(role.cps[fullCloseInt(0, role.cps.length - 1)]);
            flashRoles.push(roleIds[3]);
        }
    } else { // å…¨æ–°å¸¸ç”¨ç»„åˆ
        // çº¢é˜Ÿ
        if (isSetCurrRole) { // é‡æ–°é€‰æ‹©ä¸»è§’
            flashRoles = flashRoles.concat(RegularlyCollocation.getRandomGroup());
        } else {
            flashRoles.push(userConfig.currRole);
            let role = Role.getRoleById(userConfig.currRole);
            flashRoles.push(role.cps[fullCloseInt(0, role.cps.length - 1)]);
        }
        // è“é˜Ÿ
        flashRoles = flashRoles.concat(RegularlyCollocation.getRandomGroup());
    }

    // è®¾ç½®ä¸»è§’id
    if (isSetCurrRole) userConfig.currRole = flashRoles[0];

    return flashRoles;
}


// è§’è‰²idæ£€æŸ¥ï¼Œé¿å…idä¸ºè´Ÿæ•°ï¼›é¿å…åŒä¸€é˜Ÿé€‰ä¸­ä¸¤ä¸ªä¸€æ ·çš„è§’è‰²
function doCkeckOtherRoles(otherRoles) {
    console.log(">>>> doCkeckOtherRoles before otherRoles=" + otherRoles);
    if (otherRoles.length > 3) otherRoles = otherRoles.slice(0, 3); // slice[tart, end) å¼€åŒºé—´ ä¸æ”¹å˜åŸæ•°ç»„
    // çº¢é˜Ÿæ ¡éªŒ
    if (otherRoles[0] < 0 || otherRoles[0] === userConfig.currRole) {
        let role = Role.getRoleById(userConfig.currRole);
        otherRoles[0] = role.cps[fullCloseInt(0, role.cps.length - 1)];
    }
    // è“é˜Ÿæ ¡éªŒ
    if (otherRoles[1] > -1 && otherRoles[2] > -1) { // ä¸¤ä¸ªéƒ½è®¾ç½®äº†
        if (otherRoles[1] === otherRoles[2]) { // ä¿©è§’è‰²ä¸€æ ·
            let role = Role.getRoleById(otherRoles[1]);
            otherRoles[2] = role.cps[fullCloseInt(0, role.cps.length - 1)];
        }
    } else if (otherRoles[1] < 0 && otherRoles[2] < 0) { // ä¸¤ä¸ªéƒ½æ²¡è®¾ç½®
        let group = RegularlyCollocation.getRandomGroup();
        otherRoles[1] = group[0];
        otherRoles[2] = group[1];
    } else if (otherRoles[1] > -1) { // è®¾ç½®äº†ç¬¬ä¸€ä¸ª
        let role = Role.getRoleById(otherRoles[1]);
        otherRoles[2] = role.cps[fullCloseInt(0, role.cps.length - 1)];
    } else if (otherRoles[2] > -1) { // è®¾ç½®äº†ç¬¬äºŒä¸ª
        let role = Role.getRoleById(otherRoles[2]);
        otherRoles[1] = role.cps[fullCloseInt(0, role.cps.length - 1)];
    }

    //console.log(">>>> doCkeckOtherRoles after otherRoles=" + otherRoles);
}


// è®¾ç½®ä¸»è§’ä¹‹å¤–çš„è§’è‰²
function setRoleOthers(otherRoles) {
    if (!otherRoles || otherRoles.length < 1) return;
    let idx = 2;
    otherRoles.some(rid => {
        // éä¸»çƒåªèƒ½ç§»åŠ¨å’Œè¢«æ’å‡»
        let otherBall = new Ball(context, {
            no: idx,
            teamColor: idx > 2 ? 'b' : 'r',
            roleId: rid,
            isMainBall: false,
            x: 0,
            y: 0,
            vx: 0,
            vy: 0
        });
        // åˆå§‹åŒ–å…¶ä»–å‚æ•°
        initBallByRole(otherBall);
        // è®¾ç½®éšæœºä½ç½®åæ ‡
        putBallRandom(otherBall);
        otherBall.x0 = otherBall.x;
        otherBall.y0 = otherBall.y;
        balls.push(otherBall);
        idx += 1;
    });
}


// è®¾ç½®å°ä¸‘åˆ†èº«
function setRoleJoker() {
    let rid;
    for (let i = 0, len = balls.length; i < len; i++) {
        rid = balls[i].roleId;
        if (rid !== Role.JOKER.id) continue;

        let otherBall = new Ball(context, {
            no: balls.length + 1,
            teamColor: i > 1 ? 'b' : 'r',
            color: '#A8A8A8A8', // å°ä¸‘åˆ†èº«å•ç‹¬é¢œè‰²ï¼Œå–é»˜è®¤çš®è‚¤å¸½å­é¢œè‰²
            roleId: rid,
            isMainBall: false,
            x: 0,
            y: 0,
            vx: 0,
            vy: 0
        });
        // åˆå§‹åŒ–å…¶ä»–å‚æ•°
        initBallByRole(otherBall);
        // è®¾ç½®éšæœºä½ç½®åæ ‡
        putBallRandom(otherBall);
        otherBall.x0 = otherBall.x;
        otherBall.y0 = otherBall.y;
        balls.push(otherBall);
    }
}


// å¯¼å…¥åˆ†äº«æ•°æ®åï¼Œè®¾ç½®å°ä¸‘åˆ†èº«é¢œè‰²
function setJoker2Color() {
    if (!balls || balls.length < 1) return;
    let ball;
    for (let i = 0, len = balls.length; i < len; i++) {
        ball = balls[i];
        if (ball.roleId !== Role.JOKER.id) continue;
        if (ball.isMainBall) continue;

        if (len < 4) { // å•ç‹¬ä¸€ä¸ªè§’è‰²æµ‹è¯•
            ball.color = '#A8A8A8A8';
        } else { // å››ä¸ªè§’è‰²
            if (ball.no < 5) continue;
            ball.color = '#A8A8A8A8';
        }
    }
}


// è®¾ç½®åŒå­åˆ†èº«
function setTwins() {
    if (!balls || balls.length < 1) return;
    // åŒå­åˆ†èº«
    twinBall.no = balls.length + 1;
    twinBall.roleId = Role.SHUANGZI.id;
    twinBall.color = '#CACAE3'; // åˆ†èº«è¡£æœé¢œè‰²
    twinBall.teamColor = balls[0].teamColor;
    twinBall.x = Ball.BODY2POS.x;
    twinBall.y = Ball.BODY2POS.y;
    twinBall.x0 = Ball.BODY2POS.x;
    twinBall.y0 = Ball.BODY2POS.y;
    // åˆå§‹åŒ–å…¶ä»–å‚æ•°
    initBallByRole(twinBall);
    balls.push(twinBall);
}


// éšæœºè®¾ç½®ä¸»è§’æ‰€åœ¨é˜Ÿé¢œè‰²
function resetMainTeamColorRandom(mtc) {
    if (!balls || balls.length < 1) return;
    if (!mtc) { // main team color
        let n = fullCloseInt(1, 100);
        if (n % 2 === 0) mtc = 'r';
        else mtc = 'b';
    }
    if (balls[0].teamColor === mtc) return;
    // teamColor å–å
    balls.some(ball => {
        if (ball.teamColor === 'r') ball.teamColor = 'b';
        else ball.teamColor = 'r';
    });
    // å‚æ•°è®¾ç½®è§’è‰²è¾“å…¥æ¡†é¢œè‰²è·Ÿç€å˜åŒ–
    let roleInputEles = document.getElementsByClassName("div-input-game-roles");
    if (!roleInputEles || roleInputEles.length !== 4) return;
    for (let i = 0, len = roleInputEles.length; i < len; i++) {
        // å­˜åœ¨åˆ™åˆ é™¤ï¼Œä¸å­˜åœ¨åˆ™æ·»åŠ 
        roleInputEles[i].classList.toggle("red");
    }
}


// è®¾ç½®è›‹
function setEggs() {
    if (!balls || balls.length < 1) return;
    eggs = [];
    for (let i = 0; i < balls.length; i++) {
        if (balls[i].roleId !== Role.DUODUO.id) continue;
        if (balls[i].teamColor === 'r') {
            eggs.push(new Ball(context, {
                roleId: Ball.SPECIALROLEID.eggId, // è›‹ä¸å¯¹åº”è§’è‰²
                x: 7 * sysConfig.girdSize,
                y: 22 * sysConfig.girdSize,
                vx: 0,
                vy: 0,
                radius: sysConfig.girdSize,
                color: '#CE605B',
                m: sysConfig.maxWeightVal, // è›‹ä¸ä¼šåŠ¨ï¼Œç»™æœ€å¤§è´¨é‡
            }));
        } else {
            eggs.push(new Ball(context, {
                roleId: Ball.SPECIALROLEID.eggId,
                x: 7 * sysConfig.girdSize,
                y: 0 * sysConfig.girdSize,
                vx: 0,
                vy: 0,
                radius: sysConfig.girdSize,
                color: '#2A7CE9',
                m: sysConfig.maxWeightVal,
            }));
        }
    }
}


// ä¸åˆ·æ–°é¡µé¢ï¼Œé‡æ–°è®¾ç½®è›‹
function resetEggs() {
    // é‡æ–°è®¾ç½®è›‹
    setEggs();
    // gameSceneCanvas åœºæ™¯å±‚æ¸…ç©ºé‡ç”»
    clearCanvasAll(gameSceneCanvas);
    // å¡«å……èƒŒæ™¯è‰²
    drawSceneBg();
    // ç”»ç½‘æ ¼ï¼Œåœ¨èƒŒæ™¯è‰²ä¹‹å
    drawSceneGrid();
    // å¢™é¢åˆ‡è§’
    clipTableAngles();
    // ç”»è›‹
    drawEggs();
}


// è·å–éšæœºä½ç½®åæ ‡ç‚¹
function getRandomPoint(radius, targetCanvas) {
    if (!targetCanvas) targetCanvas = canvas;
    let p = { x: 0, y: 0 };
    p.x = randomPos(radius, "x", targetCanvas);
    p.y = randomPos(radius, "y", targetCanvas);
    while (!checkRandomPos(radius, p.x, p.y)) {
        p.x = randomPos(radius, "x", targetCanvas);
        p.y = randomPos(radius, "y", targetCanvas);
    }
    return p;
}


// [n,m)èŒƒå›´éšæœºæ•° Math.random()*(m-n)+n
function randomPos(radius, need, targetCanvas) {
    // x [radius+1, targetCanvas.width-radius)
    if (need === "x") return fullOpen(radius + 1, targetCanvas.width - radius);
    // y [radius+1, targetCanvas.height-radius)
    if (need === "y") return fullOpen(radius + 1, targetCanvas.height - radius);
    return 0;
}


// æ£€æµ‹éšæœºåæ ‡
function checkRandomPos(radius, x, y) {
    //console.log(">>>> checkRandomPos x=" + x + ", y=" + y);
    tempCheckBall.x = x;
    tempCheckBall.y = y;
    tempCheckBall.radius = radius;
    // ç²—ç•¥æ£€æµ‹æ˜¯å¦åœ¨å››æ¡åˆ‡è§’çº¿åŒºåŸŸ
    //if (isInAngleArea(tempCheckBall) > -1) return false;
    // æ£€æµ‹å¢™é¢ç¢°æ’
    if (checkWallCollided(tempCheckBall)) return false;
    // æ£€æµ‹åˆ‡é¢ç¢°æ’
    if (checkLineCollided(tempCheckBall)) return false;
    return true;
}


// æ£€æµ‹æ–°åŠ å…¥è§’è‰²ä¸åœºä¸Šè§’è‰²åæ ‡æ˜¯å¦æœ‰å†²çª
function checkBallsCollided(newBall) {
    let result = false;
    balls.some(ball => {
        if (newBall !== ball) { // ä¸æ˜¯è‡ªå·±
            if (is2CirclesCollided(newBall, ball)) {
                result = true;
                return true; // åªæ˜¯é€€å‡ºäº†å¾ªç¯
            }
        }
    });
    if (result) return result;

    // ç»§ç»­æ£€æµ‹æ˜¯å¦ä¸è›‹çš„ä½ç½®å†²çª
    //if(eggs) console.log(eggs.length); // è®¾ç½®è§’è‰²çš„æ—¶å€™è¿˜æ²¡æœ‰è®¾ç½®è›‹
    /*
    if (eggs && eggs.length > 0) {
        result = isBallAndEggCollided(newBall);
    }
    */

    // å°çƒåŒºåŸŸä¸èƒ½ç¢°åˆ°è›‹çš„åŒºåŸŸ
    if (isInEggArea(newBall)) result = true;
    //console.log(">>>> checkBallsCollided isBallAndEggCollided=" + result + " > " + ball.getBallDesc());

    return result;
}


// æ ¹æ®æ‰‹æœºDPRè®¾ç½®é€Ÿåº¦
function setSpeed() {
    if (!balls || balls.length < 1) return;
    let speed = 0;
    // æ ¹æ®å±å¹•å¤§å°åŠ¨æ€è®¾ç½®åˆå§‹é€Ÿåº¦ï¼Œå¦‚æœé€Ÿåº¦ä¸å˜ï¼Œåœ¨å°åˆ†è¾¨ç‡å±å¹•ä¸Šè·‘çš„æ›´è¿œã€‚60/644 = x/canvas.width x=60/644*canvas.width
    //speed = roundNumber(60 / 644 * canvas.width, 4);
    // æ ¹æ® dpr åŠ¨æ€è®¾ç½®åˆå§‹é€Ÿåº¦ 74/2.7 = x/dpr >>>> x=74/2.7*dpr
    //sysConfig.bounce = 2;
    console.log(">>>> sysConfig.bounce=" + sysConfig.bounce);
    if (sysConfig.bounce > 0) { // sysConfig.bounce=2ï¼Œç¢°æ’æœ‰æŸè€—ï¼Œæ¨ªå‘ç›´æ‰“è·ç¦»æ­£å¸¸ï¼ˆæ°´å¹³ç¢°æ’æ¬¡æ•°å¤šï¼‰ï¼Œç«–ç›´è·ç¦»åå¤§ä¸€äº›ï¼ˆç«–ç›´ç¢°æ’æ¬¡æ•°å°‘ï¼‰
        // TODO è¿˜éœ€è¦çœŸæœºæ¨¡æ‹Ÿæ ¡å‡†
        speed = getHeiwaSpeedByDpr() * balls[0].vRatio + sysConfig.bounce * 4; // å¨ƒæ¨ªå‘ç›´æ‰“ä¼šç¢°å››æ¬¡ï¼ŒåŠ ä¸ŠæŸè€—çš„å››æ¬¡
    } else { // sysConfig.bounce <= 0ï¼Œç¢°æ’æ— æŸè€—ï¼Œæ¨ªå‘ç›´æ‰“è·ç¦»æ­£å¸¸ï¼Œç«–ç›´è·ç¦»è·Ÿå®æˆ˜æ¥è¿‘ï¼Œä½†å°çƒå‘å°„é€Ÿåº¦ç¨å¾®æ…¢ä¸€ç‚¹
        // è®¾ç½®ä¸»çƒé€Ÿåº¦ï¼Œç›®å‰åªæ”¯æŒä¸»çƒå¯ä»¥å‘å°„
        speed = getHeiwaSpeedByDpr() * balls[0].vRatio;
    }
    // é…ç½®äº†åŠ é€Ÿæˆ–å‡é€Ÿ
    if (userConfig.roleSpeedAddVal) {
        console.log(">>>> userConfig.roleSpeedAddVal=" + userConfig.roleSpeedAddVal);
        speed += userConfig.roleSpeedAddVal;
    }
    speed = roundNumber(speed, 4);
    console.log(">>>> main ball speed=" + speed);
    balls[0].v = speed;
}


// è·å–åŸå§‹é€Ÿåº¦
function getBallSpeed0(ball) {
    let speed = 0;
    // æ ¹æ®å±å¹•å¤§å°åŠ¨æ€è®¾ç½®åˆå§‹é€Ÿåº¦ï¼Œå¦‚æœé€Ÿåº¦ä¸å˜ï¼Œåœ¨å°åˆ†è¾¨ç‡å±å¹•ä¸Šè·‘çš„æ›´è¿œã€‚60/644 = x/canvas.width x=60/644*canvas.width
    //speed = roundNumber(60 / 644 * canvas.width, 4);
    // æ ¹æ® dpr åŠ¨æ€è®¾ç½®åˆå§‹é€Ÿåº¦ 74/2.7 = x/dpr >>>> x=74/2.7*dpr
    //sysConfig.bounce = 2;
    //console.log(">>>> sysConfig.bounce=" + sysConfig.bounce);
    if (sysConfig.bounce > 0) { // sysConfig.bounce=2ï¼Œç¢°æ’æœ‰æŸè€—ï¼Œæ¨ªå‘ç›´æ‰“è·ç¦»æ­£å¸¸ï¼ˆæ°´å¹³ç¢°æ’æ¬¡æ•°å¤šï¼‰ï¼Œç«–ç›´è·ç¦»åå¤§ä¸€äº›ï¼ˆç«–ç›´ç¢°æ’æ¬¡æ•°å°‘ï¼‰
        // TODO è¿˜éœ€è¦çœŸæœºæ¨¡æ‹Ÿæ ¡å‡†
        speed = getHeiwaSpeedByDpr() * ball.vRatio + sysConfig.bounce * 4; // å¨ƒæ¨ªå‘ç›´æ‰“ä¼šç¢°å››æ¬¡ï¼ŒåŠ ä¸ŠæŸè€—çš„å››æ¬¡
    } else { // sysConfig.bounce <= 0ï¼Œç¢°æ’æ— æŸè€—ï¼Œæ¨ªå‘ç›´æ‰“è·ç¦»æ­£å¸¸ï¼Œç«–ç›´è·ç¦»è·Ÿå®æˆ˜æ¥è¿‘ï¼Œä½†å°çƒå‘å°„é€Ÿåº¦ç¨å¾®æ…¢ä¸€ç‚¹
        // è®¾ç½®ä¸»çƒé€Ÿåº¦ï¼Œç›®å‰åªæ”¯æŒä¸»çƒå¯ä»¥å‘å°„
        speed = getHeiwaSpeedByDpr() * ball.vRatio;
    }
    speed = roundNumber(speed, 4);
    return speed;
}


// æ ¹æ®æ‰‹æœºdprè·å–é»‘å¨ƒçš„é€Ÿåº¦ï¼Œå…¶ä»–è§’è‰²é€Ÿåº¦å–é»‘å¨ƒç›¸å¯¹å€¼ï¼Œæ¯”å¦‚åƒµå°¸çš„é€Ÿåº¦æ˜¯é»‘å¨ƒçš„0.9å€
function getHeiwaSpeedByDpr() {
    // ä¸åŒè®¾å¤‡é»‘å¨ƒæ¨ªæ‰“çš„æ—¶é—´ç›¸åŒ t=d/v=46*girdSize/48.412=46*42/48.412â‰ˆ39.907
    // åˆå§‹åŒ–æ—¶ä¼šæ ¹æ® dpr è®¡ç®— girdSize 
    // v=d/t
    let v = roundNumber(46 * sysConfig.girdSize / 39.907, 4);
    //console.log(">>>> getHeiwaSpeedByDpr v=" + v);
    return v;
}


// æ ¹æ®canvas.widthè®¾ç½®æ‘©æ“¦åŠ›
function setFriction() {
    // æ­£ç›¸å…³ 0.6008 / 583 = f / canvas.width
    // dpr=2 canvas.width=588 sysConfig.friction=0.606
    sysConfig.friction = roundNumber(0.6008 / 583 * canvas.width, 4);
    console.log(">>>> sysConfig.friction=" + sysConfig.friction);
}


// æ£€æµ‹è§’è‰²æ˜¯å¦å­˜åœ¨
function checkRoleExist() {
    isDuoduoExist = checkIsDuoduoExist();
    isLuluExist = checkIsLuluExist();
    isShuangziExist = checkIsShuangziExist();
}


// é™æ€æ¸¸æˆæ¡Œé¢åœºæ™¯åˆå§‹åŒ–
function gameSceneInit() {
    // ç”»æ¸¸æˆå°é¢
    drawTable();
    // ç”»è›‹
    if (isDuoduoExist) drawEggs();
}


// å››ä¸ªè§’è‰²é‡Œé¢æ˜¯å¦æœ‰æœµæœµï¼Œç”¨äºæ§åˆ¶æ˜¯å¦ç”»è›‹
// è®¾ç½®ä¸€ä¸ªå˜é‡ï¼Œåˆå§‹åŒ–çš„æ—¶å€™åˆ¤æ–­ä¸€æ¬¡ï¼Œä¸å»ºè®®æ¯æ¬¡éƒ½è°ƒç”¨åˆ¤æ–­æ–¹æ³•
function checkIsDuoduoExist() {
    let result = false;
    balls.some(ball => {
        //console.log(">>>> ball.roleId=" + ball.roleId);
        if (ball.roleId === Role.DUODUO.id) {
            result = true;
            return true; // åªæ˜¯é€€å‡ºå¾ªç¯
        }
    });
    return result;
}


// æ˜¯å¦æœ‰éœ²éœ²ï¼Œåˆ¤æ–­æ˜¯å¦ç”»ç»ç’ƒçƒ
function checkIsLuluExist() {
    let result = false;
    balls.some(ball => {
        //console.log(">>>> ball.roleId=" + ball.roleId);
        if (ball.roleId === Role.LULU.id && ball.no === 2) {
            result = true;
            return true; // åªæ˜¯é€€å‡ºå¾ªç¯
        }
    });
    return result;
}


// æ˜¯å¦æœ‰åŒå­ï¼Œä»…é™ä¸»çƒ
function checkIsShuangziExist() {
    let result = false;
    balls.some(ball => {
        //console.log(">>>> ball.roleId=" + ball.roleId);
        if (ball.isMainBall && ball.roleId === Role.SHUANGZI.id) {
            result = true;
            return true; // åªæ˜¯é€€å‡ºå¾ªç¯
        }
    });
    return result;
}


// ç»˜åˆ¶æ¸¸æˆå°é¢
function drawTable() {
    // å¡«å……èƒŒæ™¯è‰²
    drawSceneBg();
    // ç”»ç½‘æ ¼ï¼Œåœ¨èƒŒæ™¯è‰²ä¹‹å
    drawSceneGrid();
    // å¤æ—¥ä¸»é¢˜ç”»é—´éš”é¢œè‰²çš„ç –æ ¼
    if (userConfig.sceneThemeMode === 5) drawSceneGridRect();
    // å¢™é¢åˆ‡è§’
    clipTableAngles();
    // è®¾ç½®åœºæ™¯ä¸»é¢˜
    if (userConfig.currRole > -1) setSceneTheme(); // æœªé€‰æ‹©è§’è‰²ï¼Œä¸æ¸²æŸ“åœºæ™¯ï¼ŒèŠ‚çœæ€§èƒ½
    // ç”»å°é¢è¾¹æ¡†ï¼Œæ”¾åœ¨ä¸»é¢˜è®¾ç½®ä¹‹åï¼Œç¡®ä¿è¾¹æ¡†è¦†ç›–emojiå›¾å½¢
    if (userConfig.isShowTableBorder) doDrawTableLines();
    // ç”»ç –æ ¼åæ ‡
    if (userConfig.isShowGridCoordinate) drawSceneCoordinate();
    // å¤æ—¥ä¸»é¢˜ä¸ªåˆ«åŠ¨ç‰©ä¸Šå°é¢
    if (userConfig.sceneThemeMode === 5) {
        drawIconRandom("ğŸ¦€", "ss", 1, false, gameSceneCanvas);
        drawIconRandom("ğŸ¦€", "xxs", 2, false, gameSceneCanvas);
        //drawIconRandom("ğŸ¦", "ss", 1, false, gameSceneCanvas);
        //drawIconRandom("ğŸ¦", "xxs", 1, false, gameSceneCanvas);
        //drawIconRandom("ğŸ¢", "ss", 1, false, gameSceneCanvas);
    }

}


// ç”»ç½‘æ ¼
// https://juejin.cn/post/6844904042062151688
function drawSceneGrid() {

    gameSceneContext.save();
    gameSceneContext.beginPath();
    gameSceneContext.lineWidth = roundNumber(1 * dpr * sysConfig.pxRatio, 4);
    //gameSceneContext.shadowColor = '#5A5030';
    //gameSceneContext.shadowBlur = 1 * dpr;

    // 1. è®¾ç½®ç½‘æ ¼å¤§å°
    // girdSize

    // 2. è·å–Canvasçš„widthã€height
    let CanvasWidth = gameSceneCanvas.width;
    let CanvasHeight = gameSceneCanvas.height;

    // 3. é‡‡ç”¨éå†çš„æ–¹å¼ï¼Œç”»æ°´å¹³çº¿æ¡
    //let xLineTotals = Math.floor(CanvasHeight / sysConfig.girdSize); // è®¡ç®—éœ€è¦ç»˜ç”»çš„xè½´æ¡æ•°ã€ä¼šæœ‰ä¸€äº›è¯¯å·®ï¼Œå¯¼è‡´å°‘ç”»çº¿é—®é¢˜ã€‘
    let xLineTotals = 22;
    for (let i = 0; i <= xLineTotals; i++) {
        gameSceneContext.beginPath(); // å¼€å¯è·¯å¾„ï¼Œè®¾ç½®ä¸åŒçš„æ ·å¼
        gameSceneContext.moveTo(0, sysConfig.girdSize * i); // -0.5æ˜¯ä¸ºäº†è§£å†³åƒç´ æ¨¡ç³Šé—®é¢˜
        gameSceneContext.lineTo(CanvasWidth, sysConfig.girdSize * i);
        gameSceneContext.strokeStyle = "#8384D1D0"; // é»˜è®¤ä¸»é¢˜
        if (i === 11) gameSceneContext.strokeStyle = "#6A6CBFD0"; // ä¸­é—´çº¿çªå‡ºä¸€ç‚¹
        if (userConfig.sceneThemeMode === 1) { // å†°é›ªä¸»é¢˜
            gameSceneContext.strokeStyle = "#438EC2";
            if (i === 11) gameSceneContext.strokeStyle = "#3483B7";
        } else if (userConfig.sceneThemeMode === 3) { // ç”°å›­ä¸»é¢˜
            gameSceneContext.strokeStyle = "#6B624060";
            if (i === 11) gameSceneContext.strokeStyle = "#6B6240D0";
        } else if (userConfig.sceneThemeMode === 4) { // æ˜Ÿé™…ä¸»é¢˜
            gameSceneContext.strokeStyle = "#696969A0";
            if (i === 11) gameSceneContext.strokeStyle = "#2F4F4FA0";
        } else if (userConfig.sceneThemeMode === 5) { // å¤æ—¥ä¸»é¢˜
            gameSceneContext.strokeStyle = "#B7521AA0";
            if (i === 11) gameSceneContext.strokeStyle = "#B7521AD0";
        }
        gameSceneContext.stroke();
    }

    // 4.é‡‡ç”¨éå†çš„æ–¹å¼ï¼Œç”»å‚ç›´çº¿æ¡
    //let yLineTotals = Math.floor(CanvasWidth / sysConfig.girdSize); // è®¡ç®—éœ€è¦ç»˜ç”»yè½´çš„æ¡æ•°
    let yLineTotals = 14;
    for (let j = 0; j <= yLineTotals; j++) {
        gameSceneContext.beginPath(); // å¼€å¯è·¯å¾„ï¼Œè®¾ç½®ä¸åŒçš„æ ·å¼
        gameSceneContext.moveTo(sysConfig.girdSize * j, 0);
        gameSceneContext.lineTo(sysConfig.girdSize * j, CanvasHeight);
        gameSceneContext.strokeStyle = "#8384D1D0"; // é»˜è®¤ä¸»é¢˜
        if (j === 7) gameSceneContext.strokeStyle = "#6A6CBFD0";
        if (userConfig.sceneThemeMode === 1) { // å†°é›ªä¸»é¢˜
            gameSceneContext.strokeStyle = "#438EC2";
            if (j === 7) gameSceneContext.strokeStyle = "#3483B7";
        } else if (userConfig.sceneThemeMode === 3) { // ç”°å›­ä¸»é¢˜
            gameSceneContext.strokeStyle = "#6B624060";
            if (j === 7) gameSceneContext.strokeStyle = "#6B6240D0";
        } else if (userConfig.sceneThemeMode === 4) { // æ˜Ÿé™…ä¸»é¢˜
            gameSceneContext.strokeStyle = "#696969A0";
            if (j === 7) gameSceneContext.strokeStyle = "#2F4F4FA0";
        } else if (userConfig.sceneThemeMode === 5) { // å¤æ—¥ä¸»é¢˜
            gameSceneContext.strokeStyle = "#B7521AA0";
            if (j === 7) gameSceneContext.strokeStyle = "#B7521AD0";
        }
        gameSceneContext.stroke();
    }

    gameSceneContext.restore();
}


// ç”»é—´éš”é¢œè‰²çš„ç –æ ¼
function drawSceneGridRect() {
    gameSceneContext.save();
    gameSceneContext.beginPath();
    gameSceneContext.lineWidth = roundNumber(1 * dpr * sysConfig.pxRatio, 4);
    //gameSceneContext.shadowColor = '#5A5030';
    //gameSceneContext.shadowBlur = 1 * dpr;

    // 1. è®¾ç½®ç½‘æ ¼å¤§å°
    // girdSize

    // 2. è·å–Canvasçš„widthã€height
    let CanvasWidth = gameSceneCanvas.width;
    let CanvasHeight = gameSceneCanvas.height;

    let xLineTotals = 22;
    let yLineTotals = 14;
    for (let i = 0; i < xLineTotals; i++) {
        for (let j = 0; j < yLineTotals; j++) {
            if (i % 2 === 0) { // å¶æ•°è¡Œ
                if (j % 2 === 0) { // å¶æ•°åˆ—
                    gameSceneContext.fillStyle = "#FFA35D"; // å¤æ—¥ä¸»é¢˜-ç –æ ¼æ·±é¢œè‰²å¡«å……
                } else { // å¥‡æ•°åˆ—
                    gameSceneContext.fillStyle = "#FFC777"; // å¤æ—¥ä¸»é¢˜-ç –æ ¼æµ…é¢œè‰²å¡«å……
                }
            } else { // å¥‡æ•°è¡Œ-ç›¸å
                if (j % 2 !== 0) {
                    gameSceneContext.fillStyle = "#FFA35D"; // å¤æ—¥ä¸»é¢˜-ç –æ ¼æ·±é¢œè‰²å¡«å……
                } else {
                    gameSceneContext.fillStyle = "#FFC777"; // å¤æ—¥ä¸»é¢˜-ç –æ ¼æµ…é¢œè‰²å¡«å……
                }
            }

            gameSceneContext.globalAlpha = Math.random(); // éšæœºé€æ˜åº¦
            //if (gameSceneContext.fillStyle === "#FFC777") gameSceneContext.globalAlpha = 1.0; // æµ…é¢œè‰²å¡«å……ä¸è®¾ç½®é€æ˜åº¦
            gameSceneContext.fillRect(j * sysConfig.girdSize, i * sysConfig.girdSize, sysConfig.girdSize - gameSceneContext.lineWidth * Math.random(), sysConfig.girdSize - gameSceneContext.lineWidth * Math.random());

        }
    }

    gameSceneContext.restore();
}


// ç”»ç –æ ¼åæ ‡
function drawSceneCoordinate() {

    gameSceneCoordinateContext.save();
    gameSceneCoordinateContext.textAlign = "center";
    gameSceneCoordinateContext.textBaseline = 'middle';
    gameSceneCoordinateContext.font = htmlFontSizeNum * dpr * sysConfig.pxRatio + "px serif";

    // ç§»åŠ¨åæ ‡ç³»åˆ°åœºæ™¯ä¸­å¿ƒ
    //gameSceneCoordinateContext.translate(roundNumber(gameSceneCoordinateCanvas.width / 2), roundNumber(gameSceneCoordinateCanvas.height / 2));
    gameSceneCoordinateContext.translate(gameSceneCoordinateCanvas.width / 2, gameSceneCoordinateCanvas.height / 2);

    // é—´éš”å®½åº¦
    let sceneLineRealWidth = roundNumber(sysConfig.sceneLineWidth * dpr * 1.3, 4);
    if (userConfig.isShowTableBorder) sceneLineRealWidth += roundNumber(sysConfig.sceneLineWidth * dpr * 1.1, 4);

    let CanvasWidth = gameSceneCanvas.width;
    let CanvasHeight = gameSceneCanvas.height;

    // ç”»å·¦å³è¾¹ç•Œç –æ ¼åæ ‡
    let xLineTotals = 22;
    let xLineNum = 8;
    for (let i = 0; i < xLineTotals; i++) {
        // åˆ‡è§’ç –æ ¼åæ ‡ä¸ç”¨ç”»
        if ((i > -1 && i < 4) || (i > 19 && i < 22)) continue;
        gameSceneCoordinateContext.beginPath(); // å¼€å¯è·¯å¾„ï¼Œè®¾ç½®ä¸åŒçš„æ ·å¼
        gameSceneCoordinateContext.fillStyle = "#D2CCF1"; // è®¾ç½®æ¯ä¸ªçº¿æ¡çš„é¢œè‰²
        if (isDarkMode) gameSceneCoordinateContext.fillStyle = "#D7D7DC";
        if (userConfig.sceneThemeMode === 1) { // å†°é›ªä¸»é¢˜
            gameSceneCoordinateContext.fillStyle = "#687CA1"; // 5A63D1
            if (isDarkMode) gameSceneCoordinateContext.fillStyle = "#EEF0F2";
        } else if (userConfig.sceneThemeMode === 3) { // ç”°å›­ä¸»é¢˜
            gameSceneCoordinateContext.fillStyle = "#252042";
            if (isDarkMode) gameSceneCoordinateContext.fillStyle = "#FBFAD0";
        } else if (userConfig.sceneThemeMode === 4) { // æ˜Ÿé™…ä¸»é¢˜
            gameSceneCoordinateContext.fillStyle = "#D7D7DC";
            if (isDarkMode) gameSceneCoordinateContext.fillStyle = "#D7D7DC";
        } else if (userConfig.sceneThemeMode === 5) { // å¤æ—¥ä¸»é¢˜
            gameSceneCoordinateContext.fillStyle = "#2B117D";
            if (isDarkMode) gameSceneCoordinateContext.fillStyle = "#FBFAD0";
        }
        gameSceneCoordinateContext.fillText(xLineNum + "", -(CanvasWidth / 2 + sceneLineRealWidth), -(CanvasHeight / 2 + sysConfig.girdSize / 2) + sysConfig.girdSize * i);
        gameSceneCoordinateContext.fillText(xLineNum + "", (CanvasWidth / 2 + sceneLineRealWidth), -(CanvasHeight / 2 + sysConfig.girdSize / 2) + sysConfig.girdSize * i);
        if (i < 11) xLineNum--;
        if (i > 11) xLineNum++;
    }

    // ç”»ä¸Šä¸‹è¾¹ç•Œç –æ ¼åæ ‡
    let yLineTotals = 14;
    let yLineNum = 4;
    for (let j = 0; j < yLineTotals; j++) {
        // åˆ‡è§’ç –æ ¼åæ ‡ä¸ç”¨ç”»
        if ((j > -1 && j < 4) || (j > 11 && j < 14)) continue;
        gameSceneCoordinateContext.beginPath();
        gameSceneCoordinateContext.fillStyle = "#D2CCF1";
        if (isDarkMode) gameSceneCoordinateContext.fillStyle = "#D7D7DC";
        if (userConfig.sceneThemeMode === 1) { // å†°é›ªä¸»é¢˜
            gameSceneCoordinateContext.fillStyle = "#687CA1";
            if (isDarkMode) gameSceneCoordinateContext.fillStyle = "#EEF0F2";
        } else if (userConfig.sceneThemeMode === 3) { // ç”°å›­ä¸»é¢˜
            gameSceneCoordinateContext.fillStyle = "#252042";
            if (isDarkMode) gameSceneCoordinateContext.fillStyle = "#FBFAD0";
        } else if (userConfig.sceneThemeMode === 4) { // æ˜Ÿé™…ä¸»é¢˜
            gameSceneCoordinateContext.fillStyle = "#D7D7DC";
            if (isDarkMode) gameSceneCoordinateContext.fillStyle = "#D7D7DC";
        } else if (userConfig.sceneThemeMode === 5) { // å¤æ—¥ä¸»é¢˜
            gameSceneCoordinateContext.fillStyle = "#2B117D";
            if (isDarkMode) gameSceneCoordinateContext.fillStyle = "#FBFAD0";
        }
        gameSceneCoordinateContext.fillText(yLineNum + "", -(CanvasWidth / 2 + sysConfig.girdSize / 2) + sysConfig.girdSize * j, -(CanvasHeight / 2 + sceneLineRealWidth));
        gameSceneCoordinateContext.fillText(yLineNum + "", -(CanvasWidth / 2 + sysConfig.girdSize / 2) + sysConfig.girdSize * j, (CanvasHeight / 2 + sceneLineRealWidth));
        if (j < 7) yLineNum--;
        if (j > 7) yLineNum++;
    }

    gameSceneCoordinateContext.restore();
}


// ç”»åœºæ™¯èƒŒæ™¯è‰²
function drawSceneBg() {
    gameSceneContext.save();
    gameSceneContext.fillStyle = "#8d93d8"; // é»˜è®¤ä¸»é¢˜-åœºåœ°èƒŒæ™¯è‰²
    if (userConfig.sceneThemeMode === 1)
        gameSceneContext.fillStyle = "#4B99C9"; // å†°é›ªä¸»é¢˜-åœºåœ°èƒŒæ™¯è‰²
    else if (userConfig.sceneThemeMode === 3)
        gameSceneContext.fillStyle = "#9A9069"; // ç”°å›­ä¸»é¢˜-åœºåœ°èƒŒæ™¯è‰²
    else if (userConfig.sceneThemeMode === 4)
        gameSceneContext.fillStyle = "Gray"; // æ˜Ÿé™…ä¸»é¢˜-åœºåœ°èƒŒæ™¯è‰²
    else if (userConfig.sceneThemeMode === 5)
        gameSceneContext.fillStyle = "#FFBF6F"; // å¤æ—¥ä¸»é¢˜-åœºåœ°èƒŒæ™¯è‰²
    gameSceneContext.fillRect(0, 0, gameSceneCanvas.width, gameSceneCanvas.height);
    // è®¾ç½®dialogå¼¹çª—ç¡®è®¤æŒ‰é’®é¢œè‰²ä¸ºåœºæ™¯èƒŒæ™¯è‰²
    setDialogOkColor(gameSceneContext.fillStyle);
    gameSceneContext.restore();
}


// å››ä¸ªåˆ‡è§’å‰ªåˆ‡æ‰
function clipTableAngles() {
    // å·¦ä¸Šè§’
    let p0 = { x: 0, y: 0 };
    let p1 = { x: sysConfig.girdSize * 3 + sysConfig.wan8CocosTableMoveVals[1], y: 0 }; // ç©å§æ’å‡»å°é¢ï¼Œåˆ»æ„æ··æ·†è°ƒæ•´äº†è§’åº¦
    let p2 = { x: 0, y: sysConfig.girdSize * 3 + sysConfig.wan8CocosTableMoveVals[0] };
    let points = [p0, p1, p2];
    doGraphClip(points, gameSceneCanvas);

    // å³ä¸Šè§’
    p0 = { x: sysConfig.girdSize * 11 + sysConfig.wan8CocosTableMoveVals[2], y: 0 };
    p1 = { x: gameSceneCanvas.width, y: 0 };
    p2 = { x: gameSceneCanvas.width, y: sysConfig.girdSize * 3 + sysConfig.wan8CocosTableMoveVals[3] };
    points = [p0, p1, p2];
    doGraphClip(points, gameSceneCanvas);

    // å³ä¸‹è§’
    p0 = { x: gameSceneCanvas.width, y: sysConfig.girdSize * 19 + sysConfig.wan8CocosTableMoveVals[4] };
    p1 = { x: gameSceneCanvas.width, y: gameSceneCanvas.height };
    p2 = { x: sysConfig.girdSize * 11 + sysConfig.wan8CocosTableMoveVals[5], y: gameSceneCanvas.height };
    points = [p0, p1, p2];
    doGraphClip(points, gameSceneCanvas);

    // å·¦ä¸‹è§’
    p0 = { x: sysConfig.girdSize * 3 + sysConfig.wan8CocosTableMoveVals[6], y: gameSceneCanvas.height };
    p1 = { x: 0, y: gameSceneCanvas.height };
    p2 = { x: 0, y: sysConfig.girdSize * 19 + sysConfig.wan8CocosTableMoveVals[7] };
    points = [p0, p1, p2];
    doGraphClip(points, gameSceneCanvas);

}


// é»˜è®¤ä¸»é¢˜å·¦å³ä¸¤ä¸ªè¾¹æ¡†å‰ªåˆ‡æ‰
function clipDefaultTableLines() {
    // å·¦è¾¹æ¡†
    let p0 = { x: 0, y: 0 };
    let p1 = { x: gameSceneLinesCanvas.width / 2 - sysConfig.girdSize * 7, y: 0 };
    let p2 = { x: gameSceneLinesCanvas.width / 2 - sysConfig.girdSize * 7, y: gameSceneLinesCanvas.height };
    let p3 = { x: 0, y: gameSceneLinesCanvas.height };
    let points = [p0, p1, p2, p3];
    doGraphClip(points, gameSceneLinesCanvas);

    // å³è¾¹æ¡†
    p0 = { x: gameSceneLinesCanvas.width / 2 + sysConfig.girdSize * 7, y: 0 };
    p1 = { x: gameSceneLinesCanvas.width, y: 0 };
    p2 = { x: gameSceneLinesCanvas.width, y: gameSceneLinesCanvas.height };
    p3 = { x: gameSceneLinesCanvas.width / 2 + sysConfig.girdSize * 7, y: gameSceneLinesCanvas.height };
    points = [p0, p1, p2, p3];
    doGraphClip(points, gameSceneLinesCanvas);
}


// æ‰§è¡Œå›¾å½¢å‰ªåˆ‡
function doGraphClip(points, tCanvas) {
    if (!points) return; // null [] undefined
    let ctx = tCanvas.getContext('2d');
    ctx.save();
    ctx.fillStyle = "#00000000"; // é€æ˜
    ctx.beginPath();
    for (let i = 0; i < points.length; i++) {
        if (i === 0) ctx.moveTo(points[i].x, points[i].y);
        else ctx.lineTo(points[i].x, points[i].y);
    }
    ctx.clip(); // è£å‰ª
    ctx.clearRect(0, 0, tCanvas.width, tCanvas.height); // clip()æŒ‡å®šäº†å‰ªè¾‘åŒºåŸŸï¼Œè¿™é‡Œåªä¼šæ¸…é™¤æŒ‡å®šåŒºåŸŸå†…å®¹
    ctx.fill();
    ctx.restore();
}


// è®¾ç½®åœºæ™¯ä¸»é¢˜
function setSceneTheme() {
    switch (userConfig.sceneThemeMode) {
        case 1: // å†°é›ªä¸»é¢˜
            document.body.style.backgroundColor = '#C7D0E0';
            if (userConfig.isShowSceneGraph) { // æ˜¯å¦æ˜¾ç¤ºåœºæ™¯å›¾å½¢
                // æ¡Œé¢ä¸­å¿ƒå›¾å½¢
                //drawCenterGraphIcon();
                drawCenterGraphSvg("svg-snow");
                // å†°é›ªä¸»é¢˜æ™¯ç‰©å›¾å½¢
                drawIconUpAndDown("ğŸ„", "l", 1);
                drawIconUpAndDown("ğŸ„", "m", 1, true); // éšæœº
                drawIconUpAndDown("ğŸ„", "mm", 1);
                drawIconUpAndDown("ğŸ", "s", 1, true); // éšæœº
                drawIconUpAndDown("ğŸ", "ss", 1);
                drawIconUpAndDown("ğŸ", "xs", 1);
                drawIconUpAndDown("â›„ï¸", "m", 1);
                drawIconUpAndDown("â›„ï¸", "s", 1, true); // éšæœº
                drawIconUpAndDown("â›„ï¸", "ss", 1, true);
                drawIconUpAndDown("â„ï¸", "xs", 2, true);
                drawIconUpAndDown("â„ï¸", "xxs", 4, true);
                drawIconRandom("â„ï¸", "xs", 10);
                drawIconRandom("â„ï¸", "xxs", 10);
                drawIconRandom("â„ï¸", "xxxs", 20);
                drawIconRandom("ğŸ„", "mm", 1);
                drawIconRandom("ğŸ", "xs", 1);
                drawIconRandom("â›„ï¸", "ss", 1);
            }
            break;
        case 2: // æ–°å¹´ä¸»é¢˜
            document.body.style.backgroundColor = '#C7D0E0';
            break;
        case 3: // ç”°å›­ä¸»é¢˜
            document.body.style.backgroundColor = '#E6DD9C';
            if (userConfig.isShowSceneGraph) {
                // èŠ±è‰æ ‘æœ¨ï¼Œé¸¡é¸­é¹…ç‹—çŒªç‰›ç¾Šã€å…ˆåé¡ºåºå¯æ§åˆ¶å›¾å½¢å åŠ æ•ˆæœã€‘
                drawIconUpAndDown("ğŸŒ¹", "xxs", 4, true);
                drawIconRandom("ğŸŒ¹", "xxs", 8);
                drawIconRandom("ğŸŒ¼", "xxs", 5);
                drawIconUpAndDown("ğŸŒ·", "xxs", 4, true);
                drawIconRandom("ğŸŒ·", "xxs", 8);
                drawIconUpAndDown("ğŸŒ»", "mm", 1);
                drawIconRandom("ğŸŒ»", "s", 2);
                drawIconRandom("ğŸ¥•", "xs", 4);
                drawIconRandom("ğŸ„", "xxxs", 4);
                if (isWoodIconShow) drawIconRandom("ğŸªµ", "ss", 2);
                drawIconRandom("ğŸ¥š", "xxs", 5);
                drawIconUpAndDown("ğŸŒ³", "l", 1);
                drawIconRandom("ğŸŒ³", "s", 1);
                drawIconRandom("ğŸ•", "s", 2);
                drawIconRandom("ğŸ–", "m", 1);
                drawIconRandom("ğŸ–", "mm", 1);
                drawIconRandom("ğŸ‚", "l", 1);
                drawIconRandom("ğŸ", "mm", 1);
                drawIconRandom("ğŸ‘", "mm", 1);
                drawIconRandom("ğŸˆ", "ss", 1);
                drawIconRandom("ğŸ‡", "ss", 1);
                drawIconRandom("ğŸ‡", "xs", 1);
                drawIconRandom("ğŸ", "xs", 1);
                drawIconRandom("ğŸŒ", "xxxs", 4);
                drawIconRandom("ğŸ", "xxxs", 4);
                drawIconRandom("ğŸ¦‹", "xxs", 2);
                drawIconUpAndDown("ğŸ“", "ss", 1, false, 1); // åªç”»ä¸Š/å·¦æ–¹
                drawIconRandom("ğŸ“", "ss", 2);
                drawIconRandom("ğŸ¦ƒ", "ss", 4);
                drawIconUpAndDown("ğŸ¦†", "ss", 1, false, 2); // åªç”»ä¸‹/å³æ–¹
                drawIconRandom("ğŸ¦†", "ss", 2);
            }
            break;
        case 4: // æ˜Ÿé™…ä¸»é¢˜
            document.body.style.backgroundColor = '#05132C';
            if (userConfig.isShowSceneGraph) {
                // ç”»æ˜Ÿç³»å…‰äº®
                //drawGalaxyLight();
                // ç”»éšæœºæ˜Ÿç³»å…‰äº®
                globalParams.shadowColor = "#7F9BC2";
                globalParams.shadowBlur = 100 * dpr;
                drawGalaxyLightRandom(null, "mm", 1);
                drawGalaxyLightRandom(null, "s", 2);
                drawGalaxyLightRandom(null, "ss", 2);
                drawGalaxyLightRandom(null, "xs", 5);
                drawGalaxyLightRandom(null, "xxs", 10);
                drawGalaxyLightRandom(null, "xxxs", 15);
                drawIconUpAndDown("ğŸ›°ï¸", "mm", 1);
                drawIconUpAndDown("ğŸŒ", "s", 1, false, 2); // åªç”»ä¸‹/å³æ–¹
                //drawIconRandom("ğŸŒ", "s", 1);
                //drawIconRandom("ğŸŒ•", "xxs", 1); // æœˆçƒä½ç½®åº”è¯¥è·Ÿéšåœ°çƒ
                if (isRingedIconShow)
                    drawIconUpAndDown("ğŸª", "s", 1, false, 2); // åªç”»ä¸‹/å³æ–¹
                drawIconRandom("â˜„ï¸", "ss", 2);
                drawIconRandom("â˜„ï¸", "xs", 2);
                drawIconRandom("â­", "xxs", 10);
                drawIconRandom("â­", "xxxs", 15);
                drawIconRandom("ğŸ›°ï¸", "s", 2);
                drawIconRandom("ğŸš€", "ss", 2);
                //drawIconRandom("ğŸ‘¨â€ğŸš€", "ss", 1);
                //drawIconRandom("ğŸ‘©â€ğŸš€", "ss", 1);
                drawIconUpAndDown("ğŸ‘©â€ğŸš€", "ss", 1, true, 1);
                drawIconUpAndDown("ğŸ‘¨â€ğŸš€", "ss", 1, true, 2);
            }
            break;
        case 5: // å¤æ—¥ä¸»é¢˜
            document.body.style.backgroundColor = '#3C8BBB'; // 00ABDE
            if (userConfig.isShowSceneGraph) {
                // å›¾å½¢å…ˆåé¡ºåºå¯ä»¥æ§åˆ¶å åŠ æ•ˆæœ
                drawIconUpAndDown("ğŸï¸", "l", 1, true);
                //drawIconUpAndDown("ğŸï¸", "xl", 1, false, 1); // åªç”»ä¸Š/å·¦æ–¹
                drawIconUpAndDown("ğŸ›Ÿ", "ss", 1, true); // æ•‘ç”Ÿåœˆ
                drawIconUpAndDown("ğŸŒŠ", "ss", 1, true);
                drawIconUpAndDown("ğŸ–ï¸", "s", 1, true);
                drawIconUpAndDown("ğŸ„", "s", 1, true, 1);
                drawIconUpAndDown("ğŸ„â€â™€ï¸", "s", 1, true, 2);
                drawIconRandom("ğŸ›Ÿ", "ss", 1); // æ•‘ç”Ÿåœˆ
                drawIconRandom("ğŸ„", "s", 1);
                drawIconRandom("ğŸ„â€â™€ï¸", "s", 1);
                drawIconRandom("ğŸŠ", "s", 1);
                drawIconRandom("ğŸŠâ€â™€ï¸", "s", 1);
                drawIconRandom("ğŸŒŠ", "ss", 2);
                drawIconRandom("ğŸŒŠ", "xxs", 5);
                drawIconRandom("ğŸš", "xxxs", 4);
                drawIconRandom("â›µï¸", "m", 2);
                drawIconRandom("ğŸª‚", "m", 2);
                drawIconRandom("ğŸ‹", "m", 1);
                drawIconRandom("ğŸ¦ˆ", "s", 1);
                drawIconRandom("ğŸ¬", "s", 1);
                drawIconRandom("ğŸŸ", "xxs", 15);
                drawIconRandom("ğŸ¦", "xxs", 2);
                drawIconRandom("ğŸ¦€", "xxs", 4);
                drawIconRandom("ğŸ¡", "xxs", 2);
                drawIconRandom("ğŸ™", "xxs", 2);
                drawIconRandom("ğŸ¦‘", "xxs", 2);
                drawIconRandom("ğŸª¼", "xxs", 2); // æ°´æ¯
                drawIconRandom("ğŸª¸", "ss", 2); // çŠç‘š
                drawIconRandom("ğŸª¸", "xxs", 8); // çŠç‘š
                drawIconRandom("ğŸ¢", "ss", 1);
                drawSvgUpAndDown("svg-yl-duck", "s", 1, true);
            }
            break;
        default: // é»˜è®¤ä¸»é¢˜
            document.body.style.backgroundColor = '#7F70C3';
            //sysConfig.sceneLineWidth -= 2; // è¾¹æ¡†çª„ä¸€ç‚¹
            if (userConfig.isShowSceneGraph) {
                // ä¸­å¿ƒå›¾å½¢
                drawCenterGraphSvg("svg-default-center");
                // ç”»çŸ³å¤´
                /*
                if (isRockIconShow) {
                    drawIconUpAndDown("ğŸª¨", "mm", 1);
                    drawIconUpAndDown("ğŸª¨", "s", 1);
                    drawIconRandom("ğŸª¨", "s", 2);
                    drawIconRandom("ğŸª¨", "ss", 6);
                    drawIconRandom("ğŸª¨", "xxs", 15);
                }
                */
                // æ”¹ä¸ºç”»svgçŸ³å¤´
                drawSvgUpAndDown("svg-stone", "s", 1);
                drawSvgUpAndDown("svg-stone", "ss", 1);
                drawSvgUpAndDown("svg-stone", "xxs", 2);
                drawSvgRandom("svg-stone", "ss", 2);
                drawSvgRandom("svg-stone", "xxs", 6);
                // æŒ‡å®šä½ç½®ç”»çŸ³å¤´å’Œéª¨å¤´
                drawStoneGraphDefault();
                // ç”»éª¨å¤´
                drawSvgUpAndDown("svg-bone", "mm", 1, true);
                drawSvgUpAndDown("svg-bone", "s", 1);
                drawSvgRandom("svg-bone", "s", 1);
                drawSvgRandom("svg-bone", "xs", 2);
                drawSvgRandom("svg-bone", "xxs", 6);
            }
    }

    /* é¢å¤–å¤„ç† */
    // é»˜è®¤ä¸»é¢˜å‰ªæ‰å·¦å³è¾¹æ¡†
    //if (userConfig.sceneThemeMode === 0) clipDefaultTableLines();
}


function doDrawTableLines() {
    globalParams.shadowColor = "#352e6160";
    //if (userConfig.sceneThemeMode === 1 && isLightMode) globalParams.shadowColor = "#819BC3"; // å†°é›ªä¸»é¢˜è¾¹æ¡†é˜´å½±
    globalParams.shadowBlur = 6 * dpr;
    drawTableLines();
    globalParams.shadowBlur = 1 * dpr;
    drawTableLines();
}


// è¾¹æ¡†é˜´å½±åªç”¨ç”»ä¸€æ¬¡ï¼Œæ€§èƒ½å½±å“ä¸å¤§
// gameSceneLinesç”»å¸ƒå…¨å±ï¼Œåæ ‡ç§»åˆ°æ­£ä¸­é—´
function drawTableLines() {
    gameSceneLinesContext.save();
    if (globalParams) { // è®¾ç½®é˜´å½±
        gameSceneLinesContext.shadowColor = globalParams.shadowColor;
        gameSceneLinesContext.shadowBlur = globalParams.shadowBlur;
    }
    gameSceneLinesContext.strokeStyle = "#35357A"; // é»˜è®¤ä¸»é¢˜è¾¹æ¡†
    if (userConfig.sceneThemeMode === 1)
        gameSceneLinesContext.strokeStyle = "#EEF0F2"; // å†°é›ªä¸»é¢˜è¾¹æ¡†
    else if (userConfig.sceneThemeMode === 3)
        gameSceneLinesContext.strokeStyle = "#FBFAD0"; // ç”°å›­ä¸»é¢˜è¾¹æ¡†
    else if (userConfig.sceneThemeMode === 4)
        gameSceneLinesContext.strokeStyle = "#D7D7DC"; // æ˜Ÿé™…ä¸»é¢˜è¾¹æ¡† EBEBE9
    else if (userConfig.sceneThemeMode === 5)
        gameSceneLinesContext.strokeStyle = "#FAF9CB"; // å¤æ—¥ä¸»é¢˜è¾¹æ¡† FAF9CB
    let sceneLineRealWidth = roundNumber(sysConfig.sceneLineWidth * dpr, 4); // ä¸åŒè®¾å¤‡å®é™…çº¿å®½
    gameSceneLinesContext.lineWidth = sceneLineRealWidth; // è®¾ç½®çº¿å®½
    // ç§»åŠ¨åæ ‡ç³»åˆ°åœºæ™¯ä¸­å¿ƒ
    gameSceneLinesContext.translate(roundNumber(gameSceneLinesCanvas.width / 2, 4), roundNumber(gameSceneLinesCanvas.height / 2, 4));
    gameSceneLinesContext.beginPath();
    gameSceneLinesContext.moveTo(-sysConfig.girdSize * 4 + sysConfig.wan8CocosTableMoveVals[1], -sysConfig.girdSize * 11 - sceneLineRealWidth / 2); // èµ·ç‚¹ï¼Œå¯¹åº”å·¦ä¸Šç¬¬äºŒä¸ªç‚¹
    gameSceneLinesContext.lineTo(sysConfig.girdSize * 4 + sysConfig.wan8CocosTableMoveVals[2], -sysConfig.girdSize * 11 - sceneLineRealWidth / 2);
    gameSceneLinesContext.lineTo(sysConfig.girdSize * 7 + sceneLineRealWidth / 2, -sysConfig.girdSize * 8 + sysConfig.wan8CocosTableMoveVals[3]);
    gameSceneLinesContext.lineTo(sysConfig.girdSize * 7 + sceneLineRealWidth / 2, sysConfig.girdSize * 8 + sysConfig.wan8CocosTableMoveVals[4]);
    gameSceneLinesContext.lineTo(sysConfig.girdSize * 4 + sysConfig.wan8CocosTableMoveVals[5], sysConfig.girdSize * 11 + sceneLineRealWidth / 3);
    gameSceneLinesContext.lineTo(-sysConfig.girdSize * 4 + sysConfig.wan8CocosTableMoveVals[6], sysConfig.girdSize * 11 + sceneLineRealWidth / 3);
    gameSceneLinesContext.lineTo(-sysConfig.girdSize * 7 - sceneLineRealWidth / 2, sysConfig.girdSize * 8 + sysConfig.wan8CocosTableMoveVals[7]);
    gameSceneLinesContext.lineTo(-sysConfig.girdSize * 7 - sceneLineRealWidth / 2, -sysConfig.girdSize * 8 + sysConfig.wan8CocosTableMoveVals[0]);
    gameSceneLinesContext.closePath(); // é—­åˆè·¯å¾„
    gameSceneLinesContext.stroke();
    gameSceneLinesContext.restore();
}


// ã€ä¸­å¿ƒå¸ƒå±€ICONã€‘
// ä¸­å¿ƒé›ªèŠ±â„ï¸ ç”»åœ¨æ¸¸æˆåœºæ™¯ç”»å¸ƒä¸Š  3 * sysConfig.girdSize â‰¤ height â‰¤ 5 * sysConfig.girdSize
// é›ªèŠ±å› ä¸ºå­—ä½“åŸå› ï¼Œä¼šå‡ºç°ä¸èƒ½å®Œå…¨å±…ä¸­
function drawCenterGraphIcon(icon, size, num) {
    gameSceneContext.save();
    gameSceneContext.fillStyle = "#EEF0F220";
    // æ°´å¹³å¯¹é½æ–¹å¼ (center left right start end)
    gameSceneContext.textAlign = "center";
    // å‚ç›´å¯¹é½çš„æ–¹å¼ (top bottom middle)
    gameSceneContext.textBaseline = 'middle';

    let content = "â„";
    let fontSize = 8;
    let metrics, width, height;

    gameSceneContext.font = fontSize * dpr + "px serif";
    metrics = gameSceneContext.measureText(content);
    width = roundNumber(metrics.width, 4);
    height = roundNumber(metrics.actualBoundingBoxAscent + metrics.actualBoundingBoxDescent, 4);

    while (height > 5 * sysConfig.girdSize) {
        fontSize -= 1;
        gameSceneContext.font = fontSize * dpr + "px serif";
        metrics = gameSceneContext.measureText(content);
        width = roundNumber(metrics.width, 4);
        height = roundNumber(metrics.actualBoundingBoxAscent + metrics.actualBoundingBoxDescent, 4);
        if (fontSize < 1) break; // é¿å… height è®¡ç®—å¼‚å¸¸ï¼Œå¯¼è‡´æ­»å¾ªç¯
    }

    while (height < 3 * sysConfig.girdSize) {
        fontSize += 1;
        gameSceneContext.font = fontSize * dpr + "px serif";
        metrics = gameSceneContext.measureText(content);
        width = roundNumber(metrics.width, 4);
        height = roundNumber(metrics.actualBoundingBoxAscent + metrics.actualBoundingBoxDescent, 4);
        if (fontSize > 50) break; // é¿å… height è®¡ç®—å¼‚å¸¸ï¼Œå¯¼è‡´æ­»å¾ªç¯
    }

    if (fontSize < 1 || fontSize > 50) { // å­—ä½“å¤§å°å¼‚å¸¸
        console.error(">>>> drawTableCenterGraph fontSize error.");
        fontSize = 7;
        gameSceneContext.font = fontSize * dpr + "px serif";
    }

    console.log(">>>> center graph fontSize=" + fontSize + ", width=" + width + ", height=" + height);
    gameSceneContext.fillText(content, gameSceneCanvas.width / 2, gameSceneCanvas.height / 2);
    gameSceneContext.restore();
}


// ã€ä¸­å¿ƒå¸ƒå±€SVGã€‘
// ä¸­å¿ƒé›ªèŠ±â„ï¸ ç”»åœ¨æ¸¸æˆåœºæ™¯ç”»å¸ƒä¸Š  3 * sysConfig.girdSize â‰¤ height â‰¤ 5 * sysConfig.girdSize
function drawCenterGraphSvg(svgId) {
    gameSceneContext.save();
    //gameSceneContext.fillStyle = "#EEF0F220"; // åœ¨ svg ä¸­é…ç½® fill é¢œè‰²ï¼Œè¿™é‡Œè®¾ç½®æ²¡ç”¨
    // æ°´å¹³å¯¹é½æ–¹å¼ (center left right start end)
    gameSceneContext.textAlign = "center";
    // å‚ç›´å¯¹é½çš„æ–¹å¼ (top bottom middle)
    gameSceneContext.textBaseline = 'middle';
    //gameSceneContext.globalCompositeOperation = "source-over";

    let svgEle = document.getElementById(svgId);
    if (!svgEle) return;
    let svg_xml = (new XMLSerializer()).serializeToString(svgEle);
    //console.log(">>>> svg_xml:", svg_xml);
    let img = new Image();
    img.src = "data:image/svg+xml;base64," + window.btoa(svg_xml);
    //console.log(">>>> img.src:", img.src);

    // é¿å…è·å–åˆ° widthã€height ä¸º 0
    img.onload = function () {
        if (!img || !img.width || !img.height) return;
        let scale, width, height;
        scale = getCenterImgScale(img);
        if (scale <= 0) return;
        width = roundNumber(img.width * scale, 4);
        height = roundNumber(img.height * scale, 4);

        gameSceneContext.drawImage(img, gameSceneCanvas.width / 2 - width / 2, gameSceneCanvas.height / 2 - height / 2, width, height); // å¤§å›¾ç¼©å°ï¼Œä¸ä¼šå˜æ¨¡ç³Š
    }
    gameSceneContext.restore();
}


// è·å–ä¸­å¿ƒå›¾å½¢ç¼©æ”¾æ¯”ä¾‹
function getCenterImgScale(img) {
    let scale, width, height;
    scale = 0.5;
    width = img.width;
    height = img.height;
    //console.log(">>>> getCenterImgScale origin width=" + width);

    if (width) {
        while (width > 4.6 * sysConfig.girdSize) {
            scale -= 0.05;
            width = roundNumber(img.width * scale, 4);
            height = roundNumber(img.height * scale, 4);
            if (scale <= 0) break; // é¿å…è®¡ç®—å¼‚å¸¸ï¼Œå¯¼è‡´æ­»å¾ªç¯
        }
        while (width < 3 * sysConfig.girdSize) {
            scale += 0.05;
            width = roundNumber(img.width * scale, 4);
            height = roundNumber(img.height * scale, 4);
            if (scale > 1) break;
        }
    }
    scale = roundNumber(scale, 4);

    //console.log(">>>> getCenterImgScale scale=" + scale);
    //console.log(">>>> getCenterImgScale final width=" + width);
    return scale;
}


// è·å–å­—ç¬¦ã€iconæ˜¾ç¤ºå¤§å°
function getFontSize(begin, end, size) {
    let fontSize = { begin: (begin ? begin : 0), end: (end ? end : 0) };
    if (size === "xl") { fontSize.begin = (fontSize.begin + 2.0) * sysConfig.girdSize; fontSize.end = (fontSize.end + 5) * sysConfig.girdSize; }
    if (size === "l") { fontSize.begin = (fontSize.begin + 1.5) * sysConfig.girdSize; fontSize.end = (fontSize.end + 4) * sysConfig.girdSize; }
    if (size === "ll") { fontSize.begin = (fontSize.begin + 1.0) * sysConfig.girdSize; fontSize.end = (fontSize.end + 3) * sysConfig.girdSize; }
    if (size === "m") { fontSize.begin = (fontSize.begin + 1) * sysConfig.girdSize; fontSize.end = (fontSize.end + 2.3) * sysConfig.girdSize; }
    if (size === "mm") { fontSize.begin = (fontSize.begin + 0.8) * sysConfig.girdSize; fontSize.end = (fontSize.end + 1.8) * sysConfig.girdSize; }
    if (size === "s") { fontSize.begin = (fontSize.begin + 0.6) * sysConfig.girdSize; fontSize.end = (fontSize.end + 1.5) * sysConfig.girdSize; }
    if (size === "ss") { fontSize.begin = (fontSize.begin + 0.4) * sysConfig.girdSize; fontSize.end = (fontSize.end + 0.8) * sysConfig.girdSize; }
    if (size === "xs") { fontSize.begin = (fontSize.begin + 0.3) * sysConfig.girdSize; fontSize.end = (fontSize.end + 0.6) * sysConfig.girdSize; }
    if (size === "xxs") { fontSize.begin = (fontSize.begin + 0.15) * sysConfig.girdSize; fontSize.end = (fontSize.end + 0.4) * sysConfig.girdSize; }
    if (size === "xxxs") { fontSize.begin = (fontSize.begin + 0.10) * sysConfig.girdSize; fontSize.end = (fontSize.end + 0.25) * sysConfig.girdSize; }

    fontSize.begin = Math.round(fontSize.begin);
    fontSize.end = Math.round(fontSize.end);
    return fontSize;
}


// è·å–å›¾å½¢å¯è§†åŒºåŸŸå¤§å°ï¼Œé»˜è®¤ä¸ºåœºåœ°é«˜åº¦çš„ä¸€åŠå·¦å³
function getGraphViewAreaSize() {
    let graphViewAreaSize = roundNumber(sysConfig.girdSize * 5, 4); // 8.5
    if (!os.isPc && sysConfig.cTop * dpr > graphViewAreaSize) graphViewAreaSize = sysConfig.cTop * dpr;
    if (os.isPc && sysConfig.cLeft * dpr > graphViewAreaSize) graphViewAreaSize = sysConfig.cLeft * dpr;
    return Math.round(graphViewAreaSize);
}


// ã€ä¸Šä¸‹å¸ƒå±€ICONã€‘
function drawIconUpAndDown(icon, size, num, isNumRd, posIdx) {
    if (!posIdx) posIdx = 0; // 1-åªç”»ä¸Š/å·¦æ–¹ï¼›2-åªç”»ä¸‹/å³æ–¹ï¼›å…¶ä»–-éƒ½ç”»

    gameSceneEmojiContext.save();
    //gameSceneEmojiContext.fillStyle = "#3ACC57"; // è¿™ä¸ªé¢œè‰²ä¼šè¦†ç›–å›¾å½¢åŸæœ‰é¢œè‰²
    // æ°´å¹³å¯¹é½æ–¹å¼ (center left right start end)
    gameSceneEmojiContext.textAlign = "center";
    // å‚ç›´å¯¹é½çš„æ–¹å¼ (top,bottom,middle)
    gameSceneEmojiContext.textBaseline = 'middle';

    let fontSize = getFontSize(0, 0, size);
    let graphViewAreaSize = getGraphViewAreaSize();
    let metrics, width, height, count;

    if (posIdx !== 2) {
        // ä¸Š/å·¦æ–¹ç©ºç™½åŒºåŸŸ
        if (isNumRd) num = fullCloseInt(0, num);
        for (let i = 0; i < num; i++) {
            gameSceneEmojiContext.font = fullOpen(fontSize.begin, fontSize.end) + "px serif";
            metrics = gameSceneEmojiContext.measureText(icon);
            width = roundNumber(metrics.width, 4);
            height = roundNumber(metrics.actualBoundingBoxAscent + metrics.actualBoundingBoxDescent, 4);
            //console.log(">>>> graph width=" + width + ", height=" + height);
            count = Math.round(sysConfig.cTop * dpr / height); // èƒ½å®¹çº³å¤šå°‘ä¸ª
            if (os.isPc) count = Math.round(sysConfig.cLeft * dpr / width);
            //console.log(">>>> count=" + count);
            // if (count < 1) continue; // ä¸è€ƒè™‘ countï¼Œåˆ™å›¾å½¢å¯ä»¥è¶…å‡ºè¾¹ç•Œ
            //if (!os.isPc) gameSceneEmojiContext.fillText(icon, fullOpen(width / 2, gameSceneEmojiCanvas.width - width / 2), fullOpen(sysConfig.cTop * dpr / 4, sysConfig.cTop * dpr - height));
            //if (os.isPc) gameSceneEmojiContext.fillText(icon, fullOpen(width / 2, sysConfig.cLeft * dpr - width), fullOpen(height / 2, gameSceneEmojiCanvas.height - height / 2));
            if (!os.isPc) gameSceneEmojiContext.fillText(icon, fullOpen(width / 2, gameSceneEmojiCanvas.width - width / 2), fullOpen(sysConfig.cTop * dpr - graphViewAreaSize + height / 2, sysConfig.cTop * dpr - height / 2));
            if (os.isPc) gameSceneEmojiContext.fillText(icon, fullOpen(sysConfig.cLeft * dpr - graphViewAreaSize + width / 2, sysConfig.cLeft * dpr - width / 2), fullOpen(height / 2, gameSceneEmojiCanvas.height - height / 2));
            gameSceneEmojiContext.beginPath();
        }
    }

    if (posIdx !== 1) {
        // ä¸‹/å³æ–¹ç©ºç™½åŒºåŸŸ
        if (isNumRd) num = fullCloseInt(0, num);
        for (let i = 0; i < num; i++) {
            gameSceneEmojiContext.font = fullOpen(fontSize.begin, fontSize.end) + "px serif";
            metrics = gameSceneEmojiContext.measureText(icon);
            width = roundNumber(metrics.width, 4);
            height = roundNumber(metrics.actualBoundingBoxAscent + metrics.actualBoundingBoxDescent, 4);
            count = Math.round(sysConfig.cTop * dpr / height);
            if (os.isPc) count = Math.round(sysConfig.cLeft * dpr / width);
            //if (count < 1) continue;
            //if (!os.isPc) gameSceneEmojiContext.fillText(icon, fullOpen(width / 2, gameSceneEmojiCanvas.width - width / 2), fullOpen(gameSceneEmojiCanvas.height - sysConfig.cTop * dpr + height / 2, gameSceneEmojiCanvas.height - height / 2));
            //if (os.isPc) gameSceneEmojiContext.fillText(icon, fullOpen(gameSceneEmojiCanvas.width - sysConfig.cLeft * dpr + width / 2, gameSceneEmojiCanvas.width), fullOpen(height / 2, gameSceneEmojiCanvas.height - height / 2));
            if (!os.isPc) gameSceneEmojiContext.fillText(icon, fullOpen(width / 2, gameSceneEmojiCanvas.width - width / 2), fullOpen(gameSceneEmojiCanvas.height - sysConfig.cTop * dpr + height / 2, gameSceneEmojiCanvas.height + (graphViewAreaSize - sysConfig.cTop * dpr) - height / 2));
            if (os.isPc) gameSceneEmojiContext.fillText(icon, fullOpen(gameSceneEmojiCanvas.width - sysConfig.cLeft * dpr + width / 2, gameSceneEmojiCanvas.width + (graphViewAreaSize - sysConfig.cLeft * dpr) - width / 2), fullOpen(height / 2, gameSceneEmojiCanvas.height - height / 2));
            gameSceneEmojiContext.beginPath();
        }
    }

    gameSceneEmojiContext.restore();
}


// ã€å…¨å±éšæœºå¸ƒå±€ICONã€‘
function drawIconRandom(icon, size, num, isNumRd, targetCanvas) {
    if (!targetCanvas) targetCanvas = gameSceneEmojiCanvas;
    let ctx = targetCanvas ? targetCanvas.getContext('2d') : gameSceneEmojiContext;
    ctx.save();
    //ctx.fillStyle = "#3ACC57";
    // æ°´å¹³å¯¹é½æ–¹å¼ (center left right start end)
    ctx.textAlign = "center";
    // å‚ç›´å¯¹é½çš„æ–¹å¼ (top,bottom,middle)
    ctx.textBaseline = 'middle';

    // ä¿æŒè·Ÿä¸Šä¸‹å¸ƒå±€ä¸€æ ·
    let fontSize = getFontSize(0, 0, size);

    let metrics, width, height, count;
    if (isNumRd) num = fullCloseInt(1, num);
    for (let i = 0; i < num; i++) {
        ctx.font = fullOpen(fontSize.begin, fontSize.end) + "px serif";
        metrics = ctx.measureText(icon);
        width = roundNumber(metrics.width, 4);
        height = roundNumber(metrics.actualBoundingBoxAscent + metrics.actualBoundingBoxDescent, 4);
        count = Math.round(sysConfig.cTop / height);
        if (count < 1) continue;
        ctx.fillText(icon, fullOpen(width / 2, targetCanvas.width - width / 2), fullOpen(height / 2, targetCanvas.height - height / 2));
        ctx.beginPath();
    }
    ctx.restore();
}


// ã€ä¸Šä¸‹å¸ƒå±€SVGã€‘
function drawSvgUpAndDown(svgId, size, num, isNumRd, posIdx) {
    if (!posIdx) posIdx = 0;

    gameSceneEmojiContext.save();
    gameSceneEmojiContext.fillStyle = "#FAF8F9"; // åœ¨ svg ä¸­é…ç½® fill é¢œè‰²
    // æ°´å¹³å¯¹é½æ–¹å¼ (center left right start end)
    gameSceneEmojiContext.textAlign = "center";
    // å‚ç›´å¯¹é½çš„æ–¹å¼ (top,bottom,middle)
    gameSceneEmojiContext.textBaseline = 'middle';

    let fontSize = getFontSize(0, 0, size);
    let graphViewAreaSize = getGraphViewAreaSize();

    let svg_xml = (new XMLSerializer()).serializeToString(document.getElementById(svgId));
    //console.log(">>>> svg_xml:", svg_xml);
    let img = new Image();
    img.src = "data:image/svg+xml;base64," + window.btoa(svg_xml);
    //console.log(">>>> img.src:", img.src);

    img.onload = function () {
        let scale, width, height, count;
        scale = 1;
        width = img.width;
        height = img.height;

        if (height) {
            if (posIdx !== 2) {
                // ä¸Š/å·¦æ–¹ç©ºç™½åŒºåŸŸ
                if (isNumRd) num = fullCloseInt(1, num);
                for (let i = 0; i < num; i++) {
                    if (i === 0)
                        scale = roundNumber(fullOpen(fontSize.begin, fontSize.end) / (sysConfig.girdSize * 8), 4);
                    else
                        scale = roundNumber(fullOpen(fontSize.begin, fontSize.end) / (sysConfig.girdSize * 10), 4);
                    width = roundNumber(img.width * scale, 4);
                    height = roundNumber(img.height * scale, 4);
                    count = Math.round(sysConfig.cTop * dpr / height);
                    if (os.isPc) count = Math.round(sysConfig.cLeft * dpr / width);
                    //if (count < 1) continue;
                    // éšæœºæ—‹è½¬è§’åº¦ï¼Œ0 ~ 360
                    //let rotate = fullCloseInt(0, 360);
                    //gameSceneEmojiContext.rotate((rotate * Math.PI) / 180);
                    //if (!os.isPc) gameSceneEmojiContext.drawImage(img, 0, 0, img.width, img.height, fullOpen(width / 2, gameSceneEmojiCanvas.width - width / 2), fullOpen(sysConfig.cTop * dpr / 4, sysConfig.cTop * dpr - height / 2), width, height);
                    //if (os.isPc) gameSceneEmojiContext.drawImage(img, 0, 0, img.width, img.height, fullOpen(width / 2, sysConfig.cLeft * dpr - width / 2), fullOpen(height / 2, gameSceneEmojiCanvas.height - height / 2), width, height);
                    if (!os.isPc) gameSceneEmojiContext.drawImage(img, 0, 0, img.width, img.height, fullOpen(width / 2, gameSceneEmojiCanvas.width - width / 2), fullOpen(sysConfig.cTop * dpr - graphViewAreaSize + height / 2, sysConfig.cTop * dpr - height / 2), width, height);
                    if (os.isPc) gameSceneEmojiContext.drawImage(img, 0, 0, img.width, img.height, fullOpen(sysConfig.cLeft * dpr - graphViewAreaSize + width / 2, sysConfig.cLeft * dpr - width / 2), fullOpen(height / 2, gameSceneEmojiCanvas.height - height / 2), width, height);
                    //gameSceneEmojiContext.rotate((-rotate * Math.PI) / 180); // ç”»å®Œä¹‹åæ—‹è½¬å›å»
                    gameSceneEmojiContext.beginPath();
                }
            }

            if (posIdx !== 1) {
                // ä¸‹/å³æ–¹ç©ºç™½åŒºåŸŸ
                if (isNumRd) num = fullCloseInt(1, num);
                for (let i = 0; i < num; i++) {
                    scale = roundNumber(fullOpen(fontSize.begin, fontSize.end) / (sysConfig.girdSize * 10), 4);
                    width = roundNumber(img.width * scale, 4);
                    height = roundNumber(img.height * scale, 4);
                    count = Math.round(sysConfig.cTop * dpr / height);
                    if (os.isPc) count = Math.round(sysConfig.cLeft * dpr / width);
                    //if (count < 1) continue;
                    //if (!os.isPc) gameSceneEmojiContext.drawImage(img, 0, 0, img.width, img.height, fullOpen(width / 2, gameSceneEmojiCanvas.width - width / 2), fullOpen(gameSceneEmojiCanvas.height - sysConfig.cTop * dpr + height / 2, gameSceneEmojiCanvas.height - height / 2), width, height);
                    //if (os.isPc) gameSceneEmojiContext.drawImage(img, 0, 0, img.width, img.height, fullOpen(gameSceneEmojiCanvas.width - sysConfig.cLeft * dpr + width / 2, gameSceneEmojiCanvas.width), fullOpen(height / 2, gameSceneEmojiCanvas.height - height / 2), width, height)
                    if (!os.isPc) gameSceneEmojiContext.drawImage(img, 0, 0, img.width, img.height, fullOpen(width / 2, gameSceneEmojiCanvas.width - width / 2), fullOpen(gameSceneEmojiCanvas.height - sysConfig.cTop * dpr + height / 2, gameSceneEmojiCanvas.height + (graphViewAreaSize - sysConfig.cTop * dpr) - height / 2), width, height);
                    if (os.isPc) gameSceneEmojiContext.drawImage(img, 0, 0, img.width, img.height, fullOpen(gameSceneEmojiCanvas.width - sysConfig.cLeft * dpr + width / 2, gameSceneEmojiCanvas.width + (graphViewAreaSize - sysConfig.cLeft * dpr) - width / 2), fullOpen(height / 2, gameSceneEmojiCanvas.height - height / 2), width, height)
                    gameSceneEmojiContext.beginPath();
                }
            }
        }
    }

    gameSceneEmojiContext.restore();
}


// ã€å…¨å±éšæœºå¸ƒå±€SVGã€‘
function drawSvgRandom(svgId, size, num, isNumRd) {
    gameSceneEmojiContext.save();
    gameSceneEmojiContext.fillStyle = "#FAF8F9"; // åœ¨ svg ä¸­é…ç½® fill é¢œè‰²
    // æ°´å¹³å¯¹é½æ–¹å¼ (center left right start end)
    gameSceneEmojiContext.textAlign = "center";
    // å‚ç›´å¯¹é½çš„æ–¹å¼ (top,bottom,middle)
    gameSceneEmojiContext.textBaseline = 'middle';

    let fontSize = getFontSize(0, 0, size);

    let svg_xml = (new XMLSerializer()).serializeToString(document.getElementById(svgId));
    //console.log(">>>> svg_xml:", svg_xml);
    let img = new Image();
    img.src = "data:image/svg+xml;base64," + window.btoa(svg_xml);
    //console.log(">>>> img.src:", img.src);

    img.onload = function () {
        let scale, width, height, count;
        scale = 1;
        width = img.width;
        height = img.height;

        if (height) {
            if (isNumRd) num = fullCloseInt(1, num);
            for (let i = 0; i < num; i++) {
                if (i % 5 === 1)
                    scale = roundNumber(fullOpen(fontSize.begin, fontSize.end) / (sysConfig.girdSize * 8), 4);
                else
                    scale = roundNumber(fullOpen(fontSize.begin, fontSize.end) / (sysConfig.girdSize * 10), 4);
                width = roundNumber(img.width * scale, 4);
                height = roundNumber(img.height * scale, 4);
                count = Math.round(sysConfig.cTop * dpr / height);
                if (os.isPc) count = Math.round(sysConfig.cLeft * dpr / width);
                //if (count < 1) continue;
                gameSceneEmojiContext.drawImage(img, 0, 0, img.width, img.height, fullOpen(width / 2, gameSceneEmojiCanvas.width - width / 2), fullOpen(height / 2, gameSceneEmojiCanvas.height - height / 2), width, height);
                gameSceneEmojiContext.beginPath();
            }
        }
    }

    gameSceneEmojiContext.restore();
}


// ã€æŒ‡å®šä½ç½®ç”»SVGã€‘
function drawSvgWithPos(svgId, size, pos) {
    gameSceneEmojiContext.save();
    // æ°´å¹³å¯¹é½æ–¹å¼ (center left right start end)
    gameSceneEmojiContext.textAlign = "center";
    // å‚ç›´å¯¹é½çš„æ–¹å¼ (top,bottom,middle)
    gameSceneEmojiContext.textBaseline = 'middle';
    gameSceneEmojiContext.beginPath();

    // åæ ‡ç³»ç§»åŠ¨åˆ°ä¸­å¿ƒ
    gameSceneEmojiContext.translate(roundNumber(gameSceneEmojiCanvas.width / 2, 4), roundNumber(gameSceneEmojiCanvas.height / 2, 4));
    // å…·ä½“æ“ä½œ
    doDrawSvgWithPos(svgId, size, pos);

    gameSceneEmojiContext.restore();
}

function doDrawSvgWithPos(svgId, size, pos) {
    let svg_xml = (new XMLSerializer()).serializeToString(document.getElementById(svgId));
    //console.log(">>>> svg_xml:", svg_xml);
    let img = new Image();
    img.src = "data:image/svg+xml;base64," + window.btoa(svg_xml);
    //console.log(">>>> img.src:", img.src);

    img.onload = function () {
        let scale, width, height;
        scale = roundNumber(size / (sysConfig.girdSize * 10), 4);
        width = roundNumber(img.width * scale, 4);
        height = roundNumber(img.height * scale, 4);
        gameSceneEmojiContext.drawImage(img, pos.x, pos.y, width, height);
    }
}


// é»˜è®¤ä¸»é¢˜æŒ‡å®šä½ç½®ç”»çŸ³å¤´
function drawStoneGraphDefault() {
    gameSceneEmojiContext.save();
    // æ°´å¹³å¯¹é½æ–¹å¼ (center left right start end)
    gameSceneEmojiContext.textAlign = "center";
    // å‚ç›´å¯¹é½çš„æ–¹å¼ (top,bottom,middle)
    gameSceneEmojiContext.textBaseline = 'middle';
    gameSceneEmojiContext.beginPath();
    // è®¾ç½®é˜´å½±
    gameSceneEmojiContext.shadowColor = "#2D2560";
    gameSceneEmojiContext.shadowBlur = 20 * dpr;

    // å·¦ä¸Šè§’
    // åŸå§‹åæ ‡ç‚¹
    let pos0 = { x: sysConfig.cLeft * dpr - sysConfig.girdSize * 0.8, y: sysConfig.cTop * dpr + sysConfig.girdSize * 0.5 };
    doDrawSvgWithPos("svg-stone", sysConfig.girdSize * fullOpen(1, 2), pos0);
    // ç›¸å¯¹åŸå§‹åæ ‡ç§»åŠ¨
    let pos01 = { x: pos0.x + sysConfig.girdSize * 1.6, y: pos0.y + sysConfig.girdSize * 0.1 };
    doDrawSvgWithPos("svg-stone", sysConfig.girdSize * fullOpen(0, 1.4), pos01);
    let pos02 = { x: pos0.x - sysConfig.girdSize * 0.2, y: pos0.y + sysConfig.girdSize * 1.4 };
    doDrawSvgWithPos("svg-stone", sysConfig.girdSize * fullOpen(0, 1.4), pos02);
    // å³ä¸Šè§’
    pos0 = { x: sysConfig.cLeft * dpr + sysConfig.girdSize * 11, y: sysConfig.cTop * dpr - sysConfig.girdSize * 0.5 };
    doDrawSvgWithPos("svg-stone", sysConfig.girdSize * fullOpen(1, 2), pos0);
    // ç›¸å¯¹åŸå§‹åæ ‡ç§»åŠ¨
    pos01 = { x: pos0.x - sysConfig.girdSize * 0.6, y: pos0.y - sysConfig.girdSize * 0.2 };
    doDrawSvgWithPos("svg-stone", sysConfig.girdSize * fullOpen(0, 1.4), pos01);
    pos02 = { x: pos0.x + sysConfig.girdSize * 1.6, y: pos0.y + sysConfig.girdSize * 1.4 };
    //doDrawSvgWithPos("svg-stone", sysConfig.girdSize * fullOpen(0, 1.2), pos02);
    // å·¦ä¸‹è§’
    pos0 = { x: sysConfig.cLeft * dpr + sysConfig.girdSize * 0.2, y: sysConfig.cTop * dpr + sysConfig.girdSize * 20 };
    doDrawSvgWithPos("svg-stone", sysConfig.girdSize * fullOpen(1, 2), pos0);
    // ç›¸å¯¹åŸå§‹åæ ‡ç§»åŠ¨
    pos01 = { x: pos0.x - sysConfig.girdSize * 1.0, y: pos0.y + sysConfig.girdSize * 1.3 };
    //doDrawSvgWithPos("svg-stone", sysConfig.girdSize * fullOpen(0, 1.4), pos01);
    pos02 = { x: pos0.x + sysConfig.girdSize * 1.2, y: pos0.y + sysConfig.girdSize * 1.0 };
    doDrawSvgWithPos("svg-stone", sysConfig.girdSize * fullOpen(0, 1.2), pos02);
    // å³ä¸‹è§’
    pos0 = { x: sysConfig.cLeft * dpr + sysConfig.girdSize * 13, y: sysConfig.cTop * dpr + sysConfig.girdSize * 18 };
    doDrawSvgWithPos("svg-stone", sysConfig.girdSize * fullOpen(1, 2), pos0);
    // ç›¸å¯¹åŸå§‹åæ ‡ç§»åŠ¨
    pos01 = { x: pos0.x - sysConfig.girdSize * 1.0, y: pos0.y + sysConfig.girdSize * 1.2 };
    doDrawSvgWithPos("svg-stone", sysConfig.girdSize * fullOpen(0, 1.4), pos01);
    pos02 = { x: pos0.x - sysConfig.girdSize * 0.6, y: pos0.y + sysConfig.girdSize * 2 };
    //doDrawSvgWithPos("svg-stone", sysConfig.girdSize * fullOpen(0, 1.0), pos02);

    gameSceneEmojiContext.restore();
}


// é»˜è®¤ä¸»é¢˜æŒ‡å®šä½ç½®ç”»éª¨å¤´
function drawBoneGraphDefault() {

}


// æ˜Ÿé™…ä¸»é¢˜ç”»æ˜Ÿç³»å…‰äº®
function drawGalaxyLight() {
    gameSceneGraphContext.save();
    // éšæœºæ—‹è½¬è§’åº¦ï¼Œ0 ~ 360
    let rotate = fullCloseInt(0, 360);
    gameSceneGraphContext.rotate((rotate * Math.PI) / 180);
    // é˜´å½±
    gameSceneGraphContext.shadowColor = '#7F9BC2';
    gameSceneGraphContext.shadowBlur = 700;
    // æ¸å˜
    //let grd = gameSceneGraphContext.createLinearGradient(0.9 * gameSceneGraphCanvas.width, 0.1 * gameSceneGraphCanvas.height,0.1 * gameSceneGraphCanvas.width, 0.9 * gameSceneGraphCanvas.height);
    //grd.addColorStop(0, "#05132C");
    //grd.addColorStop(0.5, "#05132C");
    //grd.addColorStop(1, "#EEF0F2");
    gameSceneGraphContext.beginPath();
    gameSceneGraphContext.moveTo(0.9 * gameSceneGraphCanvas.width, 0.01 * gameSceneGraphCanvas.height); // èµ·ç‚¹
    gameSceneGraphContext.quadraticCurveTo(0.8 * gameSceneGraphCanvas.width, 0.4 * gameSceneGraphCanvas.height, 0.01 * gameSceneGraphCanvas.width, 0.6 * gameSceneGraphCanvas.height);
    gameSceneGraphContext.quadraticCurveTo(0.78 * gameSceneGraphCanvas.width, 0.4 * gameSceneGraphCanvas.height, 0.9 * gameSceneGraphCanvas.width, 0.01 * gameSceneGraphCanvas.height);

    gameSceneGraphContext.lineWidth = 2 * dpr; // è®¾ç½®çº¿å®½
    gameSceneGraphContext.fillStyle = "#EEF0F2"; // è®¾ç½®é¢œè‰²
    //gameSceneGraphContext.fillStyle = grd; // ä½¿ç”¨æ¸å˜
    //gameSceneGraphContext.strokeStyle = "#EEF0F2"; // è®¾ç½®é¢œè‰²
    //gameSceneGraphContext.stroke();
    gameSceneGraphContext.fill();
    gameSceneGraphContext.restore();
}


// æ˜Ÿé™…ä¸»é¢˜å…¨å±éšæœºç”»æ˜Ÿç³»å…‰äº®
function drawGalaxyLightRandom(icon, size, num, isNumRd) {
    gameSceneGraphContext.save();

    let fontSize = getFontSize(0, 0, size);

    if (globalParams) { // è®¾ç½®é˜´å½±
        gameSceneGraphContext.shadowColor = globalParams.shadowColor;
        gameSceneGraphContext.shadowBlur = globalParams.shadowBlur;
    }
    // æ¸å˜
    //let grd = gameSceneGraphContext.createLinearGradient(0.9 * gameSceneGraphCanvas.width, 0.1 * gameSceneGraphCanvas.height,0.1 * gameSceneGraphCanvas.width, 0.9 * gameSceneGraphCanvas.height);
    let grd, x, y, r;
    if (isNumRd) num = fullCloseInt(1, num);
    for (let i = 0; i < num; i++) {
        r = roundNumber(fullOpen(fontSize.begin, fontSize.end) / 2, 4);
        x = fullOpen(r, gameSceneEmojiCanvas.width - r);
        y = fullOpen(r, gameSceneEmojiCanvas.height - r);
        grd = gameSceneGraphContext.createRadialGradient(x, y, 0.1 * r, x, y, r);
        grd.addColorStop(0.1, "#EEF0F2F0");
        grd.addColorStop(0.5, "#EEF0F280");
        grd.addColorStop(1, "#EEF0F200");
        gameSceneGraphContext.beginPath();
        //gameSceneGraphContext.arc(this.x0, this.y0, this.pathRadius, Math.PI / 180 * 0, Math.PI / 180 * 360);
        gameSceneGraphContext.arc(x, y, r, 0, Math.PI * 2, true);
        //gameSceneGraphContext.fillStyle = "#EEF0F2"; // è®¾ç½®é¢œè‰²
        gameSceneGraphContext.fillStyle = grd; // ä½¿ç”¨æ¸å˜
        gameSceneGraphContext.fill();
    }
    gameSceneGraphContext.restore();
}


// ç”»åœºåœ°ä¸Šå¤§é¢ç§¯æ™¯ç‰©å›¾å½¢ã€ä¸å¥½ç”»ï¼Œä»¥åå†æã€‘
function drawSceneGraph(icon, size) {
    gameSceneGraphContext.save();
    let topLeftRatio = roundNumber(sysConfig.cTop / sysConfig.cLeft * 1.6, 4);
    //console.log(">>>> topLeftRatio=" + topLeftRatio);
    // é˜´å½±
    gameSceneGraphContext.shadowColor = '#7F9BC2';
    gameSceneGraphContext.shadowBlur = 15;
    gameSceneGraphContext.beginPath();
    //gameSceneGraphContext.moveTo(0.4 * sysConfig.cLeft, 0.4 * sysConfig.cLeft * topLeftRatio); // èµ·ç‚¹
    //gameSceneGraphContext.quadraticCurveTo(gameSceneGraphCanvas.width / 8 - 0.4 * sysConfig.cLeft, 0.3 * sysConfig.cLeft * topLeftRatio, gameSceneGraphCanvas.width / 2.4 - 0.4 * sysConfig.cLeft, 0.35 * sysConfig.cLeft * topLeftRatio);

    gameSceneGraphContext.fillStyle = "#EEF0F2"; // è®¾ç½®é¢œè‰²
    //gameSceneGraphContext.strokeStyle = "#EEF0F2"; // è®¾ç½®é¢œè‰²
    //gameSceneGraphContext.stroke();
    gameSceneGraphContext.fill();
    gameSceneGraphContext.restore();
}


// ç”»è›‹
function drawEggs() {
    //console.log(eggs);
    if (!eggs || eggs.length < 1) return;
    for (let i = 0; i < eggs.length; i++) {
        gameSceneContext.save();
        gameSceneContext.beginPath();
        gameSceneContext.arc(eggs[i].x, eggs[i].y, eggs[i].radius, Math.PI / 180 * 0, Math.PI / 180 * 360);
        gameSceneContext.lineWidth = 2 * dpr;
        gameSceneContext.strokeStyle = eggs[i].color;
        //gameSceneContext.setLineDash([3, 3]); // è™šçº¿
        gameSceneContext.closePath();
        gameSceneContext.stroke(); // ç©ºå¿ƒ
        gameSceneContext.restore();
    }
}


//////////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////////
// ã€é€‰æ‹©è§’è‰²ã€å‚æ•°è®¾ç½®ã€‘ å˜é‡ã€æ–¹æ³•åŒºåŸŸ
//////////////////////////////////////////////////////////////////////

// é€‰æ‹©è§’è‰²
function chooseRole(ele, roleId) {

    // é€‰è§’è‰²å¼€å§‹ä¹‹å‰ï¼Œå…ˆè¾“å…¥è®¿é—®å¯†é’¥ï¼Œæˆæƒè®¿é—®
    if (!checkCoreCode("do2BallsCollidedMV2", true)) return;

    //console.log(">>>> collide-try-role-chose: " + roleId);
    //if (roleId === Role.SHUANGZI.id) {alert("ğŸ‘¬ï¼šæ•¬è¯·æœŸå¾…~å“ˆå“ˆå“ˆå“ˆğŸ˜„"); return;}
    if (roleId === Role.YOUXIA.id) { alert("ğŸ¹ï¼šå’±æœ‰ç»ƒçš„å¿…è¦å—ï¼ŸğŸ¤”"); return; }
    if (roleId === Role.HUAQIANJI.id) { alert("ğŸš€ï¼šç‚®å¼¹åå¼¹ä¸€æ¬¡éƒ½ä¸ä¼šå—ï¼ŸğŸ˜‚"); return; }

    userConfig.currRole = roleId;
    userConfig.isRandomRole = false;
    userConfig.isFlashRole = false;

    if (roleId === -2) { // æé€Ÿå¼€å§‹ï¼Œé‡‡ç”¨è®¾ç½®é‡Œé¢é…ç½®çš„è§’è‰²ã€‚å¦‚æœæ²¡æœ‰é…ç½®ï¼Œåˆ™ä½¿ç”¨å¸¸ç”¨ç»„åˆ
        userConfig.isFlashRole = true;
        setRolesFlash(userConfig.gameRoleIds, true);
    } else if (roleId < 0) { // éšæœºè§’è‰²ï¼Œå®Œå…¨éšæœº
        roleId = Role.getRandomRoleId();
        userConfig.currRole = roleId;
        userConfig.isRandomRole = true;
    }

    // å­˜åˆ° sessionStorageã€PCæµè§ˆå™¨åˆ·æ–°ä¸ä¼šå¤±æ•ˆï¼Œå…³é—­é¡µé¢ä¼šå¤±æ•ˆã€‘
    //if (userConfig.currRole > -1) sessionStorage.setItem('collide-try-role-chose', userConfig.currRole);
    // TODO å­˜åˆ° localStorageï¼Œå…¼å®¹ä¸€äº›æµè§ˆå™¨ï¼ˆViaï¼‰åˆ·æ–°å sessionStorage å¤±æ•ˆï¼Œå¯¼è‡´ä¸€ç›´å¼¹å‡ºé€‰æ‹©è§’è‰²é—®é¢˜
    if (userConfig.currRole > -1) localStorage.setItem('collide-try-role-chose', userConfig.currRole);
    // æ›´æ–° localStorage ä¸­çš„ userConfig
    if (userConfig.currRole > -1) localStorage.setItem('collide-try-user-settings', JSON.stringify(userConfig));
    // åˆ·æ–°é¡µé¢
    location.reload();
}


// å¼¹çª—é€‰æ‹©è§’è‰²æ˜¯å¦å®Œæˆ
function isRoleChooseFinished() {
    let choseRoleIdStr = sessionStorage.getItem('collide-try-role-chose');
    if (!choseRoleIdStr) choseRoleIdStr = localStorage.getItem('collide-try-role-chose');
    if (!choseRoleIdStr) return false;
    if (Number(choseRoleIdStr) > -1) return true;
    return false;
}


// åˆ¤æ–­æŒ‡å®šå¼¹çª—æ˜¯å¦æ­£åœ¨æ˜¾ç¤º
function isDialogShowing(dialogEle) {
    let isShowing = false;
    if (dialogEle && dialogEle.style.display && dialogEle.style.display !== "none") { // æ­£åœ¨æ˜¾ç¤º
        isShowing = true;
    }
    return isShowing;
}


// åˆ‡æ¢å¼¹çª—æ˜¾ç¤ºæˆ–éšè—
function switchDialogShow(dialogEle, isShow, params) {
    //console.log(dialogEle);
    if (!params) params = { display: "unset" };
    if (!params.display) params.display = "unset";
    if (!dialogEle && params.dialogEleId) dialogEle = document.getElementById(params.dialogEleId);
    if (!dialogEle) return;
    if (isShow) { // æ˜¾ç¤ºï¼Œdisplay æœ‰å¤šç§å€¼å¯ä»¥è®©å…ƒç´ æ˜¾ç¤º
        dialogEle.style.display = params.display;
    } else { // å…³é—­
        dialogEle.style.display = "none";
    }
}


// æ˜¾ç¤ºå³ä¸Šè§’è®¾ç½®å…¥å£æç¤º
function showGameSettingEntryDialog() {
    // æœ‰å…¶ä»–å¼¹çª—æ—¶ï¼Œä¸æ˜¾ç¤º
    if (isDialogShowing(chooseRoleDialog) || isDialogShowing(userSettingDialog)) return;
    let t0 = localStorage.getItem('collide-try-game-settings-entry-time');
    if (!t0) t0 = "0";
    t0 = Number(t0);
    if (t0 > 0) { // å·²ç»å¼¹è¿‡æç¤ºäº†ï¼Œä¸å†æç¤º
        return;
    }
    switchDialogShow(gameSettingEntryDialog, true);
}


// å…³é—­å³ä¸Šè§’è®¾ç½®å…¥å£æç¤ºï¼Œä¸å†æç¤º
function closeGameSettingEntryDialog() {
    switchDialogShow(gameSettingEntryDialog, false, { display: "none" });
    localStorage.setItem('collide-try-game-settings-entry-time', new Date().getTime());
}


// æ˜¾ç¤ºè®¾ç½®ä¸»è§’æç¤º
function showGameSettingMainRoleDialog() {
    // æœ‰å‚æ•°è®¾ç½®å¼¹çª—æ—¶ï¼Œæ‰æ˜¾ç¤º
    if (!isDialogShowing(userSettingDialog)) return;
    let t0 = localStorage.getItem('collide-try-game-settings-main-role-time');
    if (!t0) t0 = "0";
    t0 = Number(t0);
    if (t0 > 0) { // å·²ç»å¼¹è¿‡æç¤ºäº†ï¼Œä¸å†æç¤º
        return;
    }
    switchDialogShow(gameSettingMainRoleDialog, true);
}


// å…³é—­è®¾ç½®ä¸»è§’æç¤ºï¼Œä¸å†æç¤º
function closeGameSettingMainRoleDialog() {
    switchDialogShow(gameSettingMainRoleDialog, false, { display: "none" });
    localStorage.setItem('collide-try-game-settings-main-role-time', new Date().getTime());
}


// æ˜¾ç¤ºæ›´æ–°å†…å®¹
function showUpdateContent(isShow) {
    if (isShow) { // æ˜¾ç¤º
        // å…ˆå‡å°‘æ˜¾ç¤ºé€‰æ‹©è§’è‰²å¼¹çª—é«˜åº¦ï¼Œé¿å…å†…å®¹é‡å 
        chooseRoleDialog.style.height = "0%";
        updateContentDialog.style.display = "unset";
    } else { // å…³é—­
        updateContentDialog.style.display = "none";
        chooseRoleDialog.style.height = "max-content";
    }
}


// æ˜¾ç¤ºä¸€æ¬¡æ“ä½œæŒ‡å—å¼¹çª—
function showHowToPlay(isShow) {
    if (isShow) { // æ˜¾ç¤º
        // åªæç¤ºä¸€æ¬¡
        let howToPlayTimeStr = localStorage.getItem('collide-try-how-to-play-time');
        if (howToPlayTimeStr) return;
        // æœ‰å…¶ä»–å¼¹çª—æ—¶ï¼Œä¸æ˜¾ç¤º
        if (isDialogShowing(chooseRoleDialog) || isDialogShowing(userSettingDialog)) return;
        howToPlayDialog.style.display = "unset";
        dialogMask.style.display = "unset";
    } else { // å…³é—­
        howToPlayDialog.style.display = "none";
        dialogMask.style.display = "none";
        // è®¾ç½®å¼¹çª—æ—¶é—´ï¼Œç”¨æ¥åˆ¤æ–­æ˜¯å¦æ˜¾ç¤ºè¿‡
        localStorage.setItem('collide-try-how-to-play-time', new Date().getTime());
        /*
        // é¦–æ¬¡è¿›å…¥æ¸¸æˆï¼Œæ“ä½œæŒ‡å—å…³é—­ä¹‹åï¼Œç›´æ¥è¿›å…¥ä¸€æ¬¡è®¾ç½®
        let localUserConfigTimeStr = localStorage.getItem('collide-try-user-settings-time');
        if (!localUserConfigTimeStr) {
            switchUserSettingDialog(true);
        }
        */
        // æ˜¾ç¤ºå³ä¸Šè§’è®¾ç½®å…¥å£æç¤º
        showGameSettingEntryDialog();
    }
}


// åˆ‡æ¢æ˜¾ç¤ºç”¨æˆ·è®¾ç½®å¼¹çª—
function switchUserSettingDialog(isShow) {
    if (isShow) { // æ˜¾ç¤º
        // åˆå§‹åŒ–é¡µé¢é»˜è®¤å€¼
        initUserSettingDialogVal();
        dialogMask.style.display = "unset";
        userSettingDialog.style.display = "unset";
        if (isDialogShowing(chooseRoleDialog)) { // æ­£åœ¨æ˜¾ç¤ºé€‰è§’è‰²å¼¹çª—
            // å…ˆå‡å°‘æ˜¾ç¤ºé€‰æ‹©è§’è‰²å¼¹çª—é«˜åº¦ï¼Œé¿å…å†…å®¹é‡å 
            chooseRoleDialog.style.height = "1%";
        }
    } else { // å…³é—­
        userSettingDialog.style.display = "none";
        if (isDialogShowing(chooseRoleDialog)) {
            // åªæ›´æ–°è®¾ç½®æ—¶é—´ï¼Œä½†ä¸åˆ·æ–°é¡µé¢
            reloadAfterUserConfigSettingFinished(new Date().getTime(), false);
            // å…³é—­å‚æ•°è®¾ç½®å¼¹çª—åï¼Œå†é‡æ–°æ¢å¤é€‰æ‹©è§’è‰²å¼¹çª—åŸæœ¬é«˜åº¦
            chooseRoleDialog.style.height = "max-content";
        } else {
            // å…³é—­é®ç½©
            dialogMask.style.display = "none";
            // æ›´æ–°è®¾ç½®æ—¶é—´ï¼Œåˆ·æ–°é¡µé¢
            reloadAfterUserConfigSettingFinished(new Date().getTime(), true);
        }
    }
}


// åˆ‡æ¢æ˜¾ç¤ºcanvaså›¾å±‚å…ƒç´ 
function switchCanvasShow(canvasEle, isShow) {
    if (!canvasEle) return;

    // å¼€å¯æˆ–å…³é—­åœºæ™¯è¾¹æ¡†ï¼Œå¦‚æœç –æ ¼åæ ‡å·²ç»åœ¨æ˜¾ç¤ºï¼Œç –æ ¼åæ ‡éœ€è¦æ¸…ç©ºé‡ç”»
    if (canvasEle === gameSceneLinesCanvas) {
        if (userConfig.isShowGridCoordinate) {
            clearCanvasAll(gameSceneCoordinateCanvas);
            drawSceneCoordinate();
        }
    }

    if (isShow) { // æ˜¾ç¤º
        // å¼€å¯åœºæ™¯è¾¹æ¡†ï¼Œæœ€å¥½æ¸…ç©ºé‡ç”»ä¸€æ¬¡ï¼Œé¿å…ä¹‹å‰æ²¡ç”»
        if (canvasEle === gameSceneLinesCanvas) {
            clearCanvasAll(gameSceneLinesCanvas);
            doDrawTableLines();
        }
        // å¼€å¯ç –æ ¼åæ ‡ï¼Œæœ€å¥½æ¸…ç©ºé‡ç”»ä¸€æ¬¡ï¼Œé¿å…æ˜¾ç¤ºæ²¡æœ‰è¾¹æ¡†æ—¶ä½ç½®
        if (canvasEle === gameSceneCoordinateCanvas) {
            clearCanvasAll(gameSceneCoordinateCanvas);
            drawSceneCoordinate();
        }
        canvasEle.style.display = "inherit";
    } else { // å…³é—­
        canvasEle.style.display = "none";
    }
}


// åˆå§‹åŒ–è§’è‰²å‚æ•°å¼¹çª—å˜é‡å€¼
function initUserSettingDialogVal() {
    try {
        let ele;
        for (let f in userConfig) {
            //console.log(f + " = " + userConfig[f]);
            ele = document.getElementById(f);
            if (f === "currRole") {

            } else if (f === "sceneThemeMode") { // ä¸»é¢˜åç§°
                setSceneThemeText(userConfig[f]);
            } else if (f === "mainTeamColor") { // ä¸»è§’æ‰€åœ¨é˜Ÿé¢œè‰²
                setMainTeamColorText(userConfig[f]);
            } else if (f === "gameRoleIds") { // æŒ‡å®šè§’è‰²åç§°
                setGameRoleIdsText(userConfig[f]);
            } else if (f === "shareRoleAndPos") { // å¯¼å…¥/å¯¼å‡ºè§’è‰²å’Œåæ ‡
                setShareContent(userConfig[f]);
            } else if (typeof userConfig[f] === "string" || typeof userConfig[f] === "number" || userConfig[f] instanceof Array) { // å­—ç¬¦ä¸²ã€æ•°å€¼ã€æ•°ç»„ç±»å‹
                if (ele && userConfig[f]) ele.value = userConfig[f].toString();
            } else if (typeof userConfig[f] === "boolean") { // å¸ƒå°”ç±»å‹
                if (f === "isShowBallMovePath") togglePathBallMoveShow(userConfig[f]); // åˆ‡æ¢è¿åŠ¨è·¯å¾„å±‚æ˜¾ç¤ºæˆ–éšè—
                if (f === "isShowBallPath") togglePathBallShow(userConfig[f]); // åˆ‡æ¢å…¨è·¯å¾„å±‚æ˜¾ç¤ºæˆ–éšè—
                if (!ele) continue;
                if (userConfig[f]) ele.setAttribute("checked", true);
                else ele.removeAttribute("checked");
            }
        }

        // è¾“å…¥äº†æ­£ç¡®çš„è®¿é—®å¯†é’¥æ‰æ˜¾ç¤ºã€ä¸‹è½½ç¦»çº¿ç‰ˆã€‘
        // vue æš‚æ—¶ä¸æ”¯æŒä¿å­˜  && !isVue()
        if (checkAccessKey()) {
            document.getElementById("collide-try-save-html").style.display = "list-item";
        } else {
            document.getElementById("collide-try-save-html").style.display = "none";
        }

        // å‘Šåˆ«ä¿¡æ¯
        if (sysConfig.isSayGoodbye) {
            let eles = document.getElementsByClassName("collide-try-goodbye") || [];
            for (let i = 0, len = eles.length; i < len; i++) {
                eles[i].style.display = "inherit"; // ç»§æ‰¿çˆ¶æ ‡ç­¾displayå±æ€§
            }
        }

    } catch (e) { // userConfig é…ç½®ä¸­ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰å­—æ®µéƒ½å¯¹åº”äº†é¡µé¢è®¾ç½®ï¼Œdocument.getElementById(f) æ‰¾ä¸åˆ°ä¼šæŠ¥å¼‚å¸¸ï¼Œå¯ä»¥å¿½ç•¥
        doGlobalError(e, (sysConfig && sysConfig.alertErrorCount) ? sysConfig.alertErrorCount : 3);
    }
}


// åˆ‡æ¢æ˜¾ç¤ºswitchå¼€å…³ï¼Œå¹¶è®¾ç½®å‚æ•°å€¼
function switchCheckbox(label, key, params) {
    if (!label) return;
    //console.log(label);
    // åˆ¤æ–­æ˜¯å¦å·²é€‰æ‹©
    //let switchEle = document.getElementById(key);
    //let switchEle = label.firstElementChild;
    //let switchEle = label.target.firstElementChild;
    let switchEle = document.getElementById(key);
    let checked = switchEle.getAttribute("checked");
    //console.log(checked);
    //console.log(">>>> userConfig: ", userConfig);
    let isShow = false;
    if (checked) { // å¼€å…³å·²æ‰“å¼€ï¼Œç‚¹å‡»åå…³é—­
        switchEle.removeAttribute("checked");
        isShow = false;
        userConfig[key] = false;
        if (key === "isKuileiPullBack") userConfig.isKuileiPullBack = false;
        if (key === "isShowBallMovePath") { // è§’è‰²è¿åŠ¨è·¯å¾„å…³é—­ï¼Œå…³è”çš„è§’è‰²å…¨è·¯å¾„ä¹Ÿä¸€èµ·å…³é—­
            userConfig.isShowBallPath = false;
            document.getElementById("isShowBallPath").removeAttribute("checked");
            togglePathBallShow(isShow);
        }
    } else { // å¼€å…³æœªæ‰“å¼€ï¼Œç‚¹å‡»åæ‰“å¼€
        switchEle.setAttribute("checked", true);
        isShow = true;
        userConfig[key] = true;
        if (key === "isShowBallPath") { // è§’è‰²å…¨è·¯å¾„æ‰“å¼€ï¼Œä¾èµ–çš„è§’è‰²è¿åŠ¨è·¯å¾„ä¹Ÿä¸€èµ·æ‰“å¼€
            userConfig.isShowBallMovePath = true;
            document.getElementById("isShowBallMovePath").setAttribute("checked", true);
            togglePathBallMoveShow(isShow);
        }
    }

    // canvaså›¾å±‚åˆ‡æ¢æ˜¾ç¤º
    if (params && params.canvasEle) switchCanvasShow(params.canvasEle, isShow);
    // è§’è‰²è¿åŠ¨è·¯å¾„
    if (key === "isShowBallMovePath") togglePathBallMoveShow(isShow);
    // è§’è‰²çƒä½“è·¯å¾„
    if (key === "isShowBallPath") togglePathBallShow(isShow);
    // è¡€é‡æ¡åˆ‡æ¢æ˜¾ç¤º
    if (key === "isShowRoleBloodLine") directPlayAgain(false);
    // åªæ˜¾ç¤ºæ’å‡»å°é¢
    if (key === "isJustShowTable") {
        toggleOnlyTable(isShow);
        if (!balls || balls.length < 1) sysConfig.isNeedReload = true;
    }
    // åˆ‡æ¢æ˜¾ç¤ºåœºæ™¯å›¾å½¢
    if (key === "isShowSceneGraph") toggleSceneGraph(isShow);

    // éœ€è¦åˆ·æ–°é¡µé¢çš„è®¾ç½®
    if (key === "isTestOnlyOne") sysConfig.isNeedReload = true;

    // localStorage å­˜å‚¨æ›´æ–° userConfig å¯¹è±¡
    localStorage.setItem('collide-try-user-settings', JSON.stringify(userConfig));

}


// ç‚¹å‡»æŒ‰é’®ï¼Œä¸‹æ‹‰èœå•åœ¨ æ˜¾ç¤º/éšè— ä¹‹é—´åˆ‡æ¢
function toggleDropdown() {
    document.getElementById("themeDropdown").classList.toggle("show");
}


// åˆ‡æ¢ä¸»è§’æ‰€åœ¨é˜Ÿé¢œè‰²
function toggleTeamColor() {

    let val = userConfig.mainTeamColor;
    if (val === 'r') val = 'b';
    else val = 'r';

    /*
    let colorTxt = "çº¢è‰²";
    if (val === 'b') colorTxt = "è“è‰²";
    // æç¤ºç¡®è®¤
    if (confirm("ğŸ’¡ ç‚¹å‡»ç¡®å®šï¼Œå³å¯å°†ä¸»è§’é˜Ÿé¢œè‰²åˆ‡æ¢åˆ°ã€" + colorTxt + "ã€‘")) { // ç¡®è®¤
        
    } else { // å–æ¶ˆ
        return;
    }
    */

    // å‚æ•°è®¾ç½®é¡¹æ–‡å­—
    setMainTeamColorText(val);
    // è§’è‰²é˜Ÿå‹é¢œè‰²ã€è®¾ç½®è§’è‰²æ¡†é¢œè‰²
    resetMainTeamColorRandom(val);
    // æœ‰æœµæœµï¼Œéœ€è¦é‡æ–°ç”»è›‹
    if (isDuoduoExist) resetEggs();

    // è§’è‰²è¡€é‡æ¡å¼€å¯ï¼Œéœ€è¦é‡æ–°æ¸²æŸ“è§’è‰²
    if (userConfig.isShowRoleBloodLine) {
        directPlayAgain(false);
    }

    // æ›´æ–°è®¾ç½®
    userConfig.mainTeamColor = val;
    localStorage.setItem('collide-try-user-settings', JSON.stringify(userConfig));
}


// åˆ‡æ¢åªæ˜¾ç¤ºæ’å‡»å°é¢ï¼Œéšè—è§’è‰²å±‚
function toggleOnlyTable(isShow) {
    // æ¸…ç©ºè·¯å¾„å±‚
    clearCanvasAll(gamePathCanvas);
    clearCanvasAll(gamePathBallCanvas);
    if (isShow) { // åªæ˜¾ç¤ºå°é¢
        canvas.style.display = "none";
        gameMainBallCanvas.style.display = "none";
    } else { // å–æ¶ˆåªæ˜¾ç¤ºå°é¢
        canvas.style.display = "unset";
        gameMainBallCanvas.style.display = "unset";
    }
}


// åˆ‡æ¢æ˜¾ç¤ºåœºæ™¯å›¾å½¢ï¼Œéšè—emojiç­‰å›¾å½¢å±‚
function toggleSceneGraph(isShow) {
    if (isShow) { // æ˜¾ç¤º
        gameSceneGraphCanvas.style.display = "unset";
        if (isCanvasBlank(gameSceneEmojiCanvas)) { // ç©ºç”»å¸ƒï¼Œéœ€è¦é‡æ–°ç»˜åˆ¶
            setSceneTheme();
        } else {
            gameSceneEmojiCanvas.style.display = "unset";
        }
    } else { // ä¸æ˜¾ç¤º
        gameSceneGraphCanvas.style.display = "none";
        gameSceneEmojiCanvas.style.display = "none";
    }
}


// è®¾ç½®åœºæ™¯ä¸»é¢˜å€¼
function setSceneThemeVal(ele, val) {
    if (!ele) return;
    //console.log(ele);

    if (val === 2) { // æ–°å¹´ä¸»é¢˜æš‚æœªå®ç°
        alert("ğŸ®ï¼šæ•¬è¯·æœŸå¾…å“¦~");
        return;
    }

    userConfig.sceneThemeMode = val;
    setSceneThemeText(val);

    // localStorage å­˜å‚¨æ›´æ–° userConfig å¯¹è±¡
    localStorage.setItem('collide-try-user-settings', JSON.stringify(userConfig));

    // ä¿®æ”¹äº†ä¸»é¢˜ï¼Œéœ€è¦åˆ·æ–°é¡µé¢
    sysConfig.isNeedReload = true;
}


// è®¾ç½®åœºæ™¯ä¸»é¢˜æ–‡å­—
function setSceneThemeText(val) {
    switch (val) {
        case 1:
            document.getElementById("sceneThemeMode").innerText = "å†°é›ªä¸»é¢˜";
            break;
        case 2:
            document.getElementById("sceneThemeMode").innerText = "æ–°å¹´ä¸»é¢˜";
            break;
        case 3:
            document.getElementById("sceneThemeMode").innerText = "ç”°å›­ä¸»é¢˜";
            break;
        case 4:
            document.getElementById("sceneThemeMode").innerText = "æ˜Ÿé™…ä¸»é¢˜";
            break;
        case 5:
            document.getElementById("sceneThemeMode").innerText = "å¤æ—¥ä¸»é¢˜";
            break;
        default:
            document.getElementById("sceneThemeMode").innerText = "é»˜è®¤ä¸»é¢˜";
    }
}


// è®¾ç½®ä¸»è§’æ‰€åœ¨é˜Ÿé¢œè‰²æ–‡å­—
function setMainTeamColorText(val) {
    //if (!val) return; // è¿™ç§æ ¡éªŒè¿”å›ï¼Œå› ä¸ºçœ‹ä¸åˆ°åç»­çš„æŠ¥é”™ä¿¡æ¯ï¼Œåè€Œå½±å“æ’æŸ¥
    let ele = document.getElementById("mainTeamColor");
    if (val === 'r') {
        ele.innerText = "çº¢è‰²";
        ele.classList.add("red");
    } else {
        ele.innerText = "è“è‰²";
        ele.classList.remove("red");
    }
}


// åˆ‡æ¢æ˜¾ç¤ºè¿åŠ¨è·¯å¾„å±‚ç”»å¸ƒ
function togglePathBallMoveShow(isShow) {
    switchCanvasShow(gamePathCanvas, isShow);
}


// åˆ‡æ¢æ˜¾ç¤ºæœ¬ä½“è·¯å¾„å±‚ç”»å¸ƒ
function togglePathBallShow(isShow) {
    switchCanvasShow(gamePathBallCanvas, isShow);
}


// è®¾ç½®æœ‰å˜åŠ¨ï¼Œæ‰åˆ·æ–°é¡µé¢
function reloadAfterUserConfigSettingFinished(time, isReload) {
    let t0 = localStorage.getItem('collide-try-user-settings-time');
    if (!t0) t0 = "0";
    t0 = Number(t0);
    if (time > t0) {
        localStorage.setItem('collide-try-user-settings-time', time);
        if (isReload && sysConfig.isNeedReload) location.reload();
    }
}


// æŒ‡å®šæ¸¸æˆè§’è‰²æ–‡æœ¬æ˜¾ç¤º
function setGameRoleIdsText(val) {
    //console.log(">>>> setGameRoleIdsText val=" + val);
    //console.log(">>>> setGameRoleIdsText instanceof Array=" + (val instanceof Array));
    if (!val || val.length < 1) return;
    let ele, fName;
    for (let i = 0, len = val.length; i < len; i++) {
        //console.log(">>>> setGameRoleIdsText id=" + val[i]);
        if (val[i] < 0) continue;
        ele = document.getElementById("gameRoleId" + (i + 1));
        if (!ele) continue;
        fName = Role.getFullNameById(val[i]);
        if (!fName) continue;
        ele.innerText = fName;
        //ele.setAttribute("placeholder", fName);
        ele.setAttribute("value", fName);
    }
}


// æ˜¯å¦å¯ç”¨ã€æŒ‡å®šæ¸¸æˆè§’è‰²ã€‘
function isUseGameRoleIds() {
    let result = false;
    userConfig.gameRoleIds.some(id => {
        if (id > -1) {
            result = true;
            return true; // é€€å‡ºå¾ªç¯ return false ä¹Ÿæ˜¯é€€å‡ºå¾ªç¯ï¼Œsome éå†æ²¡æœ‰ continue
        }
    });
    return result;
}


// æŒ‡å®šæ¸¸æˆè§’è‰²æ˜¯å¦å®Œæ•´ï¼Œ1-çº¢é˜Ÿä¿©ï¼›2-è“é˜Ÿä¿©ï¼›3-å…¨éƒ¨
function isUseGameRoleIdsFull(no) {
    let result = false;

    switch (no) {
        case 1:
            if (userConfig.gameRoleIds[0] > -1 && userConfig.gameRoleIds[1] > -1) result = true;
            break;
        case 2:
            if (userConfig.gameRoleIds[2] > -1 && userConfig.gameRoleIds[3] > -1) result = true;
            break;
        default:
            if (userConfig.gameRoleIds[0] > -1 && userConfig.gameRoleIds[1] > -1 && userConfig.gameRoleIds[2] > -1 && userConfig.gameRoleIds[3] > -1) result = true;
    }

    return result;
}


// å¯¼å…¥/å¯¼å‡ºè§’è‰²å’Œåæ ‡
var rolePosInput = document.getElementById("shareRoleAndPos");
var rpShareCopy = document.getElementById("rpShareCopy");
var rpShareImport = document.getElementById("rpShareImport");

onMounted(() => {
    if (!rolePosInput) rolePosInput = document.getElementById("shareRoleAndPos");
    if (!rpShareCopy) rpShareCopy = document.getElementById("rpShareCopy");
    if (!rpShareImport) rpShareImport = document.getElementById("rpShareImport");
})

// é‡ç½®åˆ†äº«å†…å®¹
function resetShareContent() {
    rolePosInput.removeAttribute('readonly', 'readonly');
    rolePosInput.value = "";
    // åˆ‡æ¢åˆ°æ˜¾ç¤ºã€å¯¼å…¥ã€‘æŒ‰é’®
    rpShareCopy.style.display = "none";
    rpShareImport.style.display = "unset";
}

// è®¾ç½®æ˜¾ç¤ºå†…å®¹
function setShareContent() {
    if (!balls || balls.length < 1) return;
    let shareObjArr = [];
    balls.some(ball => {
        // åŒå­åˆ†èº«ä¸ç”¨è®¾ç½®
        if (ball.roleId === Role.SHUANGZI.id && ball === twinBall) return;
        let shareObj = { rid: -1, x: 0, y: 0, m: 0, no: 0, tc: 'r' };
        shareObj.rid = ball.roleId;
        // åƒç´ è½¬ç –æ ¼
        let pos = { x: ball.x, y: ball.y };
        switchPxOrGird(pos, 0);
        shareObj.x = pos.x;
        shareObj.y = pos.y;
        shareObj.m = ball.isMainBall ? 1 : 0;
        shareObj.no = ball.no;
        shareObj.tc = ball.teamColor;
        shareObjArr.push(shareObj);
    });
    rolePosInput.value = JSON.stringify(shareObjArr);
    // åˆ‡æ¢åˆ°æ˜¾ç¤ºã€å¤åˆ¶ã€‘æŒ‰é’®
    rpShareCopy.style.display = "unset";
    rpShareImport.style.display = "none";
}

// å¤åˆ¶åˆ†äº«å†…å®¹
function copyShareContent() {
    rolePosInput.setAttribute('readonly', 'readonly');
    rolePosInput.setSelectionRange(0, 9999);
    rolePosInput.select();
    document.execCommand('copy');
    rpShareCopy.innerText = "âœ“";
    rpShareCopy.disabled = true;
    setTimeout(() => {
        rpShareCopy.innerText = "å¤åˆ¶";
        rpShareCopy.disabled = false;
        rolePosInput.removeAttribute('readonly', 'readonly');
    }, 5000);
}

// æ£€æŸ¥å¯¼å…¥å†…å®¹
function checkShareContent() {
    if (!rolePosInput.value || rolePosInput.value.replaceAll(" ", "") === "") return false;
    let result = false;
    try {
        let shareObjArr = JSON.parse(rolePosInput.value);
        result = true;
    } catch (e) { }
    return result;
}

// ç¡®è®¤å¯¼å…¥è§’è‰²å’Œåæ ‡
function importShareContent() {
    if (!checkShareContent()) {
        alert("è¯·æ£€æŸ¥ç²˜è´´å†…å®¹æ˜¯å¦å®Œæ•´ï¼Œæˆ–è€…æ”¹åŠ¨æ˜¯å¦æ­£ç¡®ï¼");
        return;
    }
    userConfig.shareRoleAndPos = rolePosInput.value;
    // æ›´æ–°ç¼“å­˜
    localStorage.setItem('collide-try-user-settings', JSON.stringify(userConfig));
    console.log(">>>> importShareContent userConfig in localStorage updated.");
    rpShareImport.innerText = "âœ“";
    rpShareImport.disabled = true;

    // éœ€è¦é‡æ–°åˆ·æ–°é¡µé¢
    sysConfig.isNeedReload = true;

    setTimeout(() => {
        rpShareImport.innerText = "å¯¼å…¥";
        rpShareImport.disabled = false;
    }, 5000);
}


// æµ‹è¯• some éå†
function testSomeList() {
    let arr = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9];
    console.log(">>>> testSomeList arr:", arr);
    arr.some(id => {
        if (id === 6) {
            //return true; // é€€å‡ºå¾ªç¯ï¼Œåé¢ä¸å†æ‰§è¡Œ
            return false; // continue
            //return; // continue
        }
        console.log(">>>> testSomeList:", id);
    });
    console.log(">>>> testSomeList end.");
}
//testSomeList();


// æµ‹è¯• forEach éå†
function testForEachList() {
    let arr = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9];
    console.log(">>>> testForEachList arr:", arr);
    arr.forEach(id => {
        if (id === 6) {
            //return true; // continue
            return false; // continue
            //return; // continue
        }
        console.log(">>>> testForEachList:", id);
    });
    console.log(">>>> testForEachList end.");
}
//testForEachList()


// gameRoleIds è¾“å…¥æ§åˆ¶
var gameRoleIdEles;
onMounted(() => {
    gameRoleIdEles = document.getElementsByClassName('div-input-game-roles');
    for (let i = 0, len = gameRoleIdEles.length; i < len; i++) {
        let ele = gameRoleIdEles[i];
        // è¾“å…¥ç›‘å¬
        ele.addEventListener("input", (e) => { // æ³¨æ„ï¼Œinput äº‹ä»¶æ¯æ¬¡æ¥æ”¶åˆ°çš„æ˜¯æ–°å†…å®¹
            // å¤„ç†äº‹ä»¶é»˜è®¤è¡Œä¸ºï¼Œé˜²æ­¢äº‹ä»¶å†’æ³¡
            doEventDefault(e);
            //console.log(e.target);
            // è·å–è¾“å…¥æ¡†å†…å®¹
            let inVal = e.target.innerText;
            inVal = inVal.replaceAll(" ", "");
            e.target.innerText = inVal;

            // é™åˆ¶é•¿åº¦
            if (inVal.length > 10) {
                inVal = inVal.slice(0, 11);
            }

            // è§’è‰²å…¨ç§°è‡ªåŠ¨è¡¥å…¨
            let newVal = Role.getFullNameByKeyWord(inVal);
            console.log(">>>> e.target newVal=" + newVal);
            inVal = newVal;
            e.target.innerText = inVal;
            if (!newVal) return;

            // é»˜è®¤å€¼æ›´æ–°
            e.target.setAttribute("value", inVal);

            // æ—§å€¼
            let oldVal = userConfig.gameRoleIds[i];
            //console.log(">>>> e.target oldVal=" + oldVal);
            // idè½¬å…¨ç§°
            let oldFName = Role.getFullNameById(oldVal);
            //console.log(">>>> e.target oldFName=" + oldFName);
            // ä¸¤å€¼ç›¸ç­‰ä¸å¤„ç†
            if (inVal === oldFName) return;
            // åŒé˜Ÿè§’è‰²æ ¡éªŒ
            if (!checkSomeRoleInTeam(inVal, i)) { // ä¸é€šè¿‡
                inVal = "";
                e.target.innerText = inVal;
                alert("åŒé˜Ÿè§’è‰²ä¸èƒ½ä¸€æ ·å“¦ï¼");
                return;
            }

            doGameRoleIds(inVal, i);
        });

        // æŒ‰é”®æŒ‰ä¸‹æ¾æ‰‹ç›‘å¬ï¼ŒæŒ‰ä¸‹èšç„¦ï¼›é€€æ ¼é”®åˆ é™¤é€‰æ‹©
        ele.addEventListener("keydown", (e) => { // focus ç§»åŠ¨ç«¯ä¸èƒ½è‡ªåŠ¨èšç„¦ï¼›keydown é•¿æŒ‰ä¼šè§¦å‘å¤šæ¬¡ï¼Œkeyup åªè§¦å‘ä¸€æ¬¡
            // å¤„ç†äº‹ä»¶é»˜è®¤è¡Œä¸ºï¼Œé˜²æ­¢äº‹ä»¶å†’æ³¡
            doEventDefault(e);
            //console.log(e.target);
            e.target.innerText = "";
            //ele.innerText = "";
            e.target.focus();
            //ele.focus();

            //console.log(">>>> e.keyCode=" + e.keyCode);
            // é€€æ ¼é”®åˆ é™¤é€‰æ‹©è§’è‰²ï¼Œå¹¶æ›´æ–°å­˜å‚¨
            if (e.keyCode === 8) {
                e.target.innerText = "";
                e.target.setAttribute("value", "");
                if (userConfig.gameRoleIds[i] !== -1) doGameRoleIds("", i);
            }
        });

        // å¤±ç„¦ç›‘å¬ï¼Œä¸ºç©ºè®¾ç½®é»˜è®¤å€¼
        ele.addEventListener("blur", (e) => {
            // å¤„ç†äº‹ä»¶é»˜è®¤è¡Œä¸ºï¼Œé˜²æ­¢äº‹ä»¶å†’æ³¡
            doEventDefault(e);
            //console.log(e.target);
            let text = e.target.innerText;
            if (text) return;
            let value = e.target.getAttribute("value");
            let placeholder = e.target.getAttribute("placeholder");
            if (placeholder) e.target.innerText = placeholder;
            //if (value) e.target.innerText = value;
        });

    }
})


// æ ¡éªŒåŒé˜Ÿè§’è‰²æ˜¯å¦å¯è¡Œï¼ŒåŒé˜Ÿè§’è‰²ä¸èƒ½ä¸€æ ·
function checkSomeRoleInTeam(val, idx) {
    let roleName1, roleName2, roleName3, roleName4;
    roleName1 = gameRoleIdEles[0].innerText;//.replaceAll(" ", "");
    roleName2 = gameRoleIdEles[1].innerText;
    roleName3 = gameRoleIdEles[2].innerText;
    roleName4 = gameRoleIdEles[3].innerText;

    if (idx < 2 && roleName1 && roleName2 && !roleName1.includes("è¾“å…¥") && !roleName2.includes("è¾“å…¥")) { // ä¸ä¸ºç©ºæ ¼ï¼Œä¸”ä¸æ˜¯é»˜è®¤å€¼
        if (roleName1 === roleName2) return false;
    }
    if (idx > 1 && roleName3 && roleName4 && !roleName3.includes("è¾“å…¥") && !roleName4.includes("è¾“å…¥")) {
        if (roleName3 === roleName4) return false;
    }
    return true;
}


// gameRoleIds ä¿å­˜
function doGameRoleIds(val, idx) {
    console.log(">>>> doGameRoleIds gameRoleIds input=" + val);
    // æ›´æ–°é…ç½®å€¼
    userConfig.gameRoleIds[idx] = Role.getIdByFullName(val);

    // localStorage å­˜å‚¨æ›´æ–° userConfig å¯¹è±¡
    localStorage.setItem('collide-try-user-settings', JSON.stringify(userConfig));
    console.log(">>>> doGameRoleIds userConfig.gameRoleIds in localStorage updated.");

    // æŒ‡å®šäº†æ¸¸æˆè§’è‰²ï¼Œéœ€è¦åˆ·æ–°é¡µé¢
    sysConfig.isNeedReload = true;

    // è®¾ç½®äº†ä¸»è§’ï¼Œæç¤ºä¸»è§’éœ€è¦åœ¨ã€æé€Ÿå¼€å§‹ã€‘é€‰é¡¹æ‰ä¼šç”Ÿæ•ˆ
    if (val && idx === 0) showGameSettingMainRoleDialog();
}


// é‡ç½®æŒ‡å®šè§’è‰²
function resetGameRoleIds(ele) {
    let hasValue = false;
    for (let i = 0, len = gameRoleIdEles.length; i < len; i++) {
        let ele = gameRoleIdEles[i];
        let value = ele.getAttribute("value");
        hasValue = hasValue || value;
        let placeholder = ele.getAttribute("placeholder");
        ele.innerText = placeholder;
        ele.setAttribute("value", "");
        userConfig.gameRoleIds[i] = -1;
    }
    if (!hasValue) return;

    // localStorage å­˜å‚¨æ›´æ–° userConfig å¯¹è±¡
    localStorage.setItem('collide-try-user-settings', JSON.stringify(userConfig));
    console.log(">>>> resetGameRoleIds userConfig.gameRoleIds in localStorage updated.");

    // é‡ç½®æŒ‡å®šæ¸¸æˆè§’è‰²ï¼Œéœ€è¦åˆ·æ–°é¡µé¢
    sysConfig.isNeedReload = true;
}


// roleSpeedAddVal è§’è‰²åŠ é€Ÿæˆ–å‡é€Ÿ
onMounted(() => {
    const roleSpeedAddValInput = document.getElementById("roleSpeedAddVal");
    roleSpeedAddValInput.addEventListener("change", (e) => {
        // å¤„ç†äº‹ä»¶é»˜è®¤è¡Œä¸ºï¼Œé˜²æ­¢äº‹ä»¶å†’æ³¡
        doEventDefault(e);
        // è·å–è¾“å…¥æ¡†å†…å®¹
        let inVal = e.target.value;
        inVal = inVal.replaceAll(" ", "");
        e.target.value = inVal;
        if (!inVal) {
            inVal = "0";
            e.target.value = inVal;
        }
        if (!Number.isInteger(Number(inVal))) {
            alert("è¯·è¾“å…¥æ•´æ•°");
            return;
        }
        if (Number(inVal) < -20 || Number(inVal) > 200) {
            alert("æ•°å€¼èŒƒå›´ï¼š-20~200");
            return;
        }
        // æ—§å€¼
        let oldVal = userConfig.roleSpeedAddVal.toString();
        // ä¸¤å€¼ç›¸ç­‰ä¸å¤„ç†
        if (inVal === oldVal) return;

        doRoleSpeedAddVal(inVal);
    });
})


// æ‰§è¡Œå¤„ç†è§’è‰²åŠ é€Ÿ/å‡é€Ÿ
function doRoleSpeedAddVal(str) {
    //console.log(">>>> doRoleSpeedAddVal roleSpeedAddVal input=" + str);
    // æ›´æ–°é…ç½®å€¼
    userConfig.roleSpeedAddVal = Number(str);
    // localStorage å­˜å‚¨æ›´æ–° userConfig å¯¹è±¡
    localStorage.setItem('collide-try-user-settings', JSON.stringify(userConfig));
    console.log(">>>> doRoleSpeedAddVal userConfig.roleSpeedAddVal in localStorage updated.");

    // æ›´æ–°ä¸»çƒé€Ÿåº¦ï¼Œä¸ç”¨åˆ·æ–°é¡µé¢
    setSpeed();
}


// animate æ­»å¾ªç¯è‡ªåŠ¨é€€å‡º
onMounted(() => {
    const animateAutoRestTimeInput = document.getElementById("animateAutoRestTime");
    animateAutoRestTimeInput.addEventListener("change", (e) => {
        // å¤„ç†äº‹ä»¶é»˜è®¤è¡Œä¸ºï¼Œé˜²æ­¢äº‹ä»¶å†’æ³¡
        doEventDefault(e);
        // è·å–è¾“å…¥æ¡†å†…å®¹
        let inVal = e.target.value;
        inVal = inVal.replaceAll(" ", "");
        e.target.value = inVal;
        if (!inVal) {
            alert("è‡ªåŠ¨æ¢å¤æ—¶é—´ä¸èƒ½ä¸ºç©º");
            return;
        }
        if (!isATimeValValidByRegExp(inVal)) {
            alert("è¯·è¾“å…¥å¤§äºé›¶çš„æ•´æ•°");
            return;
        }
        if (Number(inVal) < 5) {
            inVal = "5";
            e.target.value = inVal;
        }
        // æ—§å€¼
        let oldVal = userConfig.animateAutoRestTime.toString();
        // ä¸¤å€¼ç›¸ç­‰ä¸å¤„ç†
        if (inVal === oldVal) return;

        doAnimateAutoRestTime(inVal);
    });
})


// å¤„ç†è‡ªåŠ¨æ¢å¤æ—¶é—´è¾“å…¥å†…å®¹
function doAnimateAutoRestTime(str) {
    //console.log(">>>> doAnimateAutoRestTime animateAutoRestTime input=" + str);
    // æ›´æ–°é…ç½®å€¼
    userConfig.animateAutoRestTime = Number(str);
    // localStorage å­˜å‚¨æ›´æ–° userConfig å¯¹è±¡
    localStorage.setItem('collide-try-user-settings', JSON.stringify(userConfig));
    console.log(">>>> doAnimateAutoRestTime userConfig.animateAutoRestTime in localStorage updated.");
}


// æ–œè¾¹å€¾æ–œåå·®è¾“å…¥æ¡†å¤±å»ç„¦ç‚¹æ—¶ï¼Œä¿å­˜æ•°æ®
onMounted(() => {
    const wan8CocosTableMoveValsInput = document.getElementById("wan8CocosTableMoveVals");
    wan8CocosTableMoveValsInput.addEventListener("change", (e) => {
        // å¤„ç†äº‹ä»¶é»˜è®¤è¡Œä¸ºï¼Œé˜²æ­¢äº‹ä»¶å†’æ³¡
        doEventDefault(e);
        // è·å–è¾“å…¥æ¡†å†…å®¹
        let inVal = e.target.value;
        inVal = inVal.replaceAll(" ", "");
        e.target.value = inVal;
        if (!inVal) {
            alert("æ–œè¾¹å€¾æ–œåå·®è¾“å…¥å†…å®¹ä¸èƒ½ä¸ºç©º");
            return;
        }
        // æ—§å€¼
        let oldVal = userConfig.wan8CocosTableMoveVals.toString();
        // ä¸¤å€¼ç›¸ç­‰ä¸å¤„ç†
        if (inVal === oldVal) return;

        doWan8CocosTableMoveVals(inVal);
    });
})


// å¤„ç†æ–œè¾¹å€¾æ–œåå·®è¾“å…¥å†…å®¹
function doWan8CocosTableMoveVals(str) {
    //console.log(">>>> doWan8CocosTableMoveVals wan8CocosTableMoveVals input=" + str);
    if (!isMoveValValidByRegExp(str)) {
        alert("æ–œè¾¹å€¾æ–œåå·®è¾“å…¥å†…å®¹æ ¼å¼ä¸ç¬¦åˆè¦æ±‚");
        return;
    }
    if (!isMoveValValidBySplit(str)) return;

    // æ›´æ–°é…ç½®å€¼
    userConfig.wan8CocosTableMoveVals = str.split(",");
    // localStorage å­˜å‚¨æ›´æ–° userConfig å¯¹è±¡
    localStorage.setItem('collide-try-user-settings', JSON.stringify(userConfig));
    console.log(">>>> doWan8CocosTableMoveVals userConfig.wan8CocosTableMoveVals in localStorage updated.");

    // ä¿®æ”¹äº†å°é¢æ–œè¾¹å€¾æ–œè§’åº¦ï¼Œéœ€è¦åˆ·æ–°é¡µé¢
    sysConfig.isNeedReload = true;
}


// æ­£åˆ™æ ¡éªŒæ–œè¾¹å€¾æ–œåå·®è¾“å…¥å†…å®¹
function isMoveValValidByRegExp(str) {
    return /^([\-]?[0]{1}[\.]?[\d]*[\,]?[\s]*)*$/.test(str);
}


// æ­£åˆ™æ ¡éªŒå¤§äº0çš„æ­£æ•´æ•°
function isATimeValValidByRegExp(str) {
    return /^[1-9]\d*$/.test(str);
}


// åˆ†å‰²æ ¡éªŒæ–œè¾¹å€¾æ–œåå·®è¾“å…¥å†…å®¹
function isMoveValValidBySplit(str) {
    //str = str.replaceAll(" ", "");
    let wan8CocosTableMoveValsIn = str.split(",");
    // åˆ†å‰²åæ˜¯å¦æœ‰å€¼
    if (!wan8CocosTableMoveValsIn) {
        alert("æ–œè¾¹å€¾æ–œåå·®è¾“å…¥å†…å®¹æœ‰è¯¯");
        return false;
    }
    // æ˜¯å¦åªè®¾ç½®äº†ä¸€ä¸ª0
    if (wan8CocosTableMoveValsIn.length === 1 && Number(wan8CocosTableMoveValsIn[0]) === 0) {
        // å…è®¸è®¾ç½®ä¸€ä¸ª0
    } else if (wan8CocosTableMoveValsIn.length != 8) {
        alert("æ–œè¾¹å€¾æ–œåå·®å€¼ä¸ªæ•°æœ‰è¯¯");
        return false;
    }
    // å•ä¸ªå€¼æ˜¯å¦ç¬¦åˆè¦æ±‚
    for (let i = 0; i < wan8CocosTableMoveValsIn.length; i++) {
        let num = Number(wan8CocosTableMoveValsIn[i]);
        //console.log(">>>> num[" + i + "]=" + num);
        if (!num && num !== 0) {
            alert("æ–œè¾¹å€¾æ–œåå·®å¿…é¡»ä¸ºæ•°å€¼");
            return false;
        }
        if (num < -0.5 || num > 0.5) {
            alert("æ–œè¾¹å€¾æ–œåå·®ç»å¯¹å€¼ä¸èƒ½è¶…è¿‡0.5");
            return false;
        }
    }
    return true;
}


// æ¢å¤é»˜è®¤è®¾ç½®
function resetUserSettings() {
    if (confirm("âš ï¸ ç¡®å®šè¦æ¢å¤é»˜è®¤è®¾ç½®å—ï¼Ÿ")) { // ç¡®è®¤
        // æ¸…é™¤ localStorage sessionStorage ä¸­ï¼Œç«™ç‚¹è‡ªèº«å­˜å‚¨çš„æ•°æ®
        Object.keys(localStorage).forEach(item => item.startsWith('collide-try') ? localStorage.removeItem(item) : '');
        Object.keys(sessionStorage).forEach(item => item.startsWith('collide-try') ? sessionStorage.removeItem(item) : '');
        // clear() ä¼šæ¸…é™¤å½“å‰ç½‘é¡µåŸŸåä¸‹çš„ç¼“å­˜æ•°æ®ï¼å½±å“æœ¬ç«™å…¶ä»–åº”ç”¨ç¼“å­˜æ•°æ®ï¼æ³¨æ„ï¼Œæ‰€æœ‰ html æœ¬åœ°æ–‡ä»¶ï¼Œåªç®—ä¸€ä¸ª file:// åŸŸ
        //localStorage.clear();
        //sessionStorage.clear();
        // åˆ·æ–°é¡µé¢ã€vue é‡æ–°åŠ è½½åï¼Œå†å²è®°å½•æ¸…ç©ºã€‘
        location.reload();
        // href æˆ– replace éƒ½å¯ä»¥æ›¿æ¢å½“å‰ history è·³è½¬é¡µé¢ï¼Œé¿å…ä¸€æ­¥ä¸€æ­¥è¿”å›
        //window.location.href = "#";
        //window.location.replace("#");
        // replaceState æ›¿æ¢ history ä¸­çš„ state
        //window.history.replaceState(null, "", "#");
        //window.history.go(0);
    } else { // å–æ¶ˆ

    }
}


// ä¿å­˜å½“å‰ç½‘é¡µ
// https://blog.csdn.net/qq_45677671/article/details/125905454
// https://www.jianshu.com/p/ee5e2963f243
function saveLocalHtml(ele) {

    if (!checkAccessKey()) return;

    let isConfirm = false;
    let t0 = localStorage.getItem('collide-try-save-remote-html-time');
    if (!t0) t0 = "0";
    t0 = Number(t0);
    if (t0 <= 0) { // æç¤ºå¦å¤–ä¿å­˜æ–¹æ³•
        let titleEle = document.getElementsByTagName("title")[0];
        let fileFullName = "xxxx.html";
        if (titleEle) fileFullName = titleEle.innerText + ".html";
        if (!fileFullName.includes("è§’åº¦ç»ƒä¹ ")) fileFullName = "xxxx.html";
        //if (confirm("ğŸ’¡ æ¸©é¦¨æç¤ºï¼š\nå¦‚æœé•¿æ—¶é—´æ²¡ååº”ï¼Œå¯èƒ½æ˜¯é“¾æ¥ä¸å¯ç”¨äº†ï¼Œä½¿ç”¨ç”µè„‘æµè§ˆå™¨ Ctrl+S ä¹Ÿå¯ä»¥ä¿å­˜ç¦»çº¿ç‰ˆå“¦ï¼")) { // ç¡®è®¤
        if (confirm("ğŸ’¡ æ¸©é¦¨æç¤ºï¼š\nç‚¹ã€ç¡®å®šã€‘åï¼Œä¼šå¼¹å‡ºä¸‹è½½å¯¹è¯æ¡†ï¼Œè¯·è‡ªè¡Œå°†å¯¹è¯æ¡†ä¸­çš„æ–‡ä»¶æ ¼å¼æ”¹ä¸ºã€" + fileFullName + "ã€‘ï¼Œæ–‡ä»¶åå¯ä»¥éšæ„ï¼Œä½†æ–‡ä»¶åç¼€ä¸€å®šè¦ä¸º â€œ.htmlâ€ æ‰èƒ½æ‰“å¼€è¿è¡Œå“¦ï¼")) { // ç¡®è®¤
            //localStorage.setItem('collide-try-save-remote-html-time', new Date().getTime());
            isConfirm = true;
        } else { // å–æ¶ˆ
            isConfirm = false;
        }
    }
    if (!isConfirm) return;

    // ç§»é™¤bodyçš„styleå±æ€§
    let bodyStyle = document.body.getAttribute('style');
    if (bodyStyle) document.body.removeAttribute('style');
    // é€‰æ‹©è§’è‰²å¼¹çª—æ˜¯å¦æ­£åœ¨æ˜¾ç¤º
    let chooseShowing = isDialogShowing(chooseRoleDialog);
    // åˆ‡æ¢å‚æ•°è®¾ç½®ä¸é€‰æ‹©è§’è‰²å¼¹çª—
    switchUserSettingDialog(false);
    // éšè—å…³é—­æ‰€æœ‰dialogå¼¹çª—ï¼Œä¿è¯ç¦»çº¿ç‰ˆåˆšæ‰“å¼€ä¸ä¼šä¸€ç›´æœ‰å¼¹çª—
    hideAllDialog();

    // æ²¡æœ‰è¾“å…¥æ­£ç¡®çš„è®¿é—®å¯†é’¥ï¼Œç§»é™¤æ ¸å¿ƒæ–¹æ³•
    if (!checkAccessKey()) {
        let eles = document.getElementsByClassName("collide-try-core-code");
        if (eles) removeCoreScript(eles, null);
    }

    let objectURL, aTag;
    try {
        let titleEle = document.getElementsByTagName('title')[0];
        let htmlStr = htmlEle.outerHTML;
        let blob, file;
        /*
        if (!objectURL) blob = new Blob([htmlStr], {
            type: "text/plain;charset=utf-8"
        });
        */
        if (!objectURL) file = new File([htmlStr], titleEle.innerText + ".html", {
            type: "text/plain;charset=utf-8"
        });
        // ç”Ÿæˆé“¾æ¥
        if (!objectURL) objectURL = (window.URL || window.webkitURL).createObjectURL(file);
        // åˆ›å»ºä¸€ä¸ª a æ ‡ç­¾Tag
        aTag = document.createElement('a');
        //aTag.style.display = 'none';
        //aTag.setAttribute('id', 'blob-download-save-to-local');
        // è®¾ç½®æ–‡ä»¶çš„ä¸‹è½½åœ°å€
        aTag.href = objectURL;
        console.log(">>>> saveLocalHtml aTag.href=" + aTag.href);
        //aTag.target = '_blank';
        //document.body.appendChild(aTag);
        // è®¾ç½®ä¿å­˜åçš„æ–‡ä»¶åç§°
        aTag.download = document.getElementsByTagName('title')[0].innerText + ".html";
        //aTag.download = file.name;
        console.log(">>>> saveLocalHtml aTag.download=" + aTag.download);
        //if (!os.isPc) alert(">>>> saveLocalHtml aTag.download=" + aTag.download);
        // ç‚¹å‡»è§¦å‘
        aTag.click();
        //aTag.remove();
        //document.body.removeChild(aTag);
    } catch (e) {
        doGlobalError(e, (sysConfig && sysConfig.alertErrorCount) ? sysConfig.alertErrorCount : 3);
    } finally {
        setTimeout(function () {
            // é‡Šæ”¾æ‰blobå¯¹è±¡ï¼Œå‡å°‘å†…å­˜å ç”¨ TODO ã€ç§»åŠ¨ç«¯å› ä¸ºå¤ªå¿«é‡Šæ”¾äº†èµ„æºï¼Œå¯¼è‡´ä¸€ç›´æç¤ºâ€œå¤„ç† blob æ•°æ®ä¸­...â€ï¼Œä¸èƒ½æ­£å¸¸ä¸‹è½½ã€‘
            if (objectURL) URL.revokeObjectURL(objectURL);
            // ç§»é™¤å…ƒç´ ï¼Œbodyæ²¡æœ‰æ·»åŠ å°±ä¸ç”¨ç§»é™¤
            //if (aTag) aTag.remove();
        }, 20000); // 20 ç§’åå†æ‰§è¡Œ
    }

    // æ“ä½œå®Œæˆåï¼Œå†æ¢å¤åŸæ ·
    if (bodyStyle) document.body.setAttribute('style', bodyStyle);
    if (chooseShowing) switchDialogShow(chooseRoleDialog, true);
    switchUserSettingDialog(true);

}


// ä¸‹è½½ç½‘ç»œæ–‡ä»¶
function saveRemoteHtml(ele) {

    if (!checkAccessKey()) return;

    let isConfirm = false;
    let t0 = localStorage.getItem('collide-try-save-remote-html-time');
    if (!t0) t0 = "0";
    t0 = Number(t0);
    if (t0 <= 0) { // æç¤ºå¦å¤–ä¿å­˜æ–¹æ³•
        //alert("ğŸ’¡ æ¸©é¦¨æç¤ºï¼š\nè”ç½‘è¯·æ±‚ä¸‹è½½ä¸€ä¸ªç¦»çº¿ç‰ˆæ–‡ä»¶ï¼ˆå‡ ç™¾KBï¼‰ï¼Œå¦‚æœé•¿æ—¶é—´æ²¡ååº”ï¼Œå¯èƒ½æ˜¯é“¾æ¥ä¸å¯ç”¨äº†ï¼Œä½¿ç”¨ç”µè„‘æµè§ˆå™¨ Ctrl+S ä¹Ÿå¯ä»¥ä¿å­˜ç¦»çº¿ç‰ˆå“¦ï¼");
        if (confirm("ğŸ’¡ æ¸©é¦¨æç¤ºï¼š\nè”ç½‘è¯·æ±‚ä¸‹è½½ä¸€ä¸ªç¦»çº¿ç‰ˆæ–‡ä»¶ï¼ˆå‡ ç™¾KBï¼‰ï¼Œå¦‚æœé•¿æ—¶é—´æ²¡ååº”ï¼Œå¯èƒ½æ˜¯é“¾æ¥ä¸å¯ç”¨äº†ï¼Œä½¿ç”¨ç”µè„‘æµè§ˆå™¨ Ctrl+S ä¹Ÿå¯ä»¥ä¿å­˜ç¦»çº¿ç‰ˆå“¦ï¼")) { // ç¡®è®¤
            //localStorage.setItem('collide-try-save-remote-html-time', new Date().getTime());
            isConfirm = true;
        } else { // å–æ¶ˆ
            isConfirm = false;
        }
    }
    if (!isConfirm) return;

    let titleEle = document.getElementsByTagName('title')[0];
    let url = "https://www.m1yellow.cn/collide-try?download=1&f=" + titleEle.innerText + ".html";
    console.log(">>>> saveRemoteHtml url=" + url);
    window.location.href = url; // æ‰‹æœºç§»åŠ¨ç«¯ä¸‹è½½åä¼šåœç•™åœ¨ç©ºç™½é¡µé¢
    // è¿”å›åŸæ¥åœ°å€ï¼Œç§»åŠ¨ç«¯è¿˜æ˜¯æ²¡ç”¨
    //history.back();
}


// éšè—å…³é—­æ‰€æœ‰dialogå¼¹çª—
function hideAllDialog() {
    let dialogs = document.getElementsByClassName("collide-try-dialog");
    //console.log(dialogs);
    if (!dialogs || dialogs.length < 1) return;
    for (let i = 0, len = dialogs.length; i < len; i++) {
        dialogs[i].style.display = "none";
    }
}


// ç›®å‰å·²æœ‰çš„è‡ªå®šä¹‰dialogå¼¹çª—ç¡®è®¤æŒ‰é’®é¢œè‰²ï¼Œè®¾ç½®ä¸ºè·Ÿæ’å‡»å°é¢ä¸€æ ·çš„é¢œè‰²
// åœ¨ drawSceneBg() è®¾ç½®å®ŒèƒŒæ™¯è‰²çš„æ—¶å€™è°ƒç”¨
function setDialogOkColor(cVal) {
    let dialogOks = document.getElementsByClassName("collide-try-dialog-ok");
    //console.log(dialogOks);
    if (!dialogOks || dialogOks.length < 1) return;
    if (!cVal) cVal = "chartreuse";
    for (let i = 0, len = dialogOks.length; i < len; i++) {
        dialogOks[i].style.background = cVal;
    }
}


//////////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////////
// ã€å·¥å…·ç±»ç›¸å…³ã€‘ å˜é‡ã€æ–¹æ³•åŒºåŸŸ
//////////////////////////////////////////////////////////////////////

// æ˜¯å¦ä¸ºæ•°å€¼ç±»å‹
function isNumber(value) {
    return !isNaN(parseFloat(value)) && isFinite(value);
}

// ä¿ç•™æŒ‡å®šå°æ•°ä½æ•°ï¼Œé»˜è®¤ä¸¤ä½
function roundNumber(num, decimals = 2) {
    if (isNaN(num)) return -1;
    if (typeof num === 'string') num = Number(num);
    if (num === 0) return 0;
    return Math.round(num * Math.pow(10, decimals)) / Math.pow(10, decimals);
}


// æŒ‡å®šå°æ•°ä½ï¼Œä¸å¤Ÿè¡¥0
function roundNumberStr(num, decimals = 2) {
    let f = Math.round(num * Math.pow(10, decimals)) / Math.pow(10, decimals);
    let s = f.toString();
    let rs = s.indexOf('.');
    if (rs < 0) {
        s += '.';
    }
    for (let i = s.length - s.indexOf('.'); i <= decimals; i++) {
        s += "0";
    }
    return s;
}


// è·å–(n,m)èŒƒå›´éšæœºæ•°
// https://cloud.tencent.com/developer/article/1629795
function fullOpen(n, m) {
    if (m <= n) return n;
    let result = Math.random() * (m - n) + n;
    while (result === n) {
        result = Math.random() * (m - n) + n;
    }
    return result;
}


// [n, m] æ•´æ•°
function fullCloseInt(n, m) {
    return Math.floor(Math.random() * (m - n + 1)) + n;
}
/*
for (let i = 0; i < 100; i++) {
    console.log(Role.getRandomRoleId());
}
*/


// éšæœºç”ŸæˆæŒ‡å®šé•¿åº¦å­—ç¬¦ä¸²
function randomString(len) {
    var str = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
    var result = '';
    for (var i = 0; i < len; i++)
        result += str[Math.floor(Math.random() * str.length)];
    return result;
}


// ä¸¤å¹³é¢âšªæ˜¯å¦ç¢°æ’
function is2CirclesCollided(ball0, ball1) {
    return (ball0.x - ball1.x) ** 2 + (ball0.y - ball1.y) ** 2 <= (ball0.radius + ball1.radius) ** 2;
}


// canvasåˆ¶ä½œåœ†è§’çŸ©å½¢ï¼ˆåŒ…æ‹¬å¡«å……çŸ©å½¢çš„åŠŸèƒ½ï¼‰å…¼å®¹æ—§æœºå‹å’Œæµè§ˆå™¨
// https://juejin.cn/post/6977212150439739423
/**è¯¥æ–¹æ³•ç”¨æ¥ç»˜åˆ¶ä¸€ä¸ªæœ‰å¡«å……è‰²çš„åœ†è§’çŸ©å½¢ 
*@param cxt:canvasçš„ä¸Šä¸‹æ–‡ç¯å¢ƒ 
*@param x:å·¦ä¸Šè§’xè½´åæ ‡ 
*@param y:å·¦ä¸Šè§’yè½´åæ ‡ 
*@param width:çŸ©å½¢çš„å®½åº¦ 
*@param height:çŸ©å½¢çš„é«˜åº¦ 
*@param radius:åœ†çš„åŠå¾„ 
*@param fillColor:å¡«å……é¢œè‰² 
**/
function fillRoundRect(cxt, x, y, width, height, radius, /*optional*/ fillColor) {
    //åœ†çš„ç›´å¾„å¿…ç„¶è¦å°äºçŸ©å½¢çš„å®½é«˜          
    if (2 * radius > width || 2 * radius > height) { return false; }

    cxt.save();
    cxt.translate(x, y);
    //ç»˜åˆ¶åœ†è§’çŸ©å½¢çš„å„ä¸ªè¾¹  
    drawRoundRectPath(cxt, width, height, radius);
    cxt.fillStyle = fillColor || "#000"; //è‹¥æ˜¯ç»™å®šäº†å€¼å°±ç”¨ç»™å®šçš„å€¼å¦åˆ™ç»™äºˆé»˜è®¤å€¼  
    cxt.fill();
    cxt.restore();
}


/**è¯¥æ–¹æ³•ç”¨æ¥ç»˜åˆ¶åœ†è§’çŸ©å½¢ 
 *@param cxt:canvasçš„ä¸Šä¸‹æ–‡ç¯å¢ƒ 
 *@param x:å·¦ä¸Šè§’xè½´åæ ‡ 
 *@param y:å·¦ä¸Šè§’yè½´åæ ‡ 
 *@param width:çŸ©å½¢çš„å®½åº¦ 
 *@param height:çŸ©å½¢çš„é«˜åº¦ 
 *@param radius:åœ†çš„åŠå¾„ 
 *@param lineWidth:çº¿æ¡ç²—ç»† 
 *@param strokeColor:çº¿æ¡é¢œè‰² 
 **/
function strokeRoundRect(cxt, x, y, width, height, radius, /*optional*/ lineWidth, /*optional*/ strokeColor) {
    //åœ†çš„ç›´å¾„å¿…ç„¶è¦å°äºçŸ©å½¢çš„å®½é«˜          
    if (2 * radius > width || 2 * radius > height) { return false; }

    cxt.save();
    cxt.translate(x, y);
    //ç»˜åˆ¶åœ†è§’çŸ©å½¢çš„å„ä¸ªè¾¹  
    drawRoundRectPath(cxt, width, height, radius);
    cxt.lineWidth = lineWidth || 2; //è‹¥æ˜¯ç»™å®šäº†å€¼å°±ç”¨ç»™å®šçš„å€¼å¦åˆ™ç»™äºˆé»˜è®¤å€¼2  
    cxt.strokeStyle = strokeColor || "#000";
    cxt.stroke();
    cxt.restore();
}

function drawRoundRectPath(cxt, width, height, radius) {
    cxt.beginPath(0);
    //ä»å³ä¸‹è§’é¡ºæ—¶é’ˆç»˜åˆ¶ï¼Œå¼§åº¦ä»0åˆ°1/2PI  
    cxt.arc(width - radius, height - radius, radius, 0, Math.PI / 2);

    //çŸ©å½¢ä¸‹è¾¹çº¿  
    cxt.lineTo(radius, height);

    //å·¦ä¸‹è§’åœ†å¼§ï¼Œå¼§åº¦ä»1/2PIåˆ°PI  
    cxt.arc(radius, height - radius, radius, Math.PI / 2, Math.PI);

    //çŸ©å½¢å·¦è¾¹çº¿  
    cxt.lineTo(0, radius);

    //å·¦ä¸Šè§’åœ†å¼§ï¼Œå¼§åº¦ä»PIåˆ°3/2PI  
    cxt.arc(radius, radius, radius, Math.PI, Math.PI * 3 / 2);

    //ä¸Šè¾¹çº¿  
    cxt.lineTo(width - radius, 0);

    //å³ä¸Šè§’åœ†å¼§  
    cxt.arc(width - radius, radius, radius, Math.PI * 3 / 2, Math.PI * 2);

    //å³è¾¹çº¿  
    cxt.lineTo(width, height - radius);
    cxt.closePath();
}

//////////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////////
// ã€ç¢°æ’è¾¹ç•Œæ£€æµ‹ã€‘ å˜é‡ã€æ–¹æ³•åŒºåŸŸ
//////////////////////////////////////////////////////////////////////

let concurrentCollided = false;

// å¢™é¢ç¢°æ’æ£€æµ‹
// isCheck è¡¨ç¤ºæ˜¯å¦ä¸ºè·¯å¾„æ£€æµ‹ï¼Œç›®å‰è·¯å¾„æ£€æµ‹åªéœ€è¦æ‹¿åˆ°ç¬¬ä¸€ä¸ªç¢°æ’ç‚¹å³å¯è¿”å›
function checkWalls(ball, isCheck) {

    ball.isWallCollided = false; // é‡ç½®ç¢°æ’æ ‡å¿—

    // å¤‡ä»½ç¢°æ’ç‚¹åæ ‡å’Œé€Ÿåº¦
    ball.collidedP0.x = ball.x;
    ball.collidedP0.y = ball.y;
    // é€Ÿåº¦åªåœ¨ç¬¬ä¸€ä¸ªæ£€æµ‹ä¸­å¤‡ä»½
    ball.collidedV0.x = ball.vx;
    ball.collidedV0.y = ball.vy;

    // å¢™é¢ç¢°æ’äº†ï¼Œè¿˜è¦åˆ¤æ–­åˆ‡é¢ã€è›‹åˆ‡é¢æ˜¯å¦ä¹Ÿç¢°æ’äº†
    let lc = false; // åˆ‡çº¿ç¢°æ’æ£€æµ‹
    let ec = false; // è›‹åˆ‡é¢ç¢°æ’æ£€æµ‹

    // åˆå§‹åæ ‡æ£€æµ‹ï¼Œåˆ†èº«åˆå§‹ä½ç½®ï¼Œä¸æ£€æµ‹ç¢°æ’
    if (!isRoleHideBody(ball)) {
        // è¾¹ç•Œåå¼¹ã€ç¢°æ’åé€Ÿåº¦åå‘ã€‘
        //console.log(">>>> ball.x - ball.radius = " + (ball.x - ball.radius));
        if (ball.x - ball.radius <= 0) { // å·¦å¢™é¢
            ball.isCollided = true; // ç¢°æ’
            ball.isWallCollided = true;
            if (!isCheck) ball.collidedCount += 1; // æ€»ç¢°æ’æ¬¡æ•° +1
            if (!isCheck) ball.wallCollidedCount += 1; // å¢™å£ç¢°æ’æ¬¡æ•° +1
            ball.x = ball.radius + 1 * dpr; // 1 * dpr é¿å…ç¢°æ’åœˆç”»å‡ºå¢™é¢
            // æ”¹å˜äº†xçš„ä½ç½®ï¼Œè¿˜è¦æ‰¾åˆ°å¯¹åº”çš„yä½ç½®
            setXOrY(ball, ball.collidedP0, false);
            console.log(">>>> å·¦å¢™é¢-" + ball.getBallDesc() + "-æ’å‡»ç‚¹åæ ‡ï¼šx=" + ball.x + ", y=" + ball.y);
            // TODO å¢™é¢ç¢°æ’åæ ‡æ›´æ–°åï¼Œè¿˜è¦è·å–åˆ‡é¢ç¢°æ’çŠ¶æ€ï¼Œå¦‚æœåˆ‡é¢ä¹Ÿç¢°æ’äº†ï¼Œåˆ«æ”¹å˜è¿åŠ¨é€Ÿåº¦æ–¹å‘
            lc = checkLineCollided(ball);
            //if (isDuoduoExist) ec = checkEggCollided(ball);
            // ç¢°æ’æ£€æµ‹æˆ–è€…æ¨¡æ‹Ÿè¿åŠ¨ï¼Œæ‹¿åˆ°ç¬¬ä¸€ä¸ªç¢°æ’ç‚¹ï¼Œå°±å¯ä»¥ç›´æ¥è¿”å›äº†
            if (isCheck && !lc && !ec && recordCollidedPoint(ball) && !isRoleCanPierces()) return true;
            // ç»˜ç”»ç¢°æ’è™šçº¿åœ†åœˆ
            if (!lc && !ec && (!selectedBall || !isRoleCanPierces())) ball.drawCollidedPos();
            // TODO èƒ½é‡æŸè€—ã€åªæ”¹å˜ä¸€ä¸ªæ–¹å‘çš„é€Ÿåº¦å¤§å°ï¼Œä¼šå¯¼è‡´å…¥å°„ã€å‡ºå°„è§’åº¦ä¸æ»¡è¶³åå°„å®šå¾‹ã€‘
            //ball.vx *= -sysConfig.bounce;
            if (!lc && !ec) ball.vx *= -1; // é€Ÿåº¦åå‘
            // åå¼¹ç³»æ•°ä½œç”¨åœ¨åˆé€Ÿåº¦ä¸Š
            checkBounce(ball);
        } else if (ball.x + ball.radius >= canvas.width) { // å³å¢™é¢
            ball.isCollided = true;
            ball.isWallCollided = true;
            if (!isCheck) ball.collidedCount += 1;
            if (!isCheck) ball.wallCollidedCount += 1;
            ball.x = canvas.width - ball.radius - 1 * dpr;
            setXOrY(ball, ball.collidedP0, false);
            console.log(">>>> å³å¢™é¢-" + ball.getBallDesc() + "-æ’å‡»ç‚¹åæ ‡ï¼šx=" + ball.x + ", y=" + ball.y);
            lc = checkLineCollided(ball);
            //if (isDuoduoExist) ec = checkEggCollided(ball);
            if (isCheck && !lc && !ec && recordCollidedPoint(ball) && !isRoleCanPierces()) return true;
            if (!lc && !ec && (!selectedBall || !isRoleCanPierces())) ball.drawCollidedPos();
            if (!lc && !ec) ball.vx *= -1;
            checkBounce(ball);
        }

        if (ball.y - ball.radius <= 0) { // ä¸Šå¢™é¢
            ball.isCollided = true;
            ball.isWallCollided = true;
            if (!isCheck) ball.collidedCount += 1;
            if (!isCheck) ball.wallCollidedCount += 1;
            ball.y = ball.radius + 1 * dpr;
            setXOrY(ball, ball.collidedP0, true);
            console.log(">>>> ä¸Šå¢™é¢-" + ball.getBallDesc() + "-æ’å‡»ç‚¹åæ ‡ï¼šx=" + ball.x + ", y=" + ball.y);
            lc = checkLineCollided(ball);
            if (isDuoduoExist && isCheckEgg(ball)) ec = checkEggCollided(ball);
            if (isCheck && !lc && !ec && recordCollidedPoint(ball) && !isRoleCanPierces()) return true;
            if (!lc && !ec && (!selectedBall || !isRoleCanPierces())) ball.drawCollidedPos();
            if (!lc && !ec) ball.vy *= -1;
            checkBounce(ball);
        } else if (ball.y + ball.radius >= canvas.height) { // ä¸‹å¢™é¢
            //console.log(">>>> ä¸‹å¢™é¢-æ’å‡»ç‚¹ï¼š" + ball.radius);
            ball.isCollided = true;
            ball.isWallCollided = true;
            if (!isCheck) ball.collidedCount += 1;
            if (!isCheck) ball.wallCollidedCount += 1;
            ball.y = canvas.height - ball.radius - 1 * dpr;
            setXOrY(ball, ball.collidedP0, true);
            console.log(">>>> ä¸‹å¢™é¢-" + ball.getBallDesc() + "-æ’å‡»ç‚¹åæ ‡ï¼šx=" + ball.x + ", y=" + ball.y);
            lc = checkLineCollided(ball);
            if (isDuoduoExist && isCheckEgg(ball)) ec = checkEggCollided(ball);
            if (isCheck && !lc && !ec && recordCollidedPoint(ball) && !isRoleCanPierces()) return true;
            if (!lc && !ec && (!selectedBall || !isRoleCanPierces())) ball.drawCollidedPos();
            if (!lc && !ec) ball.vy *= -1;
            checkBounce(ball);
        }
    }

    ball.isCheckFinished = false;
    //console.log(">>>> checkWalls isCheckFinished=" + ball.isCheckFinished);
    drawAndUpdate(ball, isCheck); // ç»˜åˆ¶å°çƒå¹¶æ›´æ–°é€Ÿåº¦
}


// å•ç‹¬æ£€æµ‹å¢™é¢æ˜¯å¦ç¢°æ’
function checkWallCollided(ball, isChPos) {
    // è§’è‰²åˆ†èº«åˆå§‹ä½ç½®ï¼Œä¸ç”¨ç®¡
    if (isRoleHideBody(ball)) return false;

    if (ball.x - ball.radius <= 0) { // å·¦å¢™é¢
        //console.log(">>>> å·¦å¢™é¢-æ’å‡»ç‚¹åæ ‡ï¼šx=" + ball.x + ", y=" + ball.y);
        if (isChPos) ball.x = ball.radius + 1 * dpr;
        return true;
    } else if (ball.x + ball.radius >= canvas.width) { // å³å¢™é¢
        //console.log(">>>> å³å¢™é¢-æ’å‡»ç‚¹åæ ‡ï¼šx=" + ball.x + ", y=" + ball.y);
        if (isChPos) ball.x = canvas.width - ball.radius - 1 * dpr;
        return true;
    }

    if (ball.y - ball.radius <= 0) { // ä¸Šå¢™é¢
        //console.log(">>>> ä¸Šå¢™é¢-æ’å‡»ç‚¹åæ ‡ï¼šx=" + ball.x + ", y=" + ball.y);
        if (isChPos) ball.y = ball.radius + 1 * dpr;
        return true;
    } else if (ball.y + ball.radius >= canvas.height) { // ä¸‹å¢™é¢
        //console.log(">>>> ä¸‹å¢™é¢-æ’å‡»ç‚¹åæ ‡ï¼šx=" + ball.x + ", y=" + ball.y);
        if (isChPos) ball.y = canvas.height - ball.radius - 1 * dpr;
        return true;
    }
    return false;
}


// åˆ‡è§’è¾¹ç¢°æ’æ£€æµ‹
function checkLines(ball, isCheck) {
    //console.log(">>>> checkLines ball: " + JSON.stringify(ball));
    ball.isLineCollided = false; // ç¢°æ’æ ‡è¯†é‡ç½®

    // åˆ¤æ–­æ˜¯å¦åœ¨åˆ‡è§’èŒƒå›´å†…
    let angleIdx = isInAngleArea(ball);
    if (angleIdx > -1 && !isRoleHideBody(ball)) {
        console.log(">>>> angleIdx=" + angleIdx);
        let lineIndex = getOneAngleLineIndex(ball);
        let line = lines[lineIndex];
        // TODO æ¯æ¬¡éƒ½å¾ªç¯æ£€æµ‹å››æ¡çº¿ï¼Œæœ‰äº›æµªè´¹æ€§èƒ½ï¼Œåç»­æœ‰æ—¶é—´å¯ä»¥æ ¹æ®è¿åŠ¨æ–¹å‘/è§’åº¦ï¼Œåªæ£€æµ‹å¯èƒ½ç¢°åˆ°çš„è¾¹
        //lines.some(line => {
        let bounds = line.getBounds();
        // åˆ¤æ–­å°çƒæ˜¯å¦åœ¨çº¿æ®µåŒºåŸŸå†…
        if (ball.x + ball.radius > bounds.x && ball.x - ball.radius < bounds.x + bounds.width) {
            //console.log(">>>> ball in dounds.");
            let cos = Math.cos(line.rotation);
            let sin = Math.sin(line.rotation);
            // ä½ç½®ä»¥ï¼ˆline.x1ï¼Œline.y1ï¼‰ä¸ºåæ ‡åŸç‚¹æ¥æ—‹è½¬åæ ‡
            let pos = rotate(ball.x - line.x1, ball.y - line.y1, sin, cos, true); // åˆ‡è§’æ–œè¾¹åæ ‡ç³»æ—‹è½¬åˆ°æ°´å¹³
            let vel = rotate(ball.vx, ball.vy, sin, cos, true); // å°çƒé€Ÿåº¦æ–¹å‘åŒæ ·è¦æ—‹è½¬

            ball.collidedP0.x = pos.x;
            ball.collidedP0.y = pos.y;

            // å½“å°çƒä¸­å¿ƒè·ç¦»æ–œé¢çš„è·ç¦»å°äºåŠå¾„çš„æ—¶è¯´æ˜å·²ç»ç›¸ç¢°æ’äº†
            //console.log(">>>> Math.abs(pos.y)=" + Math.abs(pos.y));
            console.log(">>>> line" + lineIndex + " pos.y=" + pos.y);
            // TODO å°çƒç¢°æ’å‰ååœ¨è¾¹ç•Œä¸Šä¸‹çš„è·ç¦»éƒ½å¤§äºåŠå¾„ï¼Œå¯¼è‡´è®¤ä¸ºæ²¡ç¢°æ’ï¼Œå…¶å®æ˜¯é€Ÿåº¦å¤§äºåŠå¾„å¯¼è‡´ â€”â€”> âšª|âšª
            //if (Math.abs(pos.y) < ball.radius) { // è¿™ä¸ªåˆ¤æ–­åªé€‚ç”¨åœ¨çŸ©å½¢å†…çš„çº¿æ®µï¼Œä¸é€‚ç”¨åˆ‡è§’è¾¹ç•Œ
            if (pos.y - ball.radius <= 0) {
                console.log(">>>> line" + lineIndex + " ball Collided.");
                ball.isCollided = true; // ç¢°æ’
                ball.isLineCollided = true;
                if (!isCheck) ball.collidedCount += 1;
                if (!isCheck) ball.wallCollidedCount += 1;

                // åˆ¤æ–­å°çƒæ˜¯ä¸Šé¢ç¢°æ’è¿˜æ˜¯ä¸‹é¢ç¢°æ’
                if (pos.y - vel.y <= 0) { // ä¸‹ï¼Ÿ
                    //pos.y = -ball.radius;
                    console.log(">>>> line" + lineIndex + "-ä¸‹å¢™é¢");
                    // åˆ‡è§’è¾¹ç•Œåªå–æ­£æ•°ï¼Œæ‰“ä¸åˆ°ä¸‹å¢™é¢
                    pos.y = ball.radius + 1 * dpr;
                } else { // ä¸Š
                    console.log(">>>> line" + lineIndex + "-ä¸Šå¢™é¢");
                    pos.y = ball.radius + 1 * dpr;
                }

                // TODO ç§»åŠ¨å°çƒä½ç½®æ—¶ï¼Œå°çƒæ²¡æœ‰é€Ÿåº¦
                // æ”¹å˜äº†yçš„ä½ç½®ï¼Œè¿˜è¦æ‰¾åˆ°å¯¹åº”çš„xä½ç½®
                //console.log(">>>> vel.x=" + vel.x + ", vel.y=" + vel.y);
                let angle = Math.atan2(vel.y, vel.x);
                //console.log(">>>> angle=" + angle);
                let x = (ball.collidedP0.y - pos.y) / Math.tan(angle);
                //console.log(">>>> x=" + x);
                if (isNumber(x) && isNumber(pos.x - x)) pos.x -= x;
                //console.log(">>>> pos.x=" + pos.x + ", pos.y=" + pos.y);

                //vel.y *= -sysConfig.bounce; // èƒ½é‡æŸè€—
                vel.y *= -1; // åå‘
                // æ—‹è½¬å›å»
                let velF = rotate(vel.x, vel.y, sin, cos, false);
                let posF = rotate(pos.x, pos.y, sin, cos, false);
                ball.x = line.x1 + posF.x;
                ball.y = line.y1 + posF.y;

                // å¦‚æœåªæ˜¯æ£€æµ‹ç¢°æ’ï¼Œæˆ–è€…æ¨¡æ‹Ÿæ’å‡»è·¯çº¿ï¼Œå¯ä»¥ç›´æ¥è¿”å›äº†ï¼Œé¿å…ä¸‹é¢ç»˜åˆ¶åŠ¨ç”»æµªè´¹æ€§èƒ½
                // æ³¨æ„ï¼Œè¿™é‡Œçš„ return true åªæ˜¯é€€å‡ºäº†å¾ªç¯éå†ï¼Œæ²¡æœ‰é€€å‡º checkLines æ–¹æ³•
                //if (isCheck && recordCollidedPoint(ball)) throw new Error("æ£€æµ‹ç¢°æ’å®Œæˆ-ä¸­æ–­å¾ªç¯", {cause:1000}); // cause çš„å€¼å¯ä»¥æ˜¯ä»»ä½•ç±»å‹
                console.log(">>>> line" + lineIndex + "-" + ball.getBallDesc() + "-æ’å‡»ç‚¹åæ ‡ï¼šx=" + ball.x + ", y=" + ball.y);
                if (isCheck && recordCollidedPoint(ball) && !isRoleCanPierces()) return true; // éå¾ªç¯æ–¹æ³•ï¼Œç›´æ¥è¿”å›ç»“æŸæ•´ä¸ªæ–¹æ³•

                // è¿åŠ¨çŠ¶æ€åœ¨æ£€æµ‹ç¢°æ’ä¹‹åå†æ”¹å˜
                // åˆ‡è§’è¾¹æ˜¯åé¢æ£€æµ‹çš„ï¼Œå¢™é¢&åˆ‡é¢éƒ½æ£€æµ‹å®Œæˆåï¼Œåˆ¤æ–­æ˜¯å¦åŒæ—¶ç¢°æ’ä¸¤ä¸ªå¢™é¢
                if (concurrentCollided && ball.isMainBall && checkWallCollided(ball)) { // åŒæ—¶ç¢°æ’äº†åˆ‡é¢ã€å¢™é¢ï¼Œé€Ÿåº¦ç›´æ¥åå‘
                    console.log(">>>> æ’å¢™è§’ï¼ŒåŒæ—¶ç¢°æ’äº†å¢™é¢å’Œåˆ‡é¢ï¼Œé€Ÿåº¦ç›´æ¥åå‘");
                    ball.vx = -ball.collidedV0.x;
                    ball.vy = -ball.collidedV0.y;
                    // å› ä¸ºæ˜¯æ¢å¤äº†å¢™é¢ç¢°æ’å‰çš„å¤‡ä»½å€¼ï¼Œéœ€è¦å•ç‹¬è®¡ç®—ä¸€æ¬¡ç¢°æ’æŸè€—
                    checkBounce(ball);
                } else {
                    ball.vx = velF.x;
                    ball.vy = velF.y;
                    // TODO æ²¡æœ‰åŒæ—¶ç¢°æ’ï¼ŒçŸ«æ­£é€Ÿåº¦è¿‡å¿«ï¼Œç©¿é€æ–œé¢ç¢°åˆ°å¢™çš„é—®é¢˜
                    if (!isCheck && ball.isWallCollided) ball.collidedCount -= 1;
                    if (!isCheck && ball.isWallCollided) ball.wallCollidedCount -= 1;
                }

                // åå¼¹ç³»æ•°ä½œç”¨åœ¨åˆé€Ÿåº¦ä¸Š
                checkBounce(ball);
                // ç»˜ç”»ç¢°æ’è™šçº¿åœ†åœˆ
                if (!selectedBall || !isRoleCanPierces()) ball.drawCollidedPos();

                // å››æ¡åˆ‡è§’çº¿ä¸€æ¬¡åªä¼šç¢°åˆ°ä¸€æ¡ï¼Œç¢°æ’åç›´æ¥é€€å‡ºå¾ªç¯æ£€æµ‹
                //return true; // TODO åªæœ‰ä¸€æ¡çº¿çš„è¯ä¸ç”¨è¿”å›

            }
        }
        //});
    }

    ball.isCheckFinished = false;
    drawAndUpdate(ball, isCheck); // ç»˜åˆ¶å°çƒå¹¶æ›´æ–°é€Ÿåº¦
}


// å•ç‹¬æ£€æµ‹åˆ‡é¢æ˜¯å¦ç¢°æ’
function checkLineCollided(ball, isChPos) {

    // åˆ¤æ–­æ˜¯å¦åœ¨åˆ‡è§’èŒƒå›´å†…
    let angleIdx = isInAngleArea(ball);
    if (angleIdx > -1 && !isRoleHideBody(ball)) {
        let lineIndex = getOneAngleLineIndex(ball);
        let line = lines[lineIndex];
        // TODO æ¯æ¬¡éƒ½å¾ªç¯æ£€æµ‹å››æ¡çº¿ï¼Œæœ‰äº›æµªè´¹æ€§èƒ½ï¼Œåç»­æœ‰æ—¶é—´å¯ä»¥æ ¹æ®è¿åŠ¨æ–¹å‘/è§’åº¦ï¼Œåªæ£€æµ‹å¯èƒ½ç¢°åˆ°çš„è¾¹
        //lines.some(line => {
        let bounds = line.getBounds();
        // åˆ¤æ–­å°çƒæ˜¯å¦åœ¨çº¿æ®µåŒºåŸŸå†…
        if (ball.x + ball.radius > bounds.x && ball.x - ball.radius < bounds.x + bounds.width) {
            //console.log(">>>> ball in dounds.");
            let cos = Math.cos(line.rotation);
            let sin = Math.sin(line.rotation);
            // ä½ç½®ä»¥ï¼ˆline.x1ï¼Œline.y1ï¼‰ä¸ºåæ ‡åŸç‚¹æ¥æ—‹è½¬åæ ‡
            let pos = rotate(ball.x - line.x1, ball.y - line.y1, sin, cos, true); // åˆ‡è§’æ–œè¾¹åæ ‡ç³»æ—‹è½¬åˆ°æ°´å¹³
            let vel = rotate(ball.vx, ball.vy, sin, cos, true); // å°çƒé€Ÿåº¦æ–¹å‘åŒæ ·è¦æ—‹è½¬

            // å½“å°çƒä¸­å¿ƒè·ç¦»æ–œé¢çš„è·ç¦»å°äºåŠå¾„çš„æ—¶è¯´æ˜å·²ç»ç›¸ç¢°æ’äº†
            //console.log(">>>> line" + lineIndex + " pos.y=" + pos.y);
            // TODO å°çƒç¢°æ’å‰ååœ¨è¾¹ç•Œä¸Šä¸‹çš„è·ç¦»éƒ½å¤§äºåŠå¾„ï¼Œå¯¼è‡´è®¤ä¸ºæ²¡ç¢°æ’ï¼Œå…¶å®æ˜¯é€Ÿåº¦å¤§äºåŠå¾„å¯¼è‡´ â€”â€”> âšª|âšª
            //if (Math.abs(pos.y) < ball.radius) { // è¿™ä¸ªåˆ¤æ–­åªé€‚ç”¨åœ¨çŸ©å½¢å†…çš„çº¿æ®µï¼Œä¸é€‚ç”¨åˆ‡è§’è¾¹ç•Œ
            if (pos.y - ball.radius <= 0) {
                //console.log(">>>> checkLineCollided line" + lineIndex + " ball Collided.");
                // åˆ¤æ–­å°çƒæ˜¯ä¸Šé¢ç¢°æ’è¿˜æ˜¯ä¸‹é¢ç¢°æ’
                if (pos.y - vel.y <= 0) { // ä¸‹ï¼Ÿ
                    //pos.y = -ball.radius;
                    //console.log(">>>> checkLineCollided line" + lineIndex + "-ä¸‹å¢™é¢");
                    // åˆ‡è§’è¾¹ç•Œåªå–æ­£æ•°ï¼Œæ‰“ä¸åˆ°ä¸‹å¢™é¢
                    pos.y = ball.radius + 1 * dpr;
                } else { // ä¸Š
                    //console.log(">>>> checkLineCollided line" + lineIndex + "-ä¸Šå¢™é¢");
                    pos.y = ball.radius + 1 * dpr;
                }

                if (isChPos) {
                    // æ—‹è½¬å›å»
                    let velF = rotate(vel.x, vel.y, sin, cos, false);
                    let posF = rotate(pos.x, pos.y, sin, cos, false);
                    ball.x = line.x1 + posF.x;
                    ball.y = line.y1 + posF.y;
                }

                return true;
            }
        }
        //});
    }

    return false;
}


// æ£€æµ‹çƒä¸çƒç¢°æ’
// animate balls.forEach å¾ªç¯è°ƒç”¨
function checkOtherBalls(ball, isCheck) {
    //console.log(">>>> checkOtherBalls out " + ball.getBallDesc());

    ball.isBallCollided = false; // ç¢°æ’æ ‡è¯†é‡ç½®

    // ç„å‡†é˜¶æ®µï¼Œå¯ç©¿é€è§’è‰²ï¼Œæˆ–è€…å¼€å¯äº†ç„å‡†ç©¿é€ï¼Œä¸æ£€æµ‹ç¢°æ’
    if (!selectedBall || !isRoleCanPierces() && !isTryCanPierces())
        balls.forEach(b => {
            /*
            åªæ£€æµ‹åºå·æ¯”ballå¤§çš„ï¼Œå³å¯ä¿è¯ç»„åˆä¸é‡å¤ï¼Œ12 å’Œ 21 ç®—é‡å¤
            å¤–å±‚ 1 2 3 4
            å†…å±‚ 2 3 4
            */
            if (b.no <= ball.no) return;
            //console.log(">>>> checkOtherBalls in " + b.getBallDesc());

            // ball å¯ä»¥æ˜¯ balls æ•°ç»„ä¸­çš„çƒï¼Œä¹Ÿå¯ä»¥æ˜¯ tryMoveBallï¼ŒtryMoveBall æ˜¯æ–°çš„å¯¹è±¡ï¼Œé»˜è®¤ä¸ºã€ä¸»çƒã€‘ï¼Œä¸åœ¨ balls æ•°ç»„ä¸­
            // ç›®å‰åªæ”¯æŒä¸»çƒã€å‰¯çƒç¢°æ’ï¼Œä¸å­˜åœ¨ä¸¤ä¸»çƒç¢°æ’çš„æƒ…å†µ
            if (ball === tryMoveBall && b.isMainBall) return; // é€€å‡ºå•æ¬¡å¾ªç¯ï¼Œç›¸å½“äº continue
            // è‡ªå·±ç¢°è‡ªå·±ä¹Ÿä¸ç®—
            if (ball !== tryMoveBall && b === ball) return;

            //console.log(">>>> checkOtherBalls " + ball.getBallDesc() + "-" + b.collidingNos[ball.no - 1]);
            if (isCollisionBallAndBall(ball, b)) { // TODO å¤„ç†æ­£åœ¨ç¢°æ’è¢«å½“æˆå¾ˆå¤šæ¬¡ç¢°æ’é—®é¢˜ã€‚animate 60 å¸§å†…ä¼šè°ƒç”¨å¾ˆå¤šæ¬¡æ–¹æ³•ï¼Œå¯¼è‡´ç©¿ä¸€æ¬¡è¢«è®¡ç®—æˆå¾ˆå¤šæ¬¡
                if (!isCheck) console.log(">>>> checkOtherBalls ball Collided > " + b.getBallDesc());
                ball.isBallCollided = true;
                ball.isCollided = true;
                if (!isCheck) ball.collidedCount += 1;
                if (!isCheck) ball.roleCollidedCount += 1;
                if (!isCheck) b.collidedCount += 1;
                if (!isCheck) b.roleCollidedCount += 1;

                // TODO çŸ«æ­£ç¢°æ’æ—¶ä½ç½®ï¼Œè§£å†³é‡å é—®é¢˜
                /*
                //if (isCheck || userConfig.currRole != Role.JIANGJIANG.id && userConfig.currRole != Role.KUILEI.id) {
                if (userConfig.currRole != Role.JIANGJIANG.id && userConfig.currRole != Role.KUILEI.id) {
                    let angle = getAngleOf2BallCollided(ball, b); // æ­£æ•°ã€å°çƒé¡ºåºæœ‰å½±å“ã€‘
                    let collidedPoint = get2BallCollidedXYByAngle(angle, ball.radius + b.radius);
                    //console.log(">>>> get2BallCollidedXYByAngle, x=" + collidedPoint.x + ", y=" + collidedPoint.y);
                    // é‡æ–°è®¾ç½®å°çƒä½ç½®
                    ball.x = b.x - collidedPoint.x;
                    ball.y = b.y - collidedPoint.y;
                }
                */

                if (userConfig.currRole === Role.JIANGJIANG.id) {
                    do2BallsCollidedMV2(ball, b, isCheck, false, collideParams);
                } else if (userConfig.currRole === Role.KUILEI.id) {
                    if (isKuileiPulling) do2BallsCollidedMV2(ball, b, true, false, collideParams);
                    else do2BallsCollidedMV2(ball, b, isCheck, false, collideParams);
                } else do2BallsCollidedMV2(ball, b, true, false, collideParams);

                // æ˜¾ç¤ºç„å‡†ç¢°æ’æŒ‡ç¤ºåœˆã€ç„å‡†æ—¶ä¸åœåœ°æ£€æµ‹ï¼Œå¯¼è‡´æŒ‡ç¤ºåœˆæœ‰é—ªåŠ¨ï¼Œåç»­å†æã€‘
                //if (isCheck) ball.drawTryCollidedCircle(null, b);

                console.log(">>>> checkOtherBalls-" + ball.getBallDesc() + "-æ’å‡»ç‚¹åæ ‡ï¼šx=" + ball.x + ", y=" + ball.y);
                if (isCheck && recordCollidedPoint(ball)) return true; // æ³¨æ„åªæ˜¯ç»“æŸå¾ªç¯

                // ç¢°åˆ°å°±åœæ­¢
                if (userConfig.isStopAfterCollided) {
                    ball.vx = 0;
                    ball.vy = 0;
                    //ball.isMoving = false;
                    b.vx = 0;
                    b.vy = 0;
                    //b.isMoving = false;
                    return true;
                }

                // å¤„ç†å°çƒç¢°æ’åé€Ÿåº¦                
                if (userConfig.currRole === Role.JIANGJIANG.id) {
                    // ç®€å•æ¨¡æ‹Ÿåƒµå°¸ç©¿é€åŠ é€Ÿã€å‡é€Ÿ
                    doJiangjiangSpeed(ball, b);
                } else if (userConfig.currRole === Role.KUILEI.id) {
                    //console.log(">>>> checkOtherBalls isKuileiPulling=" + isKuileiPulling);
                    if (isKuileiPulling) do2BallsCollidedMV2(ball, b, false, true, collideParams);
                } else {
                    //do2BallsCollided(ball, b);
                    do2BallsCollidedMV2(ball, b, false, true, collideParams);
                }

                // é…·é…·åŠ é€Ÿ
                doKukuSpeed(ball, b);
                // ç”µéŸ³çªç ´åŠ é€Ÿ
                doDianyinSpeed(ball, b);
                // å¤ªå¹³ä¹åŠ é€Ÿ
                doLeleSpeed(ball, b);

                // ç¢°æ’é€Ÿåº¦å‰Šå‡
                checkBounce(ball); // TODO è‡ªå®šä¹‰ä¸€ä¸ªæŸè€—ï¼Œé¿å…æ‰“å®Œè´´ç€ä¸€ç›´ä¸åœçš„é—®é¢˜
                // ç»˜ç”»ç¢°æ’è™šçº¿åœ†åœˆ
                //if (!isCheck) ball.drawCollidedPos();
            }
        });

    if (!isDuoduoExist) ball.isCheckFinished = true; // ä¸æ£€æµ‹è›‹ï¼Œåˆ™æ£€æµ‹å®Œçƒç¢°æ’ä¹‹åï¼Œæ‰€æœ‰æ£€æµ‹å®Œæˆ
    drawAndUpdate(ball, isCheck); // ç»˜åˆ¶å°çƒå¹¶æ›´æ–°é€Ÿåº¦
}


// å•ç‹¬æ£€æµ‹çƒä¸çƒç¢°æ’
function checkOtherBallCollided(ball, isChPos) {
    let result = false;
    balls.some(b => {
        if (ball === tryMoveBall && b.isMainBall) return; // ç±»ä¼¼äºcontinueï¼Œç»ˆæ­¢å½“æ¬¡å¾ªç¯ã€‚ä½¿ç”¨æŠ›å¼‚å¸¸çš„æ–¹å¼ï¼Œç»ˆæ­¢forEachæ•´ä¸ªå¾ªç¯
        if (ball !== tryMoveBall && b === ball) return;
        //if (isCollisionBallAndBall(ball, b)) { // ç¢°æ’äº†
        if (is2CirclesCollided(ball, b)) {
            if (isChPos) {
                let angle = getAngleOf2BallCollided(ball, b); // æ­£æ•°
                let collidedPoint = get2BallCollidedXYByAngle(angle, ball.radius + b.radius);
                //console.log(">>>> get2BallCollidedXYByAngle, x=" + collidedPoint.x + ", y=" + collidedPoint.y);
                // é‡æ–°è®¾ç½®å°çƒä½ç½®
                ball.x = b.x - collidedPoint.x;
                ball.y = b.y - collidedPoint.y;
            }
            result = true;
            return true; // åªæ˜¯é€€å‡ºå¾ªç¯
        }
    });
    return result;
}


// åˆ¤æ–­æ˜¯å¦è¾¾åˆ°é€Ÿåº¦ä¸Šé™
function isSpeedMax(ball) {
    let speed0 = getBallSpeed0(ball);
    if (ball.isMainBall && ball.roleId === Role.JIANGJIANG.id) { // åƒµå°¸ä¸»æ‰“æ—¶ï¼Œä¸Šé™ä¸ºåŸå§‹é€Ÿåº¦çš„ 1.6 å€
        if (ball.vx ** 2 + ball.vy ** 2 > (speed0 * 1.3) ** 2) return true;
    } else { // 1.5
        if (ball.vx ** 2 + ball.vy ** 2 > (speed0 * 1.2) ** 2) return true;
    }
    return false;
}


// é…·é…·ä¸ºé˜Ÿå‹åŠ é€Ÿ60%/30%ï¼Œçªç ´åï¼Œè‡ªèº«åŠ é€Ÿ50%
function isKukuCollided(ball0, ball1) {
    let result = false;
    // æ˜¯å¦åŒé˜Ÿ
    if (ball0.teamColor !== ball1.teamColor) return result;
    // æ˜¯å¦æœ‰é…·é…·
    if (ball0.roleId !== Role.KUKU.id && ball1.roleId !== Role.KUKU.id) return result;
    // æ˜¯å¦æœ‰ä¸»çƒ
    if (!ball0.isMainBall && !ball1.isMainBall) return result;
    result = true;
    return result;
}


// åƒµå°¸ç¢°æ’
function isJiangjiangCollided(ball0, ball1) {
    let result = false;
    // æ˜¯å¦æœ‰åƒµåƒµ
    if (ball0.roleId !== Role.JIANGJIANG.id && ball1.roleId !== Role.JIANGJIANG.id) return result;
    // æ˜¯å¦æœ‰ä¸»çƒ
    if (!ball0.isMainBall && !ball1.isMainBall) return result;
    result = true;
    return result;
}


// å°ä¸‘ç¢°æ’
function isJoker2Collided(ball0, ball1) {
    let result = false;
    // æ˜¯å¦æœ‰å°ä¸‘
    if (ball0.roleId !== Role.JOKER.id && ball1.roleId !== Role.JOKER.id) return result;
    // æ˜¯å¦æœ‰å°ä¸‘åˆ†èº«
    if (ball0.no <= 4 && ball1.no <= 4) return result;
    // æ˜¯å¦æœ‰ä¸»çƒ
    if (!ball0.isMainBall && !ball1.isMainBall) return result;
    // æ˜¯å¦ä¸ºåŒé˜Ÿï¼ŒåŒé˜Ÿä¸ç®—ï¼Œä¸å‡é€Ÿ
    //if (ball0.teamColor === ball1.teamColor) return result;
    result = true;
    return result;
}


// ç”µéŸ³ç¢°æ’
function isDianyinCollided(ball0, ball1) {
    if (!balls || balls.length < 1) return false;
    let result = false;
    // æ˜¯å¦åŒé˜Ÿ
    if (ball0.teamColor === ball1.teamColor) return result;
    // æ˜¯å¦æœ‰ç”µéŸ³
    if (ball0.roleId !== Role.DIANYIN.id && ball1.roleId !== Role.DIANYIN.id) return result;
    // æ˜¯å¦æœ‰ä¸»çƒã€éä¸»çƒç¢°åˆ°ä¸€æ ·åŠ é€Ÿã€‘
    //if (!ball0.isMainBall && !ball1.isMainBall) return result;
    // æ˜¯å¦æœ‰å°ä¸‘åˆ†èº«ï¼Œç¢°å°ä¸‘åˆ†èº«ä¸åŠ é€Ÿ
    if ((ball0.roleId === Role.JOKER.id && ball0.no > 4)
        || (ball1.roleId === Role.JOKER.id && ball1.no > 4)) return result;
    // ç”µéŸ³ç¢°æ’å¯¹è±¡æ˜¯å¦å­˜æ´»ï¼Œç›®å‰è¿˜æ²¡æœ‰è¡€é‡ä¼¤å®³åŠŸèƒ½ï¼Œå…ˆä¸ç®¡
    // ç”µéŸ³éœ€è¦æ˜¯ä¸»è§’æˆ–è€…è·Ÿä¸»è§’ä¸€é˜Ÿ
    let isRoleRight = false;
    if ((ball0.roleId === Role.DIANYIN.id && (ball0.isMainBall || ball0.teamColor === balls[0].teamColor))
        || (ball1.roleId === Role.DIANYIN.id && (ball1.isMainBall || ball1.teamColor === balls[0].teamColor))) isRoleRight = true;

    //console.log(">>>> isRoleRight", isRoleRight);
    if (!isRoleRight) return result;

    result = true;
    return result;
}


// å¤ªå¹³ä¹ç¢°æ’
function isLeleCollided(ball0, ball1) {
    let result = false;
    // æ˜¯å¦æœ‰å¤ªå¹³ä¹
    if (ball0.roleId !== Role.LELE.id && ball1.roleId !== Role.LELE.id) return result;
    // æ˜¯å¦æœ‰ä¸»çƒ
    if (!ball0.isMainBall && !ball1.isMainBall) return result;
    // æ˜¯å¦æœ‰å°ä¸‘åˆ†èº«ï¼Œç¢°å°ä¸‘åˆ†èº«ä¸åŠ é€Ÿ
    if ((ball0.roleId === Role.JOKER.id && ball0.no > 4)
        || (ball1.roleId === Role.JOKER.id && ball1.no > 4)) return result;
    // å¤ªå¹³ä¹éœ€è¦æ˜¯ä¸»è§’
    let isRoleRight = false;
    if ((ball0.roleId === Role.LELE.id && ball0.isMainBall)
        || (ball1.roleId === Role.LELE.id && ball1.isMainBall)) isRoleRight = true;
    if (!isRoleRight) return result;
    // ç¢°åˆ°çš„è§’è‰²éœ€è¦æ˜¯å­˜æ´»çš„ã€è¡€é‡ä¼¤å®³ç³»ç»Ÿè¿˜æ²¡å®ç°å…ˆä¸ç®¡ã€‘

    result = true;
    return result;
}


// å¤„ç†é…·é…·åŠ é€Ÿ
function doKukuSpeed(ball0, ball1) {
    if (!isKukuCollided(ball0, ball1)) return;
    // ä¸ºç¢°æ’çš„é˜Ÿå‹åŠ é€Ÿ60%ã€é€Ÿåº¦å¤ªå¿«ï¼Œæ‰‹åŠ¨è°ƒæ•´æ¯”ä¾‹ã€‘
    const kukuTeammateRatio = 1.4;
    // çªç ´åé…·é…·è‡ªèº«åŠ é€Ÿ50%
    const kukuSelfRatio = 1.3;
    if (ball0.roleId === Role.KUKU.id) { // ball0 ä¸ºé…·é…·
        if (ball0.addCount < 10) {
            if (ball0.isMainBall) {
                // é™åˆ¶é€Ÿåº¦ä¸Šé™
                if (!isSpeedMax(ball0)) {
                    ball0.vx *= kukuSelfRatio;
                    ball0.vy *= kukuSelfRatio;
                }
                if (!isSpeedMax(ball1)) {
                    ball1.vx *= kukuTeammateRatio;
                    ball1.vy *= kukuTeammateRatio;
                }
            } else {
                if (!isSpeedMax(ball1)) {
                    ball1.vx *= kukuTeammateRatio;
                    ball1.vy *= kukuTeammateRatio;
                }
            }
            ball0.addCount++; // æ¯å›åˆæœ€å¤šåŠ é€Ÿ10æ¬¡
        }
    } else { // ball1 ä¸ºé…·é…·
        if (ball1.addCount < 10) {
            if (ball1.isMainBall) {
                if (!isSpeedMax(ball1)) {
                    ball1.vx *= kukuSelfRatio;
                    ball1.vy *= kukuSelfRatio;
                }
                if (!isSpeedMax(ball0)) {
                    ball0.vx *= kukuTeammateRatio;
                    ball0.vy *= kukuTeammateRatio;
                }
            } else {
                if (!isSpeedMax(ball0)) {
                    ball0.vx *= kukuTeammateRatio;
                    ball0.vy *= kukuTeammateRatio;
                }
            }
            ball1.addCount++;
        }
    }
}


// å¤„ç†åƒµåƒµåŠ é€Ÿã€å‡é€Ÿ
function doJiangjiangSpeed(ball0, ball1) {
    if (userConfig.currRole !== Role.JIANGJIANG.id) return;
    if (!isJiangjiangCollided(ball0, ball1)) return;
    if (isKukuCollided(ball0, ball1)) return; // å’Œé…·é…·ç¢°æ’ï¼Œèµ°é…·é…·åŠ é€Ÿé€»è¾‘
    // ç¢°è§’è‰²åŠ é€Ÿ 4%
    const body1Ratio = 1 + 0.09;
    // ç¢°å°ä¸‘åˆ†èº«å‡é€Ÿ 2%
    const body2Ratio = 1 - 0.07;
    if (ball0.roleId === Role.JIANGJIANG.id && ball0.isMainBall) {
        if (isJoker2Collided(ball0, ball1)) { // ç¢°åˆ°äº†å°ä¸‘åˆ†èº«
            ball0.vx *= body2Ratio;
            ball0.vy *= body2Ratio;
        } else {
            if (!isSpeedMax(ball0)) {
                ball0.vx *= body1Ratio;
                ball0.vy *= body1Ratio;
            }
        }
    }
}


// å¤„ç†ç”µéŸ³åŠ é€Ÿ
function doDianyinSpeed(ball0, ball1) {
    if (!isDianyinCollided(ball0, ball1)) return;
    //console.log(">>>> doDianyinSpeed isDianyinCollided=true");
    // çªç ´åï¼Œç¢°åˆ°å­˜æ´»å¯¹æ‰‹ï¼Œè‡ªèº«åŠ é€Ÿ20%ï¼Œæ‰‹åŠ¨è°ƒæ•´æ¯”ä¾‹ï¼Œè·Ÿå®æˆ˜å¯¹æ¯”
    //const dianyinRatio = 1.40;
    let dianyinRatio, speed0; // æ”¹ä¸ºåŸå§‹é€Ÿåº¦çš„æ¯”ä¾‹
    if (ball0.roleId === Role.DIANYIN.id) { // ball0 ä¸ºç”µéŸ³
        ball0.upgradeEffect = 1; // è®¾ç½®çªç ´æ•ˆæœ
        if (!isSpeedMax(ball0)) {
            speed0 = getBallSpeed0(ball0);
            dianyinRatio = speed0 * 0.18; // 20% åå¿«ï¼Œæ‰‹åŠ¨è°ƒæ•´
            //console.log(">>>> doDianyinSpeed dianyinRatio", dianyinRatio);
            //ball0.vx *= dianyinRatio;
            //ball0.vy *= dianyinRatio;
            ball0.vx += (ball0.vx >= 0 ? dianyinRatio : -dianyinRatio);
            ball0.vy += (ball0.vy >= 0 ? dianyinRatio : -dianyinRatio);
        }
    } else { // ball1 ä¸ºç”µéŸ³
        ball1.upgradeEffect = 1;
        if (!isSpeedMax(ball1)) {
            speed0 = getBallSpeed0(ball1);
            dianyinRatio = speed0 * 0.18;
            ball1.vx += (ball1.vx >= 0 ? dianyinRatio : -dianyinRatio);
            ball1.vy += (ball1.vy >= 0 ? dianyinRatio : -dianyinRatio);
        }
    }
}


// å¤„ç†å¤ªå¹³ä¹åŠ é€Ÿ
function doLeleSpeed(ball0, ball1) {
    if (userConfig.currRole !== Role.LELE.id) return;
    if (!isLeleCollided(ball0, ball1)) return;
    // çªç ´åï¼Œç¢°åˆ°å­˜æ´»è§’è‰²ï¼ˆé˜Ÿå‹å’Œå¯¹æ‰‹éƒ½ç®—ï¼‰ï¼Œè‡ªèº«åŠ é€Ÿ30%ï¼Œæ‰‹åŠ¨è°ƒæ•´æ¯”ä¾‹ï¼Œè·Ÿå®æˆ˜å¯¹æ¯”
    const leleRatio = 1.50;
    if (ball0.roleId === Role.LELE.id) { // ball0 ä¸ºå¤ªå¹³ä¹
        if (!isSpeedMax(ball0)) {
            ball0.vx *= leleRatio;
            ball0.vy *= leleRatio;
        }
    }
}


// æ£€æµ‹ç¢°è›‹å¤„ç†
function checkEggs(ball, isCheck) {

    ball.isEggCollided = false; // ç¢°æ’æ ‡è¯†é‡ç½®

    if (isCheckEgg(ball) && isInEggArea(ball)) {
        eggs.forEach(e => {
            if (isCollisionBallAndBall(ball, e)) {
                console.log(">>>> checkEggs egg ball Collided.");
                ball.isEggCollided = true;
                ball.isCollided = true;
                //if (!isCheck) ball.collidedCount += 1; // è›‹ä¸ç®—æ¸¸æˆè§’è‰²
                if (!isCheck) ball.wallCollidedCount += 1;

                ball.collidedP0.x = ball.x;
                ball.collidedP0.y = ball.y;

                /*
                let angle = getAngleOf2BallCollided(ball, e); // æ­£æ•°
                let collidedPoint = get2BallCollidedXYByAngle(angle, ball.radius + e.radius);
                //console.log(">>>> get2BallCollidedXYByAngle, x=" + collidedPoint.x + ", y=" + collidedPoint.y);
                // é‡æ–°è®¾ç½®å°çƒä½ç½®
                ball.x = e.x - collidedPoint.x;
                ball.y = e.y - collidedPoint.y;
                // æ”¹å˜äº†yçš„ä½ç½®ï¼Œè¿˜è¦æ‰¾åˆ°å¯¹åº”çš„xä½ç½®
                //setXOrY(ball, collidedP0, true);
                */

                do2BallsCollidedMV2(ball, e, true, false, collideParams);

                console.log(">>>> checkEggs-" + ball.getBallDesc() + "-æ’å‡»ç‚¹åæ ‡ï¼šx=" + ball.x + ", y=" + ball.y);
                if (isCheck && recordCollidedPoint(ball)) return true;

                // ç¢°åˆ°å°±åœæ­¢
                if (userConfig.isStopAfterCollided) {
                    ball.vx = 0;
                    ball.vy = 0;
                    return true;
                }

                if (concurrentCollided && ball.isMainBall && checkWallCollided(ball)) { // åŒæ—¶ç¢°æ’äº†å¢™é¢ã€è›‹åˆ‡é¢ï¼Œé€Ÿåº¦ç›´æ¥åå‘
                    console.log(">>>> æ’å¢™è§’ï¼ŒåŒæ—¶ç¢°æ’äº†å¢™é¢å’Œè›‹åˆ‡é¢ï¼Œé€Ÿåº¦ç›´æ¥åå‘");
                    ball.vx = -ball.collidedV0.x;
                    ball.vy = -ball.collidedV0.y;
                } else {
                    // è®¡ç®—å°çƒåå¼¹é€Ÿåº¦å’Œåå‘
                    //do2BallsCollided(ball, e);
                    do2BallsCollidedMV2(ball, e, false, true, collideParams);
                    // è›‹ä¸ä¼šåŠ¨
                    e.vx = 0;
                    e.vy = 0;
                    // è›‹åå¼¹åŠ é€Ÿ
                    //checkEggBounce(ball);
                }

                // ç»˜ç”»ç¢°æ’è™šçº¿åœ†åœˆ
                ball.drawCollidedPos();
            }
        });
    }

    ball.isCheckFinished = true; // æ£€æµ‹å®Œæˆ
    drawAndUpdate(ball, isCheck); // ç»˜åˆ¶å°çƒå¹¶æ›´æ–°é€Ÿåº¦
}


// å•ç‹¬æ£€æµ‹è›‹åˆ‡é¢æ˜¯å¦ç¢°æ’
function checkEggCollided(ball, isChPos) {
    let result = false;
    if (isCheckEgg(ball) && isInEggArea(ball)) {
        eggs.some(e => {
            //if (isCollisionBallAndBall(ball, e)) {
            if (is2CirclesCollided(ball, e)) {
                console.log(">>>> checkEggCollided Collided.");
                if (isChPos) {
                    let angle = getAngleOf2BallCollided(ball, e); // æ­£æ•°
                    let collidedPoint = get2BallCollidedXYByAngle(angle, ball.radius + e.radius);
                    //console.log(">>>> get2BallCollidedXYByAngle, x=" + collidedPoint.x + ", y=" + collidedPoint.y);
                    // é‡æ–°è®¾ç½®å°çƒä½ç½®
                    ball.x = e.x - collidedPoint.x;
                    ball.y = e.y - collidedPoint.y;
                    //do2BallsCollidedMV2(ball, e, true, false, collideParams);
                }
                result = true;
                return true; // åªæ˜¯é€€å‡ºå¾ªç¯
            }
        });
    }
    return result;
}


// æ˜¯å¦ç¢°åˆ°è›‹åŒºåŸŸ
function isInEggArea(ball) {
    let posCheck = ((ball.y <= 2 * sysConfig.girdSize || ball.y >= 20 * sysConfig.girdSize) && ball.x >= 5 * sysConfig.girdSize && ball.x <= 9 * sysConfig.girdSize);
    return posCheck;
}


// æ˜¯å¦éœ€è¦æ£€æµ‹ç¢°è›‹
function isCheckEgg(ball) {
    return !ball.isMainBall || ball.roleId !== Role.JIANGJIANG.id && (ball.roleId !== Role.KUILEI.id || isKuileiPulling);
}


// æ£€æµ‹æ˜¯å¦ç¢°æ’äº†è‡ªå·±
// å‚€å„¡ç¢°åˆ°è‡ªå·±åï¼Œç»³ç´¢ä¼šç«‹å³åœæ­¢
function checkSelfCollided(ball) {
    if (ball.isMainBall && ball.roleId === Role.KUILEI.id && !isKuileiPulling) {
        if (ball.wallCollidedCount < 1) return; // è‡³å°‘ç¢°å¢™é¢ä¸€æ¬¡æ‰ä¼šåå¼¹ç¢°åˆ°è‡ªå·± 
        tempCheckBall.roleId = ball.roleId;
        tempCheckBall.x = ball.x0;
        tempCheckBall.y = ball.y0;
        tempCheckBall.radius = ball.radiusTmp;
        // æ£€æµ‹ç¢°æ’
        if (is2CirclesCollided(ball, tempCheckBall)) {
            // ç¢°åˆ°è‡ªå·±ï¼Œç»³ç´¢ç«‹å³åœæ­¢
            ball.wallCollidedCount = 3;
        }
    }
}


// è®¡ç®—ä¸¤çƒç¢°æ’åé€Ÿåº¦å’Œæ–¹å‘ã€ä¸å¸¦è´¨é‡ã€‘
function do2BallsCollided(ball0, ball1) {
    let dvx = ball0.vx - ball1.vx;
    let dvy = ball0.vy - ball1.vy;
    let d_x = ball0.x - ball1.x;
    let d_y = ball0.y - ball1.y;
    let xx_yy = d_x * d_x + d_y * d_y;
    let DVx = (dvx * d_x * d_x + dvy * d_x * d_y) / xx_yy;
    let DVy = (dvy * d_y * d_y + dvx * d_x * d_y) / xx_yy;
    ball0.vx = ball0.vx - DVx;
    ball0.vy = ball0.vy - DVy;
    ball1.vx = ball1.vx + DVx;
    ball1.vy = ball1.vy + DVy;
}


// å°çƒå¸¦è´¨é‡ç¢°æ’åå¼¹
var collideParams = { bounce: 0.70, eggId: -1 };
onMounted(() => {
    collideParams.bounce = sysConfig.bounce ? sysConfig.bounce : (sysConfig.friction + 0.00);
    collideParams.eggId = Ball.SPECIALROLEID.eggId;
    if (!collideParams.bounce) collideParams.bounce = 0.70;
    if (!collideParams.eggId) collideParams.eggId = -1;
    console.log(">>>> do2BallsCollidedMV2 params=" + JSON.stringify(collideParams));
})
//function do2BallsCollidedMV2(ball0, ball1, isChPos, isChVel, params) {}


// å°çƒç»˜åˆ¶åŠé€Ÿåº¦çŠ¶æ€æ›´æ–°
function drawAndUpdate(ball, isCheck) {
    // æ‰€æœ‰ç¢°æ’æ£€æµ‹æœªå®Œæˆï¼Œä¸ç»˜åˆ¶ï¼Œä¹Ÿä¸æ›´æ–°é€Ÿåº¦ï¼Œç›´æ¥è¿”å›
    if (!ball.isCheckFinished) return;
    // å°çƒä½ç½®æ²¡åŠ¨ä¸ç”»
    if (ball.isMainBall) { // åªæ£€æµ‹ä¸»çƒ
        if (!isBallDrawAndUpdate(ball, 1)) return;
    } else { // æ£€æµ‹éä¸»çƒ
        if (!isBallDrawAndUpdate(ball, 2)) return;
    }

    if (userConfig.isStopAfter2WallCollided && ball.isMainBall && ball.wallCollidedCount >= 2) { // ç¢°ä¸¤æ¬¡ååœæ­¢ï¼Œç”¨äºæµ‹è¯•è§‚å¯Ÿè§’åº¦
        ball.vx = 0;
        ball.vy = 0;
    }

    if (!isCheck) { // æ£€æµ‹ç¢°æ’ç‚¹ï¼Œä¸ç”¨ç”»ï¼Œä¼˜åŒ–æ€§èƒ½
        ball.draw(); // ç»˜åˆ¶å°çƒ
        ball.drawLinePath(ball.prePoint, { x: ball.x, y: ball.y }); // ç»˜åˆ¶å°çƒæ’å‡»è½¨è¿¹-æ­£å¸¸ç›´çº¿
        ball.drawBallPath(ball.prePoint, { x: ball.x, y: ball.y }); // ç»˜åˆ¶å°çƒæ’å‡»è½¨è¿¹-æœ¬ä½“ç›´çº¿
        if (ball.isWallCollided || ball.isLineCollided || ball.isBallCollided || ball.isEggCollided) ball.preCollided = { x: ball.x, y: ball.y }; // å¤‡ä»½ç¢°æ’ç‚¹
        ball.prePoint = { x: ball.x, y: ball.y }; // å¤‡ä»½è¿åŠ¨ç‚¹
        //ball.drawPointPath(); // ç»˜åˆ¶å°çƒåœ†ç‚¹æ’å‡»è½¨è¿¹
    }
    ball.update(); // æ›´æ–°å°çƒè¿åŠ¨çŠ¶æ€
}


// æ‰€æœ‰ç¢°æ’æ£€æµ‹å®Œæˆä¹‹åï¼Œè¦å¤„ç†çš„äº‹æƒ…
function doAfterCollidCheck() {
    // TODO
}


// åˆ¤æ–­å°çƒæ˜¯å¦åœ¨å››ä¸ªåˆ‡è§’ï¼ˆçŸ©å½¢ï¼‰èŒƒå›´å†…ã€‚æ³¨æ„ï¼Œè¿™é‡Œåªæ˜¯ç²—ç•¥åˆ¤æ–­
function isInAngleArea(ball) {
    let idx = -1;
    // å·¦ä¸Šè§’
    if ((ball.x - ball.radius <= sysConfig.girdSize * 3) && (ball.y - ball.radius <= sysConfig.girdSize * 3)) idx = 0;
    // å³ä¸Šè§’
    if ((ball.x + ball.radius >= sysConfig.girdSize * 11) && (ball.y - ball.radius <= sysConfig.girdSize * 3)) idx = 1;
    // å³ä¸‹è§’
    if ((ball.x + ball.radius >= sysConfig.girdSize * 11) && (ball.y + ball.radius >= sysConfig.girdSize * 19)) idx = 2;
    // å·¦ä¸‹è§’
    if ((ball.x - ball.radius <= sysConfig.girdSize * 3) && (ball.y + ball.radius >= sysConfig.girdSize * 19)) idx = 3;
    //console.log(">>>> isInAngleArea idx=" + idx);
    return idx;
}


// åŸç†ï¼šåŒä¸€æ¡çº¿ä¸Šçš„ç‚¹ï¼Œå€¾æ–œè§’åº¦ç›¸åŒ
// æ”¹å˜äº†yçš„ä½ç½®ï¼Œè¿˜è¦æ‰¾åˆ°å¯¹åº”çš„xä½ç½®ï¼Œç›¸åä¹Ÿä¸€æ ·ã€‚flag=true é€šè¿‡yæ”¹å˜xï¼›flag=false é€šè¿‡xæ”¹å˜y
// åˆ‡è§’è¾¹å› ä¸ºæ—‹è½¬äº†åæ ‡ç³»ï¼Œå•ç‹¬å¤„ç†
function setXOrY(ball, collidedP0, flag) {
    let angle = Math.atan2(ball.vy, ball.vx);
    if (flag) { // y->x
        let x = (collidedP0.y - ball.y) / Math.tan(angle);
        //console.log(">>>> x=" + x);
        // TODO é˜²æ­¢è°ƒæ•´å‡ºé”™
        if (isNumber(x) && isNumber(ball.x - x)) ball.x -= x;
    } else { // x->y
        let y = (collidedP0.x - ball.x) * Math.tan(angle);
        //console.log(">>>> y=" + y);
        if (isNumber(y) && isNumber(ball.y - y)) ball.y -= y;
    }
}


// æ‘©æ“¦åŠ›ä½œç”¨ï¼Œæ•´ä¸ªå°é¢
function checkFriction(ball) {
    if (sysConfig.friction <= 0) return;
    if (ball.isMainBall && ball.roleId === Role.KUILEI.id && !isKuileiPulling) return; // å‚€å„¡çš„ç»³å­ä¸å—æ‘©æ“¦åŠ›å½±å“ï¼Œæ‹‰å›æ—¶å½±å“
    let v = Math.sqrt(ball.vx * ball.vx + ball.vy * ball.vy);
    //if (v > 0 ) console.log(">>>> v=" + v);
    let angle = Math.atan2(ball.vy, ball.vx);
    if (v > sysConfig.friction) {
        v -= sysConfig.friction;
    } else {
        v = 0;
    };
    ball.vx = Math.cos(angle) * v;
    ball.vy = Math.sin(angle) * v;
}


// åå¼¹ç³»æ•°é€Ÿåº¦æŸè€—ï¼Œæ¯å¼¹ä¸€æ¬¡ï¼Œé€Ÿåº¦ä¼šå˜æ…¢ä¸€ç‚¹
function checkBounce(ball, bounceVal) {
    if (!bounceVal && sysConfig.bounce <= 0) return;
    if (ball.isMainBall && ball.roleId === Role.KUILEI.id && !isKuileiPulling) return; // å‚€å„¡çš„ç»³å­ä¸å‡é€Ÿï¼Œæ‹‰å›æ—¶å½±å“
    let v = Math.sqrt(ball.vx * ball.vx + ball.vy * ball.vy);
    //if (v > 0 ) console.log(">>>> v=" + v);
    let val = bounceVal ? bounceVal : sysConfig.bounce;
    if (v > val) {
        //console.log(">>>> checkBounce v=" + v);
        v -= val;
    } else {
        v = 0;
    };
    let angle = Math.atan2(ball.vy, ball.vx);
    ball.vx = Math.cos(angle) * v;
    ball.vy = Math.sin(angle) * v;
}


// ç¢°è›‹åå¼¹åŠ é€Ÿ
function checkEggBounce(ball) {
    if (sysConfig.eggBounce <= 0) return;
    if (ball.isMainBall && (ball.roleId === Role.KUILEI.id && !isKuileiPulling || ball.roleId === Role.JIANGJIANG.id)) return;
    if (ball.vx <= 0 && ball.vy <= 0) return;

    ball.vx = ball.vx >= 0 ? ball.vx + sysConfig.eggBounce : ball.vx - sysConfig.eggBounce;
    ball.vy = ball.vy >= 0 ? ball.vy + sysConfig.eggBounce : ball.vy - sysConfig.eggBounce;
}


// ä¸¤çƒç¢°æ’æ£€æµ‹ï¼ˆåœ†ä¸åœ†ç¢°æ’ï¼‰ã€ç›®å‰æ£€æµ‹åˆ¤æ–­è¿˜å­˜åœ¨ä¸ªåˆ«ç¢°æ’ç©¿é€é—®é¢˜ã€‘
function isCollisionBallAndBall(ball0, ball1) {
    // ä¿©çƒéƒ½æ²¡é€Ÿåº¦ï¼Œä¸ç®—ç¢°æ’
    if (ball0.vx === 0 && ball0.vy === 0 && ball1.vx === 0 && ball1.vy === 0) return false;
    let result = false;
    // å‚€å„¡ç¢°æ’åˆ¤æ–­åŠå¾„å–ç»³å­çš„åŠå¾„
    let KLRadius;
    if (ball0.isMainBall && ball0.roleId === Role.KUILEI.id) {
        if (isKuileiPulling) KLRadius = ball0.radiusTmp;
        else KLRadius = ball0.pathRadius;
    }
    // åŒå­æœ¬ä½“ä¸åˆ†èº«ä¸ä¼šç¢°æ’ï¼Œä¼šç©¿é€
    let twinCheck = isTwinSelf(ball0, ball1);
    result = !twinCheck && (ball0.x - ball1.x) ** 2 + (ball0.y - ball1.y) ** 2 <= ((KLRadius ? KLRadius : ball0.radius) + ball1.radius) ** 2;

    // å¦‚æœæ˜¯ç¢°è›‹æ£€æµ‹ï¼Œç›´æ¥è¿”å›
    if (ball1.roleId === Ball.SPECIALROLEID.eggId) return result;

    // å¤‡ä»½ä¸€ä¸‹ç¢°æ’çŠ¶æ€
    let colliding01 = ball0.collidingNos[ball1.no - 1];

    if (result) {
        if (ball0.collidingNos) ball0.collidingNos[(ball1.no - 1) < 0 ? 0 : (ball1.no - 1)] = true;
        //if (ball1.collidingNos) ball1.collidingNos[(ball0.no - 1) < 0 ? 0 : (ball0.no - 1)] = true;
    } else {
        if (ball0.collidingNos) ball0.collidingNos[(ball1.no - 1) < 0 ? 0 : (ball1.no - 1)] = false;
        //if (ball1.collidingNos) ball1.collidingNos[(ball0.no - 1) < 0 ? 0 : (ball0.no - 1)] = false;
    }

    // è‡ªå·±ä¸ç®—ï¼Œball.collidingNos ä¸­ï¼Œball.no-1 æ˜¯è‡ªå·±
    if (ball0.collidingNos) ball0.collidingNos[(ball0.no - 1) < 0 ? 0 : (ball0.no - 1)] = false;
    if (ball1.collidingNos) ball1.collidingNos[(ball1.no - 1) < 0 ? 0 : (ball1.no - 1)] = false;

    //console.log(">>>> isCollisionBallAndBall ball0:", ball0.collidingNos);
    //console.log(">>>> isCollisionBallAndBall ball1:", ball1.collidingNos);

    // æ­£åœ¨ç¢°æ’ä¸é‡å¤æ£€æµ‹ã€åªå¯¹åƒµå°¸å’Œå‚€å„¡æœªæ‹‰å›æ—¶ç”Ÿæ•ˆã€‘
    if ((userConfig.currRole === Role.JIANGJIANG.id || (userConfig.currRole === Role.KUILEI.id && !isKuileiPulling)) &&
        colliding01 && colliding01 === ball0.collidingNos[ball1.no - 1]) result = false;

    return result;
}


// æ˜¯å¦ä¸ºåŒå­æœ¬ä½“ä¸åˆ†èº«ç¢°æ’
function isTwinSelf(ball0, ball1) {
    let twinCheck = ball0.roleId === ball1.roleId && ball0.roleId === Role.SHUANGZI.id && ball0.teamColor === ball1.teamColor && ball0.no !== ball1.no;
    return twinCheck;
}


// è§’è‰²æ˜¯å¦ç¢°åˆ°äº†è›‹ï¼ˆæœ€å¤šä¸¤ä¸ªè›‹ï¼‰
function isBallAndEggCollided(ball) {
    if (!eggs || eggs.length < 1) return false;
    let result = false;
    eggs.some(egg => {
        if (is2CirclesCollided(ball, egg)) {
            result = true;
            return true; // åªæ˜¯é€€å‡ºäº†å¾ªç¯
        }
    });
    return result;
}


// ä¸¤çƒç¢°æ’æ—¶ï¼Œåœ†å¿ƒè¿çº¿ä¸xè½´çš„å¤¹è§’ã€‚æ³¨æ„ä¸¤çƒé¡ºåºï¼Œçœ‹æ‰“å°ç»“æœï¼Œå–æ­£æ•°é¡ºåº
// ball0 ä¸ºè¿åŠ¨å°çƒï¼Œball1 ä¸ºè¢«æ’å°çƒ
function getAngleOf2BallCollided(ball0, ball1) {
    let dx = ball1.x - ball0.x;
    let dy = ball1.y - ball0.y;
    let angle = Math.atan2(dy, dx);
    //console.log(">>>> getAngleOf2BallCollided=" + angle);
    return angle;
}


// ä¸¤çƒæ­£å¥½ç¢°æ’ï¼Œé€šè¿‡å¤¹è§’è·å–å°çƒåœ†å¿ƒä¸è›‹åœ†å¿ƒçš„ç›¸å¯¹è·ç¦»xã€y
// d ä¸ºä¿©çƒåœ†å¿ƒè·ç¦»
function get2BallCollidedXYByAngle(angle, d) {
    let x = Math.cos(angle) * d;
    let y = Math.sin(angle) * d;
    return { x: x, y: y };
}

//////////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////////
// ã€åŠ¨ç”»æ¸²æŸ“æ§åˆ¶ã€‘ å˜é‡ã€æ–¹æ³•åŒºåŸŸ
//////////////////////////////////////////////////////////////////////

// é€‰ä¸­çš„å°çƒ
var selectedBall = null; // var å…¨å±€å˜é‡ï¼Œå®šä¹‰é¡ºåºä¸å½±å“å‰é¢æ–¹æ³•ä½¿ç”¨
// å°è¯•è¿åŠ¨çš„å°çƒ
//window.onload = function () {};
var tryMoveBall;
onMounted(() => {
    if (balls && balls.length > 0) tryMoveBall = new Ball(context, {
        no: balls[0].no,
        roleId: balls[0].roleId,
        isMainBall: true,
        x: 0,
        y: 0,
        vx: 0,
        vy: 0,
        radius: balls[0].radius,
        color: balls[0].color
    });
})
// å°è¯•è¿åŠ¨çš„å°çƒï¼Œç¬¬ä¸€æ¬¡ç¢°æ’åæ ‡
let tryMoveBallFirstCollidedPos = { x: 0, y: 0 };
// å°è¯•è¿åŠ¨çš„å°çƒï¼Œç¢°æ’ç‚¹åæ ‡
let tryMoveBallCollidedPoints = [];
// æ§åˆ¶ç»˜åˆ¶è¿åŠ¨è½¨è¿¹
let isAnimated = false; // æ¸²æŸ“å®Œæˆ
let isMoving = true; // æ˜¯å¦åœ¨è¿åŠ¨
let isPlaying = true; // æ˜¯å¦åœ¨ç©
let isKuileiPulling = false; // å‚€å„¡æ˜¯å¦æ­£åœ¨æ‹‰å›


// åŠ¨ç”»æ¸²æŸ“å…¥å£
onMounted(() => {
    animate();
})


// åŠ¨ç”»æ¸²æŸ“ä¸»å‡½æ•°ã€‚æ³¨æ„ï¼å¤šæ¬¡è°ƒç”¨è¿™ä¸ªæ¸²æŸ“å‡½æ•°ï¼Œä¼šå¯¼è‡´åŠ¨ç”»å˜å¿«ï¼å³å€é€Ÿå¿«æ”¾çš„æ•ˆæœ
// TODO å‡å°‘å›¾å½¢é‡å¤ç»˜åˆ¶æ¸²æŸ“ï¼Œå¯ä»¥å¾ˆå¥½åœ°èŠ‚çœCPUæ€§èƒ½
function animate() {
    if (!balls || balls.length < 1) return;

    // æ£€æµ‹æ˜¯å¦åœ¨ç©
    checkIsPlaying();

    // é—²ç½®æ²¡ç©äº†ï¼Œæˆ–è€…é•¿æ—¶é—´ç„å‡†ä¸åŠ¨æ—¶ï¼Œåœæ­¢æ¸²æŸ“ï¼Œä¼˜åŒ–CPUæ€§èƒ½
    if (!isPlaying) {
        // TODO å±å¹•å¤šç‚¹è§¦ç¢°ï¼Œå¯èƒ½ä¼šå‡ºç°ç¨‹åºå¼‚å¸¸æƒ…å†µï¼ˆç›®å‰é™åˆ¶äº†å¤šç‚¹è§¦ç¢°ï¼‰ï¼šä¸»çƒæœ‰é€Ÿåº¦ä½†æ˜¯ä¸è¿åŠ¨ï¼Œå¯¼è‡´ä¸æ‰§è¡Œ resetBallsSpeedï¼Œå‡ºç°æ­»å¾ªç¯ï¼
        // æœ‰è¿åŠ¨ç¢°æ’æ‰å¤„ç†åœæ­¢äº‹é¡¹ï¼›å› ä¸ºå•ç‹¬ç¢°è›‹ä¸ç®—ç¢°æ’ï¼Œä¼šå¯¼è‡´ resetBallsSpeed ä¸èƒ½æ‰§è¡Œï¼Œå‡ºç°å¡æ­»ï¼ selectedBall ä¸º null æ—¶ï¼Œä¸»çƒå¼€å§‹è¿åŠ¨
        if (!selectedBall || checkAnyBallCollided(0)) {
            //doAfterBallStopped(balls);
            resetBallsSpeed(balls);
        }
        // æ²¡æœ‰ç¢°æ’ï¼Œå°±åªæ˜¯åœæ­¢ animate æ¸²æŸ“
        return;
    }

    // ä¸åœåœ°æ¸²æŸ“ï¼Œç›¸å¯¹æ¥è¯´æ¯”è¾ƒè€—æ€§èƒ½
    // æ‰§è¡Œæ¬¡æ•°é€šå¸¸æ˜¯æ¯ç§’ 60 æ¬¡ï¼Œå½“é¡µé¢å¤„äºæœªæ¿€æ´»çš„çŠ¶æ€ä¸‹ï¼Œè¯¥é¡µé¢çš„å±å¹•ç»˜åˆ¶ä»»åŠ¡ä¹Ÿä¼šè¢«æµè§ˆå™¨æš‚åœ
    requestAnimationFrame(animate);
    //console.log(">>>> requestAnimationFrame åŠ¨ç”»æ¸²æŸ“ >>>>");

    // æ¸…ç©ºè¿åŠ¨å±‚ç”»å¸ƒã€TODO ç›®å‰å­˜åœ¨ä½ç½®æ²¡å˜ä¼šé‡å¤ç”»ä¸€æ¬¡çš„é—®é¢˜ï¼Œå¯ä»¥çœ‹åˆ°å°ä¸‘åˆ†èº«é€æ˜åº¦å˜åŒ–ã€‘
    doClearMoveCanvas();

    balls.forEach(ball => {
        if (selectedBall === ball) {
            //console.log(">>>> ball=" + JSON.stringify(ball));
            //balls.forEach(draw);
            //console.log(">>>> animate mainBall.x=" + ball.x + ", mainBall.y=" + ball.y);
            ball.draw();
        } else {
            try {
                checkSelfCollided(ball); // è‡ªèº«ç¢°æ’æ£€æµ‹
                checkWalls(ball, false); // å¢™é¢ç¢°æ’æ£€æµ‹
                checkLines(ball, false); // åˆ‡é¢ç¢°æ’æ£€æµ‹
                checkOtherBalls(ball, false); // çƒç¢°æ’æ£€æµ‹
                if (isDuoduoExist) checkEggs(ball, false); // è›‹ç¢°æ’æ£€æµ‹
                checkFriction(ball); // æ‘©æ“¦åŠ›ä½œç”¨
                doAfterCollidCheck(); // æ£€æµ‹å®Œæˆåå¤„ç†ä¸šåŠ¡
            } catch (e) {
                doGlobalError(e, (sysConfig && sysConfig.alertErrorCount) ? sysConfig.alertErrorCount : 3);
            }
        }
    });

    // TODO åŠ¨ç”»ï¼ŒåŠ¨ã€ç”»åˆ†å¼€ç‹¬ç«‹æ§åˆ¶ã€‚åœ¨æ£€æŸ¥ç¢°æ’æ–¹æ³•ä¸­å¯ä»¥æ›´ç»†ç²’åº¦æ§åˆ¶

    // ç»˜åˆ¶
    //lines.forEach(draw); // ç”»äº†åˆ‡è§’å¡«å……ï¼Œåˆ‡è§’çº¿å¯ä»¥ä¸ç”»äº†
    //balls.forEach(draw); // æ”¾æ£€æŸ¥ç¢°æ’æ–¹æ³•ä¸­ç»†ç²’åº¦æ§åˆ¶

    // ç§»åŠ¨ä½ç½®å®Œæˆåï¼Œç»˜åˆ¶ç§»åŠ¨è½¨è¿¹æç¤º
    //if (selectedBall) console.log(">>>> isChgPosFinished:" + selectedBall.isChgPosFinished);
    if (selectedBall && selectedBall.isChgPosFinished && selectedBall.isMainBall) {
        showMovePath();
    }

    // æ¸²æŸ“å®Œæˆ
    isAnimated = true;
}


// å°çƒç»˜åˆ¶
function draw(ball) {
    ball.draw();
}


// æ¸…ç©ºè¿åŠ¨å±‚ç”»å¸ƒ
function doClearMoveCanvas() {
    // æ¸…é™¤ä¸»çƒè¿åŠ¨å±‚ç”»å¸ƒ
    if (isBallDrawAndUpdate(null, 1)) { // ä¸»çƒæœ‰è¿åŠ¨
        console.log(">>>> doClearMoveCanvas gameMainBallCanvas");
        clearCanvasAll(gameMainBallCanvas);
    }
    // æ¸…é™¤ä¸»è¿åŠ¨å±‚ç”»å¸ƒ
    if (isBallDrawAndUpdate(null, 2)) { // éä¸»çƒæœ‰è¿åŠ¨
        console.log(">>>> doClearMoveCanvas canvas");
        clearCanvasAll(canvas);
    }
}


// æ¸…ç©ºè·¯å¾„å±‚ç”»å¸ƒ
function doClearPathCanvas() {
    if (isBallDrawAndUpdate(null, 1)) { // ä¸»çƒæœ‰è¿åŠ¨
        // æ¸…é™¤çƒè·¯å¾„
        console.log(">>>> doClearPathCanvas gamePathBallCanvas");
        clearCanvasAll(gamePathBallCanvas);
        // æ¸…é™¤çº¿è·¯å¾„
        console.log(">>>> doClearPathCanvas gamePathCanvas");
        clearCanvasAll(gamePathCanvas);
    }
}


// æ¸…ç©ºç”»å¸ƒæ‰€æœ‰å†…å®¹
function clearCanvasAll(cvs) {
    let ctx = cvs.getContext('2d');
    ctx.clearRect(0, 0, cvs.width, cvs.height);
    ctx.beginPath(); // å¼€å¯æ–°pathï¼Œé¿å…æ—§çš„pathæ®‹ç•™
}


// æ£€æµ‹æ˜¯å¦åœ¨ç©
function checkIsPlaying() {
    isMoving = checkIsMoving();
    //console.log(">>>> isAnimated=" + isAnimated);
    console.log(">>>> isMoving=" + isMoving);
    //console.log(">>>> isFirstCollidedPointFounded=" + isFirstCollidedPointFounded);
    if (!isAnimated || isMoving) { // æ²¡æœ‰æ¸²æŸ“å®Œæˆï¼Œæˆ–è€…é€Ÿåº¦è¿˜åœ¨å˜åŒ–ï¼Œè¯´æ˜åœ¨ç©
        isPlaying = true;
    } else {
        isPlaying = false;
    }

    // TODO ç„å‡†ä¸åŠ¨æ—¶ï¼Œä¼˜åŒ–CPUæ€§èƒ½
    if (isAnimated && isMoving && isFirstCollidedPointFounded) {
        isPlaying = false; // æ³¨æ„ï¼Œè¿™é‡Œä¼šåœæ­¢æ¸²æŸ“ï¼Œåç»­éœ€è¦å†æ¬¡æ‰‹åŠ¨è°ƒç”¨ animate() è¿›è¡Œæ¸²æŸ“
    }

    console.log(">>>> isPlaying=" + isPlaying);
}


// æ£€æµ‹å¤šä¸ªå°çƒæ˜¯å¦åœ¨è¿åŠ¨
function checkIsMoving() {
    let result = false;
    // æ£€æµ‹tryMoveBall
    //if (tryMoveBall) result = result || (tryMoveBall.vx > 0 || tryMoveBall.vy > 0);
    if (tryMoveBall) result = result || tryMoveBall.isMoving;
    if (result) return result;
    // æ£€æµ‹ball
    if (balls && balls.length > 0) balls.some(ball => {
        result = result || (ball.vx > 0 || ball.vy > 0);
        result = result || ball.isMoving;
        if (result) return true; // åªæ˜¯é€€å‡ºäº†å¾ªç¯
    });
    return result;
}


// animate å•æ¬¡æ‰§è¡Œæ¬¡æ•°è¿‡å¤šï¼Œå¯èƒ½æ˜¯å‡ºç°äº†æ­»å¾ªç¯ï¼Œå°†æ‰€æœ‰å°çƒé€Ÿåº¦ç½®é›¶
function resetBallsSpeed(balls) {
    // é‡ç½®æ‰€æœ‰è§’è‰²é€Ÿåº¦ï¼Œæ›´æ–°è¿åŠ¨çŠ¶æ€
    balls.some(ball => {
        ball.vx = 0;
        ball.vy = 0;
        ball.update();
    });
    // å¤„ç†åœæ­¢äº‹é¡¹ animate() ä¼šè°ƒç”¨
    doAfterBallStopped(balls);
    // å†æ£€æµ‹ä¸€æ¬¡ animate çŠ¶æ€
    checkIsPlaying();
    if (!isMoving && !isPlaying) console.log(">>>> æœ¬å›åˆç»“æŸ >>>>");
}


// å¤„ç†å‡†å¤‡ tryMoveBall
function preTryMoveBall(num) {
    if (!tryMoveBall || !tryMoveBall.isMainBall) return;
    // tryMoveBall é¢œè‰²è·Ÿä¸»çƒåŒæ­¥
    tryMoveBall.teamColor = balls[0].teamColor;
    if (tryMoveBall.roleId !== Role.KUILEI.id) return;
    // è°ƒæ•´åŠå¾„
    switch (num) {
        case 0: // è¿˜åŸ
            tryMoveBall.radius = balls[0].radiusTmp;
            balls[0].radius = balls[0].radiusTmp;
            break;
        case 1: // è°ƒæ•´åŠå¾„
            tryMoveBall.radius = balls[0].tryRadius;
            balls[0].radius = balls[0].tryRadius;
            break;
        default:

    }
}


// é‡ç½®tryMoveBall
function resetTryMoveBall() {
    if (!balls || balls.length < 1) return;
    if (!tryMoveBall) return;
    tryMoveBall.teamColor = balls[0].teamColor;
    tryMoveBall.v = balls[0].v;
    tryMoveBall.vx = 0;
    tryMoveBall.vy = 0;
    tryMoveBall.isMoving = false;
    tryMoveBall.isChgPosFinished = false;
}


// å°è¯•ç§»åŠ¨ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªç¢°æ’åæ ‡ï¼Œç”¨äºæ§åˆ¶è¿åŠ¨è½¨è¿¹æ˜¾ç¤º
let isFirstCollidedPointFounded = false;
function doTryMoveBallFirstCollidedPos() {
    if (!tryMoveBall || !selectedBall.isChgPosFinished) return;
    //console.log(">>>> doTryMoveBallFirstCollidedPos...");
    // æ¨¡æ‹Ÿå°çƒè¿åŠ¨
    // TODO å¯èƒ½å¾ªç¯å‡ æ¬¡åˆ°å››äº”åæ¬¡ï¼Œæ‰èƒ½æ‰¾åˆ°ï¼Œéå¸¸è€—æ€§èƒ½ï¼å¬åˆ°CPUé£æ‰‡åŠ é€Ÿå£°å“äº†ï¼ï¼ã€éœ€è¦ä¼˜åŒ–ã€‘
    let count = 0; // è›®ç‹ææ…¢ï¼Œå¾ªç¯äº† 36 æ¬¡å·¦å³
    //while (!tryMoveBall.isCollided) {
    while (!isTryMoveBallRecordFinished()) {
        try {
            checkWalls(tryMoveBall, true); // å¢™é¢ç¢°æ’æ£€æµ‹
            checkLines(tryMoveBall, true); // åˆ‡é¢ç¢°æ’æ£€æµ‹
            checkOtherBalls(tryMoveBall, true); // çƒç¢°æ’æ£€æµ‹
            if (isDuoduoExist) checkEggs(tryMoveBall, true); // è›‹ç¢°æ’æ£€æµ‹
            checkFriction(tryMoveBall); // æ‘©æ“¦åŠ›ä½œç”¨
            doAfterCollidCheck(); // æ£€æµ‹å®Œæˆåå¤„ç†ä¸šåŠ¡
        } catch (e) {
            doGlobalError(e, (sysConfig && sysConfig.alertErrorCount) ? sysConfig.alertErrorCount : 3);
        }

        // è¾¾åˆ°æ¬¡æ•°åï¼Œå°±ç®—æ²¡æ‰¾åˆ°ï¼Œä¹Ÿé€€å‡ºï¼Œé¿å…æ­»å¾ªç¯
        count++;
        console.log(">>>> doTryMoveBallFirstCollidedPos count=" + count);
        if (count > 100) break;
    }
    console.log(">>>> æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ’å‡»ç‚¹åæ ‡ï¼šx=" + tryMoveBallFirstCollidedPos.x + ", y=" + tryMoveBallFirstCollidedPos.y);
    isFirstCollidedPointFounded = true;
    // é‡ç½®æ ‡å¿—
    if (tryMoveBall.isCollided) tryMoveBall.isCollided = false;
    // é‡ç½®é€Ÿåº¦
    doTryMoveBallFinished();
}


// å°è¯•è¿åŠ¨å°çƒç¢°æ’çš„è®°å½•æ˜¯å¦å®Œæˆ
function isTryMoveBallRecordFinished() {
    // åƒµå°¸ã€å‚€å„¡ç­‰ç©¿é€è§’è‰²ï¼Œå– userConfig.tryFullPathPointNum é…ç½®å€¼
    if (isRoleCanPierces()) {
        if (userConfig.currRole === Role.KUILEI.id && tryMoveBallCollidedPoints.length >= 3) return true;
        //if (userConfig.currRole === Role.JIANGJIANG.id && tryMoveBallCollidedPoints.length >= userConfig.tryFullPathPointNum + 1) return true;
        if (tryMoveBallCollidedPoints.length >= userConfig.tryFullPathPointNum) return true;
    } else { // å…¶ä»–è§’è‰²åªå–ç¬¬ä¸€ä¸ªç¢°æ’ç‚¹
        if (tryMoveBallFirstCollidedPos.x > 0 && tryMoveBallFirstCollidedPos.y > 0) return true;
    }
    return false;
}


// å°è¯•è¿åŠ¨å°çƒä»»åŠ¡å®Œæˆå¤„ç†äº‹é¡¹
function doTryMoveBallFinished() {
    if (!tryMoveBall) return;
    tryMoveBall.vx = 0;
    tryMoveBall.vy = 0;
}


// è®°å½•ç¢°æ’ç‚¹åæ ‡
function recordCollidedPoint(ball) {
    //console.log(">>>> recordCollidedPoint ball: " + JSON.stringify(ball));
    if (!tryMoveBallCollidedPoints) tryMoveBallCollidedPoints = [];
    // ä¸èƒ½ç©¿é€çš„è§’è‰²ï¼Œåªè®°å½•ç¬¬ä¸€ä¸ªæ’å‡»ç‚¹åæ ‡
    if (!isRoleCanPierces() && tryMoveBallCollidedPoints.length > 0) tryMoveBallCollidedPoints = [];
    if (tryMoveBallCollidedPoints.length === 0) {
        tryMoveBallFirstCollidedPos.x = ball.x;
        tryMoveBallFirstCollidedPos.y = ball.y;
        tryMoveBallCollidedPoints[0] = tryMoveBallFirstCollidedPos;
    } else {
        tryMoveBallCollidedPoints.push({ x: ball.x, y: ball.y });
    }
    console.log(">>>> recordCollidedPoint è®°å½•æ’å‡»ç‚¹[" + tryMoveBallCollidedPoints.length + "]åæ ‡ï¼šx=" + ball.x + ", y=" + ball.y);
    return true;
}


// ä¸»è§’è‰²è¿åŠ¨å®Œæˆåï¼Œè¦å¤„ç†çš„äº‹æƒ…
// function doAfterBallStopped(balls) {}
function doAfterBallStopped(balls) {
    if (!balls || balls.length < 1) return;
    for (let i = 0, len = balls.length; i < len; i++) {
        console.log('>>>> doAfterBallStopped ' + balls[i].getBallDesc());
        // å‚€å„¡æ‰“å®Œå
        if (userConfig.currRole === Role.KUILEI.id && balls[i].roleId === Role.KUILEI.id && balls[i].isMainBall)
            doKuilei(balls[i]);
        // åŒå­æ‰“å®Œå
        if (userConfig.currRole === Role.SHUANGZI.id && balls[i].roleId === Role.SHUANGZI.id && balls[i].isMainBall)
            afterTwins(selectedBall ? false : true);
    }

    // é‡ç½®è§’è‰²å­—æ®µå±æ€§å€¼ï¼Œä¸»è¦æ˜¯ç¢°æ’æ¬¡æ•°æ¸…é›¶
    resetRoleField();

    // è¿åŠ¨ç»“æŸï¼Œé®ç½©å±‚è°ƒåˆ°æœ€ä¸‹ï¼Œé¿å…æŒ¡ä½æ‹–åŠ¨ ã€æ”¾æœ€åã€‘
    changeCanvasIndex(gameMaskCanvas, -2);

    // é‡ç½®è¶…æ—¶è®¡æ—¶å™¨
    autoStopTimer && clearTimeout(autoStopTimer);
    //console.log(">>>> autoStopTimer:", autoStopTimer);
    autoStopTimer = null;
}


// è°ƒæ•´æŒ‡å®šå›¾å±‚z-index
function changeCanvasIndex(target, idx) {
    target.style.zIndex = idx;
}


// TODO å¼€æ‰“åï¼Œè¶…æ—¶è‡ªåŠ¨åœæ­¢ï¼Œé˜²æ­¢ç¨‹åºå¼‚å¸¸ï¼Œå¯¼è‡´é«˜è€—ç”µï¼
// åœ¨ doAfterBallStoppedã€resetBallsSpeed ç­‰æ¸¸æˆç»“æŸçš„åœ°æ–¹ï¼Œä¹Ÿè¦æ¸…ç†é‡ç½®å®šæ—¶å™¨
var autoStopTimer;
function autoStopTimeout(sec) {
    let sTime = new Date().getTime();
    autoStopTimer && clearTimeout(autoStopTimer);
    if (!sec) sec = userConfig.animateAutoRestTime;
    if (!sec) sec = 20;
    autoStopTimer = setTimeout(() => {
        resetBallsSpeed(balls);
        let eTime = new Date().getTime();
        let runTime = Math.round((eTime - sTime) / 1000);
        console.log('>>>> autoStopTimeout: ' + runTime);
        alert('ğŸ‘‰ æœ¬å›åˆè¿è¡Œäº† ' + runTime + ' ç§’ï¼Œå·²è¶…æ—¶è‡ªåŠ¨ç»“æŸã€‚');
    }, sec * 1000);
}


// å¤„ç†å‚€å„¡æ‰“å®Œåä¸šåŠ¡é€»è¾‘
function doKuilei(ball) {
    if (!ball || userConfig.currRole !== Role.KUILEI.id || !ball.isMainBall || ball.roleId !== Role.KUILEI.id || ball.wallCollidedCount < 2) return;
    if (isKuileiPulling) { // å‚€å„¡æ‹‰å›ä¹‹å‰å·²ç»è¿˜åŸè¿‡ä¸€æ¬¡äº†ï¼Œæ‹‰å›æ‰“å®Œç›´æ¥é‡ç½®çŠ¶æ€è¿”å›å°±è¡Œ
        // é‡ç½®æ‹‰å›çŠ¶æ€
        isKuileiPulling = false;
        return;
    }
    // è¿˜åŸ tryMoveBall
    preTryMoveBall(0);
    // åæ ‡å›åˆ°èµ·ç‚¹
    setBallPosToBeginPoint(ball);
    //globalParams.composite = "source-over";
    //ball.drawIcon(globalParams);
    //ball.drawRoleBloodLine(globalParams);
    //ball.drawCurrentCircle();
}


// å¤„ç†å‚€å„¡æ‰“å®Œåæ‹‰å›ä¸šåŠ¡é€»è¾‘
function doKuileiPullBack(ball) {
    if (!ball || userConfig.currRole !== Role.KUILEI.id || !ball.isMainBall
        || ball.roleId !== Role.KUILEI.id || ball.wallCollidedCount < 2
        || !userConfig.isKuileiPullBack || isKuileiPulling
        || ball.roleCollidedCount < 1) return;
    // æ¸…ç©ºè·¯å¾„å±‚ç”»å¸ƒ
    doClearPathCanvas();
    // å‚€å„¡å…ˆåœæ­¢è¿åŠ¨
    ball.vx = 0;
    ball.vy = 0;
    // å‚€å„¡ç»³å­å¤ä½
    doKuilei(ball);
    // è®¾ç½®è§’è‰²æ‹‰å›é€Ÿåº¦
    getPullBackSpeed();
    // é‡ç½®è§’è‰²å­—æ®µå±æ€§å€¼
    //resetRoleField();
    // é‡ç½®å„ä¸ªå°çƒçš„ç¢°æ’æ ‡å¿—ä½
    //setBallCollidingNos();
    // è®¾ç½®å‚€å„¡æ‹‰å›æ ‡å¿—
    isKuileiPulling = true;
}


// è®¾ç½®å°çƒä½ç½®åˆ°åŸå§‹èµ·ç‚¹
function setBallPosToBeginPoint(ball) {
    ball.x = ball.x0;
    ball.y = ball.y0;
    // TODO æ‰‹åŠ¨äº§ç”Ÿä¸€ä¸ªå¾ˆå°çš„å˜åŠ¨ï¼Œåæ ‡ä¸€æ ·ä¼šå¯¼è‡´ä¸»çƒè·¯å¾„æ¸…ç†ä¸æ‰
    ball.x0 -= 0.000001;
}


// æ ¹æ®é¼ æ ‡ä¸å°çƒè¿çº¿è§’åº¦ï¼Œè·å–vxã€vy
//function getVxVy(p1, p2) {}
function getVxVy(p1, p2, v, ball) {
    if (!ball) return { vx: 0, vy: 0 };
    let targetBall = ball;
    //if (!targetBall) targetBall = balls[0];
    // è·å–è§’åº¦ï¼Œé¼ æ ‡ä½ç½®ã€çƒä½ç½®ï¼Œä¸¤ç‚¹è¿çº¿ä¸yè½´çš„è§’åº¦
    // 1-è¿‘ç‚¹ï¼ˆä¸»çƒï¼‰ï¼›2-è¿œç‚¹
    //let angle = getAngle({x:mouse.x, y:mouse.y},{x:targetBall.x, y:targetBall.y});
    let angle = getAngleX({
        x: p1 ? p1.x : targetBall.x,
        y: p1 ? p1.y : targetBall.y
    }, {
        x: p2 ? p2.x : mouse.x,
        y: p2 ? p2.y : mouse.y
    });
    //console.log('>>>> angle=' + angle);

    // å·²çŸ¥è§’åº¦ã€é€Ÿåº¦vï¼Œæ±‚ vx vy
    let radians = angle * Math.PI / 180;
    let vx = Math.cos(radians) * (v ? v : targetBall.v);
    let vy = Math.sin(radians) * (v ? v : targetBall.v);
    //console.log('>>>> vx=' + vx + '; vy=' + vy);

    // TODO è¿åŠ¨åå‘å–åï¼Œæ¨¡æ‹Ÿç©å§æ’å‡»ç‹è€…
    if (ball) {
        ball.vx = -vx;
        ball.vy = -vy;
    }

    return { vx: -vx, vy: -vy };
}


// æ˜¾ç¤ºè½¨è¿¹æç¤º
function showMovePath() {
    if (!selectedBall || !tryMoveBallCollidedPoints || tryMoveBallCollidedPoints.length < 1) return;
    let collidedPoint, p1, p2;
    for (let i = 0, len = tryMoveBallCollidedPoints.length; i < len; i++) {
        collidedPoint = tryMoveBallCollidedPoints[i];
        if (!collidedPoint) continue;
        if (collidedPoint.x <= 0 || collidedPoint.y <= 0) continue;
        // ç¬¬ä¸€ä¸ªç¢°æ’ç‚¹
        if (i === 0) p1 = { x: selectedBall.x, y: selectedBall.y }; // çƒä½ç½®
        else p1 = { x: tryMoveBallCollidedPoints[i - 1].x, y: tryMoveBallCollidedPoints[i - 1].y };
        p2 = { x: tryMoveBallCollidedPoints[i].x, y: tryMoveBallCollidedPoints[i].y }; // ç¢°æ’ç‚¹åæ ‡
        drawLine2Point(p1, p2);
    }
}


// ç»˜åˆ¶ç„å‡†çº¿ï¼Œå°çƒä¸­å¿ƒç‚¹ä¸ç¢°æ’ç‚¹è¿çº¿
// è·å–äº†ç¬¬ä¸€ä¸ªç¢°æ’ç‚¹ï¼Œå°±ä¸ç”¨åå‘ï¼Œç›´æ¥è¿æ¥çƒä½ç½®ä¸ç¬¬ä¸€ä¸ªæ’å‡»ç‚¹ä½ç½®å³å¯
function drawLine2Point(p1, p2) {
    if (!selectedBall || !selectedBall.isMainBall) return; // éä¸»çƒä¸ç”»
    let context = selectedBall.context;
    context.save();
    context.beginPath();
    context.globalCompositeOperation = "destination-over";
    context.moveTo(p1.x, p1.y); // èµ·å§‹ä½ç½®
    context.lineTo(p2.x, p2.y); // ç»“æŸä½ç½®
    context.strokeStyle = '#cfe0d330';
    if (userConfig.sceneThemeMode === 5) // å¤æ—¥ä¸»é¢˜
        context.strokeStyle = "#F9FBF540";
    context.lineWidth = selectedBall.radius * 2;
    if (selectedBall.isMainBall && selectedBall.roleId === Role.KUILEI.id) context.lineWidth = selectedBall.tryRadius * 2;
    context.lineCap = "round"; // åœ†è§’
    //context.closePath(); // é—­åˆè·¯å¾„åæ˜¯çŸ©å½¢
    context.stroke();
    context.restore();
    // ç„å‡†ç¢°æ’ç‚¹ç”»è™šçº¿åœˆ
    context.save();
    context.beginPath();
    context.arc(p2.x, p2.y, selectedBall.tryRadius, Math.PI / 180 * 0, Math.PI / 180 * 360);
    context.lineWidth = 1 * dpr * sysConfig.pxRatio;
    context.strokeStyle = "#E6ECFF75";
    if (userConfig.sceneThemeMode === 5) // å¤æ—¥ä¸»é¢˜
        context.strokeStyle = "#F9FBF5A0";
    context.setLineDash([6 * dpr * sysConfig.pxRatio, 3 * dpr * sysConfig.pxRatio]);
    if (selectedBall.isMainBall && selectedBall.roleId === Role.KUILEI.id) context.setLineDash([2 * dpr * sysConfig.pxRatio, 2 * dpr * sysConfig.pxRatio]);
    context.closePath();
    context.stroke(); // ç©ºå¿ƒ
    context.restore();
    // èµ·ç‚¹è¢«ç›´çº¿è¦†ç›–äº†ï¼Œé‡ç”»ä¸€æ¬¡
    //selectedBall.draw();
}


// è·å–ä¸¤ç‚¹è¿çº¿ä¸Xè½´çš„å¤¹è§’ 1-è¿‘ç‚¹ï¼›2-è¿œç‚¹
const getAngleX = ({ x: x1, y: y1 }, { x: x2, y: y2 }) => {
    let angle = Math.atan2(y2 - y1, x2 - x1) * 180 / (Math.PI);
    //angle = angle < 0 ? angle + 360 : angle;
    return angle;
}
// è·å–ä¸¤ç‚¹è¿çº¿ä¸Yè½´çš„å¤¹è§’ 1-è¿‘ç‚¹ï¼›2-è¿œç‚¹
const getAngleY = ({ x: x1, y: y1 }, { x: x2, y: y2 }) => {
    let angle = Math.atan2(x2 - x1, y2 - y1) * 180 / (Math.PI);
    angle = angle < 0 ? angle + 360 : angle;
    return angle;
}

//////////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////////
// ã€ç‚¹å‡»ã€æ‹–åŠ¨äº‹ä»¶ã€‘ å˜é‡ã€æ–¹æ³•åŒºåŸŸ
//////////////////////////////////////////////////////////////////////
// é•¿æŒ‰å®šæ—¶å™¨
let longPressTimer = 0;
// é•¿æŒ‰åæ ‡
let longPressPoint = { x: 0, y: 0 };
// å°çƒæ‹–åŠ¨å‰çš„åæ ‡
let oldBallPos = { x: 0, y: 0 };
// ç§»åŠ¨ç«¯å¼€å§‹è§¦æ‘¸äº‹ä»¶
let currTouchPointNum = 0;


// äº‹ä»¶é¡ºåºï¼štouchstart-touchmove-touchend-mousedown-mouseup-click
// mousedownäº‹ä»¶è§¦å‘æ—¶ç»‘å®šmousemoveã€mouseupäº‹ä»¶ï¼Œmouseupäº‹ä»¶è§¦å‘æ—¶ï¼Œè§£é™¤mousemoveã€mouseupäº‹ä»¶
onMounted(() => {
    if (os.isPc) canvas.addEventListener('mousedown', (e) => {

        if (isMoving) return; // è¿åŠ¨çŠ¶æ€

        doEventDefault(e); // å¤„ç†äº‹ä»¶é»˜è®¤è¡Œä¸º

        //balls.some(ball => {
        // æ·»åŠ äº‹ä»¶æ¥æ¨¡æ‹Ÿæ‹–æ‹½
        // æ³¨æ„ï¼Œç§»é™¤å’Œæ·»åŠ çš„å‡½æ•°åå¿…é¡»ä¸€æ¨¡ä¸€æ ·ï¼Œä¸èƒ½å¸¦å‚æ•°ï¼Œå¦åˆ™ä¸èƒ½æ­£å¸¸ç§»é™¤
        canvas.removeEventListener('mousemove', onMouseOrTouchMove, false);
        canvas.addEventListener('mousemove', onMouseOrTouchMove, false);
        canvas.removeEventListener('mouseup', onMouseUp, false);
        canvas.addEventListener('mouseup', onMouseUp, false);
        //return true;
        //});

        // é¼ æ ‡å·¦é”®æŒ‰ä¸‹ï¼Œè®¾ç½®é•¿æŒ‰å®šæ—¶å™¨
        longPressTimer && clearTimeout(longPressTimer);
        longPressTimer = setTimeout(() => { doLongPress(e) }, 500);

    }, false);

    if (!os.isPc) canvas.addEventListener('touchstart', (e) => {
        //console.log(e);
        doEventDefault(e);
        currTouchPointNum = e.touches.length;
        // ç›®å‰åªæ”¯æŒå•ç‚¹è§¦ç¢°
        if (currTouchPointNum !== 1) return;
        getClickPos(e);
        // è§¦æ‘¸å¼€å§‹ï¼Œè®¾ç½®é•¿æŒ‰å®šæ—¶å™¨
        longPressPoint.x = mouse.x;
        longPressPoint.y = mouse.y;
        longPressTimer && clearTimeout(longPressTimer);
        longPressTimer = setTimeout(() => { doLongPress(e) }, 500);
    }, false);
})


// é¼ æ ‡æŒ‰ä¸‹å¹¶æ‹–åŠ¨
var isMouseMoving = false;
function onMouseMove(isPlay2) {

    // å¦‚æœæ˜¯å¯¼å…¥ï¼Œæ ‡è®°ç§»åŠ¨å®Œæˆ
    if (userConfig.shareRoleAndPos) {
        selectMainBall(); // é€‰ä¸­ä¸»çƒ
        selectedBall.isChgPosFinished = true; // æ ‡è®°ç§»åŠ¨å®Œæˆ
        setBallsPosBack(false); // è¿˜åŸåŸå§‹ä½ç½®åæ ‡
        clearShareRoleAndPos(); // æ¸…é™¤å¯¼å…¥æ•°æ®
    }

    if (!selectedBall) return;
    console.log(">>>> onMouseMove " + selectedBall.getBallDesc());

    // æ ‡è®°é¼ æ ‡æ­£åœ¨æ‹–åŠ¨
    isMouseMoving = true;
    // åŒå‡»ä¸ç®—æ‹–åŠ¨
    if (isPlay2) isMouseMoving = false;

    // æ ‡è®°æ¸¸æˆå¼€å§‹
    sysConfig.isGameBeginning = true;

    // æ‹–åŠ¨æ—¶æ¸…ç©ºäº†ç”»å¸ƒï¼Œéœ€è¦é‡æ–°æ¸²æŸ“ç•Œé¢
    isAnimated = false;
    if (!isPlaying) animate(); // åŠ¨ç”»æ¸²æŸ“åï¼ŒisAnimated æ ‡è¯†ä¸º true

    // æ¸…ç©ºè¿åŠ¨å±‚ç”»å¸ƒ
    //doClearMoveCanvas();
    // æ¸…ç©ºè·¯å¾„å±‚ç”»å¸ƒ
    doClearPathCanvas();

    // é‡ç½®ä¹‹å‰æ‰¾åˆ°çš„æ’å‡»ç‚¹åæ ‡ã€å¿…é¡»æ”¾è¿™ã€‘
    tryMoveBallFirstCollidedPos.x = 0;
    tryMoveBallFirstCollidedPos.y = 0;
    tryMoveBallCollidedPoints = [];

    //console.log(">>>> onMouseMove isChgPosFinished=" + selectedBall.isChgPosFinished);
    if (!selectedBall.isChgPosFinished) { // è¿˜åœ¨æ‹–åŠ¨
        //console.log(">>>> onMouseMove mouse.x=" + mouse.x + ", mouse.y=" + mouse.y);
        if (!isPlay2) {
            selectedBall.x = mouse.x;
            selectedBall.y = mouse.y;
        }
        //selectedBall.x0 = mouse.x;
        //selectedBall.y0 = mouse.y;
        // åŒå­åˆ†èº«ä½ç½®å¤„ç†
        afterTwins(false);

        // å°çƒç¢°æ’æ£€æµ‹ï¼Œæ”¾æœ€å‰é¢ï¼Œé¿å…å°çƒä½ç½®è¶…å‡ºå¢™é¢è¾¹ç•Œ
        checkOtherBallCollided(selectedBall, true);
        // å››é¢å¢™æ£€æµ‹
        checkWallCollided(selectedBall, true);
        // å››ä¸ªåˆ‡é¢æ£€æµ‹
        checkLineCollided(selectedBall, true);
        // è›‹åˆ‡é¢ç¢°æ’æ£€æµ‹
        if (isDuoduoExist) checkEggCollided(selectedBall, true);

        //console.log(">>>> onMouseMove selectedBall.x=" + selectedBall.x + ", selectedBall.y=" + selectedBall.y);

        // åæ ‡æç¤ºè·Ÿéšæ˜¾ç¤º
        setRolePosLineFollowing(selectedBall, true);

        // çŸ­æ—¶é—´è¯¯ç¢°ï¼Œé‡æ–°æ¸²æŸ“
        isAnimated = false;
        if (!isPlaying) animate();
        // æ¸…ç©ºè·¯å¾„å±‚ç”»å¸ƒ
        doClearPathCanvas();

    } else { // æ‹–åŠ¨å®Œæˆï¼ŒåŠ¨æ€æ˜¾ç¤ºå°çƒè¿åŠ¨æ–¹å‘
        // åæ ‡æç¤ºè·Ÿéšå…³é—­
        setRolePosLineFollowing(selectedBall, false);

        // è·å–å°çƒåˆ†é€Ÿåº¦ vxã€vy
        if (isRoleCanPierces()) { // èƒ½ç©¿é€çš„è§’è‰²ï¼Œé€Ÿåº¦è®¾ç½®å¤§ä¸€äº›ï¼ŒåŠ å¿«æ‹¿åˆ°å‰5ä¸ªç¢°æ’ç‚¹ï¼Œå‡å°‘å»¶è¿Ÿ
            tryMoveBall.v = 200;
            getVxVy(null, null, tryMoveBall.v, selectedBall);
        } else { // å…¶ä»–è§’è‰²
            getVxVy(null, null, null, selectedBall);
        }
        // æ›´æ–°ç§»åŠ¨çš„çƒ
        tryMoveBall.x = selectedBall.x;
        tryMoveBall.y = selectedBall.y;
        //tryMoveBall.x0 = selectedBall.x;
        //tryMoveBall.y0 = selectedBall.y;
        tryMoveBall.vx = selectedBall.vx;
        tryMoveBall.vy = selectedBall.vy;
        // å‡†å¤‡ tryMoveBall
        preTryMoveBall(1);
        // å°è¯•æ¨¡æ‹Ÿè¿åŠ¨æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ’å‡»ç‚¹
        doTryMoveBallFirstCollidedPos();
    }
}


// è§’è‰²åæ ‡æç¤ºè·Ÿéšè§’è‰²ç§»åŠ¨
let rolePosXEle, rolePosYEle, rolePosLineTimer;
function setRolePosLineFollowing(ball, isShow) {
    if (!userConfig.isShowRoleMovePos) return;
    //if (!ball) return;

    // æ¸…ç†å®šæ—¶å™¨
    rolePosLineTimer && clearTimeout(rolePosLineTimer);

    let girdCount = 2.5;
    if (userConfig.isShowRoleBloodLine) girdCount = 3.2;
    //rolePosLine.style.left = (screenPos.x - rolePosLine.getBoundingClientRect().width / 2).toFixed(2) + "px";
    //rolePosLine.style.top = (screenPos.y - sysConfig.girdSizeCss * girdCount).toFixed(2) + "px";
    rolePosLine.style.left = (ball.x / dpr + sysConfig.cLeft - rolePosLine.getBoundingClientRect().width / 2).toFixed(2) + "px";
    rolePosLine.style.top = (ball.y / dpr + sysConfig.cTop - sysConfig.girdSizeCss * girdCount).toFixed(2) + "px";

    if (!rolePosXEle) rolePosXEle = document.getElementById("rolePosX");
    if (!rolePosYEle) rolePosYEle = document.getElementById("rolePosY");
    let pos = { x: ball.x, y: ball.y };
    switchPxOrGird(pos, 0);
    //switchPxOrGird(pos, 1);
    rolePosXEle.innerText = pos.x.toFixed(2);
    rolePosYEle.innerText = pos.y.toFixed(2);

    if (isShow) rolePosLine.style.display = "unset";
    else rolePosLine.style.display = "none";
}


// åæ ‡æ¢ç®—
function switchPxOrGird(p, no) {
    switch (no) {
        case 1: // gird to px
            // x
            if (p.x >= 0) {
                p.x += 7;
            } else {
                p.x = 7 + p.x;
            }
            //y
            if (p.y >= 0) {
                p.y = 11 - p.y;
            } else {
                p.y = 11 - p.y;
            }

            p.x = roundNumber(p.x * sysConfig.girdSize, 2);
            p.y = roundNumber(p.y * sysConfig.girdSize, 2);
            break;
        default: // px to gird
            p.x = roundNumber((p.x / sysConfig.girdSize - 7), 2);
            p.y = roundNumber(((p.y / sysConfig.girdSize - 11) * -1), 2);
    }
}


function onMouseUp() {
    // é¼ æ ‡å·¦é”®æŠ¬èµ·ï¼Œé‡ç½®é•¿æŒ‰å®šæ—¶å™¨
    longPressTimer && clearTimeout(longPressTimer);
    longPressTimer = 0;
    // æ¸…é™¤äº‹ä»¶
    canvas.removeEventListener('mousemove', onMouseOrTouchMove, false);
    canvas.removeEventListener('mouseup', onMouseUp, false);
}


function onMouseOrTouchMove(e) {
    //console.log(e);
    doEventDefault(e);
    // è§£å†³éƒ¨åˆ†æœºå‹ï¼Œæ‰‹æŒ‡æ²¡æœ‰moveï¼Œtouchmoveäº‹ä»¶ä»ä¼šè¢«è°ƒç”¨çš„é—®é¢˜
    if (longPressPoint.x !== mouse.x || longPressPoint.y !== mouse.y) {
        // æœ‰æ‹–åŠ¨è¡Œä¸ºï¼Œé‡ç½®é•¿æŒ‰å®šæ—¶å™¨
        longPressTimer && clearTimeout(longPressTimer);
        longPressTimer = 0;
    }
    selectBall();
    onMouseMove();
}


function onTouchEnd() {
    // æ¸…é™¤äº‹ä»¶
    canvas.removeEventListener('touchmove', onMouseOrTouchMove, false);
    canvas.removeEventListener('touchend', onTouchEnd, false);
}

// é€‰ä¸­å°çƒ
function selectBall(pos) {
    if (selectedBall) return;
    balls.some(ball => {
        if (isBallSelected(ball, pos)) {
            selectedBall = ball;
            oldBallPos.x = ball.x;
            oldBallPos.y = ball.y;
            return true;
        }
    });
}


// ç§»åŠ¨ç«¯æ‹–åŠ¨äº‹ä»¶
// touchstart --> mousedown æ‰‹æŒ‡åœ¨å…ƒç´ æŒ‰ä¸‹
// touchmove --> mousemove æ‰‹æŒ‡åœ¨å…ƒç´ æŒ‰ä¸‹ä¹‹åï¼Œåœ¨å±å¹•ä¸­ç§»åŠ¨
// touchend --> mouseup æ‰‹æŒ‡åœ¨å…ƒç´ æŒ‰ä¸‹ä¹‹åï¼Œåœ¨å±å¹•ä¸­æŠ¬èµ·
onMounted(() => {
    if (!os.isPc) canvas.addEventListener('touchmove', (e) => {
        if (currTouchPointNum !== 1) return;
        onMouseOrTouchMove(e);
    }, false);
})


// å•å‡»å¼€å§‹å¾€æŒ‡å®šæ–¹å‘è¿åŠ¨
// äº‹ä»¶é¡ºåº mousedownã€mouseupã€clickï¼Œå‰ä¸€ä¸ªäº‹ä»¶æ‰§è¡Œå®Œæ¯•æ‰ä¼šæ‰§è¡Œä¸‹ä¸€ä¸ªäº‹ä»¶
onMounted(() => {
    if (os.isPc) canvas.addEventListener('click', (e) => {
        doEventDefault(e);
        getClickPos(e);
        doClick(e);

    }, false);
})


// åŒå‡»å…è®¸æ‹–åŠ¨å°çƒä½ç½®
onMounted(() => {
    if (os.isPc) canvas.addEventListener('dblclick', (e) => {
        doEventDefault(e);
        doDbClick(e);

    }, false);
})


// ç§»åŠ¨ç«¯å•ã€åŒå‡»äº‹ä»¶
onMounted(() => {
    let lastTouchEnd = 0;
    if (!os.isPc) canvas.addEventListener('touchend', (e) => {
        //console.log(e);
        //alert(e.touches.length);
        doEventDefault(e);
        //if (e.type !== "touchend" && e.touches.length !== 0) return;
        if (currTouchPointNum !== 1) return;
        // è§¦æ‘¸ç»“æŸï¼Œé‡ç½®é•¿æŒ‰å®šæ—¶å™¨
        longPressTimer && clearTimeout(longPressTimer);
        longPressTimer = 0;

        let now = (new Date()).getTime();
        if (now - lastTouchEnd <= 300) { // 200~300
            //alert(">>>> åŒå‡»äº†");
            doDbClick(e);
        } else {
            //alert(">>>> å•å‡»äº†");
            doClick(e);
        }
        lastTouchEnd = now;
    }, false);
})


// å•å‡»åå¤„ç†é€»è¾‘
function doClick(e) {

    // ä¸‰è¿å‡»è®¡æ•°
    //preTripleClick(e);
    // é¼ æ ‡æˆ–æ‰‹æŒ‡æŠ¬èµ·ï¼Œæ ‡è®°é¼ æ ‡æ²¡æœ‰åœ¨æ‹–åŠ¨
    isMouseMoving = false;

    if (!selectedBall) return; // æ²¡ç”¨é€‰ä¸­çƒ

    //console.log(">>>> isChgPosFinished=" + selectedBall.isChgPosFinished);
    //if (selectedBall) console.log(">>>> isBallReady=" + isBallReady(selectedBall));
    if (selectedBall.isChgPosFinished && isBallReady(selectedBall)) {
        console.log(">>>> doClick is readying >>>>");
        // é‡ç½®æ‹–åŠ¨æ ‡è¯†
        selectedBall.isChgPosFinished = false;
        //if (userConfig.isJustTrying) return; // åªç„å‡†ä¸æ‰“
        // è®¾ç½®èµ·ç‚¹
        //selectedBall.x0 = selectedBall.x;
        //selectedBall.y0 = selectedBall.y;
        selectedBall.preCollided = { x: selectedBall.x, y: selectedBall.y };
        selectedBall.prePoint = { x: selectedBall.x, y: selectedBall.y };
        // æ›´æ–°ä¸»çƒç§»åŠ¨ä½ç½®åæ ‡
        oldBallPos.x = selectedBall.x;
        oldBallPos.y = selectedBall.y;
        // å¤‡ä»½åŸå§‹ä½ç½®åæ ‡
        setBallsPosBack(true);
        // åˆå§‹åŒ–åŒå­åˆ†èº«
        if (selectedBall.isMainBall && selectedBall.roleId === Role.SHUANGZI.id) doTwins(selectedBall);
        // é‡ç½®è§’è‰²å­—æ®µå±æ€§å€¼
        resetRoleField();
        // ç„å‡†æ¾æ‰‹å¼€æ‰“ä¹‹å‰ï¼Œå†æ¬¡æ›´æ–°é€Ÿåº¦ï¼Œé¿å…ç„å‡†çœ‹åˆ°çš„è·Ÿå®é™…æ‰“çš„æ–¹å‘å› ä¸ºæ‰‹æŠ–å¯¼è‡´åå·®
        if (tryMoveBallFirstCollidedPos.x > 0 && tryMoveBallFirstCollidedPos.y > 0)
            getVxVy(tryMoveBallFirstCollidedPos, { x: selectedBall.x, y: selectedBall.y }, null, selectedBall);
        // æ¸…ç©ºselectedBallåå¼€å§‹è¿åŠ¨
        if (!userConfig.isJustTrying) {
            selectedBall.draw();
            selectedBall.update();
        }
        selectedBall = null;
        // é‡ç½®tryMoveBall
        resetTryMoveBall();
        // é‡ç½®æ˜¯å¦æ‰¾åˆ°ç¬¬ä¸€æ¬¡æ’å‡»ç‚¹æ ‡è¯†
        isFirstCollidedPointFounded = false;
        // é‡æ–°æ¸²æŸ“
        if (!isPlaying) animate();
        // å¼€å§‹è¿åŠ¨ï¼Œç½®é¡¶é®ç½©ï¼Œé¿å…è¯¯ç¢°
        changeCanvasIndex(gameMaskCanvas, 2);
        // è¶…æ—¶è‡ªåŠ¨åœæ­¢
        autoStopTimeout();
        // é‡ç½®å„ä¸ªå°çƒçš„ç¢°æ’æ ‡å¿—ä½
        setBallCollidingNos();
        // é‡ç½®å‚€å„¡æ‹‰å›æ ‡å¿—
        isKuileiPulling = false;
        // åªç„å‡†ä¸æ‰“
        if (userConfig.isJustTrying) doJustTrying();
    }
    // åˆ¤æ–­çƒä½ç½®æ˜¯å¦æ”¹åŠ¨
    if (isBallMoved(selectedBall)) { // æ‹–åŠ¨å®Œæˆ
        if (selectedBall.isMainBall) selectedBall.isChgPosFinished = true; // ä¸»çƒæ‰ä¼šæœ‰æ‹–åŠ¨å®Œæˆï¼Œä¼šå‘å°„ï¼Œå‘å°„åæ‰å¯ä»¥å†æ¬¡æ‹–åŠ¨
        if (!selectedBall.isMainBall) selectedBall = null; // éä¸»çƒæ‹–åŠ¨å®Œæˆåï¼Œä¸å‘å°„ï¼Œå¯ä»¥å¤šæ¬¡æ‹–åŠ¨
        // è‡ªåŠ¨éšè—åæ ‡æ¡
        rolePosLineTimer = setTimeout(() => { rolePosLine.style.display = 'none' }, 3000);
    }
}


// åŒå‡»åå¤„ç†é€»è¾‘ã€ç§»åŠ¨ç«¯åŒå‡»è¿˜æœ‰ç‚¹é—®é¢˜ã€‘
function doDbClick(e) {
    // ä¸‰è¿å‡»è®¡æ•°
    //preTripleClick(e, true);
    // åŒå‡»ä¸»çƒï¼Œå…æ‹–åŠ¨ï¼Œç›´æ¥å¼€æ‰“
    directPlayAgain(true);
}


// ä¸‰è¿å‡»ï¼Œä¸ç”¨å¤ªå¿«ç‚¹ã€ä¸ç¨³å®šï¼Œä¼šè§¦å‘å•å‡»ã€åŒå‡»çš„äº‹ä»¶ï¼Œå¯¼è‡´åŠŸèƒ½æ··ä¹±ã€‘
let tripleClick = 0;
let tripleClickTimer = 0;
function doTripleClick(e) {
    //alert(">>>> ä¸‰è¿å‡»");
    // æ‰€æœ‰è§’è‰²é‡æ–°è®¾ç½®éšæœºä½ç½®
    putAllBallsRandom();
    // é‡æ–°æ¸²æŸ“
    isAnimated = false;
    if (!isPlaying) animate();
}


// ä¸‰è¿å‡»å‡†å¤‡
function preTripleClick(e, isDbClick) {
    if (isDbClick) tripleClick += 2;
    else tripleClick += 1;
    if (tripleClick >= 4) { // TODO ç›®å‰åŒå‡»äº‹ä»¶ä¼šå¤šå‡ºä¸€æ¬¡å•å‡»
        tripleClickTimer && clearTimeout(tripleClickTimer);
        tripleClick = 0;
        tripleClickTimer = 0;
        doTripleClick(e);
        return;
    }
    tripleClickTimer && clearTimeout(tripleClickTimer);
    tripleClickTimer = setTimeout(() => {
        tripleClickTimer && clearTimeout(tripleClickTimer);
        tripleClick = 0;
        tripleClickTimer = 0;
    }, 500);
}


// é•¿æŒ‰å¤„ç†
function doLongPress(e) {
    //console.log(e);
    if (!userConfig.isLongPressRandom) return;
    // ç§»åŠ¨ç«¯ç›®å‰åªæ”¯æŒå•ç‚¹è§¦ç¢°
    if (!os.isPc && currTouchPointNum !== 1) return;
    // æŒ‰è§’è‰²ä¸é‡ç½®ï¼Œåªèƒ½æŒ‰ç©ºç™½åŒºåŸŸ
    if (isBallsSelected(balls)) return;
    //alert(">>>> é•¿æŒ‰");
    // æ‰€æœ‰è§’è‰²é‡æ–°è®¾ç½®éšæœºä½ç½®
    putAllBallsRandom();
    // é€‰ä¸­ä¸»çƒ
    selectMainBall();
    // è¿˜åŸtryMoveBallåŠå¾„
    preTryMoveBall(0);
    // é‡ç½®tryMoveBallé€Ÿåº¦çŠ¶æ€
    resetTryMoveBall();
    // ä¸»çƒé€Ÿåº¦é‡ç½®
    selectedBall.vx = 0;
    selectedBall.vy = 0;
    selectedBall.isMoving = false;
    // æ ‡è®°ä¸»çƒæœªç§»åŠ¨å®Œæˆã€è¿™é‡Œå¿…é¡»æ”¾åœ¨onMouseMoveä¹‹å‰ã€‘
    selectedBall.isChgPosFinished = false;
    // æ¨¡æ‹Ÿæ‹–åŠ¨ï¼Œé‡æ–°æ¸²æŸ“æ”¹å˜ä½ç½®åçš„ç”»é¢
    onMouseMove(true);
    // ä¸é€‰ä¸­ä¸»çƒ
    selectedBall = null;
    // é˜»æ–­åç»­äº‹ä»¶
    doEventDefault(e);
    // è§’è‰²åæ ‡å…³é—­
    rolePosLine.style.display = "none";
}


// å¤„ç†äº‹ä»¶å†’æ³¡å’Œé»˜è®¤è¡Œä¸º
function doEventDefault(e) {
    e = e || window.event;
    if (!e) return;

    //console.log(">>>> doEventDefault ", e);
    // æ‰“å°è°ƒç”¨å †æ ˆ
    //if (!isProd()) printStack();

    // é˜»æ­¢äº‹ä»¶å†’æ³¡ï¼Œä½†ä¸ä¼šé˜»æ­¢æµè§ˆå™¨é»˜è®¤è¡Œä¸º
    if (e.stopPropagation) { // éIE
        e.stopPropagation();
    } else { // IE
        e.cacelBubble = true;
    }

    let ele = e.target;
    if (ele && ele.tagName && ele.tagName.toLowerCase() === "a") return;

    // é˜»æ­¢æµè§ˆå™¨é»˜è®¤è¡Œä¸º
    if (e.preventDefault) { // éIE
        if (e.cancelable) e.preventDefault();
    } else { // IE
        e.returnValue = false;
    }
}


// åˆ¤æ–­çƒä½ç½®æ˜¯å¦æ”¹åŠ¨
function isBallMoved(ball) {
    if (!ball) return false;
    if (ball.x != oldBallPos.x || ball.y != oldBallPos.y) {
        // æ‹–åŠ¨å®Œæˆ
        return true;
    }
    return false;
}


// å°çƒæ˜¯å¦å‡†å¤‡å°±ç»ªï¼Œvxã€vy ä¸ä¸ºé›¶
function isBallReady(ball) {
    if (!ball) return false;
    if (ball.vx !== 0 || ball.vy !== 0) {
        // é€Ÿåº¦å‡†å¤‡å°±ç»ª
        return true;
    }
    return false;
}


// åˆ¤æ–­é¼ æ ‡æ˜¯å¦ç‚¹å‡»äº†å°çƒ
function isBallSelected(ball, pos) {
    // é€šè¿‡é¼ æ ‡ä½ç½®åˆ°åœ†å¿ƒçš„è·ç¦»åˆ¤æ–­
    //console.log(">>>> mouse.x=" + mouse.x + ", mouse.y=" + mouse.y);
    //console.log(">>>> ball.x=" + ball.x + ", ball.y=" + ball.y);
    let d;
    if (pos) d = getDistanceOf2Points({ x: pos.x, y: pos.y }, { x: ball.x, y: ball.y });
    else d = getDistanceOf2Points({ x: mouse.x, y: mouse.y }, { x: ball.x, y: ball.y });
    //console.log(">>>> isBallSelected d=" + d);
    if (d <= ball.radius) return true;
    return false;
}


// åˆ¤æ–­é¼ æ ‡æ˜¯å¦æŒ¨åˆ°äº†ä»»æ„ä¸€ä¸ªå°çƒ
function isBallsSelected(checkBalls, pos) {
    if (!checkBalls || checkBalls.length < 1) return false;
    let ball;
    for (let i = 0, len = checkBalls.length; i < len; i++) {
        ball = checkBalls[i];
        let d;
        if (pos) d = getDistanceOf2Points({ x: pos.x, y: pos.y }, { x: ball.x, y: ball.y });
        else d = getDistanceOf2Points({ x: mouse.x, y: mouse.y }, { x: ball.x, y: ball.y });
        //console.log(">>>> isBallSelected d=" + d);
        if (d <= ball.radius) return true;
    }
    return false;
}


// é€‰ä¸­ä¸»çƒï¼Œåªæ”¯æŒä¸€ä¸ªä¸»çƒ
function selectMainBall() {
    let mainBall = balls[0];
    selectedBall = mainBall;
    //oldBallPos.x = mainBall.x;
    //oldBallPos.y = mainBall.y;
}


// å¤„ç†åªç„å‡†ä¸æ‰“äº‹å®œ
function doJustTrying() {
    if (!userConfig.isJustTrying) return;
    if (!balls || balls.length < 1) return;
    let selectedBall = balls[0];
    selectedBall.vx = 0;
    selectedBall.vy = 0;
    // è¿˜åŸ tryMoveBall
    preTryMoveBall(0);
    doAfterBallStopped(balls);
    // æ‰‹åŠ¨åç§»ä¸€ç‚¹ç‚¹ä½ç½®åæ ‡ï¼Œå¥½è®©è§’è‰²é‡æ–°æ¸²æŸ“
    selectedBall.y -= 0.0000000001;
}


// æ‰“å®Œä¸€æ¬¡åï¼Œå…æ‹–åŠ¨ï¼Œã€åŸä½ç½®ã€‘å†æ¬¡å¼€æ‰“
function directPlayAgain(isChgPosFinished) {
    if (!userConfig.isDbclickBack) return;
    if (selectedBall && selectedBall.isChgPosFinished) return;
    if (checkIsMoving()) return; // è§£å†³å¤šç‚¹è§¦ç¢°ï¼Œå•å‡»å¼€æ‰“ååˆè§¦å‘åŒå‡»é‡ç½®ï¼Œå¯¼è‡´æ— é™å¾ªç¯
    // è·å–ç‚¹å‡»åæ ‡
    let pos = clickPos;
    // æ˜¯å¦ç‚¹å‡»äº†ä¸»çƒã€ç§»åŠ¨ç«¯å¯èƒ½ç‚¹ä¸å‡†ã€‘
    //if (!isBallSelected(balls[0], pos)) return;
    console.log(">>>> directPlayAgain >>>>");
    // é€‰ä¸­ä¸»çƒ
    selectMainBall();
    // è¿˜åŸåŸå§‹ä½ç½®åæ ‡
    setBallsPosBack(false);
    // æ¨¡æ‹Ÿæ‹–åŠ¨
    onMouseMove(true);
    // é‡ç”»ä¸€æ¬¡
    //selectedBall.draw();
    // æ ‡è®°ä¸»çƒç§»åŠ¨å®Œæˆ
    selectedBall.isChgPosFinished = isChgPosFinished;
    // é‡æ–°æ¸²æŸ“
    //isAnimated = false;
    //if (!isPlaying) animate();
    // è§’è‰²åæ ‡å…³é—­
    rolePosLine.style.display = "none";
}


//////////////////////////////////////////////////////////////////////

</script>
